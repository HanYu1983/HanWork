System.register([],(function(e,t){"use strict";return{execute:async function(){e({A:void 0,B:void 0,E:void 0,F:void 0,G:void 0,K:void 0,L:void 0,S:void 0,T:void 0,_:$,a2:void 0,a8:Us,a9:Ba,aB:me,aC:_e,aD:function(){},aJ:ae,aK:ie,aO:se,aP:void 0,aQ:is,aU:function(e,t,n,i,r){void 0===n&&(n=Jo.R32F),void 0===i&&(i=0),void 0===r&&(r=0);var o=Fa[n];r||(r=o.size);for(var a="set"+FA(o),s=o.size/o.count,c=Math.floor(t.length/o.count),l=Rv.isLittleEndian,u=0;u<c;++u)for(var h=i+r*u,_=0;_<o.count;++_){var f=h+s*_;e[a](f,t[o.count*u+_],l)}},aV:void 0,aW:_b,aX:zA,aZ:xt,a_:function(e){return Eh(Ah({formerlySerializedAs:e}))},ac:void 0,ad:oe,ag:void 0,ai:void 0,al:void 0,an:Ha,ao:I,ap:g,at:void 0,au:function(e,t,n,i,r,o){void 0===t&&(t=Jo.R32F),void 0===n&&(n=0),void 0===i&&(i=e.byteLength-n),void 0===r&&(r=0),void 0===o&&(o=[]);var a=Fa[t];r||(r=a.size);for(var s="get"+FA(a),c=a.size/a.count,l=Math.floor(i/r),u=Rv.isLittleEndian,h=0;h<l;++h)for(var _=n+r*h,f=0;f<a.count;++f){var m=_+c*f;o[a.count*h+f]=e[s](m,u)}return o},av:function(){},b:ZN,b$:void 0,b0:qh,b2:void 0,bA:VM,bB:kM,bD:void 0,bF:void 0,bL:void 0,bM:void 0,bT:ke,bV:H,bW:$e,bd:void 0,be:void 0,bh:void 0,bs:Tn,bt:rf,bu:void 0,bw:function(e,t,n){for(ei.identity(n);e!==t;)ei.fromRTS(QM,e.rotation,e.position,e.scale),ei.multiply(n,QM,n),e=e.parent;return n},bz:jM,c$:wn,c1:void 0,c2:void 0,c3:Tt,c4:void 0,cE:Sn,cH:Mt,cM:En,cT:An,cX:void 0,cY:Pn,cZ:bn,cb:xn,cj:void 0,cp:void 0,cs:zt,ct:Je,cu:C,cw:void 0,cz:void 0,d0:In,d1:he,d3:Mn,d5:kE,d7:gn,d9:D_,dA:void 0,dB:_n,dE:ht,dK:si,dL:kn,dM:li,dN:Jn,dQ:_i,dR:mi,dS:Bn,dU:yn,dV:Rn,dW:On,dX:Nn,dY:Dn,dZ:Ln,d_:yt,dc:Fn,dd:Ie,de:ne,df:be,dg:Eh,dj:Bt,dk:Ut,dl:M,dn:q,dp:v,dq:aR,dr:ii,dw:w_,e:aP,e4:function(e){e>0&&(Se=e)},e5:void 0,e6:OT,e7:NT,eD:void 0,eF:void 0,eG:void 0,eH:void 0,eI:void 0,eJ:void 0,eK:void 0,eL:void 0,eM:void 0,ea:Ff,en:x,eo:P,ep:D,eq:L,er:void 0,fB:tD,fC:nD,fD:iD,fE:wP,fF:MP,fJ:FP,fK:zP,fN:function(e,t){for(var n=e,i="";null!==n&&n!==t;)i=n.name+"/"+i,n=n.parent;return i.slice(0,-1)},fP:hD,i:QN,l:Z,o:void 0,q:void 0,r:R,t:za,u:void 0,v:void 0,w:y,x:void 0,y:void 0,z:void 0});const n=e("af",!1),i=e("cW",!1),r=e("cL",!1),o=e("cJ",!1),a=e("cK",!1);var s="undefined"==typeof window?global:window,c=e("as",{_global:s});c.internal={},s.CC_BUILD=!0,s.CC_TEST=!1,s.CC_EDITOR=i,s.CC_PREVIEW=!1,s.CC_DEV=!1,s.CC_DEBUG=!1,s.CC_JSB=a,s.CC_BYTEDANCE=!1,s.CC_WECHAT=n,s.CC_ALIPAY=!1,s.CC_XIAOMI=!1,s.CC_BAIDU=!1,s.CC_COCOSPLAY=!1,s.CC_HUAWEI=!1,s.CC_OPPO=!1,s.CC_VIVO=!1,s.CC_MINIGAME=o,s.CC_RUNTIME_BASED=r,s.CC_SUPPORT_JIT=!0;var l=e("dt","3.0.0");s.CocosEngine=c.ENGINE_VERSION=l,s.cc=c;var u="https://github.com/cocos-creator/engine/blob/3d/EngineErrorMap.md",h=null,_=console.log.bind(console),f=_,m=_,d=function(e,t){if(!e){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];console.log("ASSERT: "+p.apply(void 0,[t].concat(i)))}};function p(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return c.js.formatStr.apply(null,[e].concat(n))}function v(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return _.apply(void 0,[e].concat(n))}function g(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return f.apply(void 0,[e].concat(n))}function y(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return m.apply(void 0,[e].concat(n))}function x(e,t){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return d.apply(void 0,[e,t].concat(i))}function E(e){if(_=f=m=d=function(){},e!==O.NONE){if(e>O.ERROR){var t=function(e){if(c.game.canvas){if(!h){var t=document.createElement("Div");t.setAttribute("id","logInfoDiv"),t.setAttribute("width","200"),t.setAttribute("height",c.game.canvas.height);var n=t.style;n.zIndex="99999",n.position="absolute",n.top=n.left="0",(h=document.createElement("textarea")).setAttribute("rows","20"),h.setAttribute("cols","30"),h.setAttribute("disabled","true");var i=h.style;i.backgroundColor="transparent",i.borderBottom="1px solid #cccccc",i.borderTopWidth=i.borderLeftWidth=i.borderRightWidth="0px",i.borderTopStyle=i.borderLeftStyle=i.borderRightStyle="none",i.padding="0px",i.margin="0px",t.appendChild(h),c.game.canvas.parentNode.appendChild(t)}h.value=h.value+e+"\r\n",h.scrollTop=h.scrollHeight}};m=function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];t("ERROR :  "+p.apply(void 0,[e].concat(i)))},d=function(e,n){if(!e){for(var i=arguments.length,r=new Array(i>2?i-2:0),o=2;o<i;o++)r[o-2]=arguments[o];t("ASSERT: "+p.apply(void 0,[n].concat(r)))}},e!==O.ERROR_FOR_WEB_PAGE&&(f=function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];t("WARN :  "+p.apply(void 0,[e].concat(i)))}),e===O.INFO_FOR_WEB_PAGE&&(_=function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];t(p.apply(void 0,[e].concat(i)))})}else console&&console.log.apply&&(console.error||(console.error=console.log),console.warn||(console.warn=console.log),m=console.error.bind?console.error.bind(console):function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return console.error.apply(console,[e].concat(n))},d=function(e,t){if(!e){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];var o=p.apply(void 0,[t].concat(i));throw new Error(o)}});e!==O.ERROR&&(f=console.warn.bind?console.warn.bind(console):function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return console.warn.apply(console,[e].concat(n))}),e===O.INFO&&(_=console.log.bind?console.log.bind(console):function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return console.log.apply(console,[e].concat(n))})}}function S(e){y(e.stack||e)}function T(e){return function(t){for(var n=e+" "+t+", please go to "+u+"#"+t+" to see details.",i=arguments.length,r=new Array(i>1?i-1:0),o=1;o<i;o++)r[o-1]=arguments[o];return 0===r.length?n:n+" Arguments: "+r.join(", ")}}var A=T("Log");function C(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];v(A.apply(void 0,[e].concat(n)))}var w=T("Warning");function I(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];g(w.apply(void 0,[e].concat(n)))}var b=T("Error");function R(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];y(b.apply(void 0,[e].concat(n)))}var O,N=T("Assert");function P(e,t){if(!e){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];x(!1,N.apply(void 0,[t].concat(i)))}}function M(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return b.apply(void 0,[e].concat(n))}function D(){return!!c.profiler&&c.profiler.isShowingStats()}function L(e){c.profiler&&(e?c.profiler.showStats():c.profiler.hideStats(),c.game.config.showFPS=!!e)}!function(e){e[e.NONE=0]="NONE",e[e.INFO=1]="INFO",e[e.WARN=2]="WARN",e[e.ERROR=3]="ERROR",e[e.INFO_FOR_WEB_PAGE=4]="INFO_FOR_WEB_PAGE",e[e.WARN_FOR_WEB_PAGE=5]="WARN_FOR_WEB_PAGE",e[e.ERROR_FOR_WEB_PAGE=6]="ERROR_FOR_WEB_PAGE"}(O||(O=e("er",{})));var F=Object.freeze({__proto__:null,log:v,warn:g,error:y,assert:x,_resetDebugSetting:E,_throw:S,logID:C,warnID:I,errorID:R,assertID:P,get DebugMode(){return O},getError:M,isDisplayStats:D,setDisplayStats:L}),z=/(\.[^\.\/\?\\]*)(\?.*)?$/,B=/((.*)(\/|\\|\\\\))?(.*?\..*$)?/,U=/[^\.\/]+\/\.\.\//;function G(){for(var e="",t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];for(var r=0,o=n;r<o.length;r++){var a=o[r];e=(e+(""===e?"":"/")+a).replace(/(\/|\\\\)$/,"")}return e}function H(e){var t=z.exec(e);return t?t[1]:""}function k(e){if(e){var t=e.lastIndexOf(".");if(-1!==t)return e.substring(0,t)}return e}function V(e,t){var n=e.indexOf("?");n>0&&(e=e.substring(0,n));var i=/(\/|\\)([^\/\\]+)$/g.exec(e.replace(/(\/|\\)$/,""));if(!i)return e;var r=i[2];return t&&e.substring(e.length-t.length).toLowerCase()===t.toLowerCase()?r.substring(0,r.length-t.length):r}function j(e){var t=B.exec(e);return t?t[2]:""}function W(e,t){t=t||"";var n=e.indexOf("?"),i="";return n>0&&(i=e.substring(n),e=e.substring(0,n)),(n=e.lastIndexOf("."))<0?e+t+i:e.substring(0,n)+t+i}function q(e,t,n){if(0===t.indexOf("."))return W(e,t);var i=e.indexOf("?"),r="",o=n?H(e):"";return i>0&&(r=e.substring(i),e=e.substring(0,i)),i=(i=e.lastIndexOf("/"))<=0?0:i+1,e.substring(0,i)+t+o+r}function Y(e){var t=e=String(e);do{t=e,e=e.replace(U,"")}while(t.length!==e.length);return e}function X(e){return e.replace(/[\/\\]$/,"")}function K(){return c.sys.os===c.sys.OS_WINDOWS?"\\":"/"}function Q(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Z(e,t,n){return t&&Q(e.prototype,t),n&&Q(e,n),e}function J(){return(J=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}function $(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function ee(e,t){return(ee=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function te(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function ne(t,n,i){return(ne=te()?e("de",Reflect.construct):e("de",(function(e,t,n){var i=[null];i.push.apply(i,t);var r=new(Function.bind.apply(e,i));return n&&ee(r,n.prototype),r}))).apply(null,arguments)}function ie(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function re(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function oe(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e){if(e){if("string"==typeof e)return re(e,void 0);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?re(e,void 0):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function ae(e,t,n,i){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(i):void 0})}function se(e,t,n,i,r){var o={};return Object.keys(i).forEach((function(e){o[e]=i[e]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=n.slice().reverse().reduce((function(n,i){return i(e,t,n)||n}),o),r&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(r):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}e("e2",Object.freeze({__proto__:null,join:G,extname:H,mainFileName:k,basename:V,dirname:j,changeExtname:W,changeBasename:q,_normalize:Y,stripSep:X,getSeperator:K})),c.log=v,c.warn=g,c.error=y,c.assert=x,c._throw=S,c.logID=C,c.warnID=I,c.errorID=R,c.assertID=P,c.debug=F,c.path={join:G,extname:H,mainFileName:k,basename:V,dirname:j,changeExtname:W,changeBasename:q,_normalize:Y,stripSep:X,get sep(){return K()}};var ce=0,le={},ue=e("d4",2147483647);function he(e){return(e>0)-(e<0)}function _e(e){var t,n;return t=(e>65535)<<4,t|=n=((e>>>=t)>255)<<3,t|=n=((e>>>=n)>15)<<2,(t|=n=((e>>>=n)>3)<<1)|(e>>>=n)>>1}function fe(e){var t=32;return(e&=-e)&&t--,65535&e&&(t-=16),16711935&e&&(t-=8),252645135&e&&(t-=4),858993459&e&&(t-=2),1431655765&e&&(t-=1),t}function me(e){return e+=0===e,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,1+(e|=e>>>16)}var de=new Array(256);!function(e){for(var t=0;t<256;++t){var n=t,i=t,r=7;for(n>>>=1;n;n>>>=1)i<<=1,i|=1&n,--r;e[t]=i<<r&255}}(de);var pe=Object.freeze({__proto__:null,INT_BITS:32,INT_MAX:ue,INT_MIN:-1<<31,sign:he,abs:function(e){var t=e>>31;return(e^t)-t},min:function(e,t){return t^(e^t)&-(e<t)},max:function(e,t){return e^(e^t)&-(e<t)},isPow2:function(e){return!(e&e-1||!e)},log2:_e,log10:function(e){return e>=1e9?9:e>=1e8?8:e>=1e7?7:e>=1e6?6:e>=1e5?5:e>=1e4?4:e>=1e3?3:e>=100?2:e>=10?1:0},popCount:function(e){return 16843009*((e=(858993459&(e-=e>>>1&1431655765))+(e>>>2&858993459))+(e>>>4)&252645135)>>>24},countTrailingZeros:fe,nextPow2:me,prevPow2:function(e){return e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)-(e>>>1)},parity:function(e){return e^=e>>>16,e^=e>>>8,e^=e>>>4,27030>>>(e&=15)&1},reverse:function(e){return de[255&e]<<24|de[e>>>8&255]<<16|de[e>>>16&255]<<8|de[e>>>24&255]},interleave2:function(e,t){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e&=65535)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t&=65535)|t<<8))|t<<4))|t<<2))|t<<1))<<1},deinterleave2:function(e,t){return(e=65535&((e=16711935&((e=252645135&((e=858993459&((e=e>>>t&1431655765)|e>>>1))|e>>>2))|e>>>4))|e>>>16))<<16>>16},interleave3:function(e,t,n){return e=1227133513&((e=3272356035&((e=251719695&((e=4278190335&((e&=1023)|e<<16))|e<<8))|e<<4))|e<<2),(e|=(t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&((t&=1023)|t<<16))|t<<8))|t<<4))|t<<2))<<1)|(n=1227133513&((n=3272356035&((n=251719695&((n=4278190335&((n&=1023)|n<<16))|n<<8))|n<<4))|n<<2))<<2},deinterleave3:function(e,t){return(e=1023&((e=4278190335&((e=251719695&((e=3272356035&((e=e>>>t&1227133513)|e>>>2))|e>>>4))|e>>>8))|e>>>16))<<22>>22},nextCombination:function(e){var t=e|e-1;return t+1|(~t&-~t)-1>>>fe(e)+1}});e("dJ",pe);var ve,ge,ye,xe,Ee,Se=10,Te=0,Ae=new Map;ye=function(e,t,n,i,r,o){var a=Ae.get(o);a&&a.logTimes>a.count&&(r("'%s' is deprecated, please use '%s' instead.",e+"."+t,n+"."+i),a.count++)},ve=e("bd",(function(e,t,n){null!=e&&n.forEach((function(n){var i=Te++;Ae.set(i,{id:i,count:0,logTimes:void 0!==n.logTimes?n.logTimes:Se});var r=null!=n.target?n.target:e,o=null!=n.newName?n.newName:n.name,a=null!=n.targetName?n.targetName:t,s=r==e;if(null!=n.customFunction)e[n.name]=function(){var e;return ye(t,n.name,a,o,g,i),(e=n.customFunction).call.apply(e,[this].concat(Array.prototype.slice.call(arguments)))};else if(null!=n.customSetter||null!=n.customGetter){var c=null!=n.customSetter,l=null!=n.customGetter;c&&l?Object.defineProperty(e,n.name,{get:function(){return ye(t,n.name,a,o,g,i),n.customGetter.call(this)},set:function(e){ye(t,n.name,a,o,g,i),n.customSetter.call(this,e)},enumerable:!1}):c?Object.defineProperty(e,n.name,{set:function(e){ye(t,n.name,a,o,g,i),n.customSetter.call(this,e)},enumerable:!1}):l&&Object.defineProperty(e,n.name,{get:function(){return ye(t,n.name,a,o,g,i),n.customGetter.call(this)},enumerable:!1})}else Object.defineProperty(e,n.name,{get:function(){return ye(t,n.name,a,o,g,i),s?this[o]:r[o]},set:function(e){ye(t,n.name,a,o,g,i),s?this[o]=e:r[o]=e},enumerable:!1})}))})),Ee=function(e,t,n,i,r){var o=Ae.get(i),a=void 0===r?"":"("+r+")";o&&o.logTimes>o.count&&(n("'%s' has been removed. "+a,e+"."+t),o.count++)},ge=e("be",(function(e,t,n){null!=e&&n.forEach((function(n){var i=Te++;Ae.set(i,{id:i,count:0,logTimes:void 0!==n.logTimes?n.logTimes:Se}),Object.defineProperty(e,n.name,{get:function(){return Ee(t,n.name,y,i,n.suggest)},set:function(){Ee(t,n.name,y,i,n.suggest)},enumerable:!1})}))})),xe=function(e,t,n,i,r){var o=Ae.get(i),a=void 0===r?"":"("+r+")";o&&o.logTimes>o.count&&(n("'%s' is deprecated. "+a,e+"."+t),o.count++)},e("e5",(function(e,t,n){if(null!=e){var i=function(e,t,n,i,r,o){if(e.get){var a=e.get();e.get=function(){return xe(t,n,i,r,o),a.call(this)}}if(e.set){var s=Object.create(e.set);e.set=function(e){xe(t,n,i,r,o),s.call(this,e)}}};n.forEach((function(n){var r=n.name,o=Object.getOwnPropertyDescriptor(e,r);if(o){var a=Te++;if(Ae.set(a,{id:a,count:0,logTimes:void 0!==n.logTimes?n.logTimes:Se}),null!=o.value)if("function"==typeof o.value){var s=o.value;e[r]=function(){return xe(t,r,g,a,n.suggest),s.call.apply(s,[this].concat(Array.prototype.slice.call(arguments)))}}else i(o,t,r,g,a,n.suggest);else i(o,t,r,g,a,n.suggest);Object.defineProperty(e,r,{enumerable:!1})}}))}}));var Ce=function(){function e(e){this.i=0,this.array=e}var t=e.prototype;return t.remove=function(e){var t=this.array.indexOf(e);t>=0&&this.removeAt(t)},t.removeAt=function(e){this.array.splice(e,1),e<=this.i&&--this.i},t.fastRemove=function(e){var t=this.array.indexOf(e);t>=0&&this.fastRemoveAt(t)},t.fastRemoveAt=function(e){var t=this.array;t[e]=t[t.length-1],--t.length,e<=this.i&&--this.i},t.push=function(e){this.array.push(e)},Z(e,[{key:"length",get:function(){return this.array.length},set:function(e){this.array.length=e,this.i>=e&&(this.i=e-1)}}]),e}();function we(e,t){e.splice(t,1)}function Ie(e,t){var n=e.length;t<0||t>=n||(e[t]=e[n-1],e.length=n-1)}function be(e,t){var n=e.indexOf(t);return n>=0&&(we(e,n),!0)}function Re(e,t){return e.indexOf(t)>=0}var Oe=Object.freeze({__proto__:null,removeAt:we,fastRemoveAt:Ie,remove:be,fastRemove:function(e,t){var n=e.indexOf(t);n>=0&&(e[n]=e[e.length-1],--e.length)},removeIf:function(e,t){var n=e.findIndex(t);if(n>=0){var i=e[n];return we(e,n),i}},verifyType:function(e,t){if(e&&e.length>0)for(var n,i=oe(e);!(n=i()).done;)if(!(n.value instanceof t))return C(1300),!1;return!0},removeArray:function(e,t){for(var n=0,i=t.length;n<i;n++)be(e,t[n])},appendObjectsAt:function(e,t,n){return e.splice.apply(e,[n,0].concat(t)),e},contains:Re,copy:function(e){for(var t=e.length,n=new Array(t),i=0;i<t;i+=1)n[i]=e[i];return n},MutableForwardIterator:Ce}),Ne=function(){function e(e){this.id=void 0,this.prefix=void 0,this.id=0|998*Math.random(),this.prefix=e?e+".":""}return e.prototype.getNewId=function(){return this.prefix+ ++this.id},e}();Ne.global=new Ne("global");var Pe=new Ne("TmpCId."),Me="undefined"==typeof Symbol?"__aliases__":Symbol("[[Aliases]]");function De(e){return"number"==typeof e||e instanceof Number}function Le(e){return"string"==typeof e||e instanceof String}function Fe(e){for(var t in e)return!1;return!0}var ze,Be=(ze={value:void 0,enumerable:!1,writable:!1,configurable:!0},function(e,t,n,i,r){ze.value=n,ze.writable=i,ze.enumerable=r,Object.defineProperty(e,t,ze),ze.value=void 0}),Ue=function(){var e={get:void 0,set:void 0,enumerable:!1};return function(t,n,i,r,o,a){void 0===o&&(o=!1),void 0===a&&(a=!1),"boolean"==typeof r&&(o=r,r=void 0),e.get=i,e.set=r,e.enumerable=o,e.configurable=a,Object.defineProperty(t,n,e),e.get=void 0,e.set=void 0}}(),Ge=function(){var e={get:void 0,enumerable:!1,configurable:!1};return function(t,n,i,r,o){e.get=i,e.enumerable=r,e.configurable=o,Object.defineProperty(t,n,e),e.get=void 0}}(),He=function(){var e={set:void 0,enumerable:!1,configurable:!1};return function(t,n,i,r,o){e.set=i,e.enumerable=r,e.configurable=o,Object.defineProperty(t,n,e),e.set=void 0}}();function ke(e){var t=Object.create(null);return e&&(t["."]=1,t["/"]=1,delete t["."],delete t["/"]),t}function Ve(e){if("function"==typeof e){var t=e.prototype;if(t&&t.hasOwnProperty("__classname__")&&t.__classname__)return t.__classname__;var n="";if(e.name&&(n=e.name),e.toString){var i,r=e.toString();(i="["===r.charAt(0)?r.match(/\[\w+\s*(\w+)\]/):r.match(/function\s*(\w+)/))&&2===i.length&&(n=i[1])}return"Object"!==n?n:""}return e&&e.constructor?Ve(e.constructor):""}function je(e,t,n,i){var r=/([^.]+)$/,o=r.exec(t)[0],a=r.exec(n)[0];function s(){return this[a]}i?Ue(e,o,s,(function(e){this[a]=e})):Ge(e,o,s)}function We(e,t,n,i){for(var r in n)je(e,t+"."+r,n[r],i)}var qe=/(%d)|(%s)/,Ye=/%s/;function Xe(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];if(0===arguments.length)return"";if(0===n.length)return""+e;var r="string"==typeof e&&qe.test(e);if(r)for(var o,a=oe(n);!(o=a()).done;){var s=o.value,c="number"==typeof s?qe:Ye;if(c.test(e)){var l=""+s;e=e.replace(c,l)}else e+=" "+s}else for(var u,h=oe(n);!(u=h()).done;){var _=u.value;e+=" "+_}return e}function Ke(){for(var e=arguments.length-1,t=new Array(e),n=0;n<e;++n)t[n]=arguments[n+1];return t}function Qe(e,t){for(;e;){var n=Object.getOwnPropertyDescriptor(e,t);if(n)return n;e=Object.getPrototypeOf(e)}return null}function Ze(e,t,n){var i=Qe(t,e);i&&Object.defineProperty(n,e,i)}function Je(e){e=e||{};for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];for(var r=0,o=n;r<o.length;r++){var a=o[r];if(a){if("object"!=typeof a){R(5402,a);continue}for(var s in a)s in e||Ze(s,a,e)}}return e}function $e(e){e=e||{};for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];for(var r=0,o=n;r<o.length;r++){var a=o[r];if(a){if("object"!=typeof a){R(5403,a);continue}for(var s in a)Ze(s,a,e)}}return e}function et(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e.prototype=Object.create(t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),e}function tt(e){var t=e.prototype,n=t&&Object.getPrototypeOf(t);return n&&n.constructor}function nt(e,t){if(e&&t){if("function"!=typeof e)return!1;if("function"!=typeof t)return!1;if(e===t)return!0;for(;;){if(!(e=tt(e)))return!1;if(e===t)return!0}}return!1}function it(e){for(var t=0,n=Object.keys(e);t<n.length;t++)delete e[n[t]]}function rt(e){return"string"!=typeof e||e.startsWith(Pe.prefix)}var ot=ke(!0),at=ke(!0);function st(e,t){return function(n,i){if(i.prototype.hasOwnProperty(e)&&delete t[i.prototype[e]],Be(i.prototype,e,n),n){var r=t[n];r&&r!==i?y("A Class already exists with the same "+e+' : "'+n+'".'):t[n]=i}}}var ct=st("__cid__",ot),lt=st("__classname__",at);function ut(e,t){if(lt(e,t),!t.prototype.hasOwnProperty("__cid__")){var n=e||Pe.getNewId();n&&ct(n,t)}}function ht(e,t){var n=at[t],i=ot[t],r=!0;if(n&&n!==e&&(y('"'+t+'" has already been set as name or alias of another class.'),r=!1),i&&i!==e&&(y('"'+t+'" has already been set as id or alias of another class.'),r=!1),r){var o=e[Me];o||(o=[],e[Me]=o),o.push(t),at[t]=e,ot[t]=e}}function _t(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var i=0,r=t;i<r.length;i++){var o=r[i],a=o.prototype,s=a.__cid__;s&&delete ot[s];var c=a.__classname__;c&&delete at[c];var l=a[Me];if(l)for(var u=0;u<l.length;++u){var h=l[u];delete at[h],delete ot[h]}}}function ft(e){return ot[e]}function mt(e){return at[e]}function dt(e,t){var n;if(t=void 0===t||t,"function"==typeof e&&e.prototype.hasOwnProperty("__cid__"))return n=e.prototype.__cid__,!t&&i&&rt(n)?"":n;if(e&&e.constructor){var r=e.constructor.prototype;if(r&&r.hasOwnProperty("__cid__"))return n=e.__cid__,!t&&i&&rt(n)?"":n}return""}var pt=e("bX",function(){var e=t.prototype;function t(e,t){this.count=void 0,this._pool=void 0,this._cleanup=void 0;var n=void 0===t?e:t,i=void 0===t?null:e;this.count=0,this._pool=new Array(n),this._cleanup=i}return e.get=function(){return this._get()},e._get=function(){if(this.count>0){--this.count;var e=this._pool[this.count];return this._pool[this.count]=null,e}return null},e.put=function(e){var t=this._pool;if(this.count<t.length){if(this._cleanup&&!1===this._cleanup(e))return;t[this.count]=e,++this.count}},e.resize=function(e){e>=0&&(this._pool.length=e,this.count>e&&(this.count=e))},t}()),vt=e("cR",Oe),gt=e("bg",{IDGenerator:Ne,Pool:pt,array:Oe,isNumber:De,isString:Le,isEmptyObject:Fe,getPropertyDescriptor:Qe,addon:Je,mixin:$e,extend:et,getSuper:tt,isChildClassOf:nt,clear:it,value:Be,getset:Ue,get:Ge,set:He,unregisterClass:_t,getClassName:Ve,setClassName:ut,setClassAlias:ht,getClassByName:mt,get _registeredClassNames(){return J({},at)},set _registeredClassNames(e){it(at),Object.assign(at,e)},get _registeredClassIds(){return J({},ot)},set _registeredClassIds(e){it(ot),Object.assign(ot,e)},_getClassId:dt,_setClassId:ct,_getClassById:ft,obsolete:je,obsoletes:We,formatStr:Xe,shiftArguments:Ke,createMap:ke});function yt(e){if("__bitmask__"in e)return e;Be(e,"__bitmask__",null,!0);for(var t=-1,n=Object.keys(e),i=0;i<n.length;i++){var r=n[i],o=e[r];if(-1===o)o=++t,e[r]=o;else if("number"==typeof o)t=o;else if("string"==typeof o&&Number.isInteger(parseFloat(r)))continue;var a=""+o;r!==a&&Be(e,a,r)}return e}function xt(e){return"__enums__"in e?e:(Be(e,"__enums__",null,!0),xt.update(e))}function Et(e){e.hasOwnProperty("__enums__")}function St(e){Et(e);var t=e.__enums__||[];for(var n in t.length=0,e){var i=e[n];Number.isInteger(i)&&t.push({name:n,value:i})}return t.sort((function(e,t){return e.value-t.value})),e.__enums__=t,t}function Tt(e){"__enums__"in e||Be(e,"__enums__",null,!0)}c.js=gt,e("e0",Object.freeze({__proto__:null,array:vt,js:gt,IDGenerator:Ne,Pool:pt,isNumber:De,isString:Le,isEmptyObject:Fe,value:Be,getset:Ue,get:Ge,set:He,createMap:ke,getClassName:Ve,obsolete:je,obsoletes:We,formatStr:Xe,shiftArguments:Ke,getPropertyDescriptor:Qe,addon:Je,mixin:$e,extend:et,getSuper:tt,isChildClassOf:nt,clear:it,_idToClass:ot,_nameToClass:at,_setClassId:ct,setClassName:ut,setClassAlias:ht,unregisterClass:_t,_getClassById:ft,getClassByName:mt,_getClassId:dt})),yt.isBitMask=function(e){return e&&e.hasOwnProperty("__bitmask__")},yt.getList=function(e){if(e.__bitmask__)return e.__bitmask__;var t=e.__bitmask__=[];for(var n in e){var i=e[n];Number.isInteger(i)&&t.push({name:n,value:i})}return t.sort((function(e,t){return e.value-t.value})),t},c.BitMask=yt,xt.update=function(e){for(var t=-1,n=Object.keys(e),i=0;i<n.length;i++){var r=n[i],o=e[r];if(-1===o)o=++t,e[r]=o;else if("number"==typeof o)t=o;else if("string"==typeof o&&Number.isInteger(parseFloat(r)))continue;var a=""+o;r!==a&&Be(e,a,r)}return Array.isArray(e.__enums__)&&St(e),e},xt||(xt=e("aZ",{})),xt.isEnum=function(e){return e&&e.hasOwnProperty("__enums__")},xt.getList=function(e){return Et(e),e.__enums__?e.__enums__:St(e)},c.Enum=xt;var At=e("d$",function(){function e(){}var t=e.prototype;return t.clone=function(){return R(100,Ve(this)+".clone"),this},t.equals=function(){return!1},t.set=function(){R(100,Ve(this)+".set")},t.toString=function(){return""+{}},e}());ut("cc.ValueType",At),c.ValueType=At;var Ct=e("ab",{SUPPORT_TEXTURE_FORMATS:[".astc",".pkm",".pvr",".webp",".jpg",".jpeg",".bmp",".png"],KEY:{none:0,back:6,menu:18,backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,select:41,insert:45,Delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,num0:96,num1:97,num2:98,num3:99,num4:100,num5:101,num6:102,num7:103,num8:104,num9:105,"*":106,"+":107,"-":109,numdel:110,"/":111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,";":186,semicolon:186,equal:187,"=":187,",":188,comma:188,dash:189,".":190,period:190,forwardslash:191,grave:192,"[":219,openbracket:219,backslash:220,"]":221,closebracket:221,quote:222,dpadLeft:1e3,dpadRight:1001,dpadUp:1003,dpadDown:1004,dpadCenter:1005},RAD:Math.PI/180,DEG:180/Math.PI,REPEAT_FOREVER:Number.MAX_VALUE-1,FLT_EPSILON:1.192092896e-7,ORIENTATION_PORTRAIT:1,ORIENTATION_LANDSCAPE:2,ORIENTATION_AUTO:3,ENABLE_TILEDMAP_CULLING:!0,TOUCH_TIMEOUT:5e3,ENABLE_TRANSPARENT_CANVAS:!1,ENABLE_WEBGL_ANTIALIAS:!0,CLEANUP_IMAGE_CACHE:!1,ENABLE_MULTI_TOUCH:!0,MAX_LABEL_CANVAS_POOL_SIZE:20});c.macro=Ct;for(var wt=/^(?:cc|dragonBones|sp|ccsg)\..+/,It=new Array(123),bt=0;bt<123;++bt)It[bt]=64;for(var Rt=0;Rt<64;++Rt)It["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charCodeAt(Rt)]=Rt;var Ot=It;function Nt(e,t,n){function i(e,t,n,i){var r=Object.getOwnPropertyDescriptor(e,t);if(r)r.get&&(e[n]=r.get),r.set&&i&&(e[i]=r.set);else{var o=e[n];Ue(e,t,o,e[i])}}for(var r,o=e.prototype,a=0;a<t.length;a++){var s=(r=t[a])[0].toUpperCase()+r.slice(1);i(o,r,"get"+s,"set"+s)}for(r in n){var c=n[r];i(o,r,c[0],c[1])}}function Pt(e,t,n,i){var r=e[t];r?Array.isArray(r)?i?(r.push(r[0]),r[0]=n):r.push(n):e[t]=i?[n,r]:[r,n]:e[t]=n}function Mt(e,t){if("function"==typeof e.contains)return e.contains(t);if("function"==typeof e.compareDocumentPosition)return!!(16&e.compareDocumentPosition(t));var n=t.parentNode;if(n)do{if(n===e)return!0;n=n.parentNode}while(null!==n);return!1}function Dt(e){return"object"==typeof window&&"function"==typeof Node?e instanceof Node:e&&"object"==typeof e&&"number"==typeof e.nodeType&&"string"==typeof e.nodeName}function Lt(e,t,n){e&&setTimeout((function(){e(t,n)}),0)}function Ft(e){return!(!e||e.constructor!==Object)&&Fe(e)}function zt(e,t,n){if(t>n){var i=t;t=n,n=i}return e<t?t:e<n?e:n}function Bt(e){return e*Ct.RAD}function Ut(e){return e*Ct.DEG}function Gt(e,t){var n=t?Object.create(t):{};return Be(e,"__attrs__",n),n}function Ht(e){if("function"!=typeof e)return Gt(e,Vt(e.constructor));for(var t,n=c.Class.getInheritanceChain(e),i=n.length-1;i>=0;i--){var r=n[i];r.hasOwnProperty("__attrs__")&&r.__attrs__||Gt(r,(t=n[i+1])&&t.__attrs__)}return Gt(e,(t=n[0])&&t.__attrs__),e.__attrs__}function kt(e,t){var n=Vt(e),i=t+"$_$",r={};for(var o in n)o.startsWith(i)&&(r[o.slice(i.length)]=n[o]);return r}function Vt(e){return e.hasOwnProperty("__attrs__")&&e.__attrs__||Ht(e)}function jt(e,t,n,i){Vt(e)[t+"$_$"+n]=i}c.misc={BUILTIN_CLASSID_RE:wt,BASE64_VALUES:Ot,propertyDefine:Nt,pushToMap:Pt,contains:Mt,isDomNode:Dt,callInNextTick:Lt,isPlainEmptyObj_DEV:Ft,clampf:zt,degreesToRadians:Bt,radiansToDegrees:Ut},e("e1",Object.freeze({__proto__:null,BUILTIN_CLASSID_RE:wt,BASE64_VALUES:Ot,propertyDefine:Nt,pushToMap:Pt,contains:Mt,isDomNode:Dt,callInNextTick:Lt,tryCatchFunctor_EDITOR:function(e){return Function("target","try {\n  target."+e+"();\n}\ncatch (e) {\n  cc._throw(e);\n}")},isPlainEmptyObj_DEV:Ft,clampf:zt,degreesToRadians:Bt,radiansToDegrees:Ut}));var Wt=function(){function e(e,t){this.name=void 0,this.default=void 0,this.name=e,this.default=t}return e.prototype.toString=function(){return this.name},e}(),qt=e("dy",new Wt("Integer",0));c.Integer=qt,c.CCInteger=qt;var Yt=e("ec",new Wt("Float",0));c.Float=Yt,c.CCFloat=Yt;var Xt=e("dv",new Wt("Boolean",!1));c.Boolean=Xt,c.CCBoolean=Xt;var Kt=e("bf",new Wt("String",""));function Qt(e,t){return function(n,i){var r='"'+Ve(n)+"."+i+'"',o=kt(n,i),a=o.type;if(a===qt||a===Yt?a="Number":a!==Kt&&a!==Xt||(a=""+a),a===e){if(o.hasOwnProperty("default")){var s=o.default;if(void 0!==s&&!Array.isArray(s)&&!Ft(s)){var c=typeof s,l=e.toLowerCase();if(c===l)if("object"===l){if(!s||s instanceof o.ctor)return;I(3605,r,Ve(o.ctor))}else"Number"!==e&&I(3606,t,r,e);else{if("function"===c)return;e===Kt.default&&null==s?I(3607,r):I(3611,t,r,c)}delete o.type}}}else I(3604,r)}}c.String=Kt,c.CCString=Kt;var Zt=Object.freeze({__proto__:null,DELIMETER:"$_$",createAttrsSingle:Gt,createAttrs:Ht,attr:kt,getClassAttrs:Vt,setClassAttr:jt,PrimitiveType:Wt,CCInteger:qt,CCFloat:Yt,CCBoolean:Xt,CCString:Kt,getTypeChecker_ET:Qt,getObjTypeChecker_ET:function(e){return function(t,n){Qt("Object","type")(t,n);var i=Vt(t)[n+"$_$default"],r=c.Class.getDefault(i);if(!Array.isArray(r)&&nt(e,c.ValueType)){var o=Ve(e),a=Xe('No need to specify the "type" of "%s.%s" because %s is a child class of ValueType.',Ve(t),n,o);i?v(a):I(3612,a,o,Ve(t),n,o)}}}}),Jt={default:{},serializable:{},editorOnly:{},formerlySerializedAs:{}};function $t(e,t,n,i){if(!e.get&&!e.set&&e.hasOwnProperty("default")){var r="_N$"+t;e.get=function(){return this[r]},e.set=function(e){var t=this[r];this[r]=e,n.call(this,t)};var o={};for(var a in i[r]=o,Jt){var s=Jt[a];e.hasOwnProperty(a)&&(o[a]=e[a],s.canUsedInGet||delete e[a])}}}function en(e,t,n,i){if(Array.isArray(t)){if(!(t.length>0))return R(5508,n,i);e.type=t=t[0]}"function"==typeof t&&(t===String?e.type=c.String:t===Boolean?e.type=c.Boolean:t===Number&&(e.type=c.Float))}function tn(e,t,n){var i=e?{_short:!0}:{_short:!0,default:t};return n&&(i.type=n),i}function nn(e,t){if(!e||e.constructor!==Object){if(Array.isArray(e)&&e.length>0)return tn(t,[],e);if("function"==typeof e){var n=e;return tn(t,nt(n,c.ValueType)?new n:null,n)}return tn(t,e instanceof Wt?e.default:e)}return null}var rn=[];function on(){return rn[rn.length-1]}c._RF={push:function(e,t,n,i){void 0===n&&(n=t,t=""),rn.push({uuid:t,script:n,module:e,exports:e.exports,beh:null,importMeta:i})},pop:function(){var e=rn.pop(),t=e.module,n=t.exports;if(n===e.exports){for(var i in n)return;t.exports=n=e.cls}},peek:on};var an={datas:null,push:function(e){if(this.datas)this.datas.push(e);else{this.datas=[e];var t=this;setTimeout((function(){t.init()}),0)}},init:function(){var e=this.datas;if(e){for(var t=0;t<e.length;++t){var n=e[t],i=n.cls,r=n.props;"function"==typeof r&&(r=r());var o=Ve(i);r?hn(i,o,r,i.$super,n.mixins):R(3633,o)}this.datas=null}}};function sn(e,t,n,i){!function(e,t){!function(e,t){e.indexOf(t)<0&&e.push(t)}(e.__props__,t)}(e,n),mn(e,i,t,n)}function cn(e,t,n,i){var r=i.get;i.set,r&&(mn(e,i,t,n),jt(e,n,"serializable",!1))}function ln(e){return"function"==typeof e?e():e}function un(e,t,n){for(var i in t)e.hasOwnProperty(i)||n&&!n(i)||Object.defineProperty(e,i,Qe(t,i))}function hn(e,t,n,i,r){if(e.__props__=[],i&&i.__props__&&(e.__props__=i.__props__.slice()),r)for(var o=0;o<r.length;++o){var a=r[o];a.__props__&&(e.__props__=e.__props__.concat(a.__props__.filter((function(t){return e.__props__.indexOf(t)<0}))))}if(n)for(var s in function(e,t){for(var n in e){var i=e[n],r=nn(i,!1);if(r&&(i=e[n]=r),i){var o=i.notify;o&&$t(i,n,o,e),"type"in i&&en(i,i.type,t,n)}}}(n,t),n){var c=n[s];c.get||c.set?cn(e,t,s,c):sn(e,t,s,c)}var l=Vt(e);e.__values__=e.__props__.filter((function(e){return!1!==l[e+"$_$serializable"]}))}function _n(e){var t=e.name,n=e.extends,i=e.mixins,r=function(e,t,n,i){var r=c.Component,o=on();if(o&&nt(t,r)){if(nt(o.cls,r))return R(3615),null;e=e||o.script}var a=function(e,t,n,i){var r=i.ctor,o=[r],a=r;Be(a,"__ctors__",o.length>0?o:null,!0);var s=a.prototype;if(t&&(a.$super=t),n){for(var c=n.length-1;c>=0;c--){var l=n[c];un(s,l.prototype),_n._isCCClass(l)&&un(Vt(a),Vt(l))}s.constructor=a}return ut(e,a),a}(e,t,n,i);if(o)if(nt(t,r)){var s=o.uuid;s&&ct(s,a),o.cls=a}else nt(o.cls,r)||(o.cls=a);return a}(t,n,i,e);t||(t=c.js.getClassName(r)),r._sealed=!0,n&&(n._sealed=!1);var o=e.properties;"function"==typeof o||n&&null===n.__props__||i&&i.some((function(e){return null===e.__props__}))?(an.push({cls:r,props:o,mixins:i}),r.__props__=r.__values__=null):hn(r,t,o,n,e.mixins);var a=e.editor;return a&&nt(n,c.Component)&&c.Component._registerEditorProps(r,a),r}_n._isCCClass=function(e){var t;return null==e||null===(t=e.hasOwnProperty)||void 0===t?void 0:t.call(e,"__ctors__")},_n.fastDefine=function(e,t,n){ut(e,t);for(var i=t.__props__=t.__values__=Object.keys(n),r=Vt(t),o=0;o<i.length;o++){var a=i[o];r[a+"$_$visible"]=!1,r[a+"$_$default"]=n[a]}},_n.Attr=Zt,_n.attr=kt,_n.getInheritanceChain=function(e){for(var t=[];e=tt(e);)e!==Object&&t.push(e);return t};var fn={Integer:"Number",Float:"Number",Boolean:"Boolean",String:"String"};function mn(e,t,n,i){var r=null,o="";function a(){return o=i+"$_$",r=Vt(e)}"type"in t&&void 0===t.type&&I(3660,i,n);var s=t.type;s&&(fn[s]?(r||a())[o+"type"]=s:"Object"===s||("object"==typeof s?xt.isEnum(s)?((r||a())[o+"type"]="Enum",r[o+"enumList"]=xt.getList(s)):yt.isBitMask(s)&&((r||a())[o+"type"]="BitMask",r[o+"bitmaskList"]=yt.getList(s)):"function"==typeof s&&((r||a())[o+"type"]="Object",r[o+"ctor"]=s))),"default"in t&&((r||a())[o+"default"]=t.default);var c,l=function(e,n){if(e in t){var i=t[e];typeof i===n&&((r||a())[o+e]=i)}};t.editorOnly&&((r||a())[o+"editorOnly"]=!0),t.__noImplicit?(r||a())[o+"serializable"]=null!==(c=t.serializable)&&void 0!==c&&c:!1===t.serializable&&((r||a())[o+"serializable"]=!1),l("formerlySerializedAs","string");var u=t.range;u&&Array.isArray(u)&&u.length>=2&&((r||a())[o+"min"]=u[0],r[o+"max"]=u[1],u.length>2&&(r[o+"step"]=u[2])),l("min","number"),l("max","number"),l("step","number")}_n.isArray=function(e){return e=ln(e),Array.isArray(e)},_n.getDefault=ln,_n.escapeForJS=function(e){return JSON.stringify(e).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")},_n.IDENTIFIER_RE=/^[A-Za-z_$][0-9A-Za-z_$]*$/,_n.getNewValueTypeCode=function(e){for(var t=Ve(e),n=e.constructor,i="new "+t+"(",r=0;r<n.__props__.length;r++)i+=e[n.__props__[r]],r<n.__props__.length-1&&(i+=",");return i+")"},c.Class=_n;var dn=Math.PI/180,pn=180/Math.PI,vn=e("dT",1e-6);function gn(e,t){return Math.abs(e-t)<=vn*Math.max(1,Math.abs(e),Math.abs(t))}function yn(e,t,n){return n=n||vn,Math.abs(e-t)<=n}function xn(e,t,n){if(t>n){var i=t;t=n,n=i}return e<t?t:e>n?n:e}function En(e){return e<0?0:e>1?1:e}function Sn(e,t,n){return e+(t-e)*n}function Tn(e){return e*dn}function An(e){return e*pn}var Cn=e("c_",Math.random);function wn(e,t){return Math.random()*(t-e)+e}function In(e,t){return Math.floor(wn(e,t))}function bn(e){return(e=(9301*e+49297)%233280)/233280}function Rn(e,t,n){return bn(e)*(n-t)+t}function On(e,t,n){return Math.floor(Rn(e,t,n))}function Nn(e){return--e,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}function Pn(e,t){return e-Math.floor(e/t)*t}function Mn(e,t){return e=Pn(e,2*t),t-Math.abs(e-t)}function Dn(e,t,n){return(n-e)/(t-e)}function Ln(e){return Math.abs(e.x)>Math.abs(e.y)?Math.abs(e.x)>Math.abs(e.z)?e.x:e.z:Math.abs(e.y)>Math.abs(e.z)?e.y:e.z}function Fn(e,t){return Math.abs(e)>Math.abs(t)?e:t}var zn=e("bm",function(e){function t(t,n,i,r){var o;return(o=e.call(this)||this)._val=0,"string"==typeof t?o.fromHEX(t):void 0!==n?o.set(t,n,i,r):o.set(t),o}$(t,e),t.clone=function(e){var n=new t;return e._val?n._val=e._val:n._val=(e.a<<24>>>0)+(e.b<<16)+(e.g<<8)+e.r,n},t.copy=function(e,t){return e.r=t.r,e.g=t.g,e.b=t.b,e.a=t.a,e},t.set=function(e,t,n,i,r){return e.r=t,e.g=n,e.b=i,e.a=r,e},t.fromHEX=function(e,t){return t=0===t.indexOf("#")?t.substring(1):t,e.r=parseInt(t.substr(0,2),16)||0,e.g=parseInt(t.substr(2,2),16)||0,e.b=parseInt(t.substr(4,2),16)||0,e.a=parseInt(t.substr(6,2),16)||255,e._val=(e.a<<24>>>0)+(e.b<<16)+(e.g<<8)+e.r,e},t.add=function(e,t,n){return e.r=t.r+n.r,e.g=t.g+n.g,e.b=t.b+n.b,e.a=t.a+n.a,e},t.subtract=function(e,t,n){return e.r=t.r-n.r,e.g=t.g-n.g,e.b=t.b-n.b,e.a=t.a-n.a,e},t.multiply=function(e,t,n){return e.r=t.r*n.r,e.g=t.g*n.g,e.b=t.b*n.b,e.a=t.a*n.a,e},t.divide=function(e,t,n){return e.r=t.r/n.r,e.g=t.g/n.g,e.b=t.b/n.b,e.a=t.a/n.a,e},t.scale=function(e,t,n){return e.r=t.r*n,e.g=t.g*n,e.b=t.b*n,e.a=t.a*n,e},t.lerp=function(e,t,n,i){var r=t.r,o=t.g,a=t.b,s=t.a;return r+=(n.r-r)*i,o+=(n.g-o)*i,a+=(n.b-a)*i,s+=(n.a-s)*i,e._val=Math.floor((s<<24>>>0)+(a<<16)+(o<<8)+r),e},t.toArray=function(e,n,i){void 0===i&&(i=0);var r=n instanceof t||n.a>1?1/255:1;return e[i+0]=n.r*r,e[i+1]=n.g*r,e[i+2]=n.b*r,e[i+3]=n.a*r,e},t.fromArray=function(e,t,n){return void 0===n&&(n=0),t.r=255*e[n+0],t.g=255*e[n+1],t.b=255*e[n+2],t.a=255*e[n+3],t},t.strictEquals=function(e,t){return e.r===t.r&&e.g===t.g&&e.b===t.b&&e.a===t.a},t.equals=function(e,t,n){return void 0===n&&(n=vn),Math.abs(e.r-t.r)<=n*Math.max(1,Math.abs(e.r),Math.abs(t.r))&&Math.abs(e.g-t.g)<=n*Math.max(1,Math.abs(e.g),Math.abs(t.g))&&Math.abs(e.b-t.b)<=n*Math.max(1,Math.abs(e.b),Math.abs(t.b))&&Math.abs(e.a-t.a)<=n*Math.max(1,Math.abs(e.a),Math.abs(t.a))},t.hex=function(e){return(255*e.r<<24|255*e.g<<16|255*e.b<<8|255*e.a)>>>0},Z(t,[{key:"r",get:function(){return 255&this._val},set:function(e){e=~~xn(e,0,255),this._val=(4294967040&this._val|e)>>>0}},{key:"g",get:function(){return(65280&this._val)>>8},set:function(e){e=~~xn(e,0,255),this._val=(4294902015&this._val|e<<8)>>>0}},{key:"b",get:function(){return(16711680&this._val)>>16},set:function(e){e=~~xn(e,0,255),this._val=(4278255615&this._val|e<<16)>>>0}},{key:"a",get:function(){return(4278190080&this._val)>>>24},set:function(e){e=~~xn(e,0,255),this._val=(16777215&this._val|e<<24)>>>0}},{key:"x",get:function(){return this.r*(1/255)},set:function(e){this.r=255*e}},{key:"y",get:function(){return this.g*(1/255)},set:function(e){this.g=255*e}},{key:"z",get:function(){return this.b*(1/255)},set:function(e){this.b=255*e}},{key:"w",get:function(){return this.a*(1/255)},set:function(e){this.a=255*e}}]);var n=t.prototype;return n.clone=function(){var e=new t;return e._val=this._val,e},n.equals=function(e){return e&&this._val===e._val},n.lerp=function(e,t){var n=this.r,i=this.g,r=this.b,o=this.a;return n+=(e.r-n)*t,i+=(e.g-i)*t,r+=(e.b-r)*t,o+=(e.a-o)*t,this._val=Math.floor((o<<24>>>0)+(r<<16)+(i<<8)+n),this},n.toString=function(){return"rgba("+this.r.toFixed()+", "+this.g.toFixed()+", "+this.b.toFixed()+", "+this.a.toFixed()+")"},n.toCSS=function(e){return void 0===e&&(e="rgba"),"rgba"===e?"rgba("+this.r+","+this.g+","+this.b+","+(this.a*(1/255)).toFixed(2)+")":"rgb"===e?"rgb("+this.r+","+this.g+","+this.b+")":"#"+this.toHEX(e)},n.fromHEX=function(e){e=0===e.indexOf("#")?e.substring(1):e;var t=parseInt(e.substr(0,2),16)||0,n=parseInt(e.substr(2,2),16)||0,i=parseInt(e.substr(4,2),16)||0,r=parseInt(e.substr(6,2),16)||255;return this._val=(r<<24>>>0)+(i<<16)+(n<<8)+(0|t),this},n.toHEX=function(e){void 0===e&&(e="#rrggbb");var t=[(this.r<16?"0":"")+this.r.toString(16),(this.g<16?"0":"")+this.g.toString(16),(this.b<16?"0":"")+this.b.toString(16)];return"#rgb"===e?(t[0]=t[0][0],t[1]=t[1][0],t[2]=t[2][0]):"#rrggbbaa"===e&&t.push((this.a<16?"0":"")+this.a.toString(16)),t.join("")},n.toRGBValue=function(){return 16777215&this._val},n.fromHSV=function(e,t,n){var i=0,r=0,o=0;if(0===t)i=r=o=n;else if(0===n)i=r=o=0;else{1===e&&(e=0),e*=6;var a=Math.floor(e),s=e-a,c=n*(1-t),l=n*(1-t*s),u=n*(1-t*(1-s));switch(a){case 0:i=n,r=u,o=c;break;case 1:i=l,r=n,o=c;break;case 2:i=c,r=n,o=u;break;case 3:i=c,r=l,o=n;break;case 4:i=u,r=c,o=n;break;case 5:i=n,r=c,o=l}}return i*=255,r*=255,o*=255,this._val=(this.a<<24>>>0)+(o<<16)+(r<<8)+(0|i),this},n.toHSV=function(){var e=this.r*(1/255),t=this.g*(1/255),n=this.b*(1/255),i={h:0,s:0,v:0},r=Math.max(e,t,n),o=Math.min(e,t,n),a=0;return i.v=r,i.s=r?(r-o)/r:0,i.s?(a=r-o,i.h=e===r?(t-n)/a:t===r?2+(n-e)/a:4+(e-t)/a,i.h/=6,i.h<0&&(i.h+=1)):i.h=0,i},n.set=function(e,t,n,i){return"object"==typeof e?null!=e._val?this._val=e._val:(t=e.g||0,n=e.b||0,i="number"==typeof e.a?e.a:255,e=e.r||0,this._val=(i<<24>>>0)+(n<<16)+(t<<8)+(0|e)):(e=e||0,t=t||0,n=n||0,i="number"==typeof i?i:255,this._val=(i<<24>>>0)+(n<<16)+(t<<8)+(0|e)),this},n.multiply=function(e){var t=(255&this._val)*e.r>>8,n=(65280&this._val)*e.g>>8,i=(16711680&this._val)*e.b>>8,r=((4278190080&this._val)>>>8)*e.a;return this._val=4278190080&r|16711680&i|65280&n|255&t,this},n._set_r_unsafe=function(e){return this._val=(4294967040&this._val|e)>>>0,this},n._set_g_unsafe=function(e){return this._val=(4294902015&this._val|e<<8)>>>0,this},n._set_b_unsafe=function(e){return this._val=(4278255615&this._val|e<<16)>>>0,this},n._set_a_unsafe=function(e){return this._val=(16777215&this._val|e<<24)>>>0,this},t}(At));function Bn(e,t,n,i){return new zn(e,t,n,i)}zn.WHITE=Object.freeze(new zn(255,255,255,255)),zn.GRAY=Object.freeze(new zn(127,127,127,255)),zn.BLACK=Object.freeze(new zn(0,0,0,255)),zn.TRANSPARENT=Object.freeze(new zn(0,0,0,0)),zn.RED=Object.freeze(new zn(255,0,0,255)),zn.GREEN=Object.freeze(new zn(0,255,0,255)),zn.BLUE=Object.freeze(new zn(0,0,255,255)),zn.CYAN=Object.freeze(new zn(0,255,255,255)),zn.MAGENTA=Object.freeze(new zn(255,0,255,255)),zn.YELLOW=Object.freeze(new zn(255,255,0,255)),_n.fastDefine("cc.Color",zn,{r:0,g:0,b:0,a:255}),c.Color=zn,c.color=Bn;var Un=e("aH",function(e){function t(t,n,i){var r;return r=e.call(this)||this,t&&"object"==typeof t?(r.x=t.x,r.y=t.y,r.z=t.z):(r.x=t||0,r.y=n||0,r.z=i||0),r}$(t,e),t.zero=function(e){return e.x=0,e.y=0,e.z=0,e},t.clone=function(e){return new t(e.x,e.y,e.z)},t.copy=function(e,t){return e.x=t.x,e.y=t.y,e.z=t.z,e},t.set=function(e,t,n,i){return e.x=t,e.y=n,e.z=i,e},t.add=function(e,t,n){return e.x=t.x+n.x,e.y=t.y+n.y,e.z=t.z+n.z,e},t.subtract=function(e,t,n){return e.x=t.x-n.x,e.y=t.y-n.y,e.z=t.z-n.z,e},t.multiply=function(e,t,n){return e.x=t.x*n.x,e.y=t.y*n.y,e.z=t.z*n.z,e},t.divide=function(e,t,n){return e.x=t.x/n.x,e.y=t.y/n.y,e.z=t.z/n.z,e},t.ceil=function(e,t){return e.x=Math.ceil(t.x),e.y=Math.ceil(t.y),e.z=Math.ceil(t.z),e},t.floor=function(e,t){return e.x=Math.floor(t.x),e.y=Math.floor(t.y),e.z=Math.floor(t.z),e},t.min=function(e,t,n){return e.x=Math.min(t.x,n.x),e.y=Math.min(t.y,n.y),e.z=Math.min(t.z,n.z),e},t.max=function(e,t,n){return e.x=Math.max(t.x,n.x),e.y=Math.max(t.y,n.y),e.z=Math.max(t.z,n.z),e},t.round=function(e,t){return e.x=Math.round(t.x),e.y=Math.round(t.y),e.z=Math.round(t.z),e},t.multiplyScalar=function(e,t,n){return e.x=t.x*n,e.y=t.y*n,e.z=t.z*n,e},t.scaleAndAdd=function(e,t,n,i){return e.x=t.x+n.x*i,e.y=t.y+n.y*i,e.z=t.z+n.z*i,e},t.distance=function(e,t){var n=t.x-e.x,i=t.y-e.y,r=t.z-e.z;return Math.sqrt(n*n+i*i+r*r)},t.squaredDistance=function(e,t){var n=t.x-e.x,i=t.y-e.y,r=t.z-e.z;return n*n+i*i+r*r},t.len=function(e){var t=e.x,n=e.y,i=e.z;return Math.sqrt(t*t+n*n+i*i)},t.lengthSqr=function(e){var t=e.x,n=e.y,i=e.z;return t*t+n*n+i*i},t.negate=function(e,t){return e.x=-t.x,e.y=-t.y,e.z=-t.z,e},t.invert=function(e,t){return e.x=1/t.x,e.y=1/t.y,e.z=1/t.z,e},t.invertSafe=function(e,t){var n=t.x,i=t.y,r=t.z;return Math.abs(n)<vn?e.x=0:e.x=1/n,Math.abs(i)<vn?e.y=0:e.y=1/i,Math.abs(r)<vn?e.z=0:e.z=1/r,e},t.normalize=function(e,t){var n=t.x,i=t.y,r=t.z,o=n*n+i*i+r*r;return o>0&&(o=1/Math.sqrt(o),e.x=n*o,e.y=i*o,e.z=r*o),e},t.dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z},t.cross=function(e,t,n){var i=t.x,r=t.y,o=t.z,a=n.x,s=n.y,c=n.z;return e.x=r*c-o*s,e.y=o*a-i*c,e.z=i*s-r*a,e},t.lerp=function(e,t,n,i){return e.x=t.x+i*(n.x-t.x),e.y=t.y+i*(n.y-t.y),e.z=t.z+i*(n.z-t.z),e},t.random=function(e,t){t=t||1;var n=2*Cn()*Math.PI,i=2*Cn()-1,r=Math.sqrt(1-i*i);return e.x=r*Math.cos(n)*t,e.y=r*Math.sin(n)*t,e.z=i*t,e},t.transformMat4=function(e,t,n){var i=t.x,r=t.y,o=t.z,a=n.m03*i+n.m07*r+n.m11*o+n.m15;return a=a?Math.abs(1/a):1,e.x=(n.m00*i+n.m04*r+n.m08*o+n.m12)*a,e.y=(n.m01*i+n.m05*r+n.m09*o+n.m13)*a,e.z=(n.m02*i+n.m06*r+n.m10*o+n.m14)*a,e},t.transformMat4Normal=function(e,t,n){var i=t.x,r=t.y,o=t.z,a=n.m03*i+n.m07*r+n.m11*o;return a=a?Math.abs(1/a):1,e.x=(n.m00*i+n.m04*r+n.m08*o)*a,e.y=(n.m01*i+n.m05*r+n.m09*o)*a,e.z=(n.m02*i+n.m06*r+n.m10*o)*a,e},t.transformMat3=function(e,t,n){var i=t.x,r=t.y,o=t.z;return e.x=i*n.m00+r*n.m03+o*n.m06,e.y=i*n.m01+r*n.m04+o*n.m07,e.z=i*n.m02+r*n.m05+o*n.m08,e},t.transformAffine=function(e,t,n){var i=t.x,r=t.y,o=t.z;return e.x=n.m00*i+n.m04*r+n.m08*o+n.m12,e.y=n.m01*i+n.m05*r+n.m09*o+n.m13,e.x=n.m02*i+n.m06*r+n.m10*o+n.m14,e},t.transformQuat=function(e,t,n){var i=n.w*t.x+n.y*t.z-n.z*t.y,r=n.w*t.y+n.z*t.x-n.x*t.z,o=n.w*t.z+n.x*t.y-n.y*t.x,a=-n.x*t.x-n.y*t.y-n.z*t.z;return e.x=i*n.w+a*-n.x+r*-n.z-o*-n.y,e.y=r*n.w+a*-n.y+o*-n.x-i*-n.z,e.z=o*n.w+a*-n.z+i*-n.y-r*-n.x,e},t.transformRTS=function(e,t,n,i,r){var o=t.x*r.x,a=t.y*r.y,s=t.z*r.z,c=n.w*o+n.y*s-n.z*a,l=n.w*a+n.z*o-n.x*s,u=n.w*s+n.x*a-n.y*o,h=-n.x*o-n.y*a-n.z*s;return e.x=c*n.w+h*-n.x+l*-n.z-u*-n.y+i.x,e.y=l*n.w+h*-n.y+u*-n.x-c*-n.z+i.y,e.z=u*n.w+h*-n.z+c*-n.y-l*-n.x+i.z,e},t.transformInverseRTS=function(e,t,n,i,r){var o=t.x-i.x,a=t.y-i.y,s=t.z-i.z,c=n.w*o-n.y*s+n.z*a,l=n.w*a-n.z*o+n.x*s,u=n.w*s-n.x*a+n.y*o,h=n.x*o+n.y*a+n.z*s;return e.x=(c*n.w+h*n.x+l*n.z-u*n.y)/r.x,e.y=(l*n.w+h*n.y+u*n.x-c*n.z)/r.y,e.z=(u*n.w+h*n.z+c*n.y-l*n.x)/r.z,e},t.rotateX=function(e,t,n,i){var r=t.x-n.x,o=t.y-n.y,a=t.z-n.z,s=Math.cos(i),c=Math.sin(i),l=r,u=o*s-a*c,h=o*c+a*s;return e.x=l+n.x,e.y=u+n.y,e.z=h+n.z,e},t.rotateY=function(e,t,n,i){var r=t.x-n.x,o=t.y-n.y,a=t.z-n.z,s=Math.cos(i),c=Math.sin(i),l=a*c+r*s,u=o,h=a*s-r*c;return e.x=l+n.x,e.y=u+n.y,e.z=h+n.z,e},t.rotateZ=function(e,t,n,i){var r=t.x-n.x,o=t.y-n.y,a=t.z-n.z,s=Math.cos(i),c=Math.sin(i),l=r*s-o*c,u=r*c+o*s,h=a;return e.x=l+n.x,e.y=u+n.y,e.z=h+n.z,e},t.toArray=function(e,t,n){return void 0===n&&(n=0),e[n+0]=t.x,e[n+1]=t.y,e[n+2]=t.z,e},t.fromArray=function(e,t,n){return void 0===n&&(n=0),e.x=t[n+0],e.y=t[n+1],e.z=t[n+2],e},t.strictEquals=function(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z},t.equals=function(e,t,n){void 0===n&&(n=vn);var i=e.x,r=e.y,o=e.z,a=t.x,s=t.y,c=t.z;return Math.abs(i-a)<=n*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(r-s)<=n*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(o-c)<=n*Math.max(1,Math.abs(o),Math.abs(c))},t.angle=function(e,n){t.normalize(Gn,e),t.normalize(Hn,n);var i=t.dot(Gn,Hn);return i>1?0:i<-1?Math.PI:Math.acos(i)},t.projectOnPlane=function(e,n,i){return t.subtract(e,n,t.project(e,n,i))},t.project=function(e,n,i){var r=t.lengthSqr(i);return r<1e-6?t.set(e,0,0,0):t.multiplyScalar(e,i,t.dot(n,i)/r)};var n=t.prototype;return n.clone=function(){return new t(this.x,this.y,this.z)},n.set=function(e,t,n){return e&&"object"==typeof e?(this.x=e.x,this.y=e.y,this.z=e.z):(this.x=e||0,this.y=t||0,this.z=n||0),this},n.equals=function(e,t){return void 0===t&&(t=vn),Math.abs(this.x-e.x)<=t*Math.max(1,Math.abs(this.x),Math.abs(e.x))&&Math.abs(this.y-e.y)<=t*Math.max(1,Math.abs(this.y),Math.abs(e.y))&&Math.abs(this.z-e.z)<=t*Math.max(1,Math.abs(this.z),Math.abs(e.z))},n.equals3f=function(e,t,n,i){return void 0===i&&(i=vn),Math.abs(this.x-e)<=i*Math.max(1,Math.abs(this.x),Math.abs(e))&&Math.abs(this.y-t)<=i*Math.max(1,Math.abs(this.y),Math.abs(t))&&Math.abs(this.z-n)<=i*Math.max(1,Math.abs(this.z),Math.abs(n))},n.strictEquals=function(e){return this.x===e.x&&this.y===e.y&&this.z===e.z},n.strictEquals3f=function(e,t,n){return this.x===e&&this.y===t&&this.z===n},n.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.z.toFixed(2)+")"},n.lerp=function(e,t){return this.x+=t*(e.x-this.x),this.y+=t*(e.y-this.y),this.z+=t*(e.z-this.z),this},n.add=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this},n.add3f=function(e,t,n){return this.x+=e,this.y+=t,this.z+=n,this},n.subtract=function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this},n.subtract3f=function(e,t,n){return this.x-=e,this.y-=t,this.z-=n,this},n.multiplyScalar=function(e){return"object"==typeof e&&console.warn("should use Vec3.multiply for vector * vector operation"),this.x*=e,this.y*=e,this.z*=e,this},n.multiply=function(e){return"object"!=typeof e&&console.warn("should use Vec3.scale for vector * scalar operation"),this.x*=e.x,this.y*=e.y,this.z*=e.z,this},n.multiply3f=function(e,t,n){return this.x*=e,this.y*=t,this.z*=n,this},n.divide=function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},n.divide3f=function(e,t,n){return this.x/=e,this.y/=t,this.z/=n,this},n.negative=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},n.clampf=function(e,t){return this.x=xn(this.x,e.x,t.x),this.y=xn(this.y,e.y,t.y),this.z=xn(this.z,e.z,t.z),this},n.dot=function(e){return this.x*e.x+this.y*e.y+this.z*e.z},n.cross=function(e){var t=this.x,n=this.y,i=this.z,r=e.x,o=e.y,a=e.z;return this.x=n*a-i*o,this.y=i*r-t*a,this.z=t*o-n*r,this},n.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},n.lengthSqr=function(){return this.x*this.x+this.y*this.y+this.z*this.z},n.normalize=function(){var e=this.x,t=this.y,n=this.z,i=e*e+t*t+n*n;return i>0&&(i=1/Math.sqrt(i),this.x=e*i,this.y=t*i,this.z=n*i),this},n.transformMat4=function(e){var t=this.x,n=this.y,i=this.z,r=e.m03*t+e.m07*n+e.m11*i+e.m15;return r=r?1/r:1,this.x=(e.m00*t+e.m04*n+e.m08*i+e.m12)*r,this.y=(e.m01*t+e.m05*n+e.m09*i+e.m13)*r,this.z=(e.m02*t+e.m06*n+e.m10*i+e.m14)*r,this},t}(At));Un.UNIT_X=Object.freeze(new Un(1,0,0)),Un.UNIT_Y=Object.freeze(new Un(0,1,0)),Un.UNIT_Z=Object.freeze(new Un(0,0,1)),Un.RIGHT=Object.freeze(new Un(1,0,0)),Un.UP=Object.freeze(new Un(0,1,0)),Un.FORWARD=Object.freeze(new Un(0,0,-1)),Un.ZERO=Object.freeze(new Un(0,0,0)),Un.ONE=Object.freeze(new Un(1,1,1)),Un.NEG_ONE=Object.freeze(new Un(-1,-1,-1));var Gn=new Un,Hn=new Un;function kn(e,t,n){return new Un(e,t,n)}_n.fastDefine("cc.Vec3",Un,{x:0,y:0,z:0}),c.Vec3=Un,c.v3=kn;var Vn=e("dO",function(e){function t(t,n,i,r,o,a,s,c,l){var u;return void 0===t&&(t=1),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=1),void 0===a&&(a=0),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=1),u=e.call(this)||this,"object"==typeof t?(u.m00=t.m00,u.m01=t.m01,u.m02=t.m02,u.m03=t.m03,u.m04=t.m04,u.m05=t.m05,u.m06=t.m06,u.m07=t.m07,u.m08=t.m08):(u.m00=t,u.m01=n,u.m02=i,u.m03=r,u.m04=o,u.m05=a,u.m06=s,u.m07=c,u.m08=l),u}$(t,e),t.clone=function(e){return new t(e.m00,e.m01,e.m02,e.m03,e.m04,e.m05,e.m06,e.m07,e.m08)},t.copy=function(e,t){return e.m00=t.m00,e.m01=t.m01,e.m02=t.m02,e.m03=t.m03,e.m04=t.m04,e.m05=t.m05,e.m06=t.m06,e.m07=t.m07,e.m08=t.m08,e},t.set=function(e,t,n,i,r,o,a,s,c,l){return e.m00=t,e.m01=n,e.m02=i,e.m03=r,e.m04=o,e.m05=a,e.m06=s,e.m07=c,e.m08=l,e},t.identity=function(e){return e.m00=1,e.m01=0,e.m02=0,e.m03=0,e.m04=1,e.m05=0,e.m06=0,e.m07=0,e.m08=1,e},t.transpose=function(e,t){if(e===t){var n=t.m01,i=t.m02,r=t.m05;e.m01=t.m03,e.m02=t.m06,e.m03=n,e.m05=t.m07,e.m06=i,e.m07=r}else e.m00=t.m00,e.m01=t.m03,e.m02=t.m06,e.m03=t.m01,e.m04=t.m04,e.m05=t.m07,e.m06=t.m02,e.m07=t.m05,e.m08=t.m08;return e},t.invert=function(e,t){var n=t.m00,i=t.m01,r=t.m02,o=t.m03,a=t.m04,s=t.m05,c=t.m06,l=t.m07,u=t.m08,h=u*a-s*l,_=-u*o+s*c,f=l*o-a*c,m=n*h+i*_+r*f;return 0===m?(e.m00=0,e.m01=0,e.m02=0,e.m03=0,e.m04=0,e.m05=0,e.m06=0,e.m07=0,e.m08=0,e):(m=1/m,e.m00=h*m,e.m01=(-u*i+r*l)*m,e.m02=(s*i-r*a)*m,e.m03=_*m,e.m04=(u*n-r*c)*m,e.m05=(-s*n+r*o)*m,e.m06=f*m,e.m07=(-l*n+i*c)*m,e.m08=(a*n-i*o)*m,e)},t.determinant=function(e){var t=e.m00,n=e.m01,i=e.m02,r=e.m03,o=e.m04,a=e.m05,s=e.m06,c=e.m07,l=e.m08;return t*(l*o-a*c)+n*(-l*r+a*s)+i*(c*r-o*s)},t.multiply=function(e,t,n){var i=t.m00,r=t.m01,o=t.m02,a=t.m03,s=t.m04,c=t.m05,l=t.m06,u=t.m07,h=t.m08,_=n.m00,f=n.m01,m=n.m02,d=n.m03,p=n.m04,v=n.m05,g=n.m06,y=n.m07,x=n.m08;return e.m00=_*i+f*a+m*l,e.m01=_*r+f*s+m*u,e.m02=_*o+f*c+m*h,e.m03=d*i+p*a+v*l,e.m04=d*r+p*s+v*u,e.m05=d*o+p*c+v*h,e.m06=g*i+y*a+x*l,e.m07=g*r+y*s+x*u,e.m08=g*o+y*c+x*h,e},t.multiplyMat4=function(e,t,n){var i=t.m00,r=t.m01,o=t.m02,a=t.m03,s=t.m04,c=t.m05,l=t.m06,u=t.m07,h=t.m08,_=n.m00,f=n.m01,m=n.m02,d=n.m04,p=n.m05,v=n.m06,g=n.m08,y=n.m09,x=n.m10;return e.m00=_*i+f*a+m*l,e.m01=_*r+f*s+m*u,e.m02=_*o+f*c+m*h,e.m03=d*i+p*a+v*l,e.m04=d*r+p*s+v*u,e.m05=d*o+p*c+v*h,e.m06=g*i+y*a+x*l,e.m07=g*r+y*s+x*u,e.m08=g*o+y*c+x*h,e},t.transform=function(e,t,n){var i=t.m00,r=t.m01,o=t.m02,a=t.m03,s=t.m04,c=t.m05,l=t.m06,u=t.m07,h=t.m08,_=n.x,f=n.y;return e.m00=i,e.m01=r,e.m02=o,e.m03=a,e.m04=s,e.m05=c,e.m06=_*i+f*a+l,e.m07=_*r+f*s+u,e.m08=_*o+f*c+h,e},t.scale=function(e,t,n){var i=n.x,r=n.y;return e.m00=i*t.m00,e.m01=i*t.m01,e.m02=i*t.m02,e.m03=r*t.m03,e.m04=r*t.m04,e.m05=r*t.m05,e.m06=t.m06,e.m07=t.m07,e.m08=t.m08,e},t.rotate=function(e,t,n){var i=t.m00,r=t.m01,o=t.m02,a=t.m03,s=t.m04,c=t.m05,l=t.m06,u=t.m07,h=t.m08,_=Math.sin(n),f=Math.cos(n);return e.m00=f*i+_*a,e.m01=f*r+_*s,e.m02=f*o+_*c,e.m03=f*a-_*i,e.m04=f*s-_*r,e.m05=f*c-_*o,e.m06=l,e.m07=u,e.m08=h,e},t.fromMat4=function(e,t){return e.m00=t.m00,e.m01=t.m01,e.m02=t.m02,e.m03=t.m04,e.m04=t.m05,e.m05=t.m06,e.m06=t.m08,e.m07=t.m09,e.m08=t.m10,e},t.fromViewUp=function(e,n,i){return Un.lengthSqr(n)<vn*vn?(t.identity(e),e):(i=i||Un.UNIT_Y,Un.normalize(jn,Un.cross(jn,i,n)),Un.lengthSqr(jn)<vn*vn?(t.identity(e),e):(Un.cross(Wn,n,jn),t.set(e,jn.x,jn.y,jn.z,Wn.x,Wn.y,Wn.z,n.x,n.y,n.z),e))},t.fromTranslation=function(e,t){return e.m00=1,e.m01=0,e.m02=0,e.m03=0,e.m04=1,e.m05=0,e.m06=t.x,e.m07=t.y,e.m08=1,e},t.fromScaling=function(e,t){return e.m00=t.x,e.m01=0,e.m02=0,e.m03=0,e.m04=t.y,e.m05=0,e.m06=0,e.m07=0,e.m08=1,e},t.fromRotation=function(e,t){var n=Math.sin(t),i=Math.cos(t);return e.m00=i,e.m01=n,e.m02=0,e.m03=-n,e.m04=i,e.m05=0,e.m06=0,e.m07=0,e.m08=1,e},t.fromQuat=function(e,t){var n=t.x,i=t.y,r=t.z,o=t.w,a=n+n,s=i+i,c=r+r,l=n*a,u=i*a,h=i*s,_=r*a,f=r*s,m=r*c,d=o*a,p=o*s,v=o*c;return e.m00=1-h-m,e.m03=u-v,e.m06=_+p,e.m01=u+v,e.m04=1-l-m,e.m07=f-d,e.m02=_-p,e.m05=f+d,e.m08=1-l-h,e},t.inverseTransposeMat4=function(e,t){var n=t.m00,i=t.m01,r=t.m02,o=t.m03,a=t.m04,s=t.m05,c=t.m06,l=t.m07,u=t.m08,h=t.m09,_=t.m10,f=t.m11,m=t.m12,d=t.m13,p=t.m14,v=t.m15,g=n*s-i*a,y=n*c-r*a,x=n*l-o*a,E=i*c-r*s,S=i*l-o*s,T=r*l-o*c,A=u*d-h*m,C=u*p-_*m,w=u*v-f*m,I=h*p-_*d,b=h*v-f*d,R=_*v-f*p,O=g*R-y*b+x*I+E*w-S*C+T*A;return O?(O=1/O,e.m00=(s*R-c*b+l*I)*O,e.m01=(c*w-a*R-l*C)*O,e.m02=(a*b-s*w+l*A)*O,e.m03=(r*b-i*R-o*I)*O,e.m04=(n*R-r*w+o*C)*O,e.m05=(i*w-n*b-o*A)*O,e.m06=(d*T-p*S+v*E)*O,e.m07=(p*x-m*T-v*y)*O,e.m08=(m*S-d*x+v*g)*O,e):null},t.toArray=function(e,t,n){return void 0===n&&(n=0),e[n+0]=t.m00,e[n+1]=t.m01,e[n+2]=t.m02,e[n+3]=t.m03,e[n+4]=t.m04,e[n+5]=t.m05,e[n+6]=t.m06,e[n+7]=t.m07,e[n+8]=t.m08,e},t.fromArray=function(e,t,n){return void 0===n&&(n=0),e.m00=t[n+0],e.m01=t[n+1],e.m02=t[n+2],e.m03=t[n+3],e.m04=t[n+4],e.m05=t[n+5],e.m06=t[n+6],e.m07=t[n+7],e.m08=t[n+8],e},t.add=function(e,t,n){return e.m00=t.m00+n.m00,e.m01=t.m01+n.m01,e.m02=t.m02+n.m02,e.m03=t.m03+n.m03,e.m04=t.m04+n.m04,e.m05=t.m05+n.m05,e.m06=t.m06+n.m06,e.m07=t.m07+n.m07,e.m08=t.m08+n.m08,e},t.subtract=function(e,t,n){return e.m00=t.m00-n.m00,e.m01=t.m01-n.m01,e.m02=t.m02-n.m02,e.m03=t.m03-n.m03,e.m04=t.m04-n.m04,e.m05=t.m05-n.m05,e.m06=t.m06-n.m06,e.m07=t.m07-n.m07,e.m08=t.m08-n.m08,e},t.multiplyScalar=function(e,t,n){return e.m00=t.m00*n,e.m01=t.m01*n,e.m02=t.m02*n,e.m03=t.m03*n,e.m04=t.m04*n,e.m05=t.m05*n,e.m06=t.m06*n,e.m07=t.m07*n,e.m08=t.m08*n,e},t.multiplyScalarAndAdd=function(e,t,n,i){return e.m00=n.m00*i+t.m00,e.m01=n.m01*i+t.m01,e.m02=n.m02*i+t.m02,e.m03=n.m03*i+t.m03,e.m04=n.m04*i+t.m04,e.m05=n.m05*i+t.m05,e.m06=n.m06*i+t.m06,e.m07=n.m07*i+t.m07,e.m08=n.m08*i+t.m08,e},t.strictEquals=function(e,t){return e.m00===t.m00&&e.m01===t.m01&&e.m02===t.m02&&e.m03===t.m03&&e.m04===t.m04&&e.m05===t.m05&&e.m06===t.m06&&e.m07===t.m07&&e.m08===t.m08},t.equals=function(e,t,n){return void 0===n&&(n=vn),Math.abs(e.m00-t.m00)<=n*Math.max(1,Math.abs(e.m00),Math.abs(t.m00))&&Math.abs(e.m01-t.m01)<=n*Math.max(1,Math.abs(e.m01),Math.abs(t.m01))&&Math.abs(e.m02-t.m02)<=n*Math.max(1,Math.abs(e.m02),Math.abs(t.m02))&&Math.abs(e.m03-t.m03)<=n*Math.max(1,Math.abs(e.m03),Math.abs(t.m03))&&Math.abs(e.m04-t.m04)<=n*Math.max(1,Math.abs(e.m04),Math.abs(t.m04))&&Math.abs(e.m05-t.m05)<=n*Math.max(1,Math.abs(e.m05),Math.abs(t.m05))&&Math.abs(e.m06-t.m06)<=n*Math.max(1,Math.abs(e.m06),Math.abs(t.m06))&&Math.abs(e.m07-t.m07)<=n*Math.max(1,Math.abs(e.m07),Math.abs(t.m07))&&Math.abs(e.m08-t.m08)<=n*Math.max(1,Math.abs(e.m08),Math.abs(t.m08))};var n=t.prototype;return n.clone=function(){var e=this;return new t(e.m00,e.m01,e.m02,e.m03,e.m04,e.m05,e.m06,e.m07,e.m08)},n.set=function(e,t,n,i,r,o,a,s,c){return void 0===e&&(e=1),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=1),void 0===o&&(o=0),void 0===a&&(a=0),void 0===s&&(s=0),void 0===c&&(c=1),"object"==typeof e?(this.m00=e.m00,this.m01=e.m01,this.m02=e.m02,this.m03=e.m03,this.m04=e.m04,this.m05=e.m05,this.m06=e.m06,this.m07=e.m07,this.m08=e.m08):(this.m00=e,this.m01=t,this.m02=n,this.m03=i,this.m04=r,this.m05=o,this.m06=a,this.m07=s,this.m08=c),this},n.equals=function(e,t){return void 0===t&&(t=vn),Math.abs(this.m00-e.m00)<=t*Math.max(1,Math.abs(this.m00),Math.abs(e.m00))&&Math.abs(this.m01-e.m01)<=t*Math.max(1,Math.abs(this.m01),Math.abs(e.m01))&&Math.abs(this.m02-e.m02)<=t*Math.max(1,Math.abs(this.m02),Math.abs(e.m02))&&Math.abs(this.m03-e.m03)<=t*Math.max(1,Math.abs(this.m03),Math.abs(e.m03))&&Math.abs(this.m04-e.m04)<=t*Math.max(1,Math.abs(this.m04),Math.abs(e.m04))&&Math.abs(this.m05-e.m05)<=t*Math.max(1,Math.abs(this.m05),Math.abs(e.m05))&&Math.abs(this.m06-e.m06)<=t*Math.max(1,Math.abs(this.m06),Math.abs(e.m06))&&Math.abs(this.m07-e.m07)<=t*Math.max(1,Math.abs(this.m07),Math.abs(e.m07))&&Math.abs(this.m08-e.m08)<=t*Math.max(1,Math.abs(this.m08),Math.abs(e.m08))},n.strictEquals=function(e){return this.m00===e.m00&&this.m01===e.m01&&this.m02===e.m02&&this.m03===e.m03&&this.m04===e.m04&&this.m05===e.m05&&this.m06===e.m06&&this.m07===e.m07&&this.m08===e.m08},n.toString=function(){var e=this;return"[\n"+e.m00+", "+e.m01+", "+e.m02+",\n"+e.m03+",\n"+e.m04+", "+e.m05+",\n"+e.m06+", "+e.m07+",\n"+e.m08+"\n]"},n.identity=function(){return this.m00=1,this.m01=0,this.m02=0,this.m03=0,this.m04=1,this.m05=0,this.m06=0,this.m07=0,this.m08=1,this},n.transpose=function(){var e=this.m01,t=this.m02,n=this.m05;return this.m01=this.m03,this.m02=this.m06,this.m03=e,this.m05=this.m07,this.m06=t,this.m07=n,this},n.invert=function(){var e=this.m00,t=this.m01,n=this.m02,i=this.m03,r=this.m04,o=this.m05,a=this.m06,s=this.m07,c=this.m08,l=c*r-o*s,u=-c*i+o*a,h=s*i-r*a,_=e*l+t*u+n*h;return 0===_?(this.set(0,0,0,0,0,0,0,0,0),this):(_=1/_,this.m00=l*_,this.m01=(-c*t+n*s)*_,this.m02=(o*t-n*r)*_,this.m03=u*_,this.m04=(c*e-n*a)*_,this.m05=(-o*e+n*i)*_,this.m06=h*_,this.m07=(-s*e+t*a)*_,this.m08=(r*e-t*i)*_,this)},n.determinant=function(){var e=this.m00,t=this.m01,n=this.m02,i=this.m03,r=this.m04,o=this.m05,a=this.m06,s=this.m07,c=this.m08;return e*(c*r-o*s)+t*(-c*i+o*a)+n*(s*i-r*a)},n.add=function(e){return this.m00+=e.m00,this.m01+=e.m01,this.m02+=e.m02,this.m03+=e.m03,this.m04+=e.m04,this.m05+=e.m05,this.m06+=e.m06,this.m07+=e.m07,this.m08+=e.m08,this},n.subtract=function(e){return this.m00-=e.m00,this.m01-=e.m01,this.m02-=e.m02,this.m03-=e.m03,this.m04-=e.m04,this.m05-=e.m05,this.m06-=e.m06,this.m07-=e.m07,this.m08-=e.m08,this},n.multiply=function(e){var t=this.m00,n=this.m01,i=this.m02,r=this.m03,o=this.m04,a=this.m05,s=this.m06,c=this.m07,l=this.m08,u=e.m00,h=e.m01,_=e.m02,f=e.m03,m=e.m04,d=e.m05,p=e.m06,v=e.m07,g=e.m08;return this.m00=u*t+h*r+_*s,this.m01=u*n+h*o+_*c,this.m02=u*i+h*a+_*l,this.m03=f*t+m*r+d*s,this.m04=f*n+m*o+d*c,this.m05=f*i+m*a+d*l,this.m06=p*t+v*r+g*s,this.m07=p*n+v*o+g*c,this.m08=p*i+v*a+g*l,this},n.multiplyScalar=function(e){return this.m00*=e,this.m01*=e,this.m02*=e,this.m03*=e,this.m04*=e,this.m05*=e,this.m06*=e,this.m07*=e,this.m08*=e,this},n.scale=function(e){var t=e.x,n=e.y;return this.m00=t*this.m00,this.m01=t*this.m01,this.m02=t*this.m02,this.m03=n*this.m03,this.m04=n*this.m04,this.m05=n*this.m05,this.m06=this.m06,this.m07=this.m07,this.m08=this.m08,this},n.rotate=function(e){var t=this.m00,n=this.m01,i=this.m02,r=this.m03,o=this.m04,a=this.m05,s=this.m06,c=this.m07,l=this.m08,u=Math.sin(e),h=Math.cos(e);return this.m00=h*t+u*r,this.m01=h*n+u*o,this.m02=h*i+u*a,this.m03=h*r-u*t,this.m04=h*o-u*n,this.m05=h*a-u*i,this.m06=s,this.m07=c,this.m08=l,this},n.fromQuat=function(e){var t=e.x,n=e.y,i=e.z,r=e.w,o=t+t,a=n+n,s=i+i,c=t*o,l=n*o,u=n*a,h=i*o,_=i*a,f=i*s,m=r*o,d=r*a,p=r*s;return this.m00=1-u-f,this.m03=l-p,this.m06=h+d,this.m01=l+p,this.m04=1-c-f,this.m07=_-m,this.m02=h-d,this.m05=_+m,this.m08=1-c-u,this},t}(At));Vn.IDENTITY=Object.freeze(new Vn);var jn=new Un,Wn=new Un;_n.fastDefine("cc.Mat3",Vn,{m00:1,m01:0,m02:0,m03:0,m04:1,m05:0,m06:0,m07:0,m08:1}),c.Mat3=Vn;var qn=e("aM",function(e){function t(t,n,i,r){var o;return o=e.call(this)||this,t&&"object"==typeof t?(o.x=t.x,o.y=t.y,o.z=t.z,o.w=t.w):(o.x=t||0,o.y=n||0,o.z=i||0,o.w=null!=r?r:1),o}$(t,e),t.clone=function(e){return new t(e.x,e.y,e.z,e.w)},t.copy=function(e,t){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e},t.set=function(e,t,n,i,r){return e.x=t,e.y=n,e.z=i,e.w=r,e},t.identity=function(e){return e.x=0,e.y=0,e.z=0,e.w=1,e},t.rotationTo=function(e,n,i){var r=Un.dot(n,i);return r<-.999999?(Un.cross(Kn,Un.UNIT_X,n),Kn.length()<1e-6&&Un.cross(Kn,Un.UNIT_Y,n),Un.normalize(Kn,Kn),t.fromAxisAngle(e,Kn,Math.PI),e):r>.999999?(e.x=0,e.y=0,e.z=0,e.w=1,e):(Un.cross(Kn,n,i),e.x=Kn.x,e.y=Kn.y,e.z=Kn.z,e.w=1+r,t.normalize(e,e))},t.getAxisAngle=function(e,t){var n=2*Math.acos(t.w),i=Math.sin(n/2);return 0!==i?(e.x=t.x/i,e.y=t.y/i,e.z=t.z/i):(e.x=1,e.y=0,e.z=0),n},t.multiply=function(e,t,n){var i=t.x*n.w+t.w*n.x+t.y*n.z-t.z*n.y,r=t.y*n.w+t.w*n.y+t.z*n.x-t.x*n.z,o=t.z*n.w+t.w*n.z+t.x*n.y-t.y*n.x,a=t.w*n.w-t.x*n.x-t.y*n.y-t.z*n.z;return e.x=i,e.y=r,e.z=o,e.w=a,e},t.multiplyScalar=function(e,t,n){return e.x=t.x*n,e.y=t.y*n,e.z=t.z*n,e.w=t.w*n,e},t.scaleAndAdd=function(e,t,n,i){return e.x=t.x+n.x*i,e.y=t.y+n.y*i,e.z=t.z+n.z*i,e.w=t.w+n.w*i,e},t.rotateX=function(e,t,n){n*=.5;var i=Math.sin(n),r=Math.cos(n),o=t.x,a=t.y,s=t.z,c=t.w;return e.x=o*r+c*i,e.y=a*r+s*i,e.z=s*r-a*i,e.w=c*r-o*i,e},t.rotateY=function(e,t,n){n*=.5;var i=Math.sin(n),r=Math.cos(n),o=t.x,a=t.y,s=t.z,c=t.w;return e.x=o*r-s*i,e.y=a*r+c*i,e.z=s*r+o*i,e.w=c*r-a*i,e},t.rotateZ=function(e,t,n){n*=.5;var i=Math.sin(n),r=Math.cos(n),o=t.x,a=t.y,s=t.z,c=t.w;return e.x=o*r+a*i,e.y=a*r-o*i,e.z=s*r+c*i,e.w=c*r-s*i,e},t.rotateAround=function(e,n,i,r){return t.invert(Yn,n),Un.transformQuat(Kn,i,Yn),t.fromAxisAngle(Yn,Kn,r),t.multiply(e,n,Yn),e},t.rotateAroundLocal=function(e,n,i,r){return t.fromAxisAngle(Yn,i,r),t.multiply(e,n,Yn),e},t.calculateW=function(e,t){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=Math.sqrt(Math.abs(1-t.x*t.x-t.y*t.y-t.z*t.z)),e},t.dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w},t.lerp=function(e,t,n,i){return e.x=t.x+i*(n.x-t.x),e.y=t.y+i*(n.y-t.y),e.z=t.z+i*(n.z-t.z),e.w=t.w+i*(n.w-t.w),e},t.slerp=function(e,t,n,i){var r=0,o=0,a=n.x,s=n.y,c=n.z,l=n.w,u=t.x*n.x+t.y*n.y+t.z*n.z+t.w*n.w;if(u<0&&(u=-u,a=-a,s=-s,c=-c,l=-l),1-u>1e-6){var h=Math.acos(u),_=Math.sin(h);r=Math.sin((1-i)*h)/_,o=Math.sin(i*h)/_}else r=1-i,o=i;return e.x=r*t.x+o*a,e.y=r*t.y+o*s,e.z=r*t.z+o*c,e.w=r*t.w+o*l,e},t.sqlerp=function(e,n,i,r,o,a){return t.slerp(Yn,n,o,a),t.slerp(Xn,i,r,a),t.slerp(e,Yn,Xn,2*a*(1-a)),e},t.invert=function(e,t){var n=t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w,i=n?1/n:0;return e.x=-t.x*i,e.y=-t.y*i,e.z=-t.z*i,e.w=t.w*i,e},t.conjugate=function(e,t){return e.x=-t.x,e.y=-t.y,e.z=-t.z,e.w=t.w,e},t.len=function(e){return Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w)},t.lengthSqr=function(e){return e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w},t.normalize=function(e,t){var n=t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w;return n>0&&(n=1/Math.sqrt(n),e.x=t.x*n,e.y=t.y*n,e.z=t.z*n,e.w=t.w*n),e},t.fromAxes=function(e,n,i,r){return Vn.set(Qn,n.x,n.y,n.z,i.x,i.y,i.z,r.x,r.y,r.z),t.normalize(e,t.fromMat3(e,Qn))},t.fromViewUp=function(e,n,i){return Vn.fromViewUp(Qn,n,i),t.normalize(e,t.fromMat3(e,Qn))},t.fromAxisAngle=function(e,t,n){n*=.5;var i=Math.sin(n);return e.x=i*t.x,e.y=i*t.y,e.z=i*t.z,e.w=Math.cos(n),e},t.fromMat3=function(e,t){var n=t.m00,i=t.m03,r=t.m06,o=t.m01,a=t.m04,s=t.m07,c=t.m02,l=t.m05,u=t.m08,h=n+a+u;if(h>0){var _=.5/Math.sqrt(h+1);e.w=.25/_,e.x=(l-s)*_,e.y=(r-c)*_,e.z=(o-i)*_}else if(n>a&&n>u){var f=2*Math.sqrt(1+n-a-u);e.w=(l-s)/f,e.x=.25*f,e.y=(i+o)/f,e.z=(r+c)/f}else if(a>u){var m=2*Math.sqrt(1+a-n-u);e.w=(r-c)/m,e.x=(i+o)/m,e.y=.25*m,e.z=(s+l)/m}else{var d=2*Math.sqrt(1+u-n-a);e.w=(o-i)/d,e.x=(r+c)/d,e.y=(s+l)/d,e.z=.25*d}return e},t.fromEuler=function(e,t,n,i){t*=Zn,n*=Zn,i*=Zn;var r=Math.sin(t),o=Math.cos(t),a=Math.sin(n),s=Math.cos(n),c=Math.sin(i),l=Math.cos(i);return e.x=r*s*l+o*a*c,e.y=o*a*l+r*s*c,e.z=o*s*c-r*a*l,e.w=o*s*l-r*a*c,e},t.fromAngleZ=function(e,t){return t*=Zn,e.x=e.y=0,e.z=Math.sin(t),e.w=Math.cos(t),e},t.toAxisX=function(e,t){var n=2*t.y,i=2*t.z;return e.x=1-n*t.y-i*t.z,e.y=n*t.x+i*t.w,e.z=i*t.x+n*t.w,e},t.toAxisY=function(e,t){var n=2*t.x,i=2*t.y,r=2*t.z;return e.x=i*t.x-r*t.w,e.y=1-n*t.x-r*t.z,e.z=r*t.y+n*t.w,e},t.toAxisZ=function(e,t){var n=2*t.x,i=2*t.y,r=2*t.z;return e.x=r*t.x-i*t.w,e.y=r*t.y-n*t.w,e.z=1-n*t.x-i*t.y,e},t.toEuler=function(e,t,n){var i=t.x,r=t.y,o=t.z,a=t.w,s=0,c=0,l=0,u=i*r+o*a;if(u>.499999)s=0,c=An(2*Math.atan2(i,a)),l=90;else if(u<-.499999)s=0,c=-An(2*Math.atan2(i,a)),l=-90;else{var h=i*i,_=r*r,f=o*o;s=An(Math.atan2(2*i*a-2*r*o,1-2*h-2*f)),c=An(Math.atan2(2*r*a-2*i*o,1-2*_-2*f)),l=An(Math.asin(2*u)),n&&(s=-180*Math.sign(s+1e-6)+s,c=-180*Math.sign(c+1e-6)+c,l=180*Math.sign(l+1e-6)-l)}return e.x=s,e.y=c,e.z=l,e},t.toArray=function(e,t,n){return void 0===n&&(n=0),e[n+0]=t.x,e[n+1]=t.y,e[n+2]=t.z,e[n+3]=t.w,e},t.fromArray=function(e,t,n){return void 0===n&&(n=0),e.x=t[n+0],e.y=t[n+1],e.z=t[n+2],e.w=t[n+3],e},t.strictEquals=function(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w},t.equals=function(e,t,n){return void 0===n&&(n=vn),Math.abs(e.x-t.x)<=n*Math.max(1,Math.abs(e.x),Math.abs(t.x))&&Math.abs(e.y-t.y)<=n*Math.max(1,Math.abs(e.y),Math.abs(t.y))&&Math.abs(e.z-t.z)<=n*Math.max(1,Math.abs(e.z),Math.abs(t.z))&&Math.abs(e.w-t.w)<=n*Math.max(1,Math.abs(e.w),Math.abs(t.w))};var n=t.prototype;return n.clone=function(){return new t(this.x,this.y,this.z,this.w)},n.set=function(e,t,n,i){return e&&"object"==typeof e?(this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w):(this.x=e||0,this.y=t||0,this.z=n||0,this.w=null!=i?i:1),this},n.equals=function(e,t){return void 0===t&&(t=vn),Math.abs(this.x-e.x)<=t*Math.max(1,Math.abs(this.x),Math.abs(e.x))&&Math.abs(this.y-e.y)<=t*Math.max(1,Math.abs(this.y),Math.abs(e.y))&&Math.abs(this.z-e.z)<=t*Math.max(1,Math.abs(this.z),Math.abs(e.z))&&Math.abs(this.w-e.w)<=t*Math.max(1,Math.abs(this.w),Math.abs(e.w))},n.strictEquals=function(e){return e&&this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w},n.getEulerAngles=function(e){return t.toEuler(e,this)},n.lerp=function(e,t){return this.x+=t*(e.x-this.x),this.y+=t*(e.y-this.y),this.z+=t*(e.z-this.z),this.w+=t*(e.w-this.w),this},n.slerp=function(e,n){return t.slerp(this,this,e,n)},n.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},n.lengthSqr=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},t}(At));qn.IDENTITY=Object.freeze(new qn);var Yn=new qn,Xn=new qn,Kn=new Un,Qn=new Vn,Zn=.5*Math.PI/180;function Jn(e,t,n,i){return void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=1),new qn(e,t,n,i)}_n.fastDefine("cc.Quat",qn,{x:0,y:0,z:0,w:1}),c.Quat=qn,c.quat=Jn;var $n=e("di",Object.freeze([Object.freeze([1,0,0,1]),Object.freeze([0,1,-1,0]),Object.freeze([-1,0,0,-1]),Object.freeze([0,-1,1,0])])),ei=e("bc",function(e){function t(t,n,i,r,o,a,s,c,l,u,h,_,f,m,d,p){var v;return void 0===t&&(t=1),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=0),void 0===a&&(a=1),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=0),void 0===u&&(u=0),void 0===h&&(h=1),void 0===_&&(_=0),void 0===f&&(f=0),void 0===m&&(m=0),void 0===d&&(d=0),void 0===p&&(p=1),(v=e.call(this)||this).m00=void 0,v.m01=void 0,v.m02=void 0,v.m03=void 0,v.m04=void 0,v.m05=void 0,v.m06=void 0,v.m07=void 0,v.m08=void 0,v.m09=void 0,v.m10=void 0,v.m11=void 0,v.m12=void 0,v.m13=void 0,v.m14=void 0,v.m15=void 0,"object"==typeof t?(v.m00=t.m00,v.m01=t.m01,v.m02=t.m02,v.m03=t.m03,v.m04=t.m04,v.m05=t.m05,v.m06=t.m06,v.m07=t.m07,v.m08=t.m08,v.m09=t.m09,v.m10=t.m10,v.m11=t.m11,v.m12=t.m12,v.m13=t.m13,v.m14=t.m14,v.m15=t.m15):(v.m00=t,v.m01=n,v.m02=i,v.m03=r,v.m04=o,v.m05=a,v.m06=s,v.m07=c,v.m08=l,v.m09=u,v.m10=h,v.m11=_,v.m12=f,v.m13=m,v.m14=d,v.m15=p),v}$(t,e),t.clone=function(e){return new t(e.m00,e.m01,e.m02,e.m03,e.m04,e.m05,e.m06,e.m07,e.m08,e.m09,e.m10,e.m11,e.m12,e.m13,e.m14,e.m15)},t.copy=function(e,t){return e.m00=t.m00,e.m01=t.m01,e.m02=t.m02,e.m03=t.m03,e.m04=t.m04,e.m05=t.m05,e.m06=t.m06,e.m07=t.m07,e.m08=t.m08,e.m09=t.m09,e.m10=t.m10,e.m11=t.m11,e.m12=t.m12,e.m13=t.m13,e.m14=t.m14,e.m15=t.m15,e},t.set=function(e,t,n,i,r,o,a,s,c,l,u,h,_,f,m,d,p){return e.m00=t,e.m01=n,e.m02=i,e.m03=r,e.m04=o,e.m05=a,e.m06=s,e.m07=c,e.m08=l,e.m09=u,e.m10=h,e.m11=_,e.m12=f,e.m13=m,e.m14=d,e.m15=p,e},t.identity=function(e){return e.m00=1,e.m01=0,e.m02=0,e.m03=0,e.m04=0,e.m05=1,e.m06=0,e.m07=0,e.m08=0,e.m09=0,e.m10=1,e.m11=0,e.m12=0,e.m13=0,e.m14=0,e.m15=1,e},t.transpose=function(e,t){if(e===t){var n=t.m01,i=t.m02,r=t.m03,o=t.m06,a=t.m07,s=t.m11;e.m01=t.m04,e.m02=t.m08,e.m03=t.m12,e.m04=n,e.m06=t.m09,e.m07=t.m13,e.m08=i,e.m09=o,e.m11=t.m14,e.m12=r,e.m13=a,e.m14=s}else e.m00=t.m00,e.m01=t.m04,e.m02=t.m08,e.m03=t.m12,e.m04=t.m01,e.m05=t.m05,e.m06=t.m09,e.m07=t.m13,e.m08=t.m02,e.m09=t.m06,e.m10=t.m10,e.m11=t.m14,e.m12=t.m03,e.m13=t.m07,e.m14=t.m11,e.m15=t.m15;return e},t.invert=function(e,t){var n=t.m00,i=t.m01,r=t.m02,o=t.m03,a=t.m04,s=t.m05,c=t.m06,l=t.m07,u=t.m08,h=t.m09,_=t.m10,f=t.m11,m=t.m12,d=t.m13,p=t.m14,v=t.m15,g=n*s-i*a,y=n*c-r*a,x=n*l-o*a,E=i*c-r*s,S=i*l-o*s,T=r*l-o*c,A=u*d-h*m,C=u*p-_*m,w=u*v-f*m,I=h*p-_*d,b=h*v-f*d,R=_*v-f*p,O=g*R-y*b+x*I+E*w-S*C+T*A;return 0===O?(e.m00=0,e.m01=0,e.m02=0,e.m03=0,e.m04=0,e.m05=0,e.m06=0,e.m07=0,e.m08=0,e.m09=0,e.m10=0,e.m11=0,e.m12=0,e.m13=0,e.m14=0,e.m15=0,e):(O=1/O,e.m00=(s*R-c*b+l*I)*O,e.m01=(r*b-i*R-o*I)*O,e.m02=(d*T-p*S+v*E)*O,e.m03=(_*S-h*T-f*E)*O,e.m04=(c*w-a*R-l*C)*O,e.m05=(n*R-r*w+o*C)*O,e.m06=(p*x-m*T-v*y)*O,e.m07=(u*T-_*x+f*y)*O,e.m08=(a*b-s*w+l*A)*O,e.m09=(i*w-n*b-o*A)*O,e.m10=(m*S-d*x+v*g)*O,e.m11=(h*x-u*S-f*g)*O,e.m12=(s*C-a*I-c*A)*O,e.m13=(n*I-i*C+r*A)*O,e.m14=(d*y-m*E-p*g)*O,e.m15=(u*E-h*y+_*g)*O,e)},t.determinant=function(e){var t=e.m00,n=e.m01,i=e.m02,r=e.m03,o=e.m04,a=e.m05,s=e.m06,c=e.m07,l=e.m08,u=e.m09,h=e.m10,_=e.m11,f=e.m12,m=e.m13,d=e.m14,p=e.m15;return(t*a-n*o)*(h*p-_*d)-(t*s-i*o)*(u*p-_*m)+(t*c-r*o)*(u*d-h*m)+(n*s-i*a)*(l*p-_*f)-(n*c-r*a)*(l*d-h*f)+(i*c-r*s)*(l*m-u*f)},t.multiply=function(e,t,n){var i=t.m00,r=t.m01,o=t.m02,a=t.m03,s=t.m04,c=t.m05,l=t.m06,u=t.m07,h=t.m08,_=t.m09,f=t.m10,m=t.m11,d=t.m12,p=t.m13,v=t.m14,g=t.m15,y=n.m00,x=n.m01,E=n.m02,S=n.m03;return e.m00=y*i+x*s+E*h+S*d,e.m01=y*r+x*c+E*_+S*p,e.m02=y*o+x*l+E*f+S*v,e.m03=y*a+x*u+E*m+S*g,y=n.m04,x=n.m05,E=n.m06,S=n.m07,e.m04=y*i+x*s+E*h+S*d,e.m05=y*r+x*c+E*_+S*p,e.m06=y*o+x*l+E*f+S*v,e.m07=y*a+x*u+E*m+S*g,y=n.m08,x=n.m09,E=n.m10,S=n.m11,e.m08=y*i+x*s+E*h+S*d,e.m09=y*r+x*c+E*_+S*p,e.m10=y*o+x*l+E*f+S*v,e.m11=y*a+x*u+E*m+S*g,y=n.m12,x=n.m13,E=n.m14,S=n.m15,e.m12=y*i+x*s+E*h+S*d,e.m13=y*r+x*c+E*_+S*p,e.m14=y*o+x*l+E*f+S*v,e.m15=y*a+x*u+E*m+S*g,e},t.transform=function(e,t,n){var i=n.x,r=n.y,o=n.z;if(t===e)e.m12=t.m00*i+t.m04*r+t.m08*o+t.m12,e.m13=t.m01*i+t.m05*r+t.m09*o+t.m13,e.m14=t.m02*i+t.m06*r+t.m10*o+t.m14,e.m15=t.m03*i+t.m07*r+t.m11*o+t.m15;else{var a=t.m00,s=t.m01,c=t.m02,l=t.m03,u=t.m04,h=t.m05,_=t.m06,f=t.m07,m=t.m08,d=t.m09,p=t.m10,v=t.m11;t.m12,t.m13,t.m14,t.m15,e.m00=a,e.m01=s,e.m02=c,e.m03=l,e.m04=u,e.m05=h,e.m06=_,e.m07=f,e.m08=m,e.m09=d,e.m10=p,e.m11=v,e.m12=a*i+u*r+m*o+t.m12,e.m13=s*i+h*r+d*o+t.m13,e.m14=c*i+_*r+p*o+t.m14,e.m15=l*i+f*r+v*o+t.m15}return e},t.translate=function(e,t,n){return console.warn("function changed"),t===e?(e.m12+=n.x,e.m13+=n.y,e.m14+=n.z):(e.m00=t.m00,e.m01=t.m01,e.m02=t.m02,e.m03=t.m03,e.m04=t.m04,e.m05=t.m05,e.m06=t.m06,e.m07=t.m07,e.m08=t.m08,e.m09=t.m09,e.m10=t.m10,e.m11=t.m11,e.m12+=n.x,e.m13+=n.y,e.m14+=n.z,e.m15=t.m15),e},t.scale=function(e,t,n){var i=n.x,r=n.y,o=n.z;return e.m00=t.m00*i,e.m01=t.m01*i,e.m02=t.m02*i,e.m03=t.m03*i,e.m04=t.m04*r,e.m05=t.m05*r,e.m06=t.m06*r,e.m07=t.m07*r,e.m08=t.m08*o,e.m09=t.m09*o,e.m10=t.m10*o,e.m11=t.m11*o,e.m12=t.m12,e.m13=t.m13,e.m14=t.m14,e.m15=t.m15,e},t.rotate=function(e,t,n,i){var r=i.x,o=i.y,a=i.z,s=Math.sqrt(r*r+o*o+a*a);if(Math.abs(s)<vn)return null;r*=s=1/s,o*=s,a*=s;var c=Math.sin(n),l=Math.cos(n),u=1-l,h=t.m00,_=t.m01,f=t.m02,m=t.m03,d=t.m04,p=t.m05,v=t.m06,g=t.m07,y=t.m08,x=t.m09,E=t.m10,S=t.m11,T=r*r*u+l,A=o*r*u+a*c,C=a*r*u-o*c,w=r*o*u-a*c,I=o*o*u+l,b=a*o*u+r*c,R=r*a*u+o*c,O=o*a*u-r*c,N=a*a*u+l;return e.m00=h*T+d*A+y*C,e.m01=_*T+p*A+x*C,e.m02=f*T+v*A+E*C,e.m03=m*T+g*A+S*C,e.m04=h*w+d*I+y*b,e.m05=_*w+p*I+x*b,e.m06=f*w+v*I+E*b,e.m07=m*w+g*I+S*b,e.m08=h*R+d*O+y*N,e.m09=_*R+p*O+x*N,e.m10=f*R+v*O+E*N,e.m11=m*R+g*O+S*N,t!==e&&(e.m12=t.m12,e.m13=t.m13,e.m14=t.m14,e.m15=t.m15),e},t.rotateX=function(e,t,n){var i=Math.sin(n),r=Math.cos(n),o=t.m04,a=t.m05,s=t.m06,c=t.m07,l=t.m08,u=t.m09,h=t.m10,_=t.m11;return t!==e&&(e.m00=t.m00,e.m01=t.m01,e.m02=t.m02,e.m03=t.m03,e.m12=t.m12,e.m13=t.m13,e.m14=t.m14,e.m15=t.m15),e.m04=o*r+l*i,e.m05=a*r+u*i,e.m06=s*r+h*i,e.m07=c*r+_*i,e.m08=l*r-o*i,e.m09=u*r-a*i,e.m10=h*r-s*i,e.m11=_*r-c*i,e},t.rotateY=function(e,t,n){var i=Math.sin(n),r=Math.cos(n),o=t.m00,a=t.m01,s=t.m02,c=t.m03,l=t.m08,u=t.m09,h=t.m10,_=t.m11;return t!==e&&(e.m04=t.m04,e.m05=t.m05,e.m06=t.m06,e.m07=t.m07,e.m12=t.m12,e.m13=t.m13,e.m14=t.m14,e.m15=t.m15),e.m00=o*r-l*i,e.m01=a*r-u*i,e.m02=s*r-h*i,e.m03=c*r-_*i,e.m08=o*i+l*r,e.m09=a*i+u*r,e.m10=s*i+h*r,e.m11=c*i+_*r,e},t.rotateZ=function(e,t,n){var i=Math.sin(n),r=Math.cos(n),o=t.m00,a=t.m01,s=t.m02,c=t.m03,l=t.m04,u=t.m05,h=t.m06,_=t.m07;return t!==e&&(e.m08=t.m08,e.m09=t.m09,e.m10=t.m10,e.m11=t.m11,e.m12=t.m12,e.m13=t.m13,e.m14=t.m14,e.m15=t.m15),e.m00=o*r+l*i,e.m01=a*r+u*i,e.m02=s*r+h*i,e.m03=c*r+_*i,e.m04=l*r-o*i,e.m05=u*r-a*i,e.m06=h*r-s*i,e.m07=_*r-c*i,e},t.fromTranslation=function(e,t){return e.m00=1,e.m01=0,e.m02=0,e.m03=0,e.m04=0,e.m05=1,e.m06=0,e.m07=0,e.m08=0,e.m09=0,e.m10=1,e.m11=0,e.m12=t.x,e.m13=t.y,e.m14=t.z,e.m15=1,e},t.fromScaling=function(e,t){return e.m00=t.x,e.m01=0,e.m02=0,e.m03=0,e.m04=0,e.m05=t.y,e.m06=0,e.m07=0,e.m08=0,e.m09=0,e.m10=t.z,e.m11=0,e.m12=0,e.m13=0,e.m14=0,e.m15=1,e},t.fromRotation=function(e,t,n){var i=n.x,r=n.y,o=n.z,a=Math.sqrt(i*i+r*r+o*o);if(Math.abs(a)<vn)return null;i*=a=1/a,r*=a,o*=a;var s=Math.sin(t),c=Math.cos(t),l=1-c;return e.m00=i*i*l+c,e.m01=r*i*l+o*s,e.m02=o*i*l-r*s,e.m03=0,e.m04=i*r*l-o*s,e.m05=r*r*l+c,e.m06=o*r*l+i*s,e.m07=0,e.m08=i*o*l+r*s,e.m09=r*o*l-i*s,e.m10=o*o*l+c,e.m11=0,e.m12=0,e.m13=0,e.m14=0,e.m15=1,e},t.fromXRotation=function(e,t){var n=Math.sin(t),i=Math.cos(t);return e.m00=1,e.m01=0,e.m02=0,e.m03=0,e.m04=0,e.m05=i,e.m06=n,e.m07=0,e.m08=0,e.m09=-n,e.m10=i,e.m11=0,e.m12=0,e.m13=0,e.m14=0,e.m15=1,e},t.fromYRotation=function(e,t){var n=Math.sin(t),i=Math.cos(t);return e.m00=i,e.m01=0,e.m02=-n,e.m03=0,e.m04=0,e.m05=1,e.m06=0,e.m07=0,e.m08=n,e.m09=0,e.m10=i,e.m11=0,e.m12=0,e.m13=0,e.m14=0,e.m15=1,e},t.fromZRotation=function(e,t){var n=Math.sin(t),i=Math.cos(t);return e.m00=i,e.m01=n,e.m02=0,e.m03=0,e.m04=-n,e.m05=i,e.m06=0,e.m07=0,e.m08=0,e.m09=0,e.m10=1,e.m11=0,e.m12=0,e.m13=0,e.m14=0,e.m15=1,e},t.fromRT=function(e,t,n){var i=t.x,r=t.y,o=t.z,a=t.w,s=i+i,c=r+r,l=o+o,u=i*s,h=i*c,_=i*l,f=r*c,m=r*l,d=o*l,p=a*s,v=a*c,g=a*l;return e.m00=1-(f+d),e.m01=h+g,e.m02=_-v,e.m03=0,e.m04=h-g,e.m05=1-(u+d),e.m06=m+p,e.m07=0,e.m08=_+v,e.m09=m-p,e.m10=1-(u+f),e.m11=0,e.m12=n.x,e.m13=n.y,e.m14=n.z,e.m15=1,e},t.getTranslation=function(e,t){return e.x=t.m12,e.y=t.m13,e.z=t.m14,e},t.getScaling=function(e,t){var n=ni.m00=t.m00,i=ni.m01=t.m01,r=ni.m02=t.m02,o=ni.m03=t.m04,a=ni.m04=t.m05,s=ni.m05=t.m06,c=ni.m06=t.m08,l=ni.m07=t.m09,u=ni.m08=t.m10;return e.x=Math.sqrt(n*n+i*i+r*r),e.y=Math.sqrt(o*o+a*a+s*s),e.z=Math.sqrt(c*c+l*l+u*u),Vn.determinant(ni)<0&&(e.x*=-1),e},t.getRotation=function(e,t){var n=t.m00+t.m05+t.m10,i=0;return n>0?(i=2*Math.sqrt(n+1),e.w=.25*i,e.x=(t.m06-t.m09)/i,e.y=(t.m08-t.m02)/i,e.z=(t.m01-t.m04)/i):t.m00>t.m05&&t.m00>t.m10?(i=2*Math.sqrt(1+t.m00-t.m05-t.m10),e.w=(t.m06-t.m09)/i,e.x=.25*i,e.y=(t.m01+t.m04)/i,e.z=(t.m08+t.m02)/i):t.m05>t.m10?(i=2*Math.sqrt(1+t.m05-t.m00-t.m10),e.w=(t.m08-t.m02)/i,e.x=(t.m01+t.m04)/i,e.y=.25*i,e.z=(t.m06+t.m09)/i):(i=2*Math.sqrt(1+t.m10-t.m00-t.m05),e.w=(t.m01-t.m04)/i,e.x=(t.m08+t.m02)/i,e.y=(t.m06+t.m09)/i,e.z=.25*i),e},t.toRTS=function(e,t,n,i){i.x=Un.set(ti,e.m00,e.m01,e.m02).length(),ni.m00=e.m00/i.x,ni.m01=e.m01/i.x,ni.m02=e.m02/i.x,i.y=Un.set(ti,e.m04,e.m05,e.m06).length(),ni.m03=e.m04/i.y,ni.m04=e.m05/i.y,ni.m05=e.m06/i.y,i.z=Un.set(ti,e.m08,e.m09,e.m10).length(),ni.m06=e.m08/i.z,ni.m07=e.m09/i.z,ni.m08=e.m10/i.z,Vn.determinant(ni)<0&&(i.x*=-1,ni.m00*=-1,ni.m01*=-1,ni.m02*=-1),qn.fromMat3(t,ni),Un.set(n,e.m12,e.m13,e.m14)},t.fromRTS=function(e,t,n,i){var r=t.x,o=t.y,a=t.z,s=t.w,c=r+r,l=o+o,u=a+a,h=r*c,_=r*l,f=r*u,m=o*l,d=o*u,p=a*u,v=s*c,g=s*l,y=s*u,x=i.x,E=i.y,S=i.z;return e.m00=(1-(m+p))*x,e.m01=(_+y)*x,e.m02=(f-g)*x,e.m03=0,e.m04=(_-y)*E,e.m05=(1-(h+p))*E,e.m06=(d+v)*E,e.m07=0,e.m08=(f+g)*S,e.m09=(d-v)*S,e.m10=(1-(h+m))*S,e.m11=0,e.m12=n.x,e.m13=n.y,e.m14=n.z,e.m15=1,e},t.fromRTSOrigin=function(e,t,n,i,r){var o=t.x,a=t.y,s=t.z,c=t.w,l=o+o,u=a+a,h=s+s,_=o*l,f=o*u,m=o*h,d=a*u,p=a*h,v=s*h,g=c*l,y=c*u,x=c*h,E=i.x,S=i.y,T=i.z,A=r.x,C=r.y,w=r.z;return e.m00=(1-(d+v))*E,e.m01=(f+x)*E,e.m02=(m-y)*E,e.m03=0,e.m04=(f-x)*S,e.m05=(1-(_+v))*S,e.m06=(p+g)*S,e.m07=0,e.m08=(m+y)*T,e.m09=(p-g)*T,e.m10=(1-(_+d))*T,e.m11=0,e.m12=n.x+A-(e.m00*A+e.m04*C+e.m08*w),e.m13=n.y+C-(e.m01*A+e.m05*C+e.m09*w),e.m14=n.z+w-(e.m02*A+e.m06*C+e.m10*w),e.m15=1,e},t.fromQuat=function(e,t){var n=t.x,i=t.y,r=t.z,o=t.w,a=n+n,s=i+i,c=r+r,l=n*a,u=i*a,h=i*s,_=r*a,f=r*s,m=r*c,d=o*a,p=o*s,v=o*c;return e.m00=1-h-m,e.m01=u+v,e.m02=_-p,e.m03=0,e.m04=u-v,e.m05=1-l-m,e.m06=f+d,e.m07=0,e.m08=_+p,e.m09=f-d,e.m10=1-l-h,e.m11=0,e.m12=0,e.m13=0,e.m14=0,e.m15=1,e},t.frustum=function(e,t,n,i,r,o,a){var s=1/(n-t),c=1/(r-i),l=1/(o-a);return e.m00=2*o*s,e.m01=0,e.m02=0,e.m03=0,e.m04=0,e.m05=2*o*c,e.m06=0,e.m07=0,e.m08=(n+t)*s,e.m09=(r+i)*c,e.m10=(a+o)*l,e.m11=-1,e.m12=0,e.m13=0,e.m14=a*o*2*l,e.m15=0,e},t.perspective=function(e,t,n,i,r,o,a,s,c){void 0===o&&(o=!0),void 0===a&&(a=-1),void 0===s&&(s=1),void 0===c&&(c=0);var l=1/Math.tan(t/2),u=1/(i-r),h=o?l/n:l,_=(o?l:l*n)*s,f=$n[c];return e.m00=h*f[0],e.m01=h*f[1],e.m02=0,e.m03=0,e.m04=_*f[2],e.m05=_*f[3],e.m06=0,e.m07=0,e.m08=0,e.m09=0,e.m10=(r-a*i)*u,e.m11=-1,e.m12=0,e.m13=0,e.m14=r*i*u*(1-a),e.m15=0,e},t.ortho=function(e,t,n,i,r,o,a,s,c,l){void 0===s&&(s=-1),void 0===c&&(c=1),void 0===l&&(l=0);var u=1/(t-n),h=1/(i-r)*c,_=1/(o-a),f=-2*u,m=-2*h,d=(t+n)*u,p=(r+i)*h,v=$n[l];return e.m00=f*v[0],e.m01=f*v[1],e.m02=0,e.m03=0,e.m04=m*v[2],e.m05=m*v[3],e.m06=0,e.m07=0,e.m08=0,e.m09=0,e.m10=_*(1-s),e.m11=0,e.m12=d*v[0]+p*v[2],e.m13=d*v[1]+p*v[3],e.m14=(o-s*a)*_,e.m15=1,e},t.lookAt=function(e,t,n,i){var r=t.x,o=t.y,a=t.z,s=i.x,c=i.y,l=i.z,u=r-n.x,h=o-n.y,_=a-n.z,f=1/Math.sqrt(u*u+h*h+_*_),m=c*(_*=f)-l*(h*=f),d=l*(u*=f)-s*_,p=s*h-c*u,v=h*(p*=f=1/Math.sqrt(m*m+d*d+p*p))-_*(d*=f),g=_*(m*=f)-u*p,y=u*d-h*m;return e.m00=m,e.m01=v,e.m02=u,e.m03=0,e.m04=d,e.m05=g,e.m06=h,e.m07=0,e.m08=p,e.m09=y,e.m10=_,e.m11=0,e.m12=-(m*r+d*o+p*a),e.m13=-(v*r+g*o+y*a),e.m14=-(u*r+h*o+_*a),e.m15=1,e},t.inverseTranspose=function(e,t){var n=t.m00,i=t.m01,r=t.m02,o=t.m03,a=t.m04,s=t.m05,c=t.m06,l=t.m07,u=t.m08,h=t.m09,_=t.m10,f=t.m11,m=t.m12,d=t.m13,p=t.m14,v=t.m15,g=n*s-i*a,y=n*c-r*a,x=n*l-o*a,E=i*c-r*s,S=i*l-o*s,T=r*l-o*c,A=u*d-h*m,C=u*p-_*m,w=u*v-f*m,I=h*p-_*d,b=h*v-f*d,R=_*v-f*p,O=g*R-y*b+x*I+E*w-S*C+T*A;return O?(O=1/O,e.m00=(s*R-c*b+l*I)*O,e.m01=(c*w-a*R-l*C)*O,e.m02=(a*b-s*w+l*A)*O,e.m03=0,e.m04=(r*b-i*R-o*I)*O,e.m05=(n*R-r*w+o*C)*O,e.m06=(i*w-n*b-o*A)*O,e.m07=0,e.m08=(d*T-p*S+v*E)*O,e.m09=(p*x-m*T-v*y)*O,e.m10=(m*S-d*x+v*g)*O,e.m11=0,e.m12=0,e.m13=0,e.m14=0,e.m15=1,e):null},t.toArray=function(e,t,n){return void 0===n&&(n=0),e[n+0]=t.m00,e[n+1]=t.m01,e[n+2]=t.m02,e[n+3]=t.m03,e[n+4]=t.m04,e[n+5]=t.m05,e[n+6]=t.m06,e[n+7]=t.m07,e[n+8]=t.m08,e[n+9]=t.m09,e[n+10]=t.m10,e[n+11]=t.m11,e[n+12]=t.m12,e[n+13]=t.m13,e[n+14]=t.m14,e[n+15]=t.m15,e},t.fromArray=function(e,t,n){return void 0===n&&(n=0),e.m00=t[n+0],e.m01=t[n+1],e.m02=t[n+2],e.m03=t[n+3],e.m04=t[n+4],e.m05=t[n+5],e.m06=t[n+6],e.m07=t[n+7],e.m08=t[n+8],e.m09=t[n+9],e.m10=t[n+10],e.m11=t[n+11],e.m12=t[n+12],e.m13=t[n+13],e.m14=t[n+14],e.m15=t[n+15],e},t.add=function(e,t,n){return e.m00=t.m00+n.m00,e.m01=t.m01+n.m01,e.m02=t.m02+n.m02,e.m03=t.m03+n.m03,e.m04=t.m04+n.m04,e.m05=t.m05+n.m05,e.m06=t.m06+n.m06,e.m07=t.m07+n.m07,e.m08=t.m08+n.m08,e.m09=t.m09+n.m09,e.m10=t.m10+n.m10,e.m11=t.m11+n.m11,e.m12=t.m12+n.m12,e.m13=t.m13+n.m13,e.m14=t.m14+n.m14,e.m15=t.m15+n.m15,e},t.subtract=function(e,t,n){return e.m00=t.m00-n.m00,e.m01=t.m01-n.m01,e.m02=t.m02-n.m02,e.m03=t.m03-n.m03,e.m04=t.m04-n.m04,e.m05=t.m05-n.m05,e.m06=t.m06-n.m06,e.m07=t.m07-n.m07,e.m08=t.m08-n.m08,e.m09=t.m09-n.m09,e.m10=t.m10-n.m10,e.m11=t.m11-n.m11,e.m12=t.m12-n.m12,e.m13=t.m13-n.m13,e.m14=t.m14-n.m14,e.m15=t.m15-n.m15,e},t.multiplyScalar=function(e,t,n){return e.m00=t.m00*n,e.m01=t.m01*n,e.m02=t.m02*n,e.m03=t.m03*n,e.m04=t.m04*n,e.m05=t.m05*n,e.m06=t.m06*n,e.m07=t.m07*n,e.m08=t.m08*n,e.m09=t.m09*n,e.m10=t.m10*n,e.m11=t.m11*n,e.m12=t.m12*n,e.m13=t.m13*n,e.m14=t.m14*n,e.m15=t.m15*n,e},t.multiplyScalarAndAdd=function(e,t,n,i){return e.m00=t.m00+n.m00*i,e.m01=t.m01+n.m01*i,e.m02=t.m02+n.m02*i,e.m03=t.m03+n.m03*i,e.m04=t.m04+n.m04*i,e.m05=t.m05+n.m05*i,e.m06=t.m06+n.m06*i,e.m07=t.m07+n.m07*i,e.m08=t.m08+n.m08*i,e.m09=t.m09+n.m09*i,e.m10=t.m10+n.m10*i,e.m11=t.m11+n.m11*i,e.m12=t.m12+n.m12*i,e.m13=t.m13+n.m13*i,e.m14=t.m14+n.m14*i,e.m15=t.m15+n.m15*i,e},t.strictEquals=function(e,t){return e.m00===t.m00&&e.m01===t.m01&&e.m02===t.m02&&e.m03===t.m03&&e.m04===t.m04&&e.m05===t.m05&&e.m06===t.m06&&e.m07===t.m07&&e.m08===t.m08&&e.m09===t.m09&&e.m10===t.m10&&e.m11===t.m11&&e.m12===t.m12&&e.m13===t.m13&&e.m14===t.m14&&e.m15===t.m15},t.equals=function(e,t,n){return void 0===n&&(n=vn),Math.abs(e.m00-t.m00)<=n*Math.max(1,Math.abs(e.m00),Math.abs(t.m00))&&Math.abs(e.m01-t.m01)<=n*Math.max(1,Math.abs(e.m01),Math.abs(t.m01))&&Math.abs(e.m02-t.m02)<=n*Math.max(1,Math.abs(e.m02),Math.abs(t.m02))&&Math.abs(e.m03-t.m03)<=n*Math.max(1,Math.abs(e.m03),Math.abs(t.m03))&&Math.abs(e.m04-t.m04)<=n*Math.max(1,Math.abs(e.m04),Math.abs(t.m04))&&Math.abs(e.m05-t.m05)<=n*Math.max(1,Math.abs(e.m05),Math.abs(t.m05))&&Math.abs(e.m06-t.m06)<=n*Math.max(1,Math.abs(e.m06),Math.abs(t.m06))&&Math.abs(e.m07-t.m07)<=n*Math.max(1,Math.abs(e.m07),Math.abs(t.m07))&&Math.abs(e.m08-t.m08)<=n*Math.max(1,Math.abs(e.m08),Math.abs(t.m08))&&Math.abs(e.m09-t.m09)<=n*Math.max(1,Math.abs(e.m09),Math.abs(t.m09))&&Math.abs(e.m10-t.m10)<=n*Math.max(1,Math.abs(e.m10),Math.abs(t.m10))&&Math.abs(e.m11-t.m11)<=n*Math.max(1,Math.abs(e.m11),Math.abs(t.m11))&&Math.abs(e.m12-t.m12)<=n*Math.max(1,Math.abs(e.m12),Math.abs(t.m12))&&Math.abs(e.m13-t.m13)<=n*Math.max(1,Math.abs(e.m13),Math.abs(t.m13))&&Math.abs(e.m14-t.m14)<=n*Math.max(1,Math.abs(e.m14),Math.abs(t.m14))&&Math.abs(e.m15-t.m15)<=n*Math.max(1,Math.abs(e.m15),Math.abs(t.m15))};var n=t.prototype;return n.clone=function(){return new t(this.m00,this.m01,this.m02,this.m03,this.m04,this.m05,this.m06,this.m07,this.m08,this.m09,this.m10,this.m11,this.m12,this.m13,this.m14,this.m15)},n.set=function(e,t,n,i,r,o,a,s,c,l,u,h,_,f,m,d){return void 0===e&&(e=1),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=1),void 0===a&&(a=0),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=0),void 0===u&&(u=1),void 0===h&&(h=0),void 0===_&&(_=0),void 0===f&&(f=0),void 0===m&&(m=0),void 0===d&&(d=1),"object"==typeof e?(this.m01=e.m01,this.m02=e.m02,this.m03=e.m03,this.m04=e.m04,this.m05=e.m05,this.m06=e.m06,this.m07=e.m07,this.m08=e.m08,this.m09=e.m09,this.m10=e.m10,this.m11=e.m11,this.m12=e.m12,this.m13=e.m13,this.m14=e.m14,this.m15=e.m15,this.m00=e.m00):(this.m01=t,this.m02=n,this.m03=i,this.m04=r,this.m05=o,this.m06=a,this.m07=s,this.m08=c,this.m09=l,this.m10=u,this.m11=h,this.m12=_,this.m13=f,this.m14=m,this.m15=d,this.m00=e),this},n.equals=function(e,t){return void 0===t&&(t=vn),Math.abs(this.m00-e.m00)<=t*Math.max(1,Math.abs(this.m00),Math.abs(e.m00))&&Math.abs(this.m01-e.m01)<=t*Math.max(1,Math.abs(this.m01),Math.abs(e.m01))&&Math.abs(this.m02-e.m02)<=t*Math.max(1,Math.abs(this.m02),Math.abs(e.m02))&&Math.abs(this.m03-e.m03)<=t*Math.max(1,Math.abs(this.m03),Math.abs(e.m03))&&Math.abs(this.m04-e.m04)<=t*Math.max(1,Math.abs(this.m04),Math.abs(e.m04))&&Math.abs(this.m05-e.m05)<=t*Math.max(1,Math.abs(this.m05),Math.abs(e.m05))&&Math.abs(this.m06-e.m06)<=t*Math.max(1,Math.abs(this.m06),Math.abs(e.m06))&&Math.abs(this.m07-e.m07)<=t*Math.max(1,Math.abs(this.m07),Math.abs(e.m07))&&Math.abs(this.m08-e.m08)<=t*Math.max(1,Math.abs(this.m08),Math.abs(e.m08))&&Math.abs(this.m09-e.m09)<=t*Math.max(1,Math.abs(this.m09),Math.abs(e.m09))&&Math.abs(this.m10-e.m10)<=t*Math.max(1,Math.abs(this.m10),Math.abs(e.m10))&&Math.abs(this.m11-e.m11)<=t*Math.max(1,Math.abs(this.m11),Math.abs(e.m11))&&Math.abs(this.m12-e.m12)<=t*Math.max(1,Math.abs(this.m12),Math.abs(e.m12))&&Math.abs(this.m13-e.m13)<=t*Math.max(1,Math.abs(this.m13),Math.abs(e.m13))&&Math.abs(this.m14-e.m14)<=t*Math.max(1,Math.abs(this.m14),Math.abs(e.m14))&&Math.abs(this.m15-e.m15)<=t*Math.max(1,Math.abs(this.m15),Math.abs(e.m15))},n.strictEquals=function(e){return this.m00===e.m00&&this.m01===e.m01&&this.m02===e.m02&&this.m03===e.m03&&this.m04===e.m04&&this.m05===e.m05&&this.m06===e.m06&&this.m07===e.m07&&this.m08===e.m08&&this.m09===e.m09&&this.m10===e.m10&&this.m11===e.m11&&this.m12===e.m12&&this.m13===e.m13&&this.m14===e.m14&&this.m15===e.m15},n.toString=function(){return"[\n"+this.m00+", "+this.m01+", "+this.m02+", "+this.m03+",\n"+this.m04+", "+this.m05+", "+this.m06+", "+this.m07+",\n"+this.m08+", "+this.m09+", "+this.m10+", "+this.m11+",\n"+this.m12+", "+this.m13+", "+this.m14+", "+this.m15+"\n]"},n.identity=function(){return this.m00=1,this.m01=0,this.m02=0,this.m03=0,this.m04=0,this.m05=1,this.m06=0,this.m07=0,this.m08=0,this.m09=0,this.m10=1,this.m11=0,this.m12=0,this.m13=0,this.m14=0,this.m15=1,this},n.zero=function(){return this.m00=0,this.m01=0,this.m02=0,this.m03=0,this.m04=0,this.m05=0,this.m06=0,this.m07=0,this.m08=0,this.m09=0,this.m10=0,this.m11=0,this.m12=0,this.m13=0,this.m14=0,this.m15=0,this},n.transpose=function(){var e=this.m01,t=this.m02,n=this.m03,i=this.m06,r=this.m07,o=this.m11;return this.m01=this.m04,this.m02=this.m08,this.m03=this.m12,this.m04=e,this.m06=this.m09,this.m07=this.m13,this.m08=t,this.m09=i,this.m11=this.m14,this.m12=n,this.m13=r,this.m14=o,this},n.invert=function(){var e=this.m00,t=this.m01,n=this.m02,i=this.m03,r=this.m04,o=this.m05,a=this.m06,s=this.m07,c=this.m08,l=this.m09,u=this.m10,h=this.m11,_=this.m12,f=this.m13,m=this.m14,d=this.m15,p=e*o-t*r,v=e*a-n*r,g=e*s-i*r,y=t*a-n*o,x=t*s-i*o,E=n*s-i*a,S=c*f-l*_,T=c*m-u*_,A=c*d-h*_,C=l*m-u*f,w=l*d-h*f,I=u*d-h*m,b=p*I-v*w+g*C+y*A-x*T+E*S;return 0===b?(this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),this):(b=1/b,this.m00=(o*I-a*w+s*C)*b,this.m01=(n*w-t*I-i*C)*b,this.m02=(f*E-m*x+d*y)*b,this.m03=(u*x-l*E-h*y)*b,this.m04=(a*A-r*I-s*T)*b,this.m05=(e*I-n*A+i*T)*b,this.m06=(m*g-_*E-d*v)*b,this.m07=(c*E-u*g+h*v)*b,this.m08=(r*w-o*A+s*S)*b,this.m09=(t*A-e*w-i*S)*b,this.m10=(_*x-f*g+d*p)*b,this.m11=(l*g-c*x-h*p)*b,this.m12=(o*T-r*C-a*S)*b,this.m13=(e*C-t*T+n*S)*b,this.m14=(f*v-_*y-m*p)*b,this.m15=(c*y-l*v+u*p)*b,this)},n.determinant=function(){var e=this.m00,t=this.m01,n=this.m02,i=this.m03,r=this.m04,o=this.m05,a=this.m06,s=this.m07,c=this.m08,l=this.m09,u=this.m10,h=this.m11,_=this.m12,f=this.m13,m=this.m14,d=this.m15;return(e*o-t*r)*(u*d-h*m)-(e*a-n*r)*(l*d-h*f)+(e*s-i*r)*(l*m-u*f)+(t*a-n*o)*(c*d-h*_)-(t*s-i*o)*(c*m-u*_)+(n*s-i*a)*(c*f-l*_)},n.add=function(e){return this.m00+=e.m00,this.m01+=e.m01,this.m02+=e.m02,this.m03+=e.m03,this.m04+=e.m04,this.m05+=e.m05,this.m06+=e.m06,this.m07+=e.m07,this.m08+=e.m08,this.m09+=e.m09,this.m10+=e.m10,this.m11+=e.m11,this.m12+=e.m12,this.m13+=e.m13,this.m14+=e.m14,this.m15+=e.m15,this},n.subtract=function(e){return this.m00-=e.m00,this.m01-=e.m01,this.m02-=e.m02,this.m03-=e.m03,this.m04-=e.m04,this.m05-=e.m05,this.m06-=e.m06,this.m07-=e.m07,this.m08-=e.m08,this.m09-=e.m09,this.m10-=e.m10,this.m11-=e.m11,this.m12-=e.m12,this.m13-=e.m13,this.m14-=e.m14,this.m15-=e.m15,this},n.multiply=function(e){var t=this.m00,n=this.m01,i=this.m02,r=this.m03,o=this.m04,a=this.m05,s=this.m06,c=this.m07,l=this.m08,u=this.m09,h=this.m10,_=this.m11,f=this.m12,m=this.m13,d=this.m14,p=this.m15,v=e.m00,g=e.m01,y=e.m02,x=e.m03;return this.m00=v*t+g*o+y*l+x*f,this.m01=v*n+g*a+y*u+x*m,this.m02=v*i+g*s+y*h+x*d,this.m03=v*r+g*c+y*_+x*p,v=e.m04,g=e.m05,y=e.m06,x=e.m07,this.m04=v*t+g*o+y*l+x*f,this.m05=v*n+g*a+y*u+x*m,this.m06=v*i+g*s+y*h+x*d,this.m07=v*r+g*c+y*_+x*p,v=e.m08,g=e.m09,y=e.m10,x=e.m11,this.m08=v*t+g*o+y*l+x*f,this.m09=v*n+g*a+y*u+x*m,this.m10=v*i+g*s+y*h+x*d,this.m11=v*r+g*c+y*_+x*p,v=e.m12,g=e.m13,y=e.m14,x=e.m15,this.m12=v*t+g*o+y*l+x*f,this.m13=v*n+g*a+y*u+x*m,this.m14=v*i+g*s+y*h+x*d,this.m15=v*r+g*c+y*_+x*p,this},n.multiplyScalar=function(e){return this.m00*=e,this.m01*=e,this.m02*=e,this.m03*=e,this.m04*=e,this.m05*=e,this.m06*=e,this.m07*=e,this.m08*=e,this.m09*=e,this.m10*=e,this.m11*=e,this.m12*=e,this.m13*=e,this.m14*=e,this.m15*=e,this},n.translate=function(e){return console.warn("function changed"),this.m12+=e.x,this.m13+=e.y,this.m14+=e.z,this},n.scale=function(e){var t=e.x,n=e.y,i=e.z;return this.m00*=t,this.m01*=t,this.m02*=t,this.m03*=t,this.m04*=n,this.m05*=n,this.m06*=n,this.m07*=n,this.m08*=i,this.m09*=i,this.m10*=i,this.m11*=i,this},n.rotate=function(e,t){var n=t.x,i=t.y,r=t.z,o=Math.sqrt(n*n+i*i+r*r);if(Math.abs(o)<vn)return null;n*=o=1/o,i*=o,r*=o;var a=Math.sin(e),s=Math.cos(e),c=1-s,l=this.m00,u=this.m01,h=this.m02,_=this.m03,f=this.m04,m=this.m05,d=this.m06,p=this.m07,v=this.m08,g=this.m09,y=this.m10,x=this.m11,E=n*n*c+s,S=i*n*c+r*a,T=r*n*c-i*a,A=n*i*c-r*a,C=i*i*c+s,w=r*i*c+n*a,I=n*r*c+i*a,b=i*r*c-n*a,R=r*r*c+s;return this.m00=l*E+f*S+v*T,this.m01=u*E+m*S+g*T,this.m02=h*E+d*S+y*T,this.m03=_*E+p*S+x*T,this.m04=l*A+f*C+v*w,this.m05=u*A+m*C+g*w,this.m06=h*A+d*C+y*w,this.m07=_*A+p*C+x*w,this.m08=l*I+f*b+v*R,this.m09=u*I+m*b+g*R,this.m10=h*I+d*b+y*R,this.m11=_*I+p*b+x*R,this},n.getTranslation=function(e){return e.x=this.m12,e.y=this.m13,e.z=this.m14,e},n.getScale=function(e){var t=ni.m00=this.m00,n=ni.m01=this.m01,i=ni.m02=this.m02,r=ni.m03=this.m04,o=ni.m04=this.m05,a=ni.m05=this.m06,s=ni.m06=this.m08,c=ni.m07=this.m09,l=ni.m08=this.m10;return e.x=Math.sqrt(t*t+n*n+i*i),e.y=Math.sqrt(r*r+o*o+a*a),e.z=Math.sqrt(s*s+c*c+l*l),Vn.determinant(ni)<0&&(e.x*=-1),e},n.getRotation=function(e){var t=this.m00+this.m05+this.m10,n=0;return t>0?(n=2*Math.sqrt(t+1),e.w=.25*n,e.x=(this.m06-this.m09)/n,e.y=(this.m08-this.m02)/n,e.z=(this.m01-this.m04)/n):this.m00>this.m05&&this.m00>this.m10?(n=2*Math.sqrt(1+this.m00-this.m05-this.m10),e.w=(this.m06-this.m09)/n,e.x=.25*n,e.y=(this.m01+this.m04)/n,e.z=(this.m08+this.m02)/n):this.m05>this.m10?(n=2*Math.sqrt(1+this.m05-this.m00-this.m10),e.w=(this.m08-this.m02)/n,e.x=(this.m01+this.m04)/n,e.y=.25*n,e.z=(this.m06+this.m09)/n):(n=2*Math.sqrt(1+this.m10-this.m00-this.m05),e.w=(this.m01-this.m04)/n,e.x=(this.m08+this.m02)/n,e.y=(this.m06+this.m09)/n,e.z=.25*n),e},n.fromRTS=function(e,t,n){var i=e.x,r=e.y,o=e.z,a=e.w,s=i+i,c=r+r,l=o+o,u=i*s,h=i*c,_=i*l,f=r*c,m=r*l,d=o*l,p=a*s,v=a*c,g=a*l,y=n.x,x=n.y,E=n.z;return this.m00=(1-(f+d))*y,this.m01=(h+g)*y,this.m02=(_-v)*y,this.m03=0,this.m04=(h-g)*x,this.m05=(1-(u+d))*x,this.m06=(m+p)*x,this.m07=0,this.m08=(_+v)*E,this.m09=(m-p)*E,this.m10=(1-(u+f))*E,this.m11=0,this.m12=t.x,this.m13=t.y,this.m14=t.z,this.m15=1,this},n.fromQuat=function(e){var t=e.x,n=e.y,i=e.z,r=e.w,o=t+t,a=n+n,s=i+i,c=t*o,l=n*o,u=n*a,h=i*o,_=i*a,f=i*s,m=r*o,d=r*a,p=r*s;return this.m00=1-u-f,this.m01=l+p,this.m02=h-d,this.m03=0,this.m04=l-p,this.m05=1-c-f,this.m06=_+m,this.m07=0,this.m08=h+d,this.m09=_-m,this.m10=1-c-u,this.m11=0,this.m12=0,this.m13=0,this.m14=0,this.m15=1,this},t}(At));ei.IDENTITY=Object.freeze(new ei);var ti=new Un,ni=new Vn;function ii(e,t,n,i,r,o,a,s,c,l,u,h,_,f,m,d){return new ei(e,t,n,i,r,o,a,s,c,l,u,h,_,f,m,d)}_n.fastDefine("cc.Mat4",ei,{m00:1,m01:0,m02:0,m03:0,m04:0,m05:1,m06:0,m07:0,m08:0,m09:0,m10:1,m11:0,m12:0,m13:0,m14:0,m15:1}),c.Mat4=ei,c.mat4=ii;var ri=e("bO",function(e){function t(t,n){var i;return i=e.call(this)||this,t&&"object"==typeof t?(i.x=t.x,i.y=t.y):(i.x=t||0,i.y=n||0),i}$(t,e),t.clone=function(e){return new t(e.x,e.y)},t.copy=function(e,t){return e.x=t.x,e.y=t.y,e},t.set=function(e,t,n){return e.x=t,e.y=n,e},t.add=function(e,t,n){return e.x=t.x+n.x,e.y=t.y+n.y,e},t.subtract=function(e,t,n){return e.x=t.x-n.x,e.y=t.y-n.y,e},t.multiply=function(e,t,n){return e.x=t.x*n.x,e.y=t.y*n.y,e},t.divide=function(e,t,n){return e.x=t.x/n.x,e.y=t.y/n.y,e},t.ceil=function(e,t){return e.x=Math.ceil(t.x),e.y=Math.ceil(t.y),e},t.floor=function(e,t){return e.x=Math.floor(t.x),e.y=Math.floor(t.y),e},t.min=function(e,t,n){return e.x=Math.min(t.x,n.x),e.y=Math.min(t.y,n.y),e},t.max=function(e,t,n){return e.x=Math.max(t.x,n.x),e.y=Math.max(t.y,n.y),e},t.round=function(e,t){return e.x=Math.round(t.x),e.y=Math.round(t.y),e},t.multiplyScalar=function(e,t,n){return e.x=t.x*n,e.y=t.y*n,e},t.scaleAndAdd=function(e,t,n,i){return e.x=t.x+n.x*i,e.y=t.y+n.y*i,e},t.distance=function(e,t){var n=t.x-e.x,i=t.y-e.y;return Math.sqrt(n*n+i*i)},t.squaredDistance=function(e,t){var n=t.x-e.x,i=t.y-e.y;return n*n+i*i},t.len=function(e){var t=e.x,n=e.y;return Math.sqrt(t*t+n*n)},t.lengthSqr=function(e){var t=e.x,n=e.y;return t*t+n*n},t.negate=function(e,t){return e.x=-t.x,e.y=-t.y,e},t.inverse=function(e,t){return e.x=1/t.x,e.y=1/t.y,e},t.inverseSafe=function(e,t){var n=t.x,i=t.y;return Math.abs(n)<vn?e.x=0:e.x=1/n,Math.abs(i)<vn?e.y=0:e.y=1/i,e},t.normalize=function(e,t){var n=t.x,i=t.y,r=n*n+i*i;return r>0&&(r=1/Math.sqrt(r),e.x=n*r,e.y=i*r),e},t.dot=function(e,t){return e.x*t.x+e.y*t.y},t.cross=function(e,t,n){return e.x=e.y=0,e.z=t.x*n.y-t.y*n.x,e},t.lerp=function(e,t,n,i){var r=t.x,o=t.y;return e.x=r+i*(n.x-r),e.y=o+i*(n.y-o),e},t.random=function(e,t){t=t||1;var n=2*Cn()*Math.PI;return e.x=Math.cos(n)*t,e.y=Math.sin(n)*t,e},t.transformMat3=function(e,t,n){var i=t.x,r=t.y;return e.x=n.m00*i+n.m03*r+n.m06,e.y=n.m01*i+n.m04*r+n.m07,e},t.transformMat4=function(e,t,n){var i=t.x,r=t.y;return e.x=n.m00*i+n.m04*r+n.m12,e.y=n.m01*i+n.m05*r+n.m13,e},t.str=function(e){return"Vec2("+e.x+", "+e.y+")"},t.toArray=function(e,t,n){return void 0===n&&(n=0),e[n+0]=t.x,e[n+1]=t.y,e},t.fromArray=function(e,t,n){return void 0===n&&(n=0),e.x=t[n+0],e.y=t[n+1],e},t.strictEquals=function(e,t){return e.x===t.x&&e.y===t.y},t.equals=function(e,t,n){return void 0===n&&(n=vn),Math.abs(e.x-t.x)<=n*Math.max(1,Math.abs(e.x),Math.abs(t.x))&&Math.abs(e.y-t.y)<=n*Math.max(1,Math.abs(e.y),Math.abs(t.y))},t.angle=function(e,n){t.normalize(oi,e),t.normalize(ai,n);var i=t.dot(oi,ai);return i>1?0:i<-1?Math.PI:Math.acos(i)};var n=t.prototype;return n.clone=function(){return new t(this.x,this.y)},n.set=function(e,t){return e&&"object"==typeof e?(this.x=e.x,this.y=e.y):(this.x=e||0,this.y=t||0),this},n.equals=function(e,t){return void 0===t&&(t=vn),Math.abs(this.x-e.x)<=t*Math.max(1,Math.abs(this.x),Math.abs(e.x))&&Math.abs(this.y-e.y)<=t*Math.max(1,Math.abs(this.y),Math.abs(e.y))},n.equals2f=function(e,t,n){return void 0===n&&(n=vn),Math.abs(this.x-e)<=n*Math.max(1,Math.abs(this.x),Math.abs(e))&&Math.abs(this.y-t)<=n*Math.max(1,Math.abs(this.y),Math.abs(t))},n.strictEquals=function(e){return e&&this.x===e.x&&this.y===e.y},n.strictEquals2f=function(e,t){return this.x===e&&this.y===t},n.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+")"},n.lerp=function(e,t){var n=this.x,i=this.y;return this.x=n+t*(e.x-n),this.y=i+t*(e.y-i),this},n.clampf=function(e,t){return this.x=xn(this.x,e.x,t.x),this.y=xn(this.y,e.y,t.y),this},n.add=function(e){return this.x+=e.x,this.y+=e.y,this},n.add2f=function(e,t){return this.x+=e,this.y+=t,this},n.subtract=function(e){return this.x-=e.x,this.y-=e.y,this},n.subtract2f=function(e,t){return this.x-=e,this.y-=t,this},n.multiplyScalar=function(e){return"object"==typeof e&&console.warn("should use Vec2.multiply for vector * vector operation"),this.x*=e,this.y*=e,this},n.multiply=function(e){return"object"!=typeof e&&console.warn("should use Vec2.scale for vector * scalar operation"),this.x*=e.x,this.y*=e.y,this},n.multiply2f=function(e,t){return this.x*=e,this.y*=t,this},n.divide=function(e){return this.x/=e.x,this.y/=e.y,this},n.divide2f=function(e,t){return this.x/=e,this.y/=t,this},n.negative=function(){return this.x=-this.x,this.y=-this.y,this},n.dot=function(e){return this.x*e.x+this.y*e.y},n.cross=function(e){return this.x*e.y-this.y*e.x},n.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},n.lengthSqr=function(){return this.x*this.x+this.y*this.y},n.normalize=function(){var e=this.x,t=this.y,n=e*e+t*t;return n>0&&(n=1/Math.sqrt(n),this.x*=n,this.y*=n),this},n.angle=function(e){var t=this.lengthSqr(),n=e.lengthSqr();if(0===t||0===n)return console.warn("Can't get angle between zero vector"),0;var i=this.dot(e)/Math.sqrt(t*n);return i=xn(i,-1,1),Math.acos(i)},n.signAngle=function(e){var t=this.angle(e);return this.cross(e)<0?-t:t},n.rotate=function(e){var t=this.x,n=this.y,i=Math.sin(e),r=Math.cos(e);return this.x=r*t-i*n,this.y=i*t+r*n,this},n.project=function(e){var t=this.dot(e)/e.dot(e);return this.x=e.x*t,this.y=e.y*t,this},n.transformMat4=function(e){var t=this.x,n=this.y;return this.x=e.m00*t+e.m04*n+e.m12,this.y=e.m01*t+e.m05*n+e.m13,this},t}(At));ri.ZERO=Object.freeze(new ri(0,0)),ri.ONE=Object.freeze(new ri(1,1)),ri.NEG_ONE=Object.freeze(new ri(-1,-1)),ri.UNIT_X=Object.freeze(new ri(1,0)),ri.UNIT_Y=Object.freeze(new ri(0,1));var oi=new ri,ai=new ri;function si(e,t){return new ri(e,t)}_n.fastDefine("cc.Vec2",ri,{x:0,y:0}),c.Vec2=ri,c.v2=si;var ci=e("b6",function(e){function t(t,n,i,r){var o;return o=e.call(this)||this,t&&"object"==typeof t?(o.x=t.x,o.y=t.y,o.z=t.z,o.w=t.w):(o.x=t||0,o.y=n||0,o.z=i||0,o.w=r||0),o}$(t,e),t.clone=function(e){return new t(e.x,e.y,e.z,e.w)},t.copy=function(e,t){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e},t.set=function(e,t,n,i,r){return e.x=t,e.y=n,e.z=i,e.w=r,e},t.add=function(e,t,n){return e.x=t.x+n.x,e.y=t.y+n.y,e.z=t.z+n.z,e.w=t.w+n.w,e},t.subtract=function(e,t,n){return e.x=t.x-n.x,e.y=t.y-n.y,e.z=t.z-n.z,e.w=t.w-n.w,e},t.multiply=function(e,t,n){return e.x=t.x*n.x,e.y=t.y*n.y,e.z=t.z*n.z,e.w=t.w*n.w,e},t.divide=function(e,t,n){return e.x=t.x/n.x,e.y=t.y/n.y,e.z=t.z/n.z,e.w=t.w/n.w,e},t.ceil=function(e,t){return e.x=Math.ceil(t.x),e.y=Math.ceil(t.y),e.z=Math.ceil(t.z),e.w=Math.ceil(t.w),e},t.floor=function(e,t){return e.x=Math.floor(t.x),e.y=Math.floor(t.y),e.z=Math.floor(t.z),e.w=Math.floor(t.w),e},t.min=function(e,t,n){return e.x=Math.min(t.x,n.x),e.y=Math.min(t.y,n.y),e.z=Math.min(t.z,n.z),e.w=Math.min(t.w,n.w),e},t.max=function(e,t,n){return e.x=Math.max(t.x,n.x),e.y=Math.max(t.y,n.y),e.z=Math.max(t.z,n.z),e.w=Math.max(t.w,n.w),e},t.round=function(e,t){return e.x=Math.round(t.x),e.y=Math.round(t.y),e.z=Math.round(t.z),e.w=Math.round(t.w),e},t.multiplyScalar=function(e,t,n){return e.x=t.x*n,e.y=t.y*n,e.z=t.z*n,e.w=t.w*n,e},t.scaleAndAdd=function(e,t,n,i){return e.x=t.x+n.x*i,e.y=t.y+n.y*i,e.z=t.z+n.z*i,e.w=t.w+n.w*i,e},t.distance=function(e,t){var n=t.x-e.x,i=t.y-e.y,r=t.z-e.z,o=t.w-e.w;return Math.sqrt(n*n+i*i+r*r+o*o)},t.squaredDistance=function(e,t){var n=t.x-e.x,i=t.y-e.y,r=t.z-e.z,o=t.w-e.w;return n*n+i*i+r*r+o*o},t.len=function(e){var t=e.x,n=e.y,i=e.z,r=e.w;return Math.sqrt(t*t+n*n+i*i+r*r)},t.lengthSqr=function(e){var t=e.x,n=e.y,i=e.z,r=e.w;return t*t+n*n+i*i+r*r},t.negate=function(e,t){return e.x=-t.x,e.y=-t.y,e.z=-t.z,e.w=-t.w,e},t.inverse=function(e,t){return e.x=1/t.x,e.y=1/t.y,e.z=1/t.z,e.w=1/t.w,e},t.inverseSafe=function(e,t){var n=t.x,i=t.y,r=t.z,o=t.w;return Math.abs(n)<vn?e.x=0:e.x=1/n,Math.abs(i)<vn?e.y=0:e.y=1/i,Math.abs(r)<vn?e.z=0:e.z=1/r,Math.abs(o)<vn?e.w=0:e.w=1/o,e},t.normalize=function(e,t){var n=t.x,i=t.y,r=t.z,o=t.w,a=n*n+i*i+r*r+o*o;return a>0&&(a=1/Math.sqrt(a),e.x=n*a,e.y=i*a,e.z=r*a,e.w=o*a),e},t.dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w},t.lerp=function(e,t,n,i){return e.x=t.x+i*(n.x-t.x),e.y=t.y+i*(n.y-t.y),e.z=t.z+i*(n.z-t.z),e.w=t.w+i*(n.w-t.w),e},t.random=function(e,t){t=t||1;var n=2*Cn()*Math.PI,i=2*Cn()-1,r=Math.sqrt(1-i*i);return e.x=r*Math.cos(n)*t,e.y=r*Math.sin(n)*t,e.z=i*t,e.w=0,e},t.transformMat4=function(e,t,n){var i=t.x,r=t.y,o=t.z,a=t.w;return e.x=n.m00*i+n.m04*r+n.m08*o+n.m12*a,e.y=n.m01*i+n.m05*r+n.m09*o+n.m13*a,e.z=n.m02*i+n.m06*r+n.m10*o+n.m14*a,e.w=n.m03*i+n.m07*r+n.m11*o+n.m15*a,e},t.transformAffine=function(e,t,n){var i=t.x,r=t.y,o=t.z,a=t.w;return e.x=n.m00*i+n.m01*r+n.m02*o+n.m03*a,e.y=n.m04*i+n.m05*r+n.m06*o+n.m07*a,e.x=n.m08*i+n.m09*r+n.m10*o+n.m11*a,e.w=t.w,e},t.transformQuat=function(e,t,n){var i=t.x,r=t.y,o=t.z,a=n.x,s=n.y,c=n.z,l=n.w,u=l*i+s*o-c*r,h=l*r+c*i-a*o,_=l*o+a*r-s*i,f=-a*i-s*r-c*o;return e.x=u*l+f*-a+h*-c-_*-s,e.y=h*l+f*-s+_*-a-u*-c,e.z=_*l+f*-c+u*-s-h*-a,e.w=t.w,e},t.toArray=function(e,t,n){return void 0===n&&(n=0),e[n+0]=t.x,e[n+1]=t.y,e[n+2]=t.z,e[n+3]=t.w,e},t.fromArray=function(e,t,n){return void 0===n&&(n=0),e.x=t[n+0],e.y=t[n+1],e.z=t[n+2],e.w=t[n+3],e},t.strictEquals=function(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w},t.equals=function(e,t,n){return void 0===n&&(n=vn),Math.abs(e.x-t.x)<=n*Math.max(1,Math.abs(e.x),Math.abs(t.x))&&Math.abs(e.y-t.y)<=n*Math.max(1,Math.abs(e.y),Math.abs(t.y))&&Math.abs(e.z-t.z)<=n*Math.max(1,Math.abs(e.z),Math.abs(t.z))&&Math.abs(e.w-t.w)<=n*Math.max(1,Math.abs(e.w),Math.abs(t.w))};var n=t.prototype;return n.clone=function(){return new t(this.x,this.y,this.z,this.w)},n.set=function(e,t,n,i){return e&&"object"==typeof e?(this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w):(this.x=e||0,this.y=t||0,this.z=n||0,this.w=i||0),this},n.equals=function(e,t){return void 0===t&&(t=vn),Math.abs(this.x-e.x)<=t*Math.max(1,Math.abs(this.x),Math.abs(e.x))&&Math.abs(this.y-e.y)<=t*Math.max(1,Math.abs(this.y),Math.abs(e.y))&&Math.abs(this.z-e.z)<=t*Math.max(1,Math.abs(this.z),Math.abs(e.z))&&Math.abs(this.w-e.w)<=t*Math.max(1,Math.abs(this.w),Math.abs(e.w))},n.equals4f=function(e,t,n,i,r){return void 0===r&&(r=vn),Math.abs(this.x-e)<=r*Math.max(1,Math.abs(this.x),Math.abs(e))&&Math.abs(this.y-t)<=r*Math.max(1,Math.abs(this.y),Math.abs(t))&&Math.abs(this.z-n)<=r*Math.max(1,Math.abs(this.z),Math.abs(n))&&Math.abs(this.w-i)<=r*Math.max(1,Math.abs(this.w),Math.abs(i))},n.strictEquals=function(e){return this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w},n.strictEquals4f=function(e,t,n,i){return this.x===e&&this.y===t&&this.z===n&&this.w===i},n.lerp=function(e,t){var n=this.x,i=this.y,r=this.z,o=this.w;return this.x=n+t*(e.x-n),this.y=i+t*(e.y-i),this.z=r+t*(e.z-r),this.w=o+t*(e.w-o),this},n.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.z.toFixed(2)+", "+this.w.toFixed(2)+")"},n.clampf=function(e,t){return this.x=xn(this.x,e.x,t.x),this.y=xn(this.y,e.y,t.y),this.z=xn(this.z,e.z,t.z),this.w=xn(this.w,e.w,t.w),this},n.add=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this},n.add4f=function(e,t,n,i){return this.x+=e,this.y+=t,this.z+=n,this.w+=i,this},n.subtract=function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this},n.subtract4f=function(e,t,n,i){return this.x-=e,this.y-=t,this.z-=n,this.w-=i,this},n.multiplyScalar=function(e){return"object"==typeof e&&console.warn("should use Vec4.multiply for vector * vector operation"),this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},n.multiply=function(e){return"object"!=typeof e&&console.warn("should use Vec4.scale for vector * scalar operation"),this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this},n.multiply4f=function(e,t,n,i){return this.x*=e,this.y*=t,this.z*=n,this.w*=i,this},n.divide=function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this},n.divide4f=function(e,t,n,i){return this.x/=e,this.y/=t,this.z/=n,this.w/=i,this},n.negative=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},n.dot=function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},n.cross=function(e){var t=this.x,n=this.y,i=this.z,r=e.x,o=e.y,a=e.z;return this.x=n*a-i*o,this.y=i*r-t*a,this.z=t*o-n*r,this},n.length=function(){var e=this.x,t=this.y,n=this.z,i=this.w;return Math.sqrt(e*e+t*t+n*n+i*i)},n.lengthSqr=function(){var e=this.x,t=this.y,n=this.z,i=this.w;return e*e+t*t+n*n+i*i},n.normalize=function(){var e=this.x,t=this.y,n=this.z,i=this.w,r=e*e+t*t+n*n+i*i;return r>0&&(r=1/Math.sqrt(r),this.x=e*r,this.y=t*r,this.z=n*r,this.w=i*r),this},n.transformMat4=function(e){var t=this.x,n=this.y,i=this.z,r=this.w;return this.x=e.m00*t+e.m04*n+e.m08*i+e.m12*r,this.y=e.m01*t+e.m05*n+e.m09*i+e.m13*r,this.z=e.m02*t+e.m06*n+e.m10*i+e.m14*r,this.w=e.m03*t+e.m07*n+e.m11*i+e.m15*r,this},t}(At));function li(e,t,n,i){return new ci(e,t,n,i)}ci.ZERO=Object.freeze(new ci(0,0,0,0)),ci.ONE=Object.freeze(new ci(1,1,1,1)),ci.NEG_ONE=Object.freeze(new ci(-1,-1,-1,-1)),_n.fastDefine("cc.Vec4",ci,{x:0,y:0,z:0,w:0}),c.Vec4=ci,c.v4=li,ve(ri,"Vec2",[{name:"sub",newName:"subtract",target:ri,targetName:"Vec2"},{name:"mul",newName:"multiply",target:ri,targetName:"Vec2"},{name:"div",newName:"divide",target:ri,targetName:"Vec2"},{name:"dist",newName:"distance",target:ri,targetName:"Vec2"},{name:"sqrDist",newName:"squaredDistance",target:ri,targetName:"Vec2"},{name:"mag",newName:"len",target:ri,targetName:"Vec2"},{name:"sqrMag",newName:"lengthSqr",target:ri,targetName:"Vec2"},{name:"scale",newName:"multiplyScalar",target:ri,targetName:"Vec2"},{name:"exactEquals",newName:"strictEquals",target:ri,targetName:"Vec2"}]),ve(ri.prototype,"Vec2",[{name:"mag",newName:"length",target:ri.prototype,targetName:"Vec2"},{name:"magSqr",newName:"lengthSqr",target:ri.prototype,targetName:"Vec2"},{name:"scale",newName:"multiplyScalar",target:ri.prototype,targetName:"Vec2"},{name:"exactEquals",newName:"strictEquals",target:ri.prototype,targetName:"Vec2"}]),ve(Un,"Vec3",[{name:"sub",newName:"subtract",target:Un,targetName:"Vec3"},{name:"mul",newName:"multiply",target:Un,targetName:"Vec3"},{name:"div",newName:"divide",target:Un,targetName:"Vec3"},{name:"dist",newName:"distance",target:Un,targetName:"Vec3"},{name:"sqrDist",newName:"squaredDistance",target:Un,targetName:"Vec3"},{name:"mag",newName:"len",target:Un,targetName:"Vec3"},{name:"sqrMag",newName:"lengthSqr",target:Un,targetName:"Vec3"},{name:"scale",newName:"multiplyScalar",target:Un,targetName:"Vec3"},{name:"exactEquals",newName:"strictEquals",target:Un,targetName:"Vec3"}]),ve(Un.prototype,"Vec3",[{name:"mag",newName:"length",target:Un.prototype,targetName:"Vec3"},{name:"magSqr",newName:"lengthSqr",target:Un.prototype,targetName:"Vec3"},{name:"scale",newName:"multiplyScalar",target:Un.prototype,targetName:"Vec3"},{name:"exactEquals",newName:"strictEquals",target:Un.prototype,targetName:"Vec3"}]),ve(ci,"Vec4",[{name:"sub",newName:"subtract",target:ci,targetName:"Vec4"},{name:"mul",newName:"multiply",target:ci,targetName:"Vec4"},{name:"div",newName:"divide",target:ci,targetName:"Vec4"},{name:"dist",newName:"distance",target:ci,targetName:"Vec4"},{name:"sqrDist",newName:"squaredDistance",target:ci,targetName:"Vec4"},{name:"mag",newName:"len",target:ci,targetName:"Vec4"},{name:"sqrMag",newName:"lengthSqr",target:ci,targetName:"Vec4"},{name:"scale",newName:"multiplyScalar",target:ci,targetName:"Vec4"},{name:"exactEquals",newName:"strictEquals",target:ci,targetName:"Vec4"}]),ve(ci.prototype,"Vec4",[{name:"mag",newName:"length",target:ci.prototype,targetName:"Vec4"},{name:"magSqr",newName:"lengthSqr",target:ci.prototype,targetName:"Vec4"},{name:"scale",newName:"multiplyScalar",target:ci.prototype,targetName:"Vec4"},{name:"exactEquals",newName:"strictEquals",target:ci.prototype,targetName:"Vec4"}]),ve(qn,"Quat",[{name:"mag",newName:"len",target:qn,targetName:"Quat"},{name:"mul",newName:"multiply",target:qn,targetName:"Quat"},{name:"sqrMag",newName:"lengthSqr",target:qn,targetName:"Quat"},{name:"scale",newName:"multiplyScalar",target:qn,targetName:"Quat"},{name:"exactEquals",newName:"strictEquals",target:qn,targetName:"Quat"}]),ve(qn.prototype,"Quat",[{name:"scale",newName:"multiplyScalar",target:qn.prototype,targetName:"Quat"},{name:"exactEquals",newName:"strictEquals",target:qn.prototype,targetName:"Quat"}]),ve(zn,"Color",[{name:"sub",newName:"subtract",target:zn,targetName:"Color"},{name:"mul",newName:"multiply",target:zn,targetName:"Color"},{name:"div",newName:"divide",target:zn,targetName:"Color"},{name:"exactEquals",newName:"strictEquals",target:zn,targetName:"Color"},{name:"fromHex",newName:"fromHEX",customFunction:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=t[1].toString(16);return c.Color.fromHEX(t[0],i)}}]),ve(Vn,"Mat3",[{name:"sub",newName:"subtract",target:Vn,targetName:"Mat3"},{name:"mul",newName:"multiply",target:Vn,targetName:"Mat3"},{name:"exactEquals",newName:"strictEquals",target:Vn,targetName:"Mat3"},{name:"transfrom",newName:"transform",target:Vn,targetName:"Mat3"}]),ve(Vn.prototype,"Mat3",[{name:"sub",newName:"subtract",target:Vn.prototype,targetName:"Mat3"},{name:"mul",newName:"multiply",target:Vn.prototype,targetName:"Mat3"},{name:"mulScalar",newName:"multiplyScalar",target:Vn.prototype,targetName:"Mat3"},{name:"exactEquals",newName:"strictEquals",target:Vn.prototype,targetName:"Mat3"}]),ve(ei,"Mat4",[{name:"sub",newName:"subtract",target:ei,targetName:"Mat4"},{name:"mul",newName:"multiply",target:ei,targetName:"Mat4"},{name:"exactEquals",newName:"strictEquals",target:ei,targetName:"Mat4"}]),ve(ei.prototype,"Mat4",[{name:"sub",newName:"subtract",target:ei.prototype,targetName:"Mat4"},{name:"mul",newName:"multiply",target:ei.prototype,targetName:"Mat4"},{name:"mulScalar",newName:"multiplyScalar",target:ei.prototype,targetName:"Mat4"},{name:"exactEquals",newName:"strictEquals",target:ei.prototype,targetName:"Mat4"}]);var ui=e("dP",function(){function e(e,t,n,i,r,o){void 0===e&&(e=1),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=1),void 0===r&&(r=0),void 0===o&&(o=0),this.a=e,this.b=t,this.c=n,this.d=i,this.tx=r,this.ty=o}return e.identity=function(){return new e},e.clone=function(t){return new e(t.a,t.b,t.c,t.d,t.tx,t.ty)},e.concat=function(e,t,n){var i=t.a,r=t.b,o=t.c,a=t.d,s=t.tx,c=t.ty;e.a=i*n.a+r*n.c,e.b=i*n.b+r*n.d,e.c=o*n.a+a*n.c,e.d=o*n.b+a*n.d,e.tx=s*n.a+c*n.c+n.tx,e.ty=s*n.b+c*n.d+n.ty},e.invert=function(e,t){var n=1/(t.a*t.d-t.b*t.c);e.a=n*t.d,e.b=-n*t.b,e.c=-n*t.c,e.d=n*t.a,e.tx=n*(t.c*t.ty-t.d*t.tx),e.ty=n*(t.b*t.tx-t.a*t.ty)},e.fromMat4=function(e,t){e.a=t.m00,e.b=t.m01,e.c=t.m04,e.d=t.m05,e.tx=t.m12,e.ty=t.m13},e.transformVec2=function(e,t,n,i){var r,o;void 0===i?(i=n,r=t.x,o=t.y):(r=t,o=n),e.x=i.a*r+i.c*o+i.tx,e.y=i.b*r+i.d*o+i.ty},e.transformSize=function(e,t,n){e.width=n.a*t.width+n.c*t.height,e.height=n.b*t.width+n.d*t.height},e.transformRect=function(e,t,n){var i=t.x+t.width,r=t.y+t.height,o=n.a*t.x+n.c*t.y+n.tx,a=n.b*t.x+n.d*t.y+n.ty,s=n.a*i+n.c*t.y+n.tx,c=n.b*i+n.d*t.y+n.ty,l=n.a*t.x+n.c*r+n.tx,u=n.b*t.x+n.d*r+n.ty,h=n.a*i+n.c*r+n.tx,_=n.b*i+n.d*r+n.ty,f=Math.min(o,s,l,h),m=Math.max(o,s,l,h),d=Math.min(a,c,u,_),p=Math.max(a,c,u,_);e.x=f,e.y=d,e.width=m-f,e.height=p-d},e.transformObb=function(e,t,n,i,r,o){var a=o.a*r.x+o.c*r.y+o.tx,s=o.b*r.x+o.d*r.y+o.ty,c=o.a*r.width,l=o.b*r.width,u=o.c*r.height,h=o.d*r.height;t.x=a,t.y=s,n.x=c+a,n.y=l+s,e.x=u+a,e.y=h+s,i.x=c+u+a,i.y=l+h+s},e}());c.AffineTransform=ui;var hi=e("bS",function(e){function t(t,n){var i;return i=e.call(this)||this,t&&"object"==typeof t?(i.width=t.width,i.height=t.height):(i.width=t||0,i.height=n||0),i}$(t,e),t.lerp=function(e,t,n,i){return e.width=t.width+(n.width-t.width)*i,e.height=t.height+(n.height-t.height)*i,e},Z(t,[{key:"x",set:function(e){this.width=e},get:function(){return this.width}},{key:"y",set:function(e){this.height=e},get:function(){return this.height}}]);var n=t.prototype;return n.clone=function(){return new t(this.width,this.height)},n.set=function(e,t){return e&&"object"==typeof e?(this.height=e.height,this.width=e.width):(this.width=e||0,this.height=t||0),this},n.equals=function(e){return this.width===e.width&&this.height===e.height},n.lerp=function(e,t){return this.width+=(e.width-this.width)*t,this.height+=(e.height-this.height)*t,this},n.toString=function(){return"("+this.width.toFixed(2)+", "+this.height.toFixed(2)+")"},t}(At));function _i(e,t){return void 0===e&&(e=0),void 0===t&&(t=0),new hi(e,t)}hi.ZERO=Object.freeze(new hi(0,0)),hi.ONE=Object.freeze(new hi(1,1)),_n.fastDefine("cc.Size",hi,{width:0,height:0}),c.size=_i,c.Size=hi;var fi=e("bR",function(e){function t(t,n,i,r){var o;return(o=e.call(this)||this).T=void 0,t&&"object"==typeof t?(o.y=t.y,o.width=t.width,o.height=t.height,o.x=t.x):(o.x=t||0,o.y=n||0,o.width=i||0,o.height=r||0),o}$(t,e),t.fromMinMax=function(e,t,n){var i=Math.min(t.x,n.x),r=Math.min(t.y,n.y),o=Math.max(t.x,n.x),a=Math.max(t.y,n.y);return e.x=i,e.y=r,e.width=o-i,e.height=a-r,e},t.lerp=function(e,t,n,i){var r=t.x,o=t.y,a=t.width,s=t.height;return e.x=r+(n.x-r)*i,e.y=o+(n.y-o)*i,e.width=a+(n.width-a)*i,e.height=s+(n.height-s)*i,e},t.intersection=function(e,t,n){var i=t.x,r=t.y,o=t.x+t.width,a=t.y+t.height,s=n.x,c=n.y,l=n.x+n.width,u=n.y+n.height;return e.x=Math.max(i,s),e.y=Math.max(r,c),e.width=Math.min(o,l)-e.x,e.height=Math.min(a,u)-e.y,e},t.union=function(e,t,n){var i=t.x,r=t.y,o=t.width,a=t.height,s=n.x,c=n.y,l=n.width,u=n.height;return e.x=Math.min(i,s),e.y=Math.min(r,c),e.width=Math.max(i+o,s+l)-e.x,e.height=Math.max(r+a,c+u)-e.y,e},Z(t,[{key:"xMin",get:function(){return this.x},set:function(e){this.width+=this.x-e,this.x=e}},{key:"yMin",get:function(){return this.y},set:function(e){this.height+=this.y-e,this.y=e}},{key:"xMax",get:function(){return this.x+this.width},set:function(e){this.width=e-this.x}},{key:"yMax",get:function(){return this.y+this.height},set:function(e){this.height=e-this.y}},{key:"center",get:function(){return new ri(this.x+.5*this.width,this.y+.5*this.height)},set:function(e){this.x=e.x-.5*this.width,this.y=e.y-.5*this.height}},{key:"origin",get:function(){return new ri(this.x,this.y)},set:function(e){this.x=e.x,this.y=e.y}},{key:"size",get:function(){return new hi(this.width,this.height)},set:function(e){this.width=e.width,this.height=e.height}},{key:"z",set:function(e){this.width=e},get:function(){return this.width}},{key:"w",set:function(e){this.height=e},get:function(){return this.height}}]);var n=t.prototype;return n.clone=function(){return new t(this.x,this.y,this.width,this.height)},n.set=function(e,t,n,i){return e&&"object"==typeof e?(this.y=e.y,this.width=e.width,this.height=e.height,this.x=e.x):(this.x=e||0,this.y=t||0,this.width=n||0,this.height=i||0),this},n.equals=function(e){return this.x===e.x&&this.y===e.y&&this.width===e.width&&this.height===e.height},n.lerp=function(e,t){var n=this.x,i=this.y,r=this.width,o=this.height;return this.x=n+(e.x-n)*t,this.y=i+(e.y-i)*t,this.width=r+(e.width-r)*t,this.height=o+(e.height-o)*t,this},n.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.width.toFixed(2)+", "+this.height.toFixed(2)+")"},n.intersects=function(e){var t=this.x+this.width,n=this.y+this.height,i=e.x+e.width,r=e.y+e.height;return!(t<e.x||i<this.x||n<e.y||r<this.y)},n.contains=function(e){return this.x<=e.x&&this.x+this.width>=e.x&&this.y<=e.y&&this.y+this.height>=e.y},n.containsRect=function(e){return this.x<=e.x&&this.x+this.width>=e.x+e.width&&this.y<=e.y&&this.y+this.height>=e.y+e.height},n.transformMat4=function(e){var t=this.x,n=this.y,i=t+this.width,r=n+this.height,o=e.m00*t+e.m04*n+e.m12,a=e.m01*t+e.m05*n+e.m13,s=e.m00*i+e.m04*n+e.m12,c=e.m01*i+e.m05*n+e.m13,l=e.m00*t+e.m04*r+e.m12,u=e.m01*t+e.m05*r+e.m13,h=e.m00*i+e.m04*r+e.m12,_=e.m01*i+e.m05*r+e.m13,f=Math.min(o,s,l,h),m=Math.max(o,s,l,h),d=Math.min(a,c,u,_),p=Math.max(a,c,u,_);return this.x=f,this.y=d,this.width=m-f,this.height=p-d,this},n.transformMat4ToPoints=function(e,t,n,i,r){var o=this.x,a=this.y,s=o+this.width,c=a+this.height;t.x=e.m00*o+e.m04*a+e.m12,t.y=e.m01*o+e.m05*a+e.m13,r.x=e.m00*s+e.m04*a+e.m12,r.y=e.m01*s+e.m05*a+e.m13,n.x=e.m00*o+e.m04*c+e.m12,n.y=e.m01*o+e.m05*c+e.m13,i.x=e.m00*s+e.m04*c+e.m12,i.y=e.m01*s+e.m05*c+e.m13},t}(At));function mi(e,t,n,i){return void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),new fi(e,t,n,i)}_n.fastDefine("cc.Rect",fi,{x:0,y:0,width:0,height:0}),c.Rect=fi,c.rect=mi;var di=Object.freeze({__proto__:null,bits:pe,Vec2:ri,v2:si,Vec3:Un,v3:kn,Vec4:ci,v4:li,Quat:qn,quat:Jn,Mat3:Vn,Mat4:ei,mat4:ii,AffineTransform:ui,Size:hi,size:_i,Rect:fi,rect:mi,Color:zn,color:Bn,EPSILON:vn,equals:gn,approx:yn,clamp:xn,clamp01:En,lerp:Sn,toRadian:Tn,toDegree:An,random:Cn,randomRange:wn,randomRangeInt:In,pseudoRandom:bn,pseudoRandomRange:Rn,pseudoRandomRangeInt:On,nextPow2:Nn,repeat:Pn,pingPong:Mn,inverseLerp:Dn,absMaxComponent:Ln,absMax:Fn});e("dG",di);var pi,vi,gi,yi,xi,Ei,Si,Ti,Ai,Ci,wi,Ii,bi,Ri,Oi,Ni,Pi,Mi,Di,Li,Fi,zi,Bi,Ui,Gi=function(){function e(e,t,n){this._arrayBuffers=[],this._chunkSize=void 0,this._chunkSize=n*(1<<t)}return e.prototype.allocateNewChunk=function(){return new ArrayBuffer(this._chunkSize)},e}(),Hi=function(){},ki=function(){function e(){}var t=e.prototype;return t.alloc=function(e,t){return new ArrayBuffer(t)},t.free=function(){},e}();!function(e){e[e.UINT32=0]="UINT32",e[e.FLOAT32=1]="FLOAT32",e[e.NEVER=2]="NEVER"}(Ui||(Ui={}));var Vi,ji=function(){function e(e,t,n,i){void 0===i&&(i=8),this._dataType=void 0,this._elementCount=void 0,this._entryBits=void 0,this._stride=void 0,this._entriesPerChunk=void 0,this._entryMask=void 0,this._chunkMask=void 0,this._poolFlag=void 0,this._arrayBuffers=[],this._freelists=[],this._uint32BufferViews=[],this._float32BufferViews=[],this._hasUint32=!1,this._hasFloat32=!1,this._nativePool=void 0,this._elementCount=n.COUNT,this._entryBits=i,this._dataType=t,this._stride=4*this._elementCount,this._entriesPerChunk=1<<i,this._entryMask=this._entriesPerChunk-1,this._poolFlag=1<<30,this._chunkMask=~(this._entryMask|this._poolFlag),this._nativePool=new Gi(e,i,this._stride);var r=Ui.NEVER,o=!1,a=!1;for(var s in t){if(o=this._hasFloat32,(a=this._hasUint32)&&o)break;r=t[s],o||r!==Ui.FLOAT32?a||r!==Ui.UINT32||(this._hasUint32=!0):this._hasFloat32=!0}}var t=e.prototype;return t.alloc=function(){for(var e=0;e<this._freelists.length;e++){var t=this._freelists[e];if(t.length){var n=t[t.length-1];return t.length--,(e<<this._entryBits)+n+this._poolFlag}}for(var i=this._nativePool.allocateNewChunk(),r=[],o=[],a=[],s=this._hasFloat32,c=this._hasUint32,l=0;l<this._entriesPerChunk;l++)s&&r.push(new Float32Array(i,this._stride*l,this._elementCount)),c&&o.push(new Uint32Array(i,this._stride*l,this._elementCount)),l&&a.push(l);return this._arrayBuffers.push(i),c&&this._uint32BufferViews.push(o),s&&this._float32BufferViews.push(r),this._freelists.push(a),(e<<this._entryBits)+this._poolFlag},t.get=function(e,t){var n=(this._chunkMask&e)>>this._entryBits,i=this._entryMask&e;return(this._dataType[t]===Ui.UINT32?this._uint32BufferViews:this._float32BufferViews)[n][i][t]},t.set=function(e,t,n){var i=(this._chunkMask&e)>>this._entryBits,r=this._entryMask&e;(this._dataType[t]===Ui.UINT32?this._uint32BufferViews:this._float32BufferViews)[i][r][t]=n},t.setVec2=function(){},t.setVec3=function(){},t.setVec4=function(){},t.setMat4=function(){},t.free=function(e){var t=(this._chunkMask&e)>>this._entryBits,n=this._entryMask&e;(this._hasUint32?this._uint32BufferViews:this._float32BufferViews)[t][n].fill(0),this._freelists[t].push(n)},e}(),Wi=function(){function e(e,t,n){this._ctor=void 0,this._dtor=void 0,this._indexMask=void 0,this._poolFlag=void 0,this._array=[],this._freelist=[],this._nativePool=void 0,this._ctor=t,n&&(this._dtor=n),this._poolFlag=1<<29,this._indexMask=~this._poolFlag,this._nativePool=new Hi(e,this._array)}var t=e.prototype;return t.alloc=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=this._freelist,r=-1;if(i.length)r=i[i.length-1],i.length--,this._array[r]=this._ctor(arguments,this._array[r]);else{r=this._array.length;var o=this._ctor(arguments);if(!o)return 0;this._array.push(o)}return r+this._poolFlag},t.get=function(e){var t=this._indexMask&e;return this._array[t]},t.free=function(e){var t=this._indexMask&e;this._dtor&&(this._array[t]=this._dtor(this._array[t])),this._freelist.push(t)},e}(),qi=function(){function e(e){this._nativeBufferAllocator=void 0,this._buffers=new Map,this._nextBufferIdx=0,this._poolFlag=void 0,this._bufferIdxMask=void 0,this._poolFlag=1<<30,this._bufferIdxMask=~this._poolFlag,this._nativeBufferAllocator=new ki(e)}var t=e.prototype;return t.alloc=function(e){var t=this._nextBufferIdx++,n=this._nativeBufferAllocator.alloc(t,e);return this._buffers.set(t,n),t|this._poolFlag},t.free=function(e){var t=this._bufferIdxMask&e;this._buffers.get(t)&&(this._nativeBufferAllocator.free(t),this._buffers.delete(t))},t.getBuffer=function(e){var t=this._bufferIdxMask&e;return this._buffers.get(t)||null},e}(),Yi=function(e){function t(t,n,i,r){var o;return(o=e.call(this,t)||this)._viewCtor=void 0,o._size=void 0,o._step=void 0,o._viewCtor=n,o._size=i*n.BYTES_PER_ELEMENT,o._step=r||i,o}$(t,e);var n=t.prototype;return n.alloc=function(){var e=this._nextBufferIdx++,t=this._nativeBufferAllocator.alloc(e,this._size);return this._buffers.set(e,new this._viewCtor(t)),e|this._poolFlag},n.getBuffer=function(){return null},n.assign=function(e,t,n){var i=this._bufferIdxMask&e,r=this._buffers.get(i);if(r){var o=t+1;if(o>=r.length){for(var a=r.length;o>=a;)a+=this._step;a*=this._viewCtor.BYTES_PER_ELEMENT;var s=new this._viewCtor(this._nativeBufferAllocator.alloc(i,a));s.set(r),r=s,this._buffers.set(i,r)}r[o]=n;var c=r[0];r[0]=o>c?o:c}},n.erase=function(e,t){var n=this._bufferIdxMask&e,i=this._buffers.get(n);if(i&&!(t>=i[0])){for(var r=t+1;r<i[0];++r)i[r]=i[r+1];--i[0]}},n.push=function(e,t){var n=this._bufferIdxMask&e,i=this._buffers.get(n);i&&this.assign(e,i[0],t)},n.pop=function(e){var t=this._bufferIdxMask&e,n=this._buffers.get(t);n&&0!==n[0]&&--n[0]},n.clear=function(e){var t=this._bufferIdxMask&e,n=this._buffers.get(t);n&&(n[0]=0)},n.get=function(e,t){var n=this._bufferIdxMask&e,i=this._buffers.get(n);return!i||t>=i[0]?0:i[t+1]},n.length=function(e){var t=this._bufferIdxMask&e,n=this._buffers.get(t);return n?n[0]:0},t}(qi);function Xi(e,t,n,i){void 0===i&&(i=!0);for(var r=t.length(e),o=0;o<r;o++){var a=t.get(e,o);a&&n.free(a)}i?t.free(e):t.clear(e)}!function(e){e[e.ATTRIBUTE=0]="ATTRIBUTE",e[e.DESCRIPTOR_SETS=1]="DESCRIPTOR_SETS",e[e.SHADER=2]="SHADER",e[e.INPUT_ASSEMBLER=3]="INPUT_ASSEMBLER",e[e.PIPELINE_LAYOUT=4]="PIPELINE_LAYOUT",e[e.FRAMEBUFFER=5]="FRAMEBUFFER",e[e.PASS=100]="PASS",e[e.SUB_MODEL=101]="SUB_MODEL",e[e.MODEL=102]="MODEL",e[e.SCENE=103]="SCENE",e[e.CAMERA=104]="CAMERA",e[e.NODE=105]="NODE",e[e.ROOT=106]="ROOT",e[e.AABB=107]="AABB",e[e.RENDER_WINDOW=108]="RENDER_WINDOW",e[e.FRUSTUM=109]="FRUSTUM",e[e.AMBIENT=110]="AMBIENT",e[e.FOG=111]="FOG",e[e.SKYBOX=112]="SKYBOX",e[e.SHADOW=113]="SHADOW",e[e.LIGHT=114]="LIGHT",e[e.SPHERE=115]="SPHERE",e[e.INSTANCED_ATTRIBUTE=116]="INSTANCED_ATTRIBUTE",e[e.FLAT_BUFFER=117]="FLAT_BUFFER",e[e.SUB_MESH=118]="SUB_MESH",e[e.RASTERIZER_STATE=119]="RASTERIZER_STATE",e[e.DEPTH_STENCIL_STATE=120]="DEPTH_STENCIL_STATE",e[e.BLEND_TARGET=121]="BLEND_TARGET",e[e.BLEND_STATE=122]="BLEND_STATE",e[e.BATCH_2D=123]="BATCH_2D",e[e.SUB_MODEL_ARRAY=200]="SUB_MODEL_ARRAY",e[e.MODEL_ARRAY=201]="MODEL_ARRAY",e[e.ATTRIBUTE_ARRAY=202]="ATTRIBUTE_ARRAY",e[e.FLAT_BUFFER_ARRAY=203]="FLAT_BUFFER_ARRAY",e[e.INSTANCED_BUFFER_ARRAY=204]="INSTANCED_BUFFER_ARRAY",e[e.LIGHT_ARRAY=205]="LIGHT_ARRAY",e[e.BLEND_TARGET_ARRAY=206]="BLEND_TARGET_ARRAY",e[e.BATCH_ARRAY_2D=207]="BATCH_ARRAY_2D",e[e.RAW_BUFFER=300]="RAW_BUFFER",e[e.RAW_OBJECT=400]="RAW_OBJECT"}(Vi||(Vi={}));var Ki,Qi=e("cm",0),Zi=new Wi(Vi.SHADER,(function(e,t){return t?(t.initialize(e[1]),t):e[0].createShader(e[1])}),(function(e){return e&&e.destroy(),e})),Ji=e("cy",new Wi(Vi.DESCRIPTOR_SETS,(function(e,t){return t?(t.initialize(e[1]),t):e[0].createDescriptorSet(e[1])}),(function(e){return e&&e.destroy(),e}))),$i=e("cl",new Wi(Vi.INPUT_ASSEMBLER,(function(e,t){return t?(t.initialize(e[1]),t):e[0].createInputAssembler(e[1])}),(function(e){return e&&e.destroy(),e}))),er=new Wi(Vi.PIPELINE_LAYOUT,(function(e,t){return t?(t.initialize(e[1]),t):e[0].createPipelineLayout(e[1])}),(function(e){return e&&e.destroy(),e})),tr=new Wi(Vi.FRAMEBUFFER,(function(e,t){return t?(t.initialize(e[1]),t):e[0].createFramebuffer(e[1])}),(function(e){return e&&e.destroy(),e})),nr=new Yi(Vi.SUB_MODEL_ARRAY,Uint32Array,8,4),ir=new Yi(Vi.MODEL_ARRAY,Uint32Array,32,16),rr=new Yi(Vi.ATTRIBUTE_ARRAY,Uint32Array,8,4),or=new Yi(Vi.FLAT_BUFFER_ARRAY,Uint32Array,8,4),ar=new Yi(Vi.LIGHT_ARRAY,Uint32Array,8,4),sr=new Yi(Vi.BLEND_TARGET_ARRAY,Uint32Array,8,4),cr=new Yi(Vi.BATCH_ARRAY_2D,Uint32Array,32,16),lr=new qi(Vi.RAW_BUFFER),ur=new Wi(Vi.RAW_OBJECT,(function(e){return e[0]||{}}),(function(){}));!function(e){e[e.PRIORITY=0]="PRIORITY",e[e.STAGE=1]="STAGE",e[e.PHASE=2]="PHASE",e[e.BATCHING_SCHEME=3]="BATCHING_SCHEME",e[e.PRIMITIVE=4]="PRIMITIVE",e[e.DYNAMIC_STATES=5]="DYNAMIC_STATES",e[e.HASH=6]="HASH",e[e.RASTERIZER_STATE=7]="RASTERIZER_STATE",e[e.DEPTH_STENCIL_STATE=8]="DEPTH_STENCIL_STATE",e[e.BLEND_STATE=9]="BLEND_STATE",e[e.DESCRIPTOR_SET=10]="DESCRIPTOR_SET",e[e.PIPELINE_LAYOUT=11]="PIPELINE_LAYOUT",e[e.COUNT=12]="COUNT"}(Ki||(Ki={}));var hr,_r=((pi={})[Ki.PRIORITY]=Ui.UINT32,pi[Ki.STAGE]=Ui.UINT32,pi[Ki.PHASE]=Ui.UINT32,pi[Ki.BATCHING_SCHEME]=Ui.UINT32,pi[Ki.PRIMITIVE]=Ui.UINT32,pi[Ki.DYNAMIC_STATES]=Ui.UINT32,pi[Ki.HASH]=Ui.UINT32,pi[Ki.RASTERIZER_STATE]=Ui.UINT32,pi[Ki.DEPTH_STENCIL_STATE]=Ui.UINT32,pi[Ki.BLEND_STATE]=Ui.UINT32,pi[Ki.DESCRIPTOR_SET]=Ui.UINT32,pi[Ki.PIPELINE_LAYOUT]=Ui.UINT32,pi[Ki.COUNT]=Ui.NEVER,pi),fr=e("cr",new ji(Vi.PASS,_r,Ki));!function(e){e[e.PRIORITY=0]="PRIORITY",e[e.PASS_COUNT=1]="PASS_COUNT",e[e.PASS_0=2]="PASS_0",e[e.PASS_1=3]="PASS_1",e[e.PASS_2=4]="PASS_2",e[e.PASS_3=5]="PASS_3",e[e.SHADER_0=6]="SHADER_0",e[e.SHADER_1=7]="SHADER_1",e[e.SHADER_2=8]="SHADER_2",e[e.SHADER_3=9]="SHADER_3",e[e.PLANAR_SHADER=10]="PLANAR_SHADER",e[e.DESCRIPTOR_SET=11]="DESCRIPTOR_SET",e[e.INPUT_ASSEMBLER=12]="INPUT_ASSEMBLER",e[e.SUB_MESH=13]="SUB_MESH",e[e.COUNT=14]="COUNT"}(hr||(hr=e("cw",{})));var mr,dr=((vi={})[hr.PRIORITY]=Ui.UINT32,vi[hr.PASS_COUNT]=Ui.UINT32,vi[hr.PASS_0]=Ui.UINT32,vi[hr.PASS_1]=Ui.UINT32,vi[hr.PASS_2]=Ui.UINT32,vi[hr.PASS_3]=Ui.UINT32,vi[hr.SHADER_0]=Ui.UINT32,vi[hr.SHADER_1]=Ui.UINT32,vi[hr.SHADER_2]=Ui.UINT32,vi[hr.SHADER_3]=Ui.UINT32,vi[hr.PLANAR_SHADER]=Ui.UINT32,vi[hr.DESCRIPTOR_SET]=Ui.UINT32,vi[hr.INPUT_ASSEMBLER]=Ui.UINT32,vi[hr.SUB_MESH]=Ui.UINT32,vi[hr.COUNT]=Ui.NEVER,vi),pr=e("cv",new ji(Vi.SUB_MODEL,dr,hr));!function(e){e[e.ENABLED=0]="ENABLED",e[e.VIS_FLAGS=1]="VIS_FLAGS",e[e.CAST_SHADOW=2]="CAST_SHADOW",e[e.RECEIVE_SHADOW=3]="RECEIVE_SHADOW",e[e.WORLD_BOUNDS=4]="WORLD_BOUNDS",e[e.NODE=5]="NODE",e[e.TRANSFORM=6]="TRANSFORM",e[e.SUB_MODEL_ARRAY=7]="SUB_MODEL_ARRAY",e[e.INSTANCED_BUFFER=8]="INSTANCED_BUFFER",e[e.INSTANCED_ATTR_ARRAY=9]="INSTANCED_ATTR_ARRAY",e[e.COUNT=10]="COUNT"}(mr||(mr={}));var vr,gr=((gi={})[mr.ENABLED]=Ui.UINT32,gi[mr.VIS_FLAGS]=Ui.UINT32,gi[mr.CAST_SHADOW]=Ui.UINT32,gi[mr.RECEIVE_SHADOW]=Ui.UINT32,gi[mr.WORLD_BOUNDS]=Ui.UINT32,gi[mr.NODE]=Ui.UINT32,gi[mr.TRANSFORM]=Ui.UINT32,gi[mr.SUB_MODEL_ARRAY]=Ui.UINT32,gi[mr.INSTANCED_BUFFER]=Ui.UINT32,gi[mr.INSTANCED_ATTR_ARRAY]=Ui.UINT32,gi[mr.COUNT]=Ui.NEVER,gi),yr=new ji(Vi.MODEL,gr,mr);!function(e){e[e.VIS_FLAGS=0]="VIS_FLAGS",e[e.PASS_COUNT=1]="PASS_COUNT",e[e.PASS_0=2]="PASS_0",e[e.PASS_1=3]="PASS_1",e[e.PASS_2=4]="PASS_2",e[e.PASS_3=5]="PASS_3",e[e.SHADER_0=6]="SHADER_0",e[e.SHADER_1=7]="SHADER_1",e[e.SHADER_2=8]="SHADER_2",e[e.SHADER_3=9]="SHADER_3",e[e.DESCRIPTOR_SET=10]="DESCRIPTOR_SET",e[e.INPUT_ASSEMBLER=11]="INPUT_ASSEMBLER",e[e.COUNT=12]="COUNT"}(vr||(vr=e("cp",{})));var xr,Er=((yi={})[vr.VIS_FLAGS]=Ui.UINT32,yi[vr.PASS_COUNT]=Ui.UINT32,yi[vr.PASS_0]=Ui.UINT32,yi[vr.PASS_1]=Ui.UINT32,yi[vr.PASS_2]=Ui.UINT32,yi[vr.PASS_3]=Ui.UINT32,yi[vr.SHADER_0]=Ui.UINT32,yi[vr.SHADER_1]=Ui.UINT32,yi[vr.SHADER_2]=Ui.UINT32,yi[vr.SHADER_3]=Ui.UINT32,yi[vr.DESCRIPTOR_SET]=Ui.UINT32,yi[vr.INPUT_ASSEMBLER]=Ui.UINT32,yi[vr.COUNT]=Ui.NEVER,yi),Sr=e("co",new ji(Vi.BATCH_2D,Er,vr));!function(e){e[e.CENTER=0]="CENTER",e[e.HALF_EXTENSION=3]="HALF_EXTENSION",e[e.COUNT=6]="COUNT"}(xr||(xr=e("bD",{})));var Tr,Ar=((xi={})[xr.CENTER]=Ui.FLOAT32,xi[xr.HALF_EXTENSION]=Ui.FLOAT32,xi[xr.COUNT]=Ui.NEVER,xi),Cr=e("bC",new ji(Vi.AABB,Ar,xr));!function(e){e[e.MAIN_LIGHT=0]="MAIN_LIGHT",e[e.MODEL_ARRAY=1]="MODEL_ARRAY",e[e.SPHERE_LIGHT_ARRAY=2]="SPHERE_LIGHT_ARRAY",e[e.SPOT_LIGHT_ARRAY=3]="SPOT_LIGHT_ARRAY",e[e.BATCH_ARRAY_2D=4]="BATCH_ARRAY_2D",e[e.COUNT=5]="COUNT"}(Tr||(Tr={}));var wr,Ir=((Ei={})[Tr.MAIN_LIGHT]=Ui.UINT32,Ei[Tr.MODEL_ARRAY]=Ui.UINT32,Ei[Tr.SPHERE_LIGHT_ARRAY]=Ui.UINT32,Ei[Tr.SPOT_LIGHT_ARRAY]=Ui.UINT32,Ei[Tr.BATCH_ARRAY_2D]=Ui.UINT32,Ei[Tr.COUNT]=Ui.NEVER,Ei),br=new ji(Vi.SCENE,Ir,Tr);!function(e){e[e.WIDTH=0]="WIDTH",e[e.HEIGHT=1]="HEIGHT",e[e.EXPOSURE=2]="EXPOSURE",e[e.CLEAR_FLAG=3]="CLEAR_FLAG",e[e.CLEAR_DEPTH=4]="CLEAR_DEPTH",e[e.CLEAR_STENCIL=5]="CLEAR_STENCIL",e[e.VISIBILITY=6]="VISIBILITY",e[e.NODE=7]="NODE",e[e.SCENE=8]="SCENE",e[e.FRUSTUM=9]="FRUSTUM",e[e.WINDOW=10]="WINDOW",e[e.FORWARD=11]="FORWARD",e[e.POSITION=14]="POSITION",e[e.VIEW_PORT=17]="VIEW_PORT",e[e.CLEAR_COLOR=21]="CLEAR_COLOR",e[e.MAT_VIEW=25]="MAT_VIEW",e[e.MAT_VIEW_PROJ=41]="MAT_VIEW_PROJ",e[e.MAT_VIEW_PROJ_INV=57]="MAT_VIEW_PROJ_INV",e[e.MAT_PROJ=73]="MAT_PROJ",e[e.MAT_PROJ_INV=89]="MAT_PROJ_INV",e[e.COUNT=105]="COUNT"}(wr||(wr={}));var Rr,Or=((Si={})[wr.WIDTH]=Ui.UINT32,Si[wr.HEIGHT]=Ui.UINT32,Si[wr.EXPOSURE]=Ui.FLOAT32,Si[wr.CLEAR_FLAG]=Ui.UINT32,Si[wr.CLEAR_DEPTH]=Ui.FLOAT32,Si[wr.CLEAR_STENCIL]=Ui.UINT32,Si[wr.VISIBILITY]=Ui.UINT32,Si[wr.NODE]=Ui.UINT32,Si[wr.SCENE]=Ui.UINT32,Si[wr.FRUSTUM]=Ui.UINT32,Si[wr.WINDOW]=Ui.UINT32,Si[wr.FORWARD]=Ui.FLOAT32,Si[wr.POSITION]=Ui.FLOAT32,Si[wr.VIEW_PORT]=Ui.FLOAT32,Si[wr.CLEAR_COLOR]=Ui.FLOAT32,Si[wr.MAT_VIEW]=Ui.FLOAT32,Si[wr.MAT_VIEW_PROJ]=Ui.FLOAT32,Si[wr.MAT_VIEW_PROJ_INV]=Ui.FLOAT32,Si[wr.MAT_PROJ]=Ui.FLOAT32,Si[wr.MAT_PROJ_INV]=Ui.FLOAT32,Si[wr.COUNT]=Ui.NEVER,Si),Nr=new ji(Vi.CAMERA,Or,wr);!function(e){e[e.FLAGS_CHANGED=0]="FLAGS_CHANGED",e[e.LAYER=1]="LAYER",e[e.WORLD_SCALE=2]="WORLD_SCALE",e[e.WORLD_POSITION=5]="WORLD_POSITION",e[e.WORLD_ROTATION=8]="WORLD_ROTATION",e[e.WORLD_MATRIX=12]="WORLD_MATRIX",e[e.COUNT=28]="COUNT"}(Rr||(Rr={}));var Pr=((Ti={})[Rr.FLAGS_CHANGED]=Ui.UINT32,Ti[Rr.LAYER]=Ui.UINT32,Ti[Rr.WORLD_SCALE]=Ui.FLOAT32,Ti[Rr.WORLD_POSITION]=Ui.FLOAT32,Ti[Rr.WORLD_ROTATION]=Ui.FLOAT32,Ti[Rr.WORLD_MATRIX]=Ui.FLOAT32,Ti[Rr.COUNT]=Ui.NEVER,Ti);delete Rr[Rr.COUNT],Rr[Rr.COUNT=Rr.LAYER+1]="COUNT";var Mr,Dr=new ji(Vi.NODE,Pr,Rr);!function(e){e[e.CUMULATIVE_TIME=0]="CUMULATIVE_TIME",e[e.FRAME_TIME=1]="FRAME_TIME",e[e.COUNT=2]="COUNT"}(Mr||(Mr={}));var Lr,Fr=((Ai={})[Mr.CUMULATIVE_TIME]=Ui.FLOAT32,Ai[Mr.FRAME_TIME]=Ui.FLOAT32,Ai[Mr.COUNT]=Ui.NEVER,Ai),zr=new ji(Vi.ROOT,Fr,Mr,1);!function(e){e[e.HAS_ON_SCREEN_ATTACHMENTS=0]="HAS_ON_SCREEN_ATTACHMENTS",e[e.HAS_OFF_SCREEN_ATTACHMENTS=1]="HAS_OFF_SCREEN_ATTACHMENTS",e[e.FRAMEBUFFER=2]="FRAMEBUFFER",e[e.COUNT=3]="COUNT"}(Lr||(Lr={}));var Br,Ur=((Ci={})[Lr.HAS_ON_SCREEN_ATTACHMENTS]=Ui.UINT32,Ci[Lr.HAS_OFF_SCREEN_ATTACHMENTS]=Ui.UINT32,Ci[Lr.FRAMEBUFFER]=Ui.UINT32,Ci[Lr.COUNT]=Ui.NEVER,Ci),Gr=new ji(Vi.RENDER_WINDOW,Ur,Lr,2);!function(e){e[e.VERTICES=0]="VERTICES",e[e.PLANES=24]="PLANES",e[e.COUNT=48]="COUNT"}(Br||(Br={}));var Hr,kr=((wi={})[Br.VERTICES]=Ui.FLOAT32,wi[Br.PLANES]=Ui.FLOAT32,wi[Br.COUNT]=Ui.NEVER,wi),Vr=new ji(Vi.FRUSTUM,kr,Br);!function(e){e[e.ENABLE=0]="ENABLE",e[e.ILLUM=1]="ILLUM",e[e.SKY_COLOR=2]="SKY_COLOR",e[e.GROUND_ALBEDO=6]="GROUND_ALBEDO",e[e.COUNT=10]="COUNT"}(Hr||(Hr={}));var jr=((Ii={})[Hr.ENABLE]=Ui.UINT32,Ii[Hr.ILLUM]=Ui.FLOAT32,Ii[Hr.SKY_COLOR]=Ui.FLOAT32,Ii[Hr.GROUND_ALBEDO]=Ui.FLOAT32,Ii[Hr.COUNT]=Ui.NEVER,Ii);delete Hr[Hr.COUNT],Hr[Hr.COUNT=Hr.ILLUM+1]="COUNT";var Wr,qr=new ji(Vi.AMBIENT,jr,Hr,1);!function(e){e[e.ENABLE=0]="ENABLE",e[e.IS_RGBE=1]="IS_RGBE",e[e.USE_IBL=2]="USE_IBL",e[e.MODEL=3]="MODEL",e[e.COUNT=4]="COUNT"}(Wr||(Wr={}));var Yr,Xr=((bi={})[Wr.ENABLE]=Ui.UINT32,bi[Wr.IS_RGBE]=Ui.UINT32,bi[Wr.USE_IBL]=Ui.UINT32,bi[Wr.MODEL]=Ui.UINT32,bi[Wr.COUNT]=Ui.NEVER,bi),Kr=new ji(Vi.SKYBOX,Xr,Wr,1);!function(e){e[e.ENABLE=0]="ENABLE",e[e.TYPE=1]="TYPE",e[e.DENSITY=2]="DENSITY",e[e.START=3]="START",e[e.END=4]="END",e[e.ATTEN=5]="ATTEN",e[e.TOP=6]="TOP",e[e.RANGE=7]="RANGE",e[e.COLOR=8]="COLOR",e[e.COUNT=12]="COUNT"}(Yr||(Yr={}));var Qr=((Ri={})[Yr.ENABLE]=Ui.UINT32,Ri[Yr.TYPE]=Ui.UINT32,Ri[Yr.DENSITY]=Ui.FLOAT32,Ri[Yr.START]=Ui.FLOAT32,Ri[Yr.END]=Ui.FLOAT32,Ri[Yr.ATTEN]=Ui.FLOAT32,Ri[Yr.TOP]=Ui.FLOAT32,Ri[Yr.RANGE]=Ui.FLOAT32,Ri[Yr.COLOR]=Ui.FLOAT32,Ri[Yr.COUNT]=Ui.NEVER,Ri);delete Yr[Yr.COUNT],Yr[Yr.COUNT=Yr.RANGE+1]="COUNT";var Zr,Jr=new ji(Vi.FOG,Qr,Yr);!function(e){e[e.ENABLE=0]="ENABLE",e[e.DIRTY=1]="DIRTY",e[e.TYPE=2]="TYPE",e[e.DISTANCE=3]="DISTANCE",e[e.INSTANCE_PASS=4]="INSTANCE_PASS",e[e.PLANAR_PASS=5]="PLANAR_PASS",e[e.NEAR=6]="NEAR",e[e.FAR=7]="FAR",e[e.ASPECT=8]="ASPECT",e[e.PCF_TYPE=9]="PCF_TYPE",e[e.SHADOW_MAP_DIRTY=10]="SHADOW_MAP_DIRTY",e[e.BIAS=11]="BIAS",e[e.ORTHO_SIZE=12]="ORTHO_SIZE",e[e.AUTO_ADAPT=13]="AUTO_ADAPT",e[e.COLOR=14]="COLOR",e[e.SIZE=18]="SIZE",e[e.NORMAL=20]="NORMAL",e[e.MAT_LIGHT=23]="MAT_LIGHT",e[e.COUNT=39]="COUNT"}(Zr||(Zr={}));var $r=((Oi={})[Zr.ENABLE]=Ui.UINT32,Oi[Zr.DIRTY]=Ui.UINT32,Oi[Zr.TYPE]=Ui.UINT32,Oi[Zr.DISTANCE]=Ui.FLOAT32,Oi[Zr.INSTANCE_PASS]=Ui.UINT32,Oi[Zr.PLANAR_PASS]=Ui.UINT32,Oi[Zr.NEAR]=Ui.FLOAT32,Oi[Zr.FAR]=Ui.FLOAT32,Oi[Zr.ASPECT]=Ui.FLOAT32,Oi[Zr.PCF_TYPE]=Ui.UINT32,Oi[Zr.SHADOW_MAP_DIRTY]=Ui.UINT32,Oi[Zr.BIAS]=Ui.FLOAT32,Oi[Zr.ORTHO_SIZE]=Ui.FLOAT32,Oi[Zr.AUTO_ADAPT]=Ui.UINT32,Oi[Zr.COLOR]=Ui.FLOAT32,Oi[Zr.SIZE]=Ui.FLOAT32,Oi[Zr.NORMAL]=Ui.FLOAT32,Oi[Zr.MAT_LIGHT]=Ui.FLOAT32,Oi[Zr.COUNT]=Ui.NEVER,Oi);delete Zr[Zr.COUNT],Zr[Zr.COUNT=Zr.AUTO_ADAPT+1]="COUNT";var eo,to=new ji(Vi.SHADOW,$r,Zr,1);!function(e){e[e.USE_COLOR_TEMPERATURE=0]="USE_COLOR_TEMPERATURE",e[e.ILLUMINANCE=1]="ILLUMINANCE",e[e.NODE=2]="NODE",e[e.RANGE=3]="RANGE",e[e.TYPE=4]="TYPE",e[e.AABB=5]="AABB",e[e.FRUSTUM=6]="FRUSTUM",e[e.SIZE=7]="SIZE",e[e.SPOT_ANGLE=8]="SPOT_ANGLE",e[e.ASPECT=9]="ASPECT",e[e.DIRECTION=10]="DIRECTION",e[e.COLOR=13]="COLOR",e[e.COLOR_TEMPERATURE_RGB=16]="COLOR_TEMPERATURE_RGB",e[e.POSITION=19]="POSITION",e[e.COUNT=22]="COUNT"}(eo||(eo={}));var no,io=((Ni={})[eo.USE_COLOR_TEMPERATURE]=Ui.UINT32,Ni[eo.ILLUMINANCE]=Ui.FLOAT32,Ni[eo.NODE]=Ui.UINT32,Ni[eo.RANGE]=Ui.FLOAT32,Ni[eo.TYPE]=Ui.UINT32,Ni[eo.AABB]=Ui.UINT32,Ni[eo.FRUSTUM]=Ui.UINT32,Ni[eo.SIZE]=Ui.FLOAT32,Ni[eo.SPOT_ANGLE]=Ui.FLOAT32,Ni[eo.ASPECT]=Ui.FLOAT32,Ni[eo.DIRECTION]=Ui.FLOAT32,Ni[eo.COLOR]=Ui.FLOAT32,Ni[eo.COLOR_TEMPERATURE_RGB]=Ui.FLOAT32,Ni[eo.POSITION]=Ui.FLOAT32,Ni[eo.COUNT]=Ui.NEVER,Ni),ro=new ji(Vi.LIGHT,io,eo,3);!function(e){e[e.RADIUS=0]="RADIUS",e[e.CENTER=1]="CENTER",e[e.COUNT=4]="COUNT"}(no||(no={}));var oo=((Pi={})[no.RADIUS]=Ui.FLOAT32,Pi[no.CENTER]=Ui.FLOAT32,Pi[no.COUNT]=Ui.NEVER,Pi);delete no[no.COUNT],no[no.COUNT=no.RADIUS+1]="COUNT";var ao,so=new ji(Vi.SPHERE,oo,no,3);!function(e){e[e.STRIDE=0]="STRIDE",e[e.AMOUNT=1]="AMOUNT",e[e.BUFFER=2]="BUFFER",e[e.COUNT=3]="COUNT"}(ao||(ao={}));var co,lo=((Mi={})[ao.STRIDE]=Ui.UINT32,Mi[ao.AMOUNT]=Ui.UINT32,Mi[ao.BUFFER]=Ui.UINT32,Mi[ao.COUNT]=Ui.NEVER,Mi),uo=new ji(Vi.FLAT_BUFFER,lo,ao,3);!function(e){e[e.FLAT_BUFFER_ARRAY=0]="FLAT_BUFFER_ARRAY",e[e.COUNT=1]="COUNT"}(co||(co={}));var ho,_o=((Di={})[co.FLAT_BUFFER_ARRAY]=Ui.UINT32,Di[co.COUNT]=Ui.NEVER,Di),fo=new ji(Vi.SUB_MESH,_o,co,3);!function(e){e[e.IS_DISCARD=0]="IS_DISCARD",e[e.POLYGO_MODEL=1]="POLYGO_MODEL",e[e.SHADE_MODEL=2]="SHADE_MODEL",e[e.CULL_MODE=3]="CULL_MODE",e[e.IS_FRONT_FACE_CCW=4]="IS_FRONT_FACE_CCW",e[e.DEPTH_BIAS_ENABLED=5]="DEPTH_BIAS_ENABLED",e[e.DEPTH_BIAS=6]="DEPTH_BIAS",e[e.DEPTH_BIAS_CLAMP=7]="DEPTH_BIAS_CLAMP",e[e.DEPTH_BIAS_SLOP=8]="DEPTH_BIAS_SLOP",e[e.IS_DEPTH_CLIP=9]="IS_DEPTH_CLIP",e[e.IS_MULTI_SAMPLE=10]="IS_MULTI_SAMPLE",e[e.LINE_WIDTH=11]="LINE_WIDTH",e[e.COUNT=12]="COUNT"}(ho||(ho={}));var mo,po=((Li={})[ho.IS_DISCARD]=Ui.UINT32,Li[ho.POLYGO_MODEL]=Ui.UINT32,Li[ho.SHADE_MODEL]=Ui.UINT32,Li[ho.CULL_MODE]=Ui.UINT32,Li[ho.IS_FRONT_FACE_CCW]=Ui.UINT32,Li[ho.DEPTH_BIAS_ENABLED]=Ui.UINT32,Li[ho.DEPTH_BIAS]=Ui.FLOAT32,Li[ho.DEPTH_BIAS_CLAMP]=Ui.FLOAT32,Li[ho.DEPTH_BIAS_SLOP]=Ui.FLOAT32,Li[ho.IS_DEPTH_CLIP]=Ui.UINT32,Li[ho.IS_MULTI_SAMPLE]=Ui.UINT32,Li[ho.LINE_WIDTH]=Ui.FLOAT32,Li[ho.COUNT]=Ui.NEVER,Li),vo=new ji(Vi.RASTERIZER_STATE,po,ho,9);!function(e){e[e.DEPTH_TEST=0]="DEPTH_TEST",e[e.DEPTH_WRITE=1]="DEPTH_WRITE",e[e.DEPTH_FUNC=2]="DEPTH_FUNC",e[e.STENCIL_TEST_FRONT=3]="STENCIL_TEST_FRONT",e[e.STENCIL_FUNC_FRONT=4]="STENCIL_FUNC_FRONT",e[e.STENCIL_READ_MASK_FRONT=5]="STENCIL_READ_MASK_FRONT",e[e.STENCIL_WRITE_MASK_FRONT=6]="STENCIL_WRITE_MASK_FRONT",e[e.STENCIL_FAIL_OP_FRONT=7]="STENCIL_FAIL_OP_FRONT",e[e.STENCIL_Z_FAIL_OP_FRONT=8]="STENCIL_Z_FAIL_OP_FRONT",e[e.STENCIL_PASS_OP_FRONT=9]="STENCIL_PASS_OP_FRONT",e[e.STENCIL_REF_FRONT=10]="STENCIL_REF_FRONT",e[e.STENCIL_TEST_BACK=11]="STENCIL_TEST_BACK",e[e.STENCIL_FUNC_BACK=12]="STENCIL_FUNC_BACK",e[e.STENCIL_READ_MADK_BACK=13]="STENCIL_READ_MADK_BACK",e[e.STENCIL_WRITE_MASK_BACK=14]="STENCIL_WRITE_MASK_BACK",e[e.STENCIL_FAIL_OP_BACK=15]="STENCIL_FAIL_OP_BACK",e[e.STENCIL_Z_FAIL_OP_BACK=16]="STENCIL_Z_FAIL_OP_BACK",e[e.STENCIL_PASS_OP_BACK=17]="STENCIL_PASS_OP_BACK",e[e.STENCIL_REF_BACK=18]="STENCIL_REF_BACK",e[e.COUNT=19]="COUNT"}(mo||(mo={}));var go,yo=((Fi={})[mo.DEPTH_TEST]=Ui.UINT32,Fi[mo.DEPTH_WRITE]=Ui.UINT32,Fi[mo.DEPTH_FUNC]=Ui.UINT32,Fi[mo.STENCIL_TEST_FRONT]=Ui.UINT32,Fi[mo.STENCIL_FUNC_FRONT]=Ui.UINT32,Fi[mo.STENCIL_READ_MASK_FRONT]=Ui.UINT32,Fi[mo.STENCIL_WRITE_MASK_FRONT]=Ui.UINT32,Fi[mo.STENCIL_FAIL_OP_FRONT]=Ui.UINT32,Fi[mo.STENCIL_Z_FAIL_OP_FRONT]=Ui.UINT32,Fi[mo.STENCIL_PASS_OP_FRONT]=Ui.UINT32,Fi[mo.STENCIL_REF_FRONT]=Ui.UINT32,Fi[mo.STENCIL_TEST_BACK]=Ui.UINT32,Fi[mo.STENCIL_FUNC_BACK]=Ui.UINT32,Fi[mo.STENCIL_READ_MADK_BACK]=Ui.UINT32,Fi[mo.STENCIL_WRITE_MASK_BACK]=Ui.UINT32,Fi[mo.STENCIL_FAIL_OP_BACK]=Ui.UINT32,Fi[mo.STENCIL_Z_FAIL_OP_BACK]=Ui.UINT32,Fi[mo.STENCIL_PASS_OP_BACK]=Ui.UINT32,Fi[mo.STENCIL_REF_BACK]=Ui.UINT32,Fi[mo.COUNT]=Ui.NEVER,Fi),xo=new ji(Vi.DEPTH_STENCIL_STATE,yo,mo,9);!function(e){e[e.BLEND=0]="BLEND",e[e.BLEND_SRC=1]="BLEND_SRC",e[e.BLEND_DST=2]="BLEND_DST",e[e.BLEND_EQ=3]="BLEND_EQ",e[e.BLEND_SRC_ALPHA=4]="BLEND_SRC_ALPHA",e[e.BLEND_DST_ALPHA=5]="BLEND_DST_ALPHA",e[e.BLEND_ALPHA_EQ=6]="BLEND_ALPHA_EQ",e[e.BLEND_COLOR_MASK=7]="BLEND_COLOR_MASK",e[e.COUNT=8]="COUNT"}(go||(go={})),(zi={})[go.BLEND]=Ui.UINT32,zi[go.BLEND_SRC]=Ui.UINT32,zi[go.BLEND_DST]=Ui.UINT32,zi[go.BLEND_EQ]=Ui.UINT32,zi[go.BLEND_SRC_ALPHA]=Ui.UINT32,zi[go.BLEND_DST_ALPHA]=Ui.UINT32,zi[go.BLEND_ALPHA_EQ]=Ui.UINT32,zi[go.BLEND_COLOR_MASK]=Ui.UINT32,zi[go.COUNT]=Ui.NEVER;var Eo,So=new ji(Vi.BLEND_TARGET,yo,go,9);!function(e){e[e.IS_A2C=0]="IS_A2C",e[e.IS_INDEPEND=1]="IS_INDEPEND",e[e.BLEND_COLOR=2]="BLEND_COLOR",e[e.BLEND_TARGET=6]="BLEND_TARGET",e[e.COUNT=7]="COUNT"}(Eo||(Eo={}));var To=((Bi={})[Eo.IS_A2C]=Ui.UINT32,Bi[Eo.IS_INDEPEND]=Ui.UINT32,Bi[Eo.BLEND_COLOR]=Ui.FLOAT32,Bi[Eo.BLEND_TARGET]=Ui.UINT32,Bi[Eo.COUNT]=Ui.NEVER,Bi),Ao=new ji(Vi.BLEND_STATE,To,Eo,9),Co=function(){function e(){this._skyColor=new zn(51,128,204,1),this._groundAlbedo=new zn(51,51,51,255),this._albedoArray=Float32Array.from([.2,.2,.2,1]),this._colorArray=Float32Array.from([.2,.5,.8,1]),this._handle=Qi,this._handle=qr.alloc()}Z(e,[{key:"colorArray",get:function(){return this._colorArray}},{key:"albedoArray",get:function(){return this._albedoArray}},{key:"enabled",set:function(e){qr.set(this._handle,Hr.ENABLE,e?1:0)},get:function(){return qr.get(this._handle,Hr.ENABLE)}},{key:"skyColor",get:function(){return this._skyColor},set:function(e){this._skyColor.set(e),zn.toArray(this._colorArray,this._skyColor),qr.setVec4(this._handle,Hr.SKY_COLOR,this._skyColor)}},{key:"skyIllum",get:function(){return qr.get(this._handle,Hr.ILLUM)},set:function(e){qr.set(this._handle,Hr.ILLUM,e)}},{key:"groundAlbedo",get:function(){return this._groundAlbedo},set:function(e){this._groundAlbedo.set(e),Un.toArray(this._albedoArray,this._groundAlbedo),qr.setVec4(this._handle,Hr.GROUND_ALBEDO,this._groundAlbedo)}},{key:"handle",get:function(){return this._handle}}]);var t=e.prototype;return t.initialize=function(e){this._skyColor.set(e.skyColor),this._groundAlbedo.set(e.groundAlbedo),zn.toArray(this._colorArray,this._skyColor),Un.toArray(this._albedoArray,this._groundAlbedo),qr.setVec4(this._handle,Hr.SKY_COLOR,this._skyColor),qr.setVec4(this._handle,Hr.GROUND_ALBEDO,this._groundAlbedo),qr.set(this._handle,Hr.ILLUM,e.skyIllum)},t.destroy=function(){this._handle&&(qr.free(this._handle),this._handle=Qi)},e}();Co.SUN_ILLUM=65e3,Co.SKY_ILLUM=2e4,c.Ambient=Co;var wo=new Un,Io=new Un,bo=new Un,Ro=new Un,Oo=new Un,No=new Un,Po=new Array(3),Mo=new Array(3);function Do(e,t){return Un.dot(t.n,e)-t.d}function Lo(e,t,n){return Un.copy(e,t),Un.subtract(Oo,n.center,n.halfExtents),Un.add(No,n.center,n.halfExtents),e.x=e.x<Oo.x?Oo.x:e.x,e.y=e.y<Oo.y?Oo.y:e.y,e.z=e.z<Oo.z?Oo.z:e.z,e.x=e.x>No.x?No.x:e.x,e.y=e.y>No.y?No.y:e.y,e.z=e.z>No.z?No.z:e.z,e}function Fo(e,t,n){Un.set(wo,n.orientation.m00,n.orientation.m01,n.orientation.m02),Un.set(Io,n.orientation.m03,n.orientation.m04,n.orientation.m05),Un.set(bo,n.orientation.m06,n.orientation.m07,n.orientation.m08),Po[0]=wo,Po[1]=Io,Po[2]=bo,Mo[0]=n.halfExtents.x,Mo[1]=n.halfExtents.y,Mo[2]=n.halfExtents.z,Un.subtract(Ro,t,n.center),Un.set(e,n.center.x,n.center.y,n.center.z);for(var i=0;i<3;i++){var r=Un.dot(Ro,Po[i]);r>Mo[i]&&(r=Mo[i]),r<-Mo[i]&&(r=-Mo[i]),e.x+=r*Po[i].x,e.y+=r*Po[i].y,e.z+=r*Po[i].z}return e}var zo=Object.freeze({__proto__:null,point_plane:Do,pt_point_plane:function(e,t,n){var i=Do(t,n);return Un.subtract(e,t,Un.multiplyScalar(e,n.n,i))},pt_point_aabb:Lo,pt_point_obb:Fo,pt_point_line:function(e,t,n,i){Un.subtract(wo,n,i);var r=wo,o=Un.lengthSqr(r);if(0==o)Un.copy(e,n);else{Un.subtract(wo,t,n);var a=Un.dot(wo,r)/o;a<0?Un.copy(e,n):a>1?Un.copy(e,i):Un.scaleAndAdd(e,n,r,a)}}}),Bo={SHAPE_RAY:1,SHAPE_LINE:2,SHAPE_SPHERE:4,SHAPE_AABB:8,SHAPE_OBB:16,SHAPE_PLANE:32,SHAPE_TRIANGLE:64,SHAPE_FRUSTUM:128,SHAPE_FRUSTUM_ACCURATE:256,SHAPE_CAPSULE:512},Uo=function(){function e(e,t,n,i,r,o){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=-1),this.s=void 0,this.e=void 0,this._type=void 0,this._type=Bo.SHAPE_LINE,this.s=new Un(e,t,n),this.e=new Un(i,r,o)}return e.create=function(t,n,i,r,o,a){return new e(t,n,i,r,o,a)},e.clone=function(t){return new e(t.s.x,t.s.y,t.s.z,t.e.x,t.e.y,t.e.z)},e.copy=function(e,t){return Un.copy(e.s,t.s),Un.copy(e.e,t.e),e},e.fromPoints=function(e,t,n){return Un.copy(e.s,t),Un.copy(e.e,n),e},e.set=function(e,t,n,i,r,o,a){return e.s.x=t,e.s.y=n,e.s.z=i,e.e.x=r,e.e.y=o,e.e.z=a,e},e.len=function(e){return Un.distance(e.s,e.e)},Z(e,[{key:"type",get:function(){return this._type}}]),e.prototype.length=function(){return Un.distance(this.s,this.e)},e}(),Go=function(){function e(e,t,n,i,r,o){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=-1),this.o=void 0,this.d=void 0,this._type=void 0,this._type=Bo.SHAPE_RAY,this.o=new Un(e,t,n),this.d=new Un(i,r,o)}return e.create=function(t,n,i,r,o,a){return void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=0),void 0===a&&(a=1),new e(t,n,i,r,o,a)},e.clone=function(t){return new e(t.o.x,t.o.y,t.o.z,t.d.x,t.d.y,t.d.z)},e.copy=function(e,t){return Un.copy(e.o,t.o),Un.copy(e.d,t.d),e},e.fromPoints=function(e,t,n){return Un.copy(e.o,t),Un.normalize(e.d,Un.subtract(e.d,n,t)),e},e.set=function(e,t,n,i,r,o,a){return e.o.x=t,e.o.y=n,e.o.z=i,e.d.x=r,e.d.y=o,e.d.z=a,e},Z(e,[{key:"type",get:function(){return this._type}}]),e.prototype.computeHit=function(e,t){Un.normalize(e,this.d),Un.scaleAndAdd(e,this.o,e,t)},e}(),Ho=new Un,ko=new Un,Vo=new Un,jo=new Un;function Wo(e){return Math.max(Math.max(e.x,e.y),e.z)}var qo,Yo=e("db",function(){function e(e,t,n,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=1),this._center=new Un(0,0,0),this._poolHandle=Qi,this._type=void 0,this._type=Bo.SHAPE_SPHERE,this._center=new Un(e,t,n),this._poolHandle=so.alloc(),so.setVec3(this._poolHandle,no.CENTER,this._center),so.set(this._poolHandle,no.RADIUS,i)}e.create=function(t,n,i,r){return new e(t,n,i,r)},e.clone=function(t){return new e(t.center.x,t.center.y,t.center.z,t.radius)},e.copy=function(e,t){return Un.copy(e.center,t.center),e.radius=t.radius,e},e.fromPoints=function(e,t,n){return Un.multiplyScalar(e.center,Un.add(Ho,t,n),.5),e.radius=.5*Un.subtract(Ho,n,t).length(),e},e.set=function(e,t,n,i,r){return e.center.x=t,e.center.y=n,e.center.z=i,e.radius=r,e},e.mergePoint=function(e,t,n){if(t.radius<0)return e.center.set(n),e.radius=0,e;Un.subtract(ko,n,t.center);var i=ko.length();if(i>t.radius){var r=.5*(i-t.radius);e.radius+=r,Un.multiplyScalar(ko,ko,r/i),Un.add(e.center,e.center,ko)}return e},e.mergeAABB=function(t,n,i){return i.getBoundary(Vo,jo),e.mergePoint(t,n,Vo),e.mergePoint(t,n,jo),t},Z(e,[{key:"center",get:function(){return this._center},set:function(e){this._center=e,so.setVec3(this._poolHandle,no.CENTER,this._center)}},{key:"radius",get:function(){return so.get(this._poolHandle,no.RADIUS)},set:function(e){so.set(this._poolHandle,no.RADIUS,e)}},{key:"handle",get:function(){return this._poolHandle}},{key:"type",get:function(){return this._type}}]);var t=e.prototype;return t.destroy=function(){this._poolHandle&&(so.free(this._poolHandle),this._poolHandle=Qi)},t.clone=function(){return e.clone(this)},t.copy=function(t){return e.copy(this,t)},t.getBoundary=function(e,t){Un.set(e,this.center.x-this.radius,this.center.y-this.radius,this.center.z-this.radius),Un.set(t,this.center.x+this.radius,this.center.y+this.radius,this.center.z+this.radius)},t.transform=function(e,t,n,i,r){Un.transformMat4(r.center,this.center,e),r.radius=this.radius*Wo(i)},t.translateAndRotate=function(e,t,n){Un.transformMat4(n.center,this.center,e)},t.setScale=function(e,t){t.radius=this.radius*Wo(e)},e}()),Xo=function(){function e(e,t,n,i,r,o,a,s,c){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=1),void 0===r&&(r=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===s&&(s=1),void 0===c&&(c=0),this.a=void 0,this.b=void 0,this.c=void 0,this._type=void 0,this._type=Bo.SHAPE_TRIANGLE,this.a=new Un(e,t,n),this.b=new Un(i,r,o),this.c=new Un(a,s,c)}return e.create=function(t,n,i,r,o,a,s,c,l){return void 0===t&&(t=1),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=1),new e(t,n,i,r,o,a,s,c,l)},e.clone=function(t){return new e(t.a.x,t.a.y,t.a.z,t.b.x,t.b.y,t.b.z,t.c.x,t.c.y,t.c.z)},e.copy=function(e,t){return Un.copy(e.a,t.a),Un.copy(e.b,t.b),Un.copy(e.c,t.c),e},e.fromPoints=function(e,t,n,i){return Un.copy(e.a,t),Un.copy(e.b,n),Un.copy(e.c,i),e},e.set=function(e,t,n,i,r,o,a,s,c,l){return e.a.x=t,e.a.y=n,e.a.z=i,e.b.x=r,e.b.y=o,e.b.z=a,e.c.x=s,e.c.y=c,e.c.z=l,e},Z(e,[{key:"type",get:function(){return this._type}}]),e}(),Ko=e("eC",4);!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.BUFFER=1]="BUFFER",e[e.TEXTURE=2]="TEXTURE",e[e.RENDER_PASS=3]="RENDER_PASS",e[e.FRAMEBUFFER=4]="FRAMEBUFFER",e[e.SAMPLER=5]="SAMPLER",e[e.SHADER=6]="SHADER",e[e.DESCRIPTOR_SET_LAYOUT=7]="DESCRIPTOR_SET_LAYOUT",e[e.PIPELINE_LAYOUT=8]="PIPELINE_LAYOUT",e[e.PIPELINE_STATE=9]="PIPELINE_STATE",e[e.DESCRIPTOR_SET=10]="DESCRIPTOR_SET",e[e.INPUT_ASSEMBLER=11]="INPUT_ASSEMBLER",e[e.COMMAND_BUFFER=12]="COMMAND_BUFFER",e[e.FENCE=13]="FENCE",e[e.QUEUE=14]="QUEUE",e[e.WINDOW=15]="WINDOW"}(qo||(qo=e("eD",{})));var Qo,Zo,Jo,$o,ea,ta,na,ia,ra,oa,aa,sa,ca,la,ua,ha,_a,fa,ma,da,pa,va,ga,ya,xa,Ea,Sa,Ta,Aa,Ca,wa,Ia,ba,Ra,Oa,Na,Pa,Ma=e("eE",function(){function e(e){this._gfxType=qo.UNKNOWN,this._gfxType=e}return Z(e,[{key:"gfxType",get:function(){return this._gfxType}}]),e}());!function(e){e.ATTR_POSITION="a_position",e.ATTR_NORMAL="a_normal",e.ATTR_TANGENT="a_tangent",e.ATTR_BITANGENT="a_bitangent",e.ATTR_WEIGHTS="a_weights",e.ATTR_JOINTS="a_joints",e.ATTR_COLOR="a_color",e.ATTR_COLOR1="a_color1",e.ATTR_COLOR2="a_color2",e.ATTR_TEX_COORD="a_texCoord",e.ATTR_TEX_COORD1="a_texCoord1",e.ATTR_TEX_COORD2="a_texCoord2",e.ATTR_TEX_COORD3="a_texCoord3",e.ATTR_TEX_COORD4="a_texCoord4",e.ATTR_TEX_COORD5="a_texCoord5",e.ATTR_TEX_COORD6="a_texCoord6",e.ATTR_TEX_COORD7="a_texCoord7",e.ATTR_TEX_COORD8="a_texCoord8",e.ATTR_BATCH_ID="a_batch_id",e.ATTR_BATCH_UV="a_batch_uv"}(Qo||(Qo=e("at",{}))),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.BOOL=1]="BOOL",e[e.BOOL2=2]="BOOL2",e[e.BOOL3=3]="BOOL3",e[e.BOOL4=4]="BOOL4",e[e.INT=5]="INT",e[e.INT2=6]="INT2",e[e.INT3=7]="INT3",e[e.INT4=8]="INT4",e[e.UINT=9]="UINT",e[e.UINT2=10]="UINT2",e[e.UINT3=11]="UINT3",e[e.UINT4=12]="UINT4",e[e.FLOAT=13]="FLOAT",e[e.FLOAT2=14]="FLOAT2",e[e.FLOAT3=15]="FLOAT3",e[e.FLOAT4=16]="FLOAT4",e[e.MAT2=17]="MAT2",e[e.MAT2X3=18]="MAT2X3",e[e.MAT2X4=19]="MAT2X4",e[e.MAT3X2=20]="MAT3X2",e[e.MAT3=21]="MAT3",e[e.MAT3X4=22]="MAT3X4",e[e.MAT4X2=23]="MAT4X2",e[e.MAT4X3=24]="MAT4X3",e[e.MAT4=25]="MAT4",e[e.SAMPLER1D=26]="SAMPLER1D",e[e.SAMPLER1D_ARRAY=27]="SAMPLER1D_ARRAY",e[e.SAMPLER2D=28]="SAMPLER2D",e[e.SAMPLER2D_ARRAY=29]="SAMPLER2D_ARRAY",e[e.SAMPLER3D=30]="SAMPLER3D",e[e.SAMPLER_CUBE=31]="SAMPLER_CUBE",e[e.COUNT=32]="COUNT"}(Zo||(Zo=e("A",{}))),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.A8=1]="A8",e[e.L8=2]="L8",e[e.LA8=3]="LA8",e[e.R8=4]="R8",e[e.R8SN=5]="R8SN",e[e.R8UI=6]="R8UI",e[e.R8I=7]="R8I",e[e.R16F=8]="R16F",e[e.R16UI=9]="R16UI",e[e.R16I=10]="R16I",e[e.R32F=11]="R32F",e[e.R32UI=12]="R32UI",e[e.R32I=13]="R32I",e[e.RG8=14]="RG8",e[e.RG8SN=15]="RG8SN",e[e.RG8UI=16]="RG8UI",e[e.RG8I=17]="RG8I",e[e.RG16F=18]="RG16F",e[e.RG16UI=19]="RG16UI",e[e.RG16I=20]="RG16I",e[e.RG32F=21]="RG32F",e[e.RG32UI=22]="RG32UI",e[e.RG32I=23]="RG32I",e[e.RGB8=24]="RGB8",e[e.SRGB8=25]="SRGB8",e[e.RGB8SN=26]="RGB8SN",e[e.RGB8UI=27]="RGB8UI",e[e.RGB8I=28]="RGB8I",e[e.RGB16F=29]="RGB16F",e[e.RGB16UI=30]="RGB16UI",e[e.RGB16I=31]="RGB16I",e[e.RGB32F=32]="RGB32F",e[e.RGB32UI=33]="RGB32UI",e[e.RGB32I=34]="RGB32I",e[e.RGBA8=35]="RGBA8",e[e.BGRA8=36]="BGRA8",e[e.SRGB8_A8=37]="SRGB8_A8",e[e.RGBA8SN=38]="RGBA8SN",e[e.RGBA8UI=39]="RGBA8UI",e[e.RGBA8I=40]="RGBA8I",e[e.RGBA16F=41]="RGBA16F",e[e.RGBA16UI=42]="RGBA16UI",e[e.RGBA16I=43]="RGBA16I",e[e.RGBA32F=44]="RGBA32F",e[e.RGBA32UI=45]="RGBA32UI",e[e.RGBA32I=46]="RGBA32I",e[e.R5G6B5=47]="R5G6B5",e[e.R11G11B10F=48]="R11G11B10F",e[e.RGB5A1=49]="RGB5A1",e[e.RGBA4=50]="RGBA4",e[e.RGB10A2=51]="RGB10A2",e[e.RGB10A2UI=52]="RGB10A2UI",e[e.RGB9E5=53]="RGB9E5",e[e.D16=54]="D16",e[e.D16S8=55]="D16S8",e[e.D24=56]="D24",e[e.D24S8=57]="D24S8",e[e.D32F=58]="D32F",e[e.D32F_S8=59]="D32F_S8",e[e.BC1=60]="BC1",e[e.BC1_ALPHA=61]="BC1_ALPHA",e[e.BC1_SRGB=62]="BC1_SRGB",e[e.BC1_SRGB_ALPHA=63]="BC1_SRGB_ALPHA",e[e.BC2=64]="BC2",e[e.BC2_SRGB=65]="BC2_SRGB",e[e.BC3=66]="BC3",e[e.BC3_SRGB=67]="BC3_SRGB",e[e.BC4=68]="BC4",e[e.BC4_SNORM=69]="BC4_SNORM",e[e.BC5=70]="BC5",e[e.BC5_SNORM=71]="BC5_SNORM",e[e.BC6H_UF16=72]="BC6H_UF16",e[e.BC6H_SF16=73]="BC6H_SF16",e[e.BC7=74]="BC7",e[e.BC7_SRGB=75]="BC7_SRGB",e[e.ETC_RGB8=76]="ETC_RGB8",e[e.ETC2_RGB8=77]="ETC2_RGB8",e[e.ETC2_SRGB8=78]="ETC2_SRGB8",e[e.ETC2_RGB8_A1=79]="ETC2_RGB8_A1",e[e.ETC2_SRGB8_A1=80]="ETC2_SRGB8_A1",e[e.ETC2_RGBA8=81]="ETC2_RGBA8",e[e.ETC2_SRGB8_A8=82]="ETC2_SRGB8_A8",e[e.EAC_R11=83]="EAC_R11",e[e.EAC_R11SN=84]="EAC_R11SN",e[e.EAC_RG11=85]="EAC_RG11",e[e.EAC_RG11SN=86]="EAC_RG11SN",e[e.PVRTC_RGB2=87]="PVRTC_RGB2",e[e.PVRTC_RGBA2=88]="PVRTC_RGBA2",e[e.PVRTC_RGB4=89]="PVRTC_RGB4",e[e.PVRTC_RGBA4=90]="PVRTC_RGBA4",e[e.PVRTC2_2BPP=91]="PVRTC2_2BPP",e[e.PVRTC2_4BPP=92]="PVRTC2_4BPP",e[e.ASTC_RGBA_4x4=93]="ASTC_RGBA_4x4",e[e.ASTC_RGBA_5x4=94]="ASTC_RGBA_5x4",e[e.ASTC_RGBA_5x5=95]="ASTC_RGBA_5x5",e[e.ASTC_RGBA_6x5=96]="ASTC_RGBA_6x5",e[e.ASTC_RGBA_6x6=97]="ASTC_RGBA_6x6",e[e.ASTC_RGBA_8x5=98]="ASTC_RGBA_8x5",e[e.ASTC_RGBA_8x6=99]="ASTC_RGBA_8x6",e[e.ASTC_RGBA_8x8=100]="ASTC_RGBA_8x8",e[e.ASTC_RGBA_10x5=101]="ASTC_RGBA_10x5",e[e.ASTC_RGBA_10x6=102]="ASTC_RGBA_10x6",e[e.ASTC_RGBA_10x8=103]="ASTC_RGBA_10x8",e[e.ASTC_RGBA_10x10=104]="ASTC_RGBA_10x10",e[e.ASTC_RGBA_12x10=105]="ASTC_RGBA_12x10",e[e.ASTC_RGBA_12x12=106]="ASTC_RGBA_12x12",e[e.ASTC_SRGBA_4x4=107]="ASTC_SRGBA_4x4",e[e.ASTC_SRGBA_5x4=108]="ASTC_SRGBA_5x4",e[e.ASTC_SRGBA_5x5=109]="ASTC_SRGBA_5x5",e[e.ASTC_SRGBA_6x5=110]="ASTC_SRGBA_6x5",e[e.ASTC_SRGBA_6x6=111]="ASTC_SRGBA_6x6",e[e.ASTC_SRGBA_8x5=112]="ASTC_SRGBA_8x5",e[e.ASTC_SRGBA_8x6=113]="ASTC_SRGBA_8x6",e[e.ASTC_SRGBA_8x8=114]="ASTC_SRGBA_8x8",e[e.ASTC_SRGBA_10x5=115]="ASTC_SRGBA_10x5",e[e.ASTC_SRGBA_10x6=116]="ASTC_SRGBA_10x6",e[e.ASTC_SRGBA_10x8=117]="ASTC_SRGBA_10x8",e[e.ASTC_SRGBA_10x10=118]="ASTC_SRGBA_10x10",e[e.ASTC_SRGBA_12x10=119]="ASTC_SRGBA_12x10",e[e.ASTC_SRGBA_12x12=120]="ASTC_SRGBA_12x12"}(Jo||(Jo=e("F",{}))),function(e){e[e.NONE=0]="NONE",e[e.TRANSFER_SRC=1]="TRANSFER_SRC",e[e.TRANSFER_DST=2]="TRANSFER_DST",e[e.INDEX=4]="INDEX",e[e.VERTEX=8]="VERTEX",e[e.UNIFORM=16]="UNIFORM",e[e.STORAGE=32]="STORAGE",e[e.INDIRECT=64]="INDIRECT"}($o||($o=e("B",{}))),function(e){e[e.NONE=0]="NONE",e[e.DEVICE=1]="DEVICE",e[e.HOST=2]="HOST"}(ea||(ea=e("q",{}))),function(e){e[e.NONE=0]="NONE",e[e.BAKUP_BUFFER=4]="BAKUP_BUFFER"}(ta||(ta=e("G",{}))),function(e){e[e.NONE=0]="NONE",e[e.READ=1]="READ",e[e.WRITE=2]="WRITE"}(na||(na=e("eF",{}))),function(e){e[e.POINT_LIST=0]="POINT_LIST",e[e.LINE_LIST=1]="LINE_LIST",e[e.LINE_STRIP=2]="LINE_STRIP",e[e.LINE_LOOP=3]="LINE_LOOP",e[e.LINE_LIST_ADJACENCY=4]="LINE_LIST_ADJACENCY",e[e.LINE_STRIP_ADJACENCY=5]="LINE_STRIP_ADJACENCY",e[e.ISO_LINE_LIST=6]="ISO_LINE_LIST",e[e.TRIANGLE_LIST=7]="TRIANGLE_LIST",e[e.TRIANGLE_STRIP=8]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=9]="TRIANGLE_FAN",e[e.TRIANGLE_LIST_ADJACENCY=10]="TRIANGLE_LIST_ADJACENCY",e[e.TRIANGLE_STRIP_ADJACENCY=11]="TRIANGLE_STRIP_ADJACENCY",e[e.TRIANGLE_PATCH_ADJACENCY=12]="TRIANGLE_PATCH_ADJACENCY",e[e.QUAD_PATCH_LIST=13]="QUAD_PATCH_LIST"}(ia||(ia=e("aV",{}))),function(e){e[e.FILL=0]="FILL",e[e.POINT=1]="POINT",e[e.LINE=2]="LINE"}(ra||(ra=e("eG",{}))),function(e){e[e.GOURAND=0]="GOURAND",e[e.FLAT=1]="FLAT"}(oa||(oa=e("eH",{}))),function(e){e[e.NONE=0]="NONE",e[e.FRONT=1]="FRONT",e[e.BACK=2]="BACK"}(aa||(aa=e("v",{}))),function(e){e[e.NEVER=0]="NEVER",e[e.LESS=1]="LESS",e[e.EQUAL=2]="EQUAL",e[e.LESS_EQUAL=3]="LESS_EQUAL",e[e.GREATER=4]="GREATER",e[e.NOT_EQUAL=5]="NOT_EQUAL",e[e.GREATER_EQUAL=6]="GREATER_EQUAL",e[e.ALWAYS=7]="ALWAYS"}(sa||(sa=e("c1",{}))),function(e){e[e.ZERO=0]="ZERO",e[e.KEEP=1]="KEEP",e[e.REPLACE=2]="REPLACE",e[e.INCR=3]="INCR",e[e.DECR=4]="DECR",e[e.INVERT=5]="INVERT",e[e.INCR_WRAP=6]="INCR_WRAP",e[e.DECR_WRAP=7]="DECR_WRAP"}(ca||(ca=e("c2",{}))),function(e){e[e.ADD=0]="ADD",e[e.SUB=1]="SUB",e[e.REV_SUB=2]="REV_SUB",e[e.MIN=3]="MIN",e[e.MAX=4]="MAX"}(la||(la=e("dA",{}))),function(e){e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_ALPHA=2]="SRC_ALPHA",e[e.DST_ALPHA=3]="DST_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=4]="ONE_MINUS_SRC_ALPHA",e[e.ONE_MINUS_DST_ALPHA=5]="ONE_MINUS_DST_ALPHA",e[e.SRC_COLOR=6]="SRC_COLOR",e[e.DST_COLOR=7]="DST_COLOR",e[e.ONE_MINUS_SRC_COLOR=8]="ONE_MINUS_SRC_COLOR",e[e.ONE_MINUS_DST_COLOR=9]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=10]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=11]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=12]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=13]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=14]="ONE_MINUS_CONSTANT_ALPHA"}(ua||(ua=e("c4",{}))),function(e){e[e.NONE=0]="NONE",e[e.R=1]="R",e[e.G=2]="G",e[e.B=4]="B",e[e.A=8]="A",e[e.ALL=15]="ALL"}(ha||(ha=e("u",{}))),function(e){e[e.NONE=0]="NONE",e[e.POINT=1]="POINT",e[e.LINEAR=2]="LINEAR",e[e.ANISOTROPIC=3]="ANISOTROPIC"}(_a||(_a=e("a2",{}))),function(e){e[e.WRAP=0]="WRAP",e[e.MIRROR=1]="MIRROR",e[e.CLAMP=2]="CLAMP",e[e.BORDER=3]="BORDER"}(fa||(fa=e("bu",{}))),function(e){e[e.TEX1D=0]="TEX1D",e[e.TEX2D=1]="TEX2D",e[e.TEX3D=2]="TEX3D",e[e.CUBE=3]="CUBE",e[e.TEX1D_ARRAY=4]="TEX1D_ARRAY",e[e.TEX2D_ARRAY=5]="TEX2D_ARRAY"}(ma||(ma=e("T",{}))),function(e){e[e.NONE=0]="NONE",e[e.TRANSFER_SRC=1]="TRANSFER_SRC",e[e.TRANSFER_DST=2]="TRANSFER_DST",e[e.SAMPLED=4]="SAMPLED",e[e.STORAGE=8]="STORAGE",e[e.COLOR_ATTACHMENT=16]="COLOR_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=32]="DEPTH_STENCIL_ATTACHMENT",e[e.TRANSIENT_ATTACHMENT=64]="TRANSIENT_ATTACHMENT",e[e.INPUT_ATTACHMENT=128]="INPUT_ATTACHMENT"}(da||(da=e("al",{}))),function(e){e[e.X1=0]="X1",e[e.X2=1]="X2",e[e.X4=2]="X4",e[e.X8=3]="X8",e[e.X16=4]="X16",e[e.X32=5]="X32",e[e.X64=6]="X64"}(pa||(pa=e("S",{}))),function(e){e[e.NONE=0]="NONE",e[e.GEN_MIPMAP=1]="GEN_MIPMAP",e[e.CUBEMAP=2]="CUBEMAP",e[e.BAKUP_BUFFER=4]="BAKUP_BUFFER",e[e.IMMUTABLE=8]="IMMUTABLE"}(va||(va=e("z",{}))),function(e){e[e.NONE=0]="NONE",e[e.VERTEX=1]="VERTEX",e[e.CONTROL=2]="CONTROL",e[e.EVALUATION=4]="EVALUATION",e[e.GEOMETRY=8]="GEOMETRY",e[e.FRAGMENT=16]="FRAGMENT",e[e.COMPUTE=32]="COMPUTE",e[e.ALL=63]="ALL"}(ga||(ga=e("E",{}))),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.UNIFORM_BUFFER=1]="UNIFORM_BUFFER",e[e.DYNAMIC_UNIFORM_BUFFER=2]="DYNAMIC_UNIFORM_BUFFER",e[e.STORAGE_BUFFER=4]="STORAGE_BUFFER",e[e.DYNAMIC_STORAGE_BUFFER=8]="DYNAMIC_STORAGE_BUFFER",e[e.SAMPLER=16]="SAMPLER"}(ya||(ya=e("eI",{}))),function(e){e[e.PRIMARY=0]="PRIMARY",e[e.SECONDARY=1]="SECONDARY"}(xa||(xa=e("K",{}))),function(e){e[e.LOAD=0]="LOAD",e[e.CLEAR=1]="CLEAR",e[e.DISCARD=2]="DISCARD"}(Ea||(Ea=e("L",{}))),function(e){e[e.STORE=0]="STORE",e[e.DISCARD=1]="DISCARD"}(Sa||(Sa=e("eJ",{}))),function(e){e[e.UNDEFINED=0]="UNDEFINED",e[e.GENERAL=1]="GENERAL",e[e.COLOR_ATTACHMENT_OPTIMAL=2]="COLOR_ATTACHMENT_OPTIMAL",e[e.DEPTH_STENCIL_ATTACHMENT_OPTIMAL=3]="DEPTH_STENCIL_ATTACHMENT_OPTIMAL",e[e.DEPTH_STENCIL_READONLY_OPTIMAL=4]="DEPTH_STENCIL_READONLY_OPTIMAL",e[e.SHADER_READONLY_OPTIMAL=5]="SHADER_READONLY_OPTIMAL",e[e.TRANSFER_SRC_OPTIMAL=6]="TRANSFER_SRC_OPTIMAL",e[e.TRANSFER_DST_OPTIMAL=7]="TRANSFER_DST_OPTIMAL",e[e.PREINITIALIZED=8]="PREINITIALIZED",e[e.PRESENT_SRC=9]="PRESENT_SRC"}(Ta||(Ta=e("eK",{}))),function(e){e[e.GRAPHICS=0]="GRAPHICS",e[e.COMPUTE=1]="COMPUTE",e[e.RAY_TRACING=2]="RAY_TRACING"}(Aa||(Aa=e("eL",{}))),function(e){e[e.NONE=0]="NONE",e[e.VIEWPORT=1]="VIEWPORT",e[e.SCISSOR=2]="SCISSOR",e[e.LINE_WIDTH=4]="LINE_WIDTH",e[e.DEPTH_BIAS=8]="DEPTH_BIAS",e[e.BLEND_CONSTANTS=16]="BLEND_CONSTANTS",e[e.DEPTH_BOUNDS=32]="DEPTH_BOUNDS",e[e.STENCIL_WRITE_MASK=64]="STENCIL_WRITE_MASK",e[e.STENCIL_COMPARE_MASK=128]="STENCIL_COMPARE_MASK"}(Ca||(Ca=e("x",{}))),function(e){e[e.FRONT=0]="FRONT",e[e.BACK=1]="BACK",e[e.ALL=2]="ALL"}(wa||(wa=e("y",{}))),function(e){e[e.GRAPHICS=0]="GRAPHICS",e[e.COMPUTE=1]="COMPUTE",e[e.TRANSFER=2]="TRANSFER"}(Ia||(Ia=e("ai",{}))),function(e){e[e.NONE=0]="NONE",e[e.COLOR=1]="COLOR",e[e.DEPTH=2]="DEPTH",e[e.STENCIL=4]="STENCIL",e[e.DEPTH_STENCIL=6]="DEPTH_STENCIL",e[e.ALL=7]="ALL"}(ba||(ba=e("o",{}))),function(e){e[e.NONE=0]="NONE",e[e.UNORM=1]="UNORM",e[e.SNORM=2]="SNORM",e[e.UINT=3]="UINT",e[e.INT=4]="INT",e[e.UFLOAT=5]="UFLOAT",e[e.FLOAT=6]="FLOAT"}(Ra||(Ra=e("aP",{}))),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.GLES2=1]="GLES2",e[e.GLES3=2]="GLES3",e[e.METAL=3]="METAL",e[e.VULKAN=4]="VULKAN",e[e.WEBGL=5]="WEBGL",e[e.WEBGL2=6]="WEBGL2",e[e.WEBGPU=7]="WEBGPU"}(Oa||(Oa=e("ac",{}))),function(e){e[e.IDENTITY=0]="IDENTITY",e[e.ROTATE_90=1]="ROTATE_90",e[e.ROTATE_180=2]="ROTATE_180",e[e.ROTATE_270=3]="ROTATE_270"}(Na||(Na=e("eM",{}))),function(e){e[e.COLOR_FLOAT=0]="COLOR_FLOAT",e[e.COLOR_HALF_FLOAT=1]="COLOR_HALF_FLOAT",e[e.TEXTURE_FLOAT=2]="TEXTURE_FLOAT",e[e.TEXTURE_HALF_FLOAT=3]="TEXTURE_HALF_FLOAT",e[e.TEXTURE_FLOAT_LINEAR=4]="TEXTURE_FLOAT_LINEAR",e[e.TEXTURE_HALF_FLOAT_LINEAR=5]="TEXTURE_HALF_FLOAT_LINEAR",e[e.FORMAT_R11G11B10F=6]="FORMAT_R11G11B10F",e[e.FORMAT_D16=7]="FORMAT_D16",e[e.FORMAT_D16S8=8]="FORMAT_D16S8",e[e.FORMAT_D24=9]="FORMAT_D24",e[e.FORMAT_D24S8=10]="FORMAT_D24S8",e[e.FORMAT_D32F=11]="FORMAT_D32F",e[e.FORMAT_D32FS8=12]="FORMAT_D32FS8",e[e.FORMAT_ETC1=13]="FORMAT_ETC1",e[e.FORMAT_ETC2=14]="FORMAT_ETC2",e[e.FORMAT_DXT=15]="FORMAT_DXT",e[e.FORMAT_PVRTC=16]="FORMAT_PVRTC",e[e.FORMAT_ASTC=17]="FORMAT_ASTC",e[e.FORMAT_RGB8=18]="FORMAT_RGB8",e[e.MSAA=19]="MSAA",e[e.ELEMENT_INDEX_UINT=20]="ELEMENT_INDEX_UINT",e[e.INSTANCED_ARRAYS=21]="INSTANCED_ARRAYS",e[e.MULTIPLE_RENDER_TARGETS=22]="MULTIPLE_RENDER_TARGETS",e[e.BLEND_MINMAX=23]="BLEND_MINMAX",e[e.DEPTH_BOUNDS=24]="DEPTH_BOUNDS",e[e.LINE_WIDTH=25]="LINE_WIDTH",e[e.STENCIL_WRITE_MASK=26]="STENCIL_WRITE_MASK",e[e.STENCIL_COMPARE_MASK=27]="STENCIL_COMPARE_MASK",e[e.COUNT=28]="COUNT"}(Pa||(Pa=e("ag",{})));var Da=e("eN",(function(e,t,n,i,r,o,a,s){this.name=e,this.size=t,this.count=n,this.type=i,this.hasAlpha=r,this.hasDepth=o,this.hasStencil=a,this.isCompressed=s})),La=e("eO",(function(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this.bufferSize=e,this.textureSize=t})),Fa=e("s",Object.freeze([new Da("UNKNOWN",0,0,Ra.NONE,!1,!1,!1,!1),new Da("A8",1,1,Ra.UNORM,!0,!1,!1,!1),new Da("L8",1,1,Ra.UNORM,!1,!1,!1,!1),new Da("LA8",1,2,Ra.UNORM,!0,!1,!1,!1),new Da("R8",1,1,Ra.UNORM,!1,!1,!1,!1),new Da("R8SN",1,1,Ra.SNORM,!1,!1,!1,!1),new Da("R8UI",1,1,Ra.UINT,!1,!1,!1,!1),new Da("R8I",1,1,Ra.INT,!1,!1,!1,!1),new Da("R16F",2,1,Ra.FLOAT,!1,!1,!1,!1),new Da("R16UI",2,1,Ra.UINT,!1,!1,!1,!1),new Da("R16I",2,1,Ra.INT,!1,!1,!1,!1),new Da("R32F",4,1,Ra.FLOAT,!1,!1,!1,!1),new Da("R32UI",4,1,Ra.UINT,!1,!1,!1,!1),new Da("R32I",4,1,Ra.INT,!1,!1,!1,!1),new Da("RG8",2,2,Ra.UNORM,!1,!1,!1,!1),new Da("RG8SN",2,2,Ra.SNORM,!1,!1,!1,!1),new Da("RG8UI",2,2,Ra.UINT,!1,!1,!1,!1),new Da("RG8I",2,2,Ra.INT,!1,!1,!1,!1),new Da("RG16F",4,2,Ra.FLOAT,!1,!1,!1,!1),new Da("RG16UI",4,2,Ra.UINT,!1,!1,!1,!1),new Da("RG16I",4,2,Ra.INT,!1,!1,!1,!1),new Da("RG32F",8,2,Ra.FLOAT,!1,!1,!1,!1),new Da("RG32UI",8,2,Ra.UINT,!1,!1,!1,!1),new Da("RG32I",8,2,Ra.INT,!1,!1,!1,!1),new Da("RGB8",3,3,Ra.UNORM,!1,!1,!1,!1),new Da("SRGB8",3,3,Ra.UNORM,!1,!1,!1,!1),new Da("RGB8SN",3,3,Ra.SNORM,!1,!1,!1,!1),new Da("RGB8UI",3,3,Ra.UINT,!1,!1,!1,!1),new Da("RGB8I",3,3,Ra.INT,!1,!1,!1,!1),new Da("RGB16F",6,3,Ra.FLOAT,!1,!1,!1,!1),new Da("RGB16UI",6,3,Ra.UINT,!1,!1,!1,!1),new Da("RGB16I",6,3,Ra.INT,!1,!1,!1,!1),new Da("RGB32F",12,3,Ra.FLOAT,!1,!1,!1,!1),new Da("RGB32UI",12,3,Ra.UINT,!1,!1,!1,!1),new Da("RGB32I",12,3,Ra.INT,!1,!1,!1,!1),new Da("RGBA8",4,4,Ra.UNORM,!0,!1,!1,!1),new Da("BGRA8",4,4,Ra.UNORM,!0,!1,!1,!1),new Da("SRGB8_A8",4,4,Ra.UNORM,!0,!1,!1,!1),new Da("RGBA8SN",4,4,Ra.SNORM,!0,!1,!1,!1),new Da("RGBA8UI",4,4,Ra.UINT,!0,!1,!1,!1),new Da("RGBA8I",4,4,Ra.INT,!0,!1,!1,!1),new Da("RGBA16F",8,4,Ra.FLOAT,!0,!1,!1,!1),new Da("RGBA16UI",8,4,Ra.UINT,!0,!1,!1,!1),new Da("RGBA16I",8,4,Ra.INT,!0,!1,!1,!1),new Da("RGBA32F",16,4,Ra.FLOAT,!0,!1,!1,!1),new Da("RGBA32UI",16,4,Ra.UINT,!0,!1,!1,!1),new Da("RGBA32I",16,4,Ra.INT,!0,!1,!1,!1),new Da("R5G6B5",2,3,Ra.UNORM,!1,!1,!1,!1),new Da("R11G11B10F",4,3,Ra.FLOAT,!1,!1,!1,!1),new Da("RGB5A1",2,4,Ra.UNORM,!0,!1,!1,!1),new Da("RGBA4",2,4,Ra.UNORM,!0,!1,!1,!1),new Da("RGB10A2",2,4,Ra.UNORM,!0,!1,!1,!1),new Da("RGB10A2UI",2,4,Ra.UINT,!0,!1,!1,!1),new Da("RGB9E5",2,4,Ra.FLOAT,!0,!1,!1,!1),new Da("D16",2,1,Ra.UINT,!1,!0,!1,!1),new Da("D16S8",3,2,Ra.UINT,!1,!0,!0,!1),new Da("D24",3,1,Ra.UINT,!1,!0,!1,!1),new Da("D24S8",4,2,Ra.UINT,!1,!0,!0,!1),new Da("D32F",4,1,Ra.FLOAT,!1,!0,!1,!1),new Da("D32FS8",5,2,Ra.FLOAT,!1,!0,!0,!1),new Da("BC1",1,3,Ra.UNORM,!1,!1,!1,!0),new Da("BC1_ALPHA",1,4,Ra.UNORM,!0,!1,!1,!0),new Da("BC1_SRGB",1,3,Ra.UNORM,!1,!1,!1,!0),new Da("BC1_SRGB_ALPHA",1,4,Ra.UNORM,!0,!1,!1,!0),new Da("BC2",1,4,Ra.UNORM,!0,!1,!1,!0),new Da("BC2_SRGB",1,4,Ra.UNORM,!0,!1,!1,!0),new Da("BC3",1,4,Ra.UNORM,!0,!1,!1,!0),new Da("BC3_SRGB",1,4,Ra.UNORM,!0,!1,!1,!0),new Da("BC4",1,1,Ra.UNORM,!1,!1,!1,!0),new Da("BC4_SNORM",1,1,Ra.SNORM,!1,!1,!1,!0),new Da("BC5",1,2,Ra.UNORM,!1,!1,!1,!0),new Da("BC5_SNORM",1,2,Ra.SNORM,!1,!1,!1,!0),new Da("BC6H_UF16",1,3,Ra.UFLOAT,!1,!1,!1,!0),new Da("BC6H_SF16",1,3,Ra.FLOAT,!1,!1,!1,!0),new Da("BC7",1,4,Ra.UNORM,!0,!1,!1,!0),new Da("BC7_SRGB",1,4,Ra.UNORM,!0,!1,!1,!0),new Da("ETC_RGB8",1,3,Ra.UNORM,!1,!1,!1,!0),new Da("ETC2_RGB8",1,3,Ra.UNORM,!1,!1,!1,!0),new Da("ETC2_SRGB8",1,3,Ra.UNORM,!1,!1,!1,!0),new Da("ETC2_RGB8_A1",1,4,Ra.UNORM,!0,!1,!1,!0),new Da("ETC2_SRGB8_A1",1,4,Ra.UNORM,!0,!1,!1,!0),new Da("ETC2_RGBA8",2,4,Ra.UNORM,!0,!1,!1,!0),new Da("ETC2_SRGB8_A8",2,4,Ra.UNORM,!0,!1,!1,!0),new Da("EAC_R11",1,1,Ra.UNORM,!1,!1,!1,!0),new Da("EAC_R11SN",1,1,Ra.SNORM,!1,!1,!1,!0),new Da("EAC_RG11",2,2,Ra.UNORM,!1,!1,!1,!0),new Da("EAC_RG11SN",2,2,Ra.SNORM,!1,!1,!1,!0),new Da("PVRTC_RGB2",2,3,Ra.UNORM,!1,!1,!1,!0),new Da("PVRTC_RGBA2",2,4,Ra.UNORM,!0,!1,!1,!0),new Da("PVRTC_RGB4",2,3,Ra.UNORM,!1,!1,!1,!0),new Da("PVRTC_RGBA4",2,4,Ra.UNORM,!0,!1,!1,!0),new Da("PVRTC2_2BPP",2,4,Ra.UNORM,!0,!1,!1,!0),new Da("PVRTC2_4BPP",2,4,Ra.UNORM,!0,!1,!1,!0),new Da("ASTC_RGBA_4x4",1,4,Ra.UNORM,!0,!1,!1,!0),new Da("ASTC_RGBA_5x4",1,4,Ra.UNORM,!0,!1,!1,!0),new Da("ASTC_RGBA_5x5",1,4,Ra.UNORM,!0,!1,!1,!0),new Da("ASTC_RGBA_6x5",1,4,Ra.UNORM,!0,!1,!1,!0),new Da("ASTC_RGBA_6x6",1,4,Ra.UNORM,!0,!1,!1,!0),new Da("ASTC_RGBA_8x5",1,4,Ra.UNORM,!0,!1,!1,!0),new Da("ASTC_RGBA_8x6",1,4,Ra.UNORM,!0,!1,!1,!0),new Da("ASTC_RGBA_8x8",1,4,Ra.UNORM,!0,!1,!1,!0),new Da("ASTC_RGBA_10x5",1,4,Ra.UNORM,!0,!1,!1,!0),new Da("ASTC_RGBA_10x6",1,4,Ra.UNORM,!0,!1,!1,!0),new Da("ASTC_RGBA_10x8",1,4,Ra.UNORM,!0,!1,!1,!0),new Da("ASTC_RGBA_10x10",1,4,Ra.UNORM,!0,!1,!1,!0),new Da("ASTC_RGBA_12x10",1,4,Ra.UNORM,!0,!1,!1,!0),new Da("ASTC_RGBA_12x12",1,4,Ra.UNORM,!0,!1,!1,!0),new Da("ASTC_SRGBA_4x4",1,4,Ra.UNORM,!0,!1,!1,!0),new Da("ASTC_SRGBA_5x4",1,4,Ra.UNORM,!0,!1,!1,!0),new Da("ASTC_SRGBA_5x5",1,4,Ra.UNORM,!0,!1,!1,!0),new Da("ASTC_SRGBA_6x5",1,4,Ra.UNORM,!0,!1,!1,!0),new Da("ASTC_SRGBA_6x6",1,4,Ra.UNORM,!0,!1,!1,!0),new Da("ASTC_SRGBA_8x5",1,4,Ra.UNORM,!0,!1,!1,!0),new Da("ASTC_SRGBA_8x6",1,4,Ra.UNORM,!0,!1,!1,!0),new Da("ASTC_SRGBA_8x8",1,4,Ra.UNORM,!0,!1,!1,!0),new Da("ASTC_SRGBA_10x5",1,4,Ra.UNORM,!0,!1,!1,!0),new Da("ASTC_SRGBA_10x6",1,4,Ra.UNORM,!0,!1,!1,!0),new Da("ASTC_SRGBA_10x8",1,4,Ra.UNORM,!0,!1,!1,!0),new Da("ASTC_SRGBA_10x10",1,4,Ra.UNORM,!0,!1,!1,!0),new Da("ASTC_SRGBA_12x10",1,4,Ra.UNORM,!0,!1,!1,!0),new Da("ASTC_SRGBA_12x12",1,4,Ra.UNORM,!0,!1,!1,!0)]));function za(e,t,n,i){if(!Fa[e].isCompressed)return t*n*i*Fa[e].size;switch(e){case Jo.BC1:case Jo.BC1_ALPHA:case Jo.BC1_SRGB:case Jo.BC1_SRGB_ALPHA:return Math.ceil(t/4)*Math.ceil(n/4)*8*i;case Jo.BC2:case Jo.BC2_SRGB:case Jo.BC3:case Jo.BC3_SRGB:case Jo.BC4:case Jo.BC4_SNORM:case Jo.BC6H_SF16:case Jo.BC6H_UF16:case Jo.BC7:case Jo.BC7_SRGB:return Math.ceil(t/4)*Math.ceil(n/4)*16*i;case Jo.BC5:case Jo.BC5_SNORM:return Math.ceil(t/4)*Math.ceil(n/4)*32*i;case Jo.ETC_RGB8:case Jo.ETC2_RGB8:case Jo.ETC2_SRGB8:case Jo.ETC2_RGB8_A1:case Jo.EAC_R11:case Jo.EAC_R11SN:return Math.ceil(t/4)*Math.ceil(n/4)*8*i;case Jo.ETC2_RGBA8:case Jo.ETC2_SRGB8_A1:case Jo.EAC_RG11:case Jo.EAC_RG11SN:return Math.ceil(t/4)*Math.ceil(n/4)*16*i;case Jo.PVRTC_RGB2:case Jo.PVRTC_RGBA2:case Jo.PVRTC2_2BPP:return Math.ceil(Math.max(t,16)*Math.max(n,8)/4)*i;case Jo.PVRTC_RGB4:case Jo.PVRTC_RGBA4:case Jo.PVRTC2_4BPP:return Math.ceil(Math.max(t,8)*Math.max(n,8)/2)*i;case Jo.ASTC_RGBA_4x4:case Jo.ASTC_SRGBA_4x4:return Math.ceil(t/4)*Math.ceil(n/4)*16*i;case Jo.ASTC_RGBA_5x4:case Jo.ASTC_SRGBA_5x4:return Math.ceil(t/5)*Math.ceil(n/4)*16*i;case Jo.ASTC_RGBA_5x5:case Jo.ASTC_SRGBA_5x5:return Math.ceil(t/5)*Math.ceil(n/5)*16*i;case Jo.ASTC_RGBA_6x5:case Jo.ASTC_SRGBA_6x5:return Math.ceil(t/6)*Math.ceil(n/5)*16*i;case Jo.ASTC_RGBA_6x6:case Jo.ASTC_SRGBA_6x6:return Math.ceil(t/6)*Math.ceil(n/6)*16*i;case Jo.ASTC_RGBA_8x5:case Jo.ASTC_SRGBA_8x5:return Math.ceil(t/8)*Math.ceil(n/5)*16*i;case Jo.ASTC_RGBA_8x6:case Jo.ASTC_SRGBA_8x6:return Math.ceil(t/8)*Math.ceil(n/6)*16*i;case Jo.ASTC_RGBA_8x8:case Jo.ASTC_SRGBA_8x8:return Math.ceil(t/8)*Math.ceil(n/8)*16*i;case Jo.ASTC_RGBA_10x5:case Jo.ASTC_SRGBA_10x5:return Math.ceil(t/10)*Math.ceil(n/5)*16*i;case Jo.ASTC_RGBA_10x6:case Jo.ASTC_SRGBA_10x6:return Math.ceil(t/10)*Math.ceil(n/6)*16*i;case Jo.ASTC_RGBA_10x8:case Jo.ASTC_SRGBA_10x8:return Math.ceil(t/10)*Math.ceil(n/8)*16*i;case Jo.ASTC_RGBA_10x10:case Jo.ASTC_SRGBA_10x10:return Math.ceil(t/10)*Math.ceil(n/10)*16*i;case Jo.ASTC_RGBA_12x10:case Jo.ASTC_SRGBA_12x10:return Math.ceil(t/12)*Math.ceil(n/10)*16*i;case Jo.ASTC_RGBA_12x12:case Jo.ASTC_SRGBA_12x12:return Math.ceil(t/12)*Math.ceil(n/12)*16*i;default:return 0}}function Ba(e,t,n,i,r){for(var o=0,a=0;a<r;++a)o+=za(e,t,n,i),t=Math.max(t>>1,1),n=Math.max(n>>1,1);return o}var Ua=[0,4,8,12,16,4,8,12,16,4,8,12,16,4,8,12,16,16,24,32,24,36,48,32,48,64,4,4,4,4,4,4];function Ga(e){return Ua[e]||0}function Ha(e){var t=e.size/e.count;switch(e.type){case Ra.UNORM:case Ra.UINT:switch(t){case 1:return Uint8Array;case 2:return Uint16Array;case 4:return Uint32Array}break;case Ra.SNORM:case Ra.INT:switch(t){case 1:return Int8Array;case 2:return Int16Array;case 4:return Int32Array}break;case Ra.FLOAT:return Float32Array}return Float32Array}var ka=e("p",(function(e,t,n,i,r,o,a){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=0),void 0===a&&(a=0),this.vertexCount=e,this.firstVertex=t,this.indexCount=n,this.firstIndex=i,this.vertexOffset=r,this.instanceCount=o,this.firstInstance=a})),Va=e("cU",28),ja=e("I",(function(e){void 0===e&&(e=[]),this.drawInfos=e})),Wa=e("aA",(function(e,t,n,i,r){void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=ta.NONE),this.usage=e,this.memUsage=t,this.size=n,this.stride=i,this.flags=r})),qa=e("eB",(function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=0),this.buffer=e,this.offset=t,this.range=n})),Ya=e("J",function(e){function t(t){var n;return(n=e.call(this,qo.BUFFER)||this)._device=void 0,n._usage=$o.NONE,n._memUsage=ea.NONE,n._size=0,n._stride=1,n._count=0,n._flags=ta.NONE,n._bakcupBuffer=null,n._indirectBuffer=null,n._isBufferView=!1,n._device=t,n}return $(t,e),Z(t,[{key:"usage",get:function(){return this._usage}},{key:"memUsage",get:function(){return this._memUsage}},{key:"size",get:function(){return this._size}},{key:"stride",get:function(){return this._stride}},{key:"count",get:function(){return this._count}},{key:"flags",get:function(){return this._flags}},{key:"backupBuffer",get:function(){return this._bakcupBuffer}}]),t}(Ma)),Xa=e("aj",(function(e,t){void 0===t&&(t=xa.PRIMARY),this.queue=e,this.type=t})),Ka=e("N",function(e){function t(t){var n;return(n=e.call(this,qo.COMMAND_BUFFER)||this)._device=void 0,n._queue=null,n._type=xa.PRIMARY,n._numDrawCalls=0,n._numInstances=0,n._numTris=0,n._device=t,n}return $(t,e),Z(t,[{key:"type",get:function(){return this._type}},{key:"queue",get:function(){return this._queue}},{key:"numDrawCalls",get:function(){return this._numDrawCalls}},{key:"numInstances",get:function(){return this._numInstances}},{key:"numTris",get:function(){return this._numTris}}]),t}(Ma));Tt(Jo);var Qa=e("aq",(function(e,t,n){void 0===e&&(e=[]),void 0===t&&(t=[]),void 0===n&&(n=0),this.bufferOffsets=e,this.samplerOffsets=t,this.flexibleSet=n})),Za=e("eU",(function(e,t,n,i,r,o,a){void 0===t&&(t=!0),void 0===n&&(n=!0),void 0===i&&(i=1),void 0===r&&(r=1),void 0===o&&(o=1),void 0===a&&(a=new Qa),this.canvasElm=e,this.isAntialias=t,this.isPremultipliedAlpha=n,this.devicePixelRatio=i,this.nativeWidth=r,this.nativeHeight=o,this.bindingMappingInfo=a})),Ja=e("ar",function(){function e(){this._canvas=null,this._canvas2D=null,this._gfxAPI=Oa.UNKNOWN,this._transform=Na.IDENTITY,this._deviceName="",this._renderer="",this._vendor="",this._version="",this._features=new Array(Pa.COUNT),this._queue=null,this._cmdBuff=null,this._devicePixelRatio=1,this._width=0,this._height=0,this._nativeWidth=0,this._nativeHeight=0,this._maxVertexAttributes=0,this._maxVertexUniformVectors=0,this._maxFragmentUniformVectors=0,this._maxTextureUnits=0,this._maxVertexTextureUnits=0,this._maxUniformBufferBindings=0,this._maxUniformBlockSize=0,this._maxTextureSize=0,this._maxCubeMapTextureSize=0,this._uboOffsetAlignment=1,this._depthBits=0,this._stencilBits=0,this._colorFmt=Jo.UNKNOWN,this._depthStencilFmt=Jo.UNKNOWN,this._macros=new Map,this._numDrawCalls=0,this._numInstances=0,this._numTris=0,this._memoryStatus=new La,this._clipSpaceMinZ=-1,this._screenSpaceSignY=1,this._UVSpaceSignY=-1}return e.prototype.hasFeature=function(e){return this._features[e]},Z(e,[{key:"canvas",get:function(){return this._canvas}},{key:"canvas2D",get:function(){return this._canvas2D}},{key:"gfxAPI",get:function(){return this._gfxAPI}},{key:"queue",get:function(){return this._queue}},{key:"commandBuffer",get:function(){return this._cmdBuff}},{key:"devicePixelRatio",get:function(){return this._devicePixelRatio}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"nativeWidth",get:function(){return this._nativeWidth}},{key:"nativeHeight",get:function(){return this._nativeHeight}},{key:"renderer",get:function(){return this._renderer}},{key:"vendor",get:function(){return this._vendor}},{key:"maxVertexAttributes",get:function(){return this._maxVertexAttributes}},{key:"maxVertexUniformVectors",get:function(){return this._maxVertexUniformVectors}},{key:"maxFragmentUniformVectors",get:function(){return this._maxFragmentUniformVectors}},{key:"maxTextureUnits",get:function(){return this._maxTextureUnits}},{key:"maxVertexTextureUnits",get:function(){return this._maxVertexTextureUnits}},{key:"maxUniformBufferBindings",get:function(){return this._maxUniformBufferBindings}},{key:"maxUniformBlockSize",get:function(){return this._maxUniformBlockSize}},{key:"maxTextureSize",get:function(){return this._maxTextureSize}},{key:"maxCubeMapTextureSize",get:function(){return this._maxCubeMapTextureSize}},{key:"uboOffsetAlignment",get:function(){return this._uboOffsetAlignment}},{key:"depthBits",get:function(){return this._depthBits}},{key:"stencilBits",get:function(){return this._stencilBits}},{key:"colorFormat",get:function(){return this._colorFmt}},{key:"depthStencilFormat",get:function(){return this._depthStencilFmt}},{key:"macros",get:function(){return this._macros}},{key:"numDrawCalls",get:function(){return this._numDrawCalls}},{key:"numInstances",get:function(){return this._numInstances}},{key:"numTris",get:function(){return this._numTris}},{key:"memoryStatus",get:function(){return this._memoryStatus}},{key:"clipSpaceMinZ",get:function(){return this._clipSpaceMinZ}},{key:"screenSpaceSignY",get:function(){return this._screenSpaceSignY}},{key:"UVSpaceSignY",get:function(){return this._UVSpaceSignY}},{key:"surfaceTransform",get:function(){return this._transform}}]),e}()),$a=e("eV",(function(e,t,n,i,r){void 0===t&&(t=[]),void 0===n&&(n=null),void 0===i&&(i=[]),void 0===r&&(r=0),this.renderPass=e,this.colorTextures=t,this.depthStencilTexture=n,this.colorMipmapLevels=i,this.depStencilMipmapLevel=r})),es=e("Q",function(e){function t(t){var n;return(n=e.call(this,qo.FRAMEBUFFER)||this)._device=void 0,n._renderPass=null,n._colorTextures=[],n._depthStencilTexture=null,n._device=t,n}return $(t,e),Z(t,[{key:"renderPass",get:function(){return this._renderPass}},{key:"colorTextures",get:function(){return this._colorTextures}},{key:"depthStencilTexture",get:function(){return this._depthStencilTexture}}]),t}(Ma)),ts=String.prototype.charCodeAt;function ns(e){return this[e]}function is(e,t){for(var n=e.length,i=t^n,r=0,o="string"==typeof e?ts:ns;n>=4;){var a=255&o.call(e,r)|(255&o.call(e,++r))<<8|(255&o.call(e,++r))<<16|(255&o.call(e,++r))<<24;a=1540483477*(65535&a)+((1540483477*(a>>>16)&65535)<<16),i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16)^(a=1540483477*(65535&(a^=a>>>24))+((1540483477*(a>>>16)&65535)<<16)),n-=4,++r}switch(n){case 3:i^=(255&o.call(e,r+2))<<16;case 2:i^=(255&o.call(e,r+1))<<8;case 1:i=1540483477*(65535&(i^=255&o.call(e,r)))+((1540483477*(i>>>16)&65535)<<16)}return i=1540483477*(65535&(i^=i>>>13))+((1540483477*(i>>>16)&65535)<<16),(i^=i>>>15)>>>0}var rs=e("aR",(function(e,t,n,i,r,o){void 0===e&&(e=""),void 0===t&&(t=Jo.UNKNOWN),void 0===n&&(n=!1),void 0===i&&(i=0),void 0===r&&(r=!1),void 0===o&&(o=0),this.name=e,this.format=t,this.isNormalized=n,this.stream=i,this.isInstanced=r,this.location=o})),os=e("ck",(function(e,t,n,i){void 0===e&&(e=[]),void 0===t&&(t=[]),void 0===n&&(n=null),void 0===i&&(i=null),this.attributes=e,this.vertexBuffers=t,this.indexBuffer=n,this.indirectBuffer=i})),as=e("W",function(e){function t(t){var n;return(n=e.call(this,qo.INPUT_ASSEMBLER)||this)._device=void 0,n._attributes=[],n._vertexBuffers=[],n._indexBuffer=null,n._vertexCount=0,n._firstVertex=0,n._indexCount=0,n._firstIndex=0,n._vertexOffset=0,n._instanceCount=0,n._firstInstance=0,n._attributesHash=0,n._indirectBuffer=null,n._device=t,n}$(t,e),Z(t,[{key:"vertexBuffers",get:function(){return this._vertexBuffers}},{key:"indexBuffer",get:function(){return this._indexBuffer}},{key:"attributes",get:function(){return this._attributes}},{key:"attributesHash",get:function(){return this._attributesHash}},{key:"vertexCount",get:function(){return this._vertexCount},set:function(e){this._vertexCount=e}},{key:"firstVertex",get:function(){return this._firstVertex},set:function(e){this._firstVertex=e}},{key:"indexCount",get:function(){return this._indexCount},set:function(e){this._indexCount=e}},{key:"firstIndex",get:function(){return this._firstIndex},set:function(e){this._firstIndex=e}},{key:"vertexOffset",get:function(){return this._vertexOffset},set:function(e){this._vertexOffset=e}},{key:"instanceCount",get:function(){return this._instanceCount},set:function(e){this._instanceCount=e}},{key:"firstInstance",get:function(){return this._firstInstance},set:function(e){this._firstInstance=e}},{key:"indirectBuffer",get:function(){return this._indirectBuffer}}]);var n=t.prototype;return n.getVertexBuffer=function(e){return void 0===e&&(e=0),e<this._vertexBuffers.length?this._vertexBuffers[e]:null},n.computeAttributesHash=function(){for(var e="attrs",t=0;t<this.attributes.length;++t){var n=this.attributes[t];e+=","+n.name+","+n.format+","+n.isNormalized+","+n.stream+","+n.isInstanced}return is(e,666)},t}(Ma)),ss=e("n",(function(e,t,n,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=1),void 0===i&&(i=1),this.x=e,this.y=t,this.width=n,this.height=i})),cs=e("V",(function(e,t,n,i,r,o){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=1),this.left=e,this.top=t,this.width=n,this.height=i,this.minDepth=r,this.maxDepth=o})),ls=e("eP",(function(e,t,n,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),this.x=e,this.y=t,this.z=n,this.w=i})),us=e("eQ",(function(e,t,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),this.x=e,this.y=t,this.z=n})),hs=e("eR",(function(e,t,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=1),this.width=e,this.height=t,this.depth=n})),_s=e("eS",(function(e,t,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=1),this.mipLevel=e,this.baseArrayLayer=t,this.layerCount=n})),fs=e("eT",(function(e,t,n,i,r){void 0===e&&(e=new _s),void 0===t&&(t=new us),void 0===n&&(n=new _s),void 0===i&&(i=new us),void 0===r&&(r=new hs),this.srcSubres=e,this.srcOffset=t,this.dstSubres=n,this.dstOffset=i,this.extent=r})),ms=e("am",(function(e,t,n,i,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=new us),void 0===i&&(i=new hs),void 0===r&&(r=new _s),this.buffStride=e,this.buffTexHeight=t,this.texOffset=n,this.texExtent=i,this.texSubres=r})),ds=e("a5",function(){function e(e,t,n,i,r,o,a,s,c,l,u,h){void 0===e&&(e=!1),void 0===t&&(t=ra.FILL),void 0===n&&(n=oa.GOURAND),void 0===i&&(i=aa.BACK),void 0===r&&(r=!0),void 0===o&&(o=!1),void 0===a&&(a=0),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=!0),void 0===u&&(u=!1),void 0===h&&(h=1),this.isDiscard=e,this.polygonMode=t,this.shadeModel=n,this.cullMode=i,this.isFrontFaceCCW=r,this.depthBiasEnabled=o,this.depthBias=a,this.depthBiasClamp=s,this.depthBiasSlop=c,this.isDepthClip=l,this.isMultisample=u,this.lineWidth=h}var t=e.prototype;return t.reset=function(){this.isDiscard=!1,this.polygonMode=ra.FILL,this.shadeModel=oa.GOURAND,this.cullMode=aa.BACK,this.isFrontFaceCCW=!0,this.depthBiasEnabled=!1,this.depthBias=0,this.depthBiasClamp=0,this.depthBiasSlop=0,this.isDepthClip=!0,this.isMultisample=!1,this.lineWidth=1},t.assign=function(e){Object.assign(this,e)},t.destroy=function(){},Z(e,[{key:"handle",get:function(){return Qi}}]),e}()),ps=e("a6",function(){function e(e,t,n,i,r,o,a,s,c,l,u,h,_,f,m,d,p,v,g){void 0===e&&(e=!0),void 0===t&&(t=!0),void 0===n&&(n=sa.LESS),void 0===i&&(i=!1),void 0===r&&(r=sa.ALWAYS),void 0===o&&(o=65535),void 0===a&&(a=65535),void 0===s&&(s=ca.KEEP),void 0===c&&(c=ca.KEEP),void 0===l&&(l=ca.KEEP),void 0===u&&(u=1),void 0===h&&(h=!1),void 0===_&&(_=sa.ALWAYS),void 0===f&&(f=65535),void 0===m&&(m=65535),void 0===d&&(d=ca.KEEP),void 0===p&&(p=ca.KEEP),void 0===v&&(v=ca.KEEP),void 0===g&&(g=1),this.depthTest=e,this.depthWrite=t,this.depthFunc=n,this.stencilTestFront=i,this.stencilFuncFront=r,this.stencilReadMaskFront=o,this.stencilWriteMaskFront=a,this.stencilFailOpFront=s,this.stencilZFailOpFront=c,this.stencilPassOpFront=l,this.stencilRefFront=u,this.stencilTestBack=h,this.stencilFuncBack=_,this.stencilReadMaskBack=f,this.stencilWriteMaskBack=m,this.stencilFailOpBack=d,this.stencilZFailOpBack=p,this.stencilPassOpBack=v,this.stencilRefBack=g}var t=e.prototype;return t.reset=function(){this.depthTest=!0,this.depthWrite=!0,this.depthFunc=sa.LESS,this.stencilTestFront=!1,this.stencilFuncFront=sa.ALWAYS,this.stencilReadMaskFront=65535,this.stencilWriteMaskFront=65535,this.stencilFailOpFront=ca.KEEP,this.stencilZFailOpFront=ca.KEEP,this.stencilPassOpFront=ca.KEEP,this.stencilRefFront=1,this.stencilTestBack=!1,this.stencilFuncBack=sa.ALWAYS,this.stencilReadMaskBack=65535,this.stencilWriteMaskBack=65535,this.stencilFailOpBack=ca.KEEP,this.stencilZFailOpBack=ca.KEEP,this.stencilPassOpBack=ca.KEEP,this.stencilRefBack=1},t.assign=function(e){Object.assign(this,e)},t.destroy=function(){},Z(e,[{key:"handle",get:function(){return Qi}}]),e}()),vs=e("c5",function(){function e(e,t,n,i,r,o,a,s){void 0===e&&(e=!1),void 0===t&&(t=ua.ONE),void 0===n&&(n=ua.ZERO),void 0===i&&(i=la.ADD),void 0===r&&(r=ua.ONE),void 0===o&&(o=ua.ZERO),void 0===a&&(a=la.ADD),void 0===s&&(s=ha.ALL),this.blend=e,this.blendSrc=t,this.blendDst=n,this.blendEq=i,this.blendSrcAlpha=r,this.blendDstAlpha=o,this.blendAlphaEq=a,this.blendColorMask=s}var t=e.prototype;return t.reset=function(){this.blend=!1,this.blendSrc=ua.ONE,this.blendDst=ua.ZERO,this.blendEq=la.ADD,this.blendSrcAlpha=ua.ONE,this.blendDstAlpha=ua.ZERO,this.blendAlphaEq=la.ADD,this.blendColorMask=ha.ALL},t.assign=function(e){Object.assign(this,e)},t.destroy=function(){},Z(e,[{key:"handle",get:function(){return Qi}}]),e}()),gs=e("a7",function(){function e(e,t,n,i){void 0===e&&(e=!1),void 0===t&&(t=!1),void 0===n&&(n=new ls),void 0===i&&(i=[new vs]),this.isA2C=e,this.isIndepend=t,this.blendColor=n,this.targets=i}var t=e.prototype;return t.setTarget=function(e,t){var n=this.targets[e];n||(n=this.targets[e]=new vs),Object.assign(n,t)},t.reset=function(){this.isA2C=!1,this.isIndepend=!1,this.blendColor.x=0,this.blendColor.y=0,this.blendColor.z=0,this.blendColor.w=0,this.targets.length=1,this.targets[0].reset()},t.destroy=function(){},Z(e,[{key:"handle",get:function(){return Qi}}]),e}()),ys=e("eZ",(function(e){void 0===e&&(e=[]),this.attributes=e})),xs=e("e_",(function(e,t,n,i,r,o,a,s,c){void 0===s&&(s=ia.TRIANGLE_LIST),void 0===c&&(c=Ca.NONE),this.shader=e,this.pipelineLayout=t,this.renderPass=n,this.inputState=i,this.rasterizerState=r,this.depthStencilState=o,this.blendState=a,this.primitive=s,this.dynamicStates=c})),Es=e("$",function(e){function t(t){var n;return(n=e.call(this,qo.PIPELINE_STATE)||this)._device=void 0,n._shader=null,n._pipelineLayout=null,n._primitive=ia.TRIANGLE_LIST,n._is=null,n._rs=new ds,n._dss=new ps,n._bs=new gs,n._dynamicStates=Ca.NONE,n._renderPass=null,n._device=t,n}return $(t,e),Z(t,[{key:"shader",get:function(){return this._shader}},{key:"pipelineLayout",get:function(){return this._pipelineLayout}},{key:"primitive",get:function(){return this._primitive}},{key:"rasterizerState",get:function(){return this._rs}},{key:"depthStencilState",get:function(){return this._dss}},{key:"blendState",get:function(){return this._bs}},{key:"inputState",get:function(){return this._is}},{key:"dynamicStates",get:function(){return this._dynamicStates}},{key:"renderPass",get:function(){return this._renderPass}}]),t}(Ma)),Ss=e("ah",(function(e){void 0===e&&(e=Ia.GRAPHICS),this.type=e})),Ts=e("a0",function(e){function t(t){var n;return(n=e.call(this,qo.QUEUE)||this)._device=void 0,n._type=Ia.GRAPHICS,n._isAsync=!1,n._device=t,n}return $(t,e),Z(t,[{key:"type",get:function(){return this._type}}]),t.prototype.isAsync=function(){return this._isAsync},t}(Ma)),As=e("f0",(function(e,t,n,i,r,o){void 0===e&&(e=Jo.UNKNOWN),void 0===t&&(t=1),void 0===n&&(n=Ea.CLEAR),void 0===i&&(i=Sa.STORE),void 0===r&&(r=Ta.UNDEFINED),void 0===o&&(o=Ta.PRESENT_SRC),this.format=e,this.sampleCount=t,this.loadOp=n,this.storeOp=i,this.beginLayout=r,this.endLayout=o})),Cs=e("f1",(function(e,t,n,i,r,o,a,s){void 0===e&&(e=Jo.UNKNOWN),void 0===t&&(t=1),void 0===n&&(n=Ea.CLEAR),void 0===i&&(i=Sa.STORE),void 0===r&&(r=Ea.CLEAR),void 0===o&&(o=Sa.STORE),void 0===a&&(a=Ta.UNDEFINED),void 0===s&&(s=Ta.DEPTH_STENCIL_ATTACHMENT_OPTIMAL),this.format=e,this.sampleCount=t,this.depthLoadOp=n,this.depthStoreOp=i,this.stencilLoadOp=r,this.stencilStoreOp=o,this.beginLayout=a,this.endLayout=s})),ws=e("f2",(function(e,t,n,i,r,o){void 0===e&&(e=Aa.GRAPHICS),void 0===t&&(t=[]),void 0===n&&(n=[]),void 0===i&&(i=[]),void 0===r&&(r=-1),void 0===o&&(o=[]),this.bindPoint=e,this.inputs=t,this.colors=n,this.resolves=i,this.depthStencil=r,this.preserves=o})),Is=e("f3",(function(e,t,n){void 0===e&&(e=[]),void 0===t&&(t=null),void 0===n&&(n=[]),this.colorAttachments=e,this.depthStencilAttachment=t,this.subPasses=n})),bs=e("a1",function(e){function t(t){var n;return(n=e.call(this,qo.RENDER_PASS)||this)._device=void 0,n._colorInfos=[],n._depthStencilInfo=null,n._subPasses=[],n._hash=0,n._device=t,n}return $(t,e),Z(t,[{key:"colorAttachments",get:function(){return this._colorInfos}},{key:"depthStencilAttachment",get:function(){return this._depthStencilInfo}},{key:"subPasses",get:function(){return this._subPasses}},{key:"hash",get:function(){return this._hash}}]),t.prototype.computeHash=function(){var e="";if(this._subPasses.length)for(var t=0;t<this._subPasses.length;++t){var n=this._subPasses[t];if(n.inputs.length){e+="ia";for(var i=0;i<n.inputs.length;++i){var r=this._colorInfos[n.inputs[i]];e+=","+r.format+","+r.sampleCount}}if(n.colors.length){e+="ca";for(var o=0;o<n.inputs.length;++o){var a=this._colorInfos[n.inputs[o]];e+=","+a.format+","+a.sampleCount}}if(n.depthStencil>=0){var s=this._colorInfos[n.depthStencil];e+="ds,"+s.format+","+s.sampleCount}}else{e+="ca";for(var c=0;c<this._colorInfos.length;++c){var l=this._colorInfos[c];e+=","+l.format+","+l.sampleCount}var u=this._depthStencilInfo;u&&(e+="ds,"+u.format+","+u.sampleCount)}return is(e,666)},t}(Ma)),Rs=e("f4",(function(e,t,n,i,r,o,a,s,c,l,u,h){void 0===e&&(e=_a.LINEAR),void 0===t&&(t=_a.LINEAR),void 0===n&&(n=_a.NONE),void 0===i&&(i=fa.WRAP),void 0===r&&(r=fa.WRAP),void 0===o&&(o=fa.WRAP),void 0===a&&(a=16),void 0===s&&(s=sa.NEVER),void 0===c&&(c=new ls),void 0===l&&(l=0),void 0===u&&(u=0),void 0===h&&(h=0),this.minFilter=e,this.magFilter=t,this.mipFilter=n,this.addressU=i,this.addressV=r,this.addressW=o,this.maxAnisotropy=a,this.cmpFunc=s,this.borderColor=c,this.minLOD=l,this.maxLOD=u,this.mipLODBias=h})),Os=e("a3",function(e){function t(t){var n;return(n=e.call(this,qo.SAMPLER)||this)._device=void 0,n._minFilter=_a.LINEAR,n._magFilter=_a.LINEAR,n._mipFilter=_a.NONE,n._addressU=fa.WRAP,n._addressV=fa.WRAP,n._addressW=fa.WRAP,n._maxAnisotropy=16,n._cmpFunc=sa.NEVER,n._borderColor=new ls,n._minLOD=0,n._maxLOD=0,n._mipLODBias=0,n._device=t,n}return $(t,e),Z(t,[{key:"minFilter",get:function(){return this._minFilter}},{key:"magFilter",get:function(){return this._magFilter}},{key:"mipFilter",get:function(){return this._mipFilter}},{key:"addressU",get:function(){return this._addressU}},{key:"addressV",get:function(){return this._addressV}},{key:"addressW",get:function(){return this._addressW}},{key:"maxAnisotropy",get:function(){return this._maxAnisotropy}},{key:"cmpFunc",get:function(){return this._cmpFunc}},{key:"borderColor",get:function(){return this._borderColor}},{key:"minLOD",get:function(){return this._minLOD}},{key:"maxLOD",get:function(){return this._maxLOD}},{key:"mipLODBias",get:function(){return this._mipLODBias}}]),t}(Ma)),Ns=e("f5",(function(e,t){void 0===e&&(e=ga.NONE),void 0===t&&(t=""),this.stage=e,this.source=t})),Ps=e("f6",(function(e,t,n){void 0===e&&(e=""),void 0===t&&(t=Zo.UNKNOWN),void 0===n&&(n=1),this.name=e,this.type=t,this.count=n})),Ms=e("f7",(function(e,t,n,i,r){void 0===e&&(e=-1),void 0===t&&(t=-1),void 0===n&&(n=""),void 0===i&&(i=[]),void 0===r&&(r=1),this.set=e,this.binding=t,this.name=n,this.members=i,this.count=r})),Ds=e("f8",(function(e,t,n,i,r){void 0===e&&(e=-1),void 0===t&&(t=-1),void 0===n&&(n=""),void 0===i&&(i=Zo.UNKNOWN),void 0===r&&(r=1),this.set=e,this.binding=t,this.name=n,this.type=i,this.count=r})),Ls=e("f9",(function(e,t,n,i,r){void 0===e&&(e=""),void 0===t&&(t=[]),void 0===n&&(n=[]),void 0===i&&(i=[]),void 0===r&&(r=[]),this.name=e,this.stages=t,this.attributes=n,this.blocks=i,this.samplers=r})),Fs=e("a4",function(e){function t(n){var i;return(i=e.call(this,qo.SHADER)||this)._device=void 0,i._id=void 0,i._name="",i._stages=[],i._attributes=[],i._blocks=[],i._samplers=[],i._device=n,i._id=t._shaderIdGen++,i}return $(t,e),Z(t,[{key:"id",get:function(){return this._id}},{key:"name",get:function(){return this._name}},{key:"attributes",get:function(){return this._attributes}},{key:"blocks",get:function(){return this._blocks}},{key:"samplers",get:function(){return this._samplers}}]),t}(Ma));Fs._shaderIdGen=0;var zs=e("ak",(function(e,t,n,i,r,o,a,s,c,l){void 0===t&&(t=da.NONE),void 0===n&&(n=Jo.UNKNOWN),void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=va.NONE),void 0===a&&(a=1),void 0===s&&(s=1),void 0===c&&(c=pa.X1),void 0===l&&(l=1),this.type=e,this.usage=t,this.format=n,this.width=i,this.height=r,this.flags=o,this.layerCount=a,this.levelCount=s,this.samples=c,this.depth=l})),Bs=e("fa",(function(e,t,n,i,r,o,a){void 0===t&&(t=ma.TEX2D),void 0===n&&(n=Jo.UNKNOWN),void 0===i&&(i=0),void 0===r&&(r=1),void 0===o&&(o=0),void 0===a&&(a=1),this.texture=e,this.type=t,this.format=n,this.baseLevel=i,this.levelCount=r,this.baseLayer=o,this.layerCount=a}));function Us(e){return e>0&&0==(e&e-1)}var Gs=e("aa",function(e){function t(t){var n;return(n=e.call(this,qo.TEXTURE)||this)._device=void 0,n._type=ma.TEX2D,n._usage=da.NONE,n._format=Jo.UNKNOWN,n._width=0,n._height=0,n._depth=1,n._layerCount=1,n._levelCount=1,n._samples=pa.X1,n._flags=va.NONE,n._isPowerOf2=!1,n._size=0,n._buffer=null,n._device=t,n}return $(t,e),Z(t,[{key:"type",get:function(){return this._type}},{key:"usage",get:function(){return this._usage}},{key:"format",get:function(){return this._format}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"depth",get:function(){return this._depth}},{key:"layerCount",get:function(){return this._layerCount}},{key:"levelCount",get:function(){return this._levelCount}},{key:"samples",get:function(){return this._samples}},{key:"flags",get:function(){return this._flags}},{key:"size",get:function(){return this._size}},{key:"buffer",get:function(){return this._buffer}}]),t}(Ma)),Hs={Device:Ja,Buffer:Ya,Texture:Gs,Sampler:Os,Shader:Fs,InputAssembler:as,RenderPass:bs,Framebuffer:es,PipelineState:Es,CommandBuffer:Ka,Queue:Ts,FormatSize:za,FormatSurfaceSize:Ba,GetTypeSize:Ga,getTypedArrayConstructor:Ha,MAX_ATTACHMENTS:Ko,ObjectType:qo,Obj:Ma,AttributeName:Qo,Type:Zo,Format:Jo,BufferUsageBit:$o,MemoryUsageBit:ea,BufferFlagBit:ta,BufferAccessBit:na,PrimitiveMode:ia,PolygonMode:ra,ShadeModel:oa,CullMode:aa,ComparisonFunc:sa,StencilOp:ca,BlendOp:la,BlendFactor:ua,ColorMask:ha,Filter:_a,Address:fa,TextureType:ma,TextureUsageBit:da,SampleCount:pa,TextureFlagBit:va,ShaderStageFlagBit:ga,DescriptorType:ya,CommandBufferType:xa,LoadOp:Ea,StoreOp:Sa,TextureLayout:Ta,PipelineBindPoint:Aa,DynamicStateFlagBit:Ca,StencilFace:wa,QueueType:Ia,Rect:ss,Viewport:cs,Color:ls,ClearFlag:ba,Offset:us,Extent:hs,TextureSubres:_s,TextureCopy:fs,BufferTextureCopy:ms,FormatType:Ra,FormatInfo:Da,MemoryStatus:La,FormatInfos:Fa},ks=e("D",ya.UNIFORM_BUFFER|ya.DYNAMIC_UNIFORM_BUFFER|ya.STORAGE_BUFFER|ya.DYNAMIC_STORAGE_BUFFER),Vs=e("k",ya.SAMPLER),js=e("cA",(function(e){this.layout=e})),Ws=e("m",function(e){function t(t){var n;return(n=e.call(this,qo.DESCRIPTOR_SET)||this)._device=void 0,n._layout=null,n._buffers=[],n._textures=[],n._samplers=[],n._isDirty=!1,n._device=t,n}$(t,e),Z(t,[{key:"layout",get:function(){return this._layout}}]);var n=t.prototype;return n.bindBuffer=function(e,t,n){void 0===n&&(n=0);var i=this._layout.bindingIndices[e],r=this._layout.bindings[i];if(r)if(r.descriptorType&ks){var o=this._layout.descriptorIndices[e];this._buffers[o+n]!==t&&(this._buffers[o+n]=t,this._isDirty=!0)}else console.warn("Setting binding is not DescriptorType.UNIFORM_BUFFER.")},n.bindSampler=function(e,t,n){void 0===n&&(n=0);var i=this._layout.bindingIndices[e],r=this._layout.bindings[i];if(r)if(r.descriptorType&Vs){var o=this._layout.descriptorIndices[e];this._samplers[o+n]!==t&&(this._samplers[o+n]=t,this._isDirty=!0)}else console.warn("Setting binding is not DescriptorType.SAMPLER.")},n.bindTexture=function(e,t,n){void 0===n&&(n=0);var i=this._layout.bindingIndices[e],r=this._layout.bindings[i];if(r)if(r.descriptorType&Vs){var o=this._layout.descriptorIndices[e];this._textures[o+n]!==t&&(this._textures[o+n]=t,this._isDirty=!0)}else console.warn("Setting binding is not DescriptorType.SAMPLER.")},n.getBuffer=function(e,t){void 0===t&&(t=0);var n=this._layout.descriptorIndices[e];return this._buffers[n+t]},n.getSampler=function(e,t){void 0===t&&(t=0);var n=this._layout.descriptorIndices[e];return this._samplers[n+t]},n.getTexture=function(e,t){void 0===t&&(t=0);var n=this._layout.descriptorIndices[e];return this._textures[n+t]},t}(Ma)),qs=e("eW",(function(e,t,n,i,r){void 0===e&&(e=-1),void 0===t&&(t=ya.UNKNOWN),void 0===n&&(n=0),void 0===i&&(i=ga.NONE),void 0===r&&(r=[]),this.binding=e,this.descriptorType=t,this.count=n,this.stageFlags=i,this.immutableSamplers=r})),Ys=e("eX",(function(e){void 0===e&&(e=[]),this.bindings=e})),Xs=e("X",ya.DYNAMIC_STORAGE_BUFFER|ya.DYNAMIC_UNIFORM_BUFFER),Ks=e("Y",function(e){function t(t){var n;return(n=e.call(this,qo.DESCRIPTOR_SET_LAYOUT)||this)._device=void 0,n._bindings=[],n._bindingIndices=[],n._descriptorIndices=[],n._device=t,n}return $(t,e),Z(t,[{key:"bindings",get:function(){return this._bindings}},{key:"bindingIndices",get:function(){return this._bindingIndices}},{key:"descriptorIndices",get:function(){return this._descriptorIndices}}]),t}(Ma)),Qs=e("eY",(function(e){void 0===e&&(e=[]),this.setLayouts=e})),Zs=e("Z",function(e){function t(t){var n;return(n=e.call(this,qo.PIPELINE_LAYOUT)||this)._device=void 0,n._setLayouts=[],n._device=t,n}return $(t,e),Z(t,[{key:"setLayouts",get:function(){return this._setLayouts}}]),t}(Ma)),Js=e("e$",(function(){})),$s=e("O",function(e){function t(t){var n;return(n=e.call(this,qo.FENCE)||this)._device=void 0,n._device=t,n}return $(t,e),t}(Ma));ve(c,"cc",[{name:"GFXDynamicState",newName:"DynamicStateFlagBit"},{name:"GFXBindingType",newName:"DescriptorType"},{name:"GFXBindingLayout",newName:"DescriptorSet"}]),ge(Ka.prototype,"CommandBuffer.prototype",[{name:"bindBindingLayout",suggest:"Use `bindDescriptorSet` instead"}]);var ec,tc={MAX_ATTACHMENTS:"GFX_MAX_ATTACHMENTS",Obj:"GFXObject",getTypedArrayConstructor:""};for(var nc in Hs){var ic=tc[nc];""!==ic&&(void 0===ic&&(ic="GFX"+nc),ve(c,"cc",[{name:ic,newName:nc,target:c.gfx,targetName:"cc.gfx"}]))}c.gfx=Hs,e("dI",Object.freeze({__proto__:null,DESCRIPTOR_BUFFER_TYPE:ks,DESCRIPTOR_SAMPLER_TYPE:Vs,DescriptorSetInfo:js,DescriptorSet:Ws,DrawInfo:ka,DRAW_INFO_SIZE:Va,IndirectBuffer:ja,BufferInfo:Wa,BufferViewInfo:qa,Buffer:Ya,CommandBufferInfo:Xa,CommandBuffer:Ka,MAX_ATTACHMENTS:Ko,get ObjectType(){return qo},Obj:Ma,get AttributeName(){return Qo},get Type(){return Zo},get Format(){return Jo},get BufferUsageBit(){return $o},get MemoryUsageBit(){return ea},get BufferFlagBit(){return ta},get BufferAccessBit(){return na},get PrimitiveMode(){return ia},get PolygonMode(){return ra},get ShadeModel(){return oa},get CullMode(){return aa},get ComparisonFunc(){return sa},get StencilOp(){return ca},get BlendOp(){return la},get BlendFactor(){return ua},get ColorMask(){return ha},get Filter(){return _a},get Address(){return fa},get TextureType(){return ma},get TextureUsageBit(){return da},get SampleCount(){return pa},get TextureFlagBit(){return va},get ShaderStageFlagBit(){return ga},get DescriptorType(){return ya},get CommandBufferType(){return xa},get LoadOp(){return Ea},get StoreOp(){return Sa},get TextureLayout(){return Ta},get PipelineBindPoint(){return Aa},get DynamicStateFlagBit(){return Ca},get StencilFace(){return wa},get QueueType(){return Ia},get ClearFlag(){return ba},get FormatType(){return Ra},get API(){return Oa},get SurfaceTransform(){return Na},get Feature(){return Pa},FormatInfo:Da,MemoryStatus:La,FormatInfos:Fa,FormatSize:za,FormatSurfaceSize:Ba,GetTypeSize:Ga,getTypedArrayConstructor:Ha,Rect:ss,Viewport:cs,Color:ls,Offset:us,Extent:hs,TextureSubres:_s,TextureCopy:fs,BufferTextureCopy:ms,BindingMappingInfo:Qa,DeviceInfo:Za,Device:Ja,FramebufferInfo:$a,Framebuffer:es,Attribute:rs,InputAssemblerInfo:os,InputAssembler:as,DescriptorSetLayoutBinding:qs,DescriptorSetLayoutInfo:Ys,DESCRIPTOR_DYNAMIC_TYPE:Xs,DescriptorSetLayout:Ks,PipelineLayoutInfo:Qs,PipelineLayout:Zs,RasterizerState:ds,DepthStencilState:ps,BlendTarget:vs,BlendState:gs,InputState:ys,PipelineStateInfo:xs,PipelineState:Es,FenceInfo:Js,Fence:$s,QueueInfo:Ss,Queue:Ts,ColorAttachment:As,DepthStencilAttachment:Cs,SubPassInfo:ws,RenderPassInfo:Is,RenderPass:bs,SamplerInfo:Rs,Sampler:Os,ShaderStage:Ns,Uniform:Ps,UniformBlock:Ms,UniformSampler:Ds,ShaderInfo:Ls,Shader:Fs,TextureInfo:zs,TextureViewInfo:Bs,IsPowerOf2:Us,Texture:Gs})),function(e){e[e.ALL=0]="ALL",e[e.CLOSEST=1]="CLOSEST",e[e.ANY=2]="ANY"}(ec||(ec={}));var rc,oc,ac,sc,cc,lc,uc,hc,_c=(rc=new Un(0,0,0),function(e,t){var n=Un.dot(e.d,t.n);if(Math.abs(n)<Number.EPSILON)return 0;Un.multiplyScalar(rc,t.n,t.d);var i=Un.dot(Un.subtract(rc,rc,e.o),t.n)/n;return i<0?0:i}),fc=(oc=new Un(0,0,0),ac=new Un(0,0,0),sc=new Un(0,0,0),cc=new Un(0,0,0),lc=new Un(0,0,0),function(e,t,n){Un.subtract(oc,t.b,t.a),Un.subtract(ac,t.c,t.a),Un.cross(sc,e.d,ac);var i=Un.dot(oc,sc);if(i<Number.EPSILON&&(!n||i>-Number.EPSILON))return 0;var r=1/i;Un.subtract(cc,e.o,t.a);var o=Un.dot(cc,sc)*r;if(o<0||o>1)return 0;Un.cross(lc,cc,oc);var a=Un.dot(e.d,lc)*r;if(a<0||o+a>1)return 0;var s=Un.dot(ac,lc)*r;return s<0?0:s}),mc=function(){var e=new Un(0,0,0);return function(t,n){var i=n.radius,r=n.center,o=t.o,a=t.d,s=i*i;Un.subtract(e,r,o);var c=e.lengthSqr(),l=Un.dot(e,a),u=s-(c-l*l);if(u<0)return 0;var h=Math.sqrt(u),_=c<s?l+h:l-h;return _<0?0:_}}(),dc=(uc=new Un,hc=new Un,function(e,t){return Un.subtract(uc,t.center,t.halfExtents),Un.add(hc,t.center,t.halfExtents),pc(e,uc,hc)});function pc(e,t,n){var i=e.o,r=e.d,o=1/r.x,a=1/r.y,s=1/r.z,c=(t.x-i.x)*o,l=(n.x-i.x)*o,u=(t.y-i.y)*a,h=(n.y-i.y)*a,_=(t.z-i.z)*s,f=(n.z-i.z)*s,m=Math.max(Math.max(Math.min(c,l),Math.min(u,h)),Math.min(_,f)),d=Math.min(Math.min(Math.max(c,l),Math.max(u,h)),Math.max(_,f));return d<0||m>d?0:m>0?m:d}var vc,gc,yc,xc,Ec=function(){var e=new Un,t=new Un,n=new Un,i=new Un,r=new Un,o=new Un,a=new Un,s=new Array(3),c=new Array(3),l=new Array(3),u=new Array(6);return function(h,_){s[0]=_.halfExtents.x,s[1]=_.halfExtents.y,s[2]=_.halfExtents.z,e=_.center,t=h.o,n=h.d,Un.set(i,_.orientation.m00,_.orientation.m01,_.orientation.m02),Un.set(r,_.orientation.m03,_.orientation.m04,_.orientation.m05),Un.set(o,_.orientation.m06,_.orientation.m07,_.orientation.m08),Un.subtract(a,e,t),c[0]=Un.dot(i,n),c[1]=Un.dot(r,n),c[2]=Un.dot(o,n),l[0]=Un.dot(i,a),l[1]=Un.dot(r,a),l[2]=Un.dot(o,a);for(var f=0;f<3;++f){if(0===c[f]){if(-l[f]-s[f]>0||-l[f]+s[f]<0)return 0;c[f]=1e-7}u[2*f+0]=(l[f]+s[f])/c[f],u[2*f+1]=(l[f]-s[f])/c[f]}var m=Math.max(Math.max(Math.min(u[0],u[1]),Math.min(u[2],u[3])),Math.min(u[4],u[5])),d=Math.min(Math.min(Math.max(u[0],u[1]),Math.max(u[2],u[3])),Math.max(u[4],u[5]));return d<0||m>d?0:m>0?m:d}}(),Sc=function(){var e=new Un,t=new Un,n=new Un,i=new Un,r=new Un,o=new Un,a=new Un,s=new Yo;return function(c,l){var u=l.radius*l.radius,h=Un.normalize(e,c.d),_=l.ellipseCenter0,f=l.ellipseCenter1,m=Un.subtract(t,f,_);if(m.equals(Un.ZERO))return s.radius=l.radius,s.center.set(l.ellipseCenter0),al.raySphere(c,s);var d=c.o,p=Un.subtract(n,d,_),v=Un.cross(i,h,m),g=v.lengthSqr();if(0===g){s.radius=l.radius;var y=Un.subtract(r,f,d);return p.lengthSqr()<y.lengthSqr()?s.center.set(l.ellipseCenter0):s.center.set(l.ellipseCenter1),al.raySphere(c,s)}var x=Un.cross(r,p,m),E=m.lengthSqr(),S=2*Un.dot(v,x),T=S*S-4*g*(x.lengthSqr()-u*E);if(T<0)return 0;var A=(-S-Math.sqrt(T))/(2*g);if(A<0){s.radius=l.radius;var C=Un.subtract(o,f,d);return p.lengthSqr()<C.lengthSqr()?s.center.set(l.ellipseCenter0):s.center.set(l.ellipseCenter1),al.raySphere(c,s)}var w=Un.scaleAndAdd(o,c.o,h,A),I=Un.subtract(a,w,_),b=Un.dot(I,m)/E;return b>=0&&b<=1?A:b<0?(s.radius=l.radius,s.center.set(l.ellipseCenter0),al.raySphere(c,s)):b>1?(s.radius=l.radius,s.center.set(l.ellipseCenter1),al.raySphere(c,s)):0}}(),Tc=(vc=Xo.create(),gc={distance:1/0,doubleSided:!1,mode:ec.ANY},yc=0,xc=function(e,t,n,i,r,o){e===ec.CLOSEST?(yc>t||0===yc)&&(yc=t,o&&(0===o.length?o.push({distance:t,vertexIndex0:n/3,vertexIndex1:i/3,vertexIndex2:r/3}):(o[0].distance=t,o[0].vertexIndex0=n/3,o[0].vertexIndex1=i/3,o[0].vertexIndex2=r/3))):(yc=t,o&&o.push({distance:t,vertexIndex0:n/3,vertexIndex1:i/3,vertexIndex2:r/3}))},function(e,t,n){if(yc=0,0===t.geometricInfo.positions.length)return yc;var i=void 0===n?gc:n;if(pc(e,t.geometricInfo.boundingBox.min,t.geometricInfo.boundingBox.max)){var r=t.primitiveMode,o=t.geometricInfo;!function(e,t,n,i,r){if(n===ia.TRIANGLE_LIST)for(var o=t.length,a=0;a<o;a+=3){var s=3*t[a],c=3*t[a+1],l=3*t[a+2];Un.set(vc.a,e[s],e[s+1],e[s+2]),Un.set(vc.b,e[c],e[c+1],e[c+2]),Un.set(vc.c,e[l],e[l+1],e[l+2]);var u=al.rayTriangle(i,vc,r.doubleSided);if(!(0===u||u>r.distance)&&(xc(r.mode,u,s,c,l,r.result),r.mode===ec.ANY))return u}else if(n===ia.TRIANGLE_STRIP)for(var h=t.length-2,_=0,f=0;f<h;f+=1){var m=3*t[f-_],d=3*t[f+_+1],p=3*t[f+2];Un.set(vc.a,e[m],e[m+1],e[m+2]),Un.set(vc.b,e[d],e[d+1],e[d+2]),Un.set(vc.c,e[p],e[p+1],e[p+2]),_=~_;var v=al.rayTriangle(i,vc,r.doubleSided);if(!(0===v||v>r.distance)&&(xc(r.mode,v,m,d,p,r.result),r.mode===ec.ANY))return v}else if(n===ia.TRIANGLE_FAN){var g=t.length-1,y=3*t[0];Un.set(vc.a,e[y],e[y+1],e[y+2]);for(var x=1;x<g;x+=1){var E=3*t[x],S=3*t[x+1];Un.set(vc.b,e[E],e[E+1],e[E+2]),Un.set(vc.c,e[S],e[S+1],e[S+2]);var T=al.rayTriangle(i,vc,r.doubleSided);if(!(0===T||T>r.distance)&&(xc(r.mode,T,y,E,S,r.result),r.mode===ec.ANY))return T}}}(o.positions,o.indices,r,e,i)}return yc}),Ac=function(){var e=0,t={distance:1/0,doubleSided:!1,mode:ec.ANY};return function(n,i,r){e=0;var o=void 0===r?t:r,a=i.renderingSubMeshes.length,s=i.struct.minPosition,c=i.struct.maxPosition;if(s&&c&&!pc(n,s,c))return e;for(var l=0;l<a;l++){var u=i.renderingSubMeshes[l],h=Tc(n,u,o);if(h)if(o.mode===ec.CLOSEST)(0===e||e>h)&&(e=h,o.subIndices&&(o.subIndices[0]=l));else if(e=h,o.subIndices&&o.subIndices.push(l),o.mode===ec.ANY)return h}return e&&o.mode===ec.CLOSEST&&(o.result&&(o.result[0].distance=e,o.result.length=1),o.subIndices&&(o.subIndices.length=1)),e}}(),Cc=function(){var e=0,t={distance:1/0,doubleSided:!1,mode:ec.ANY},n=new Go,i=new ei;return function(r,o,a){e=0;var s=void 0===a?t:a,c=o.worldBounds;if(c&&!dc(r,c))return e;Go.copy(n,r),o.node&&(ei.invert(i,o.node.getWorldMatrix(i)),Un.transformMat4(n.o,r.o,i),Un.transformMat4Normal(n.d,r.d,i));for(var l=o.subModels,u=0;u<l.length;u++){var h=l[u].subMesh,_=Tc(n,h,s);if(_)if(s.mode===ec.CLOSEST)(0===e||e>_)&&(e=_,s.subIndices&&(s.subIndices[0]=u));else if(e=_,s.subIndices&&s.subIndices.push(u),s.mode===ec.ANY)return _}return e&&s.mode===ec.CLOSEST&&(s.result&&(s.result[0].distance=e,s.result.length=1),s.subIndices&&(s.subIndices.length=1)),e}}(),wc=function(){var e=new Un(0,0,0);return function(t,n){Un.subtract(e,t.e,t.s);var i=(n.d-Un.dot(t.s,n.n))/Un.dot(e,n.n);return i<0||i>1?0:i}}(),Ic=function(){var e=new Un(0,0,0),t=new Un(0,0,0),n=new Un(0,0,0),i=new Un(0,0,0),r=new Un(0,0,0),o=new Un(0,0,0);return function(a,s,c){Un.subtract(e,s.b,s.a),Un.subtract(t,s.c,s.a),Un.subtract(n,a.s,a.e),Un.cross(r,e,t);var l=Un.dot(n,r);if(l<=0)return 0;Un.subtract(i,a.s,s.a);var u=Un.dot(i,r);if(u<0||u>l)return 0;Un.cross(o,n,i);var h=Un.dot(t,o);if(h<0||h>l)return 0;var _=-Un.dot(e,o);if(_<0||h+_>l)return 0;if(c){var f=1/l,m=1-(h*=f)-(_*=f);Un.set(c,s.a.x*m+s.b.x*h+s.c.x*_,s.a.y*m+s.b.y*h+s.c.y*_,s.a.z*m+s.b.z*h+s.c.z*_)}return 1}}(),bc=new Go;function Rc(e,t){bc.o.set(e.s),Un.subtract(bc.d,e.e,e.s),bc.d.normalize();var n=dc(bc,t);return n<=e.length()?n:0}function Oc(e,t){bc.o.set(e.s),Un.subtract(bc.d,e.e,e.s),bc.d.normalize();var n=Ec(bc,t);return n<=e.length()?n:0}function Nc(e,t){bc.o.set(e.s),Un.subtract(bc.d,e.e,e.s),bc.d.normalize();var n=mc(bc,t);return n<=e.length()?n:0}var Pc,Mc,Dc,Lc,Fc=(Pc=new Un,Mc=new Un,Dc=new Un,Lc=new Un,function(e,t){return Un.subtract(Pc,e.center,e.halfExtents),Un.add(Mc,e.center,e.halfExtents),Un.subtract(Dc,t.center,t.halfExtents),Un.add(Lc,t.center,t.halfExtents),Pc.x<=Lc.x&&Mc.x>=Dc.x&&Pc.y<=Lc.y&&Mc.y>=Dc.y&&Pc.z<=Lc.z&&Mc.z>=Dc.z});function zc(e,t,n,i,r,o){Un.set(o[0],e.x+n.x*t.x+i.x*t.y+r.x*t.z,e.y+n.y*t.x+i.y*t.y+r.y*t.z,e.z+n.z*t.x+i.z*t.y+r.z*t.z),Un.set(o[1],e.x-n.x*t.x+i.x*t.y+r.x*t.z,e.y-n.y*t.x+i.y*t.y+r.y*t.z,e.z-n.z*t.x+i.z*t.y+r.z*t.z),Un.set(o[2],e.x+n.x*t.x-i.x*t.y+r.x*t.z,e.y+n.y*t.x-i.y*t.y+r.y*t.z,e.z+n.z*t.x-i.z*t.y+r.z*t.z),Un.set(o[3],e.x+n.x*t.x+i.x*t.y-r.x*t.z,e.y+n.y*t.x+i.y*t.y-r.y*t.z,e.z+n.z*t.x+i.z*t.y-r.z*t.z),Un.set(o[4],e.x-n.x*t.x-i.x*t.y-r.x*t.z,e.y-n.y*t.x-i.y*t.y-r.y*t.z,e.z-n.z*t.x-i.z*t.y-r.z*t.z),Un.set(o[5],e.x+n.x*t.x-i.x*t.y-r.x*t.z,e.y+n.y*t.x-i.y*t.y-r.y*t.z,e.z+n.z*t.x-i.z*t.y-r.z*t.z),Un.set(o[6],e.x-n.x*t.x+i.x*t.y-r.x*t.z,e.y-n.y*t.x+i.y*t.y-r.y*t.z,e.z-n.z*t.x+i.z*t.y-r.z*t.z),Un.set(o[7],e.x-n.x*t.x-i.x*t.y+r.x*t.z,e.y-n.y*t.x-i.y*t.y+r.y*t.z,e.z-n.z*t.x-i.z*t.y+r.z*t.z)}function Bc(e,t){for(var n=Un.dot(t,e[0]),i=n,r=1;r<8;++r){var o=Un.dot(t,e[r]);n=o<n?o:n,i=o>i?o:i}return[n,i]}var Uc,Gc,Hc,kc=function(){for(var e=new Array(15),t=0;t<15;t++)e[t]=new Un(0,0,0);for(var n=new Array(8),i=new Array(8),r=0;r<8;r++)n[r]=new Un(0,0,0),i[r]=new Un(0,0,0);var o=new Un,a=new Un;return function(t,r){Un.set(e[0],1,0,0),Un.set(e[1],0,1,0),Un.set(e[2],0,0,1),Un.set(e[3],r.orientation.m00,r.orientation.m01,r.orientation.m02),Un.set(e[4],r.orientation.m03,r.orientation.m04,r.orientation.m05),Un.set(e[5],r.orientation.m06,r.orientation.m07,r.orientation.m08);for(var s=0;s<3;++s)Un.cross(e[6+3*s],e[s],e[0]),Un.cross(e[7+3*s],e[s],e[1]),Un.cross(e[7+3*s],e[s],e[2]);Un.subtract(o,t.center,t.halfExtents),Un.add(a,t.center,t.halfExtents),function(e,t,n){Un.set(n[0],e.x,t.y,t.z),Un.set(n[1],e.x,t.y,e.z),Un.set(n[2],e.x,e.y,t.z),Un.set(n[3],e.x,e.y,e.z),Un.set(n[4],t.x,t.y,t.z),Un.set(n[5],t.x,t.y,e.z),Un.set(n[6],t.x,e.y,t.z),Un.set(n[7],t.x,e.y,e.z)}(o,a,n),zc(r.center,r.halfExtents,e[3],e[4],e[5],i);for(var c=0;c<15;++c){var l=Bc(n,e[c]),u=Bc(i,e[c]);if(u[0]>l[1]||l[0]>u[1])return 0}return 1}}(),Vc=function(e,t){var n=e.halfExtents.x*Math.abs(t.n.x)+e.halfExtents.y*Math.abs(t.n.y)+e.halfExtents.z*Math.abs(t.n.z),i=Un.dot(t.n,e.center);return i+n<t.d?-1:i-n>t.d?0:1},jc=function(e,t){for(var n=0;n<t.planes.length;n++)if(-1===Vc(e,t.planes[n]))return 0;return 1},Wc=function(){for(var e=new Array(8),t=0,n=0,i=0;i<e.length;i++)e[i]=new Un(0,0,0);return function(i,r){for(var o=0,a=!1,s=0;s<r.planes.length;s++){if(-1===(o=Vc(i,r.planes[s])))return 0;1===o&&(a=!0)}if(!a)return 1;for(var c=0;c<r.vertices.length;c++)Un.subtract(e[c],r.vertices[c],i.center);t=0,n=0;for(var l=0;l<r.vertices.length;l++)e[l].x>i.halfExtents.x?t++:e[l].x<-i.halfExtents.x&&n++;if(t===r.vertices.length||n===r.vertices.length)return 0;t=0,n=0;for(var u=0;u<r.vertices.length;u++)e[u].y>i.halfExtents.y?t++:e[u].y<-i.halfExtents.y&&n++;if(t===r.vertices.length||n===r.vertices.length)return 0;t=0,n=0;for(var h=0;h<r.vertices.length;h++)e[h].z>i.halfExtents.z?t++:e[h].z<-i.halfExtents.z&&n++;return t===r.vertices.length||n===r.vertices.length?0:1}}(),qc=(Uc=new Un(0,0,0),Gc=new Vn,function(e,t){return Un.subtract(Uc,t,e.center),Un.transformMat3(Uc,Uc,Vn.transpose(Gc,e.orientation)),n=Uc,i=e.halfExtents,Math.abs(n.x)<i.x&&Math.abs(n.y)<i.y&&Math.abs(n.z)<i.z;var n,i}),Yc=(Hc=function(e,t,n,i){return Math.abs(e.x*t+e.y*n+e.z*i)},function(e,t){var n=e.halfExtents.x*Hc(t.n,e.orientation.m00,e.orientation.m01,e.orientation.m02)+e.halfExtents.y*Hc(t.n,e.orientation.m03,e.orientation.m04,e.orientation.m05)+e.halfExtents.z*Hc(t.n,e.orientation.m06,e.orientation.m07,e.orientation.m08),i=Un.dot(t.n,e.center);return i+n<t.d?-1:i-n>t.d?0:1}),Xc=function(e,t){for(var n=0;n<t.planes.length;n++)if(-1===Yc(e,t.planes[n]))return 0;return 1},Kc=function(){for(var e=new Array(8),t=0,n=0,i=0,r=0;r<e.length;r++)e[r]=new Un(0,0,0);var o=function(e,t,n,i){return e.x*t+e.y*n+e.z*i};return function(r,a){for(var s=0,c=!1,l=0;l<a.planes.length;l++){if(-1===(s=Yc(r,a.planes[l])))return 0;1===s&&(c=!0)}if(!c)return 1;for(var u=0;u<a.vertices.length;u++)Un.subtract(e[u],a.vertices[u],r.center);n=0,i=0;for(var h=0;h<a.vertices.length;h++)(t=o(e[h],r.orientation.m00,r.orientation.m01,r.orientation.m02))>r.halfExtents.x?n++:t<-r.halfExtents.x&&i++;if(n===a.vertices.length||i===a.vertices.length)return 0;n=0,i=0;for(var _=0;_<a.vertices.length;_++)(t=o(e[_],r.orientation.m03,r.orientation.m04,r.orientation.m05))>r.halfExtents.y?n++:t<-r.halfExtents.y&&i++;if(n===a.vertices.length||i===a.vertices.length)return 0;n=0,i=0;for(var f=0;f<a.vertices.length;f++)(t=o(e[f],r.orientation.m06,r.orientation.m07,r.orientation.m08))>r.halfExtents.z?n++:t<-r.halfExtents.z&&i++;return n===a.vertices.length||i===a.vertices.length?0:1}}(),Qc=function(){for(var e=new Array(15),t=0;t<15;t++)e[t]=new Un(0,0,0);for(var n=new Array(8),i=new Array(8),r=0;r<8;r++)n[r]=new Un(0,0,0),i[r]=new Un(0,0,0);return function(t,r){Un.set(e[0],t.orientation.m00,t.orientation.m01,t.orientation.m02),Un.set(e[1],t.orientation.m03,t.orientation.m04,t.orientation.m05),Un.set(e[2],t.orientation.m06,t.orientation.m07,t.orientation.m08),Un.set(e[3],r.orientation.m00,r.orientation.m01,r.orientation.m02),Un.set(e[4],r.orientation.m03,r.orientation.m04,r.orientation.m05),Un.set(e[5],r.orientation.m06,r.orientation.m07,r.orientation.m08);for(var o=0;o<3;++o)Un.cross(e[6+3*o],e[o],e[0]),Un.cross(e[7+3*o],e[o],e[1]),Un.cross(e[7+3*o],e[o],e[2]);zc(t.center,t.halfExtents,e[0],e[1],e[2],n),zc(r.center,r.halfExtents,e[3],e[4],e[5],i);for(var a=0;a<15;++a){var s=Bc(n,e[a]),c=Bc(i,e[a]);if(c[0]>s[1]||s[0]>c[1])return 0}return 1}}(),Zc=function(){for(var e=new Yo,t=new Un,n=new Un,i=new Un,r=new Array(8),o=0;o<8;o++)r[o]=new Un;for(var a=new Array(8),s=0;s<8;s++)a[s]=new Un;return function(o,s){if(0===Un.squaredDistance(s.ellipseCenter0,s.ellipseCenter1))return e.radius=s.radius,e.center.set(s.ellipseCenter0),al.sphereOBB(e,o);t.x=o.orientation.m00,t.y=o.orientation.m01,t.z=o.orientation.m02,n.x=o.orientation.m03,n.y=o.orientation.m04,n.z=o.orientation.m05,i.x=o.orientation.m06,i.y=o.orientation.m07,i.z=o.orientation.m08,zc(o.center,o.halfExtents,t,n,i,r);var c=a,l=Un.copy(c[0],t),u=Un.copy(c[1],n),h=Un.copy(c[2],i);Un.subtract(c[3],s.center,o.center).normalize();var _=Un.subtract(c[4],s.ellipseCenter0,s.ellipseCenter1);_.normalize(),Un.cross(c[5],l,_),Un.cross(c[6],u,_),Un.cross(c[7],h,_);for(var f=0;f<8;++f){var m=Bc(r,c[f]),d=Un.dot(c[f],s.ellipseCenter0),p=Un.dot(c[f],s.ellipseCenter1),v=Math.max(d,p),g=Math.min(d,p)-s.radius,y=v+s.radius;if(g>m[1]||m[0]>y)return 0}return 1}}(),Jc=function(e,t){var n=Un.dot(t.n,e.center),i=e.radius*t.n.length();return n+i<t.d?-1:n-i>t.d?0:1},$c=function(e,t){for(var n=0;n<t.planes.length;n++)if(-1===Jc(e,t.planes[n]))return 0;return 1},el=function(){var e=new Un(0,0,0),t=[1,-1,1,-1,1,-1];return function(n,i){for(var r=0;r<6;r++){var o=i.planes[r],a=n.radius,s=n.center,c=o.n,l=o.d,u=Un.dot(c,s);if(u+a<l)return 0;if(!(u-a>l)){Un.add(e,s,Un.multiplyScalar(e,c,a));for(var h=0;h<6;h++)if(h!==r&&h!==r+t[r]){var _=i.planes[h];if(Un.dot(_.n,e)<_.d)return 0}}}return 1}}(),tl=function(e,t){var n=e.radius+t.radius;return Un.squaredDistance(e.center,t.center)<n*n},nl=function(){var e=new Un;return function(t,n){return Lo(e,t.center,n),Un.squaredDistance(t.center,e)<t.radius*t.radius}}(),il=function(){var e=new Un;return function(t,n){return Fo(e,t.center,n),Un.squaredDistance(t.center,e)<t.radius*t.radius}}(),rl=function(){var e=new Un,t=new Un;return function(n,i){var r=n.radius+i.radius,o=r*r,a=Un.squaredDistance(i.ellipseCenter0,i.ellipseCenter1);if(0===a)return Un.squaredDistance(n.center,i.center)<o;Un.subtract(e,n.center,i.ellipseCenter0),Un.subtract(t,i.ellipseCenter1,i.ellipseCenter0);var s=Un.dot(e,t)/a;return s<0?Un.squaredDistance(n.center,i.ellipseCenter0)<o:s>1?Un.squaredDistance(n.center,i.ellipseCenter1)<o:(Un.scaleAndAdd(e,i.ellipseCenter0,t,s),Un.squaredDistance(n.center,e)<o)}}(),ol=function(){var e=new Un,t=new Un,n=new Un,i=new Un,r=new Un,o=new Un;return function(a,s){var c,l,u,h,_=Un.subtract(e,a.ellipseCenter1,a.ellipseCenter0),f=Un.subtract(t,s.ellipseCenter1,s.ellipseCenter0),m=Un.subtract(n,a.ellipseCenter0,s.ellipseCenter0),d=Un.dot(_,_),p=Un.dot(_,f),v=Un.dot(f,f),g=Un.dot(_,m),y=Un.dot(f,m),x=d*v-p*p,E=x,S=x;x<vn?(l=0,E=1,h=y,S=v):(h=d*y-p*g,(l=p*y-v*g)<0?(l=0,h=y,S=v):l>E&&(l=E,h=y+p,S=v)),h<0?(h=0,-g<0?l=0:-g>d?l=E:(l=-g,E=d)):h>S&&(h=S,-g+p<0?l=0:-g+p>d?l=E:(l=-g+p,E=d)),c=Math.abs(l)<vn?0:l/E,u=Math.abs(h)<vn?0:h/S;var T=i;T.set(m),T.add(Un.multiplyScalar(r,_,c)),T.subtract(Un.multiplyScalar(o,f,u));var A=a.radius+s.radius;return T.lengthSqr()<A*A}}(),al={raySphere:mc,rayAABB:dc,rayOBB:Ec,rayPlane:_c,rayTriangle:fc,rayCapsule:Sc,raySubMesh:Tc,rayMesh:Ac,rayModel:Cc,lineSphere:Nc,lineAABB:Rc,lineOBB:Oc,linePlane:wc,lineTriangle:Ic,sphereWithSphere:tl,sphereAABB:nl,sphereOBB:il,spherePlane:Jc,sphereFrustum:$c,sphereFrustumAccurate:el,sphereCapsule:rl,aabbWithAABB:Fc,aabbWithOBB:kc,aabbPlane:Vc,aabbFrustum:jc,aabbFrustumAccurate:Wc,obbWithOBB:Qc,obbPlane:Yc,obbFrustum:Xc,obbFrustumAccurate:Kc,obbPoint:qc,obbCapsule:Zc,capsuleWithCapsule:ol,resolve:function(e,t,n){void 0===n&&(n=null);var i=e._type,r=t._type,o=this[i|r];return i<r?o(e,t,n):o(t,e,n)}};al[Bo.SHAPE_RAY|Bo.SHAPE_SPHERE]=mc,al[Bo.SHAPE_RAY|Bo.SHAPE_AABB]=dc,al[Bo.SHAPE_RAY|Bo.SHAPE_OBB]=Ec,al[Bo.SHAPE_RAY|Bo.SHAPE_PLANE]=_c,al[Bo.SHAPE_RAY|Bo.SHAPE_TRIANGLE]=fc,al[Bo.SHAPE_RAY|Bo.SHAPE_CAPSULE]=Sc,al[Bo.SHAPE_LINE|Bo.SHAPE_SPHERE]=Nc,al[Bo.SHAPE_LINE|Bo.SHAPE_AABB]=Rc,al[Bo.SHAPE_LINE|Bo.SHAPE_OBB]=Oc,al[Bo.SHAPE_LINE|Bo.SHAPE_PLANE]=wc,al[Bo.SHAPE_LINE|Bo.SHAPE_TRIANGLE]=Ic,al[Bo.SHAPE_SPHERE]=tl,al[Bo.SHAPE_SPHERE|Bo.SHAPE_AABB]=nl,al[Bo.SHAPE_SPHERE|Bo.SHAPE_OBB]=il,al[Bo.SHAPE_SPHERE|Bo.SHAPE_PLANE]=Jc,al[Bo.SHAPE_SPHERE|Bo.SHAPE_FRUSTUM]=$c,al[Bo.SHAPE_SPHERE|Bo.SHAPE_FRUSTUM_ACCURATE]=el,al[Bo.SHAPE_SPHERE|Bo.SHAPE_CAPSULE]=rl,al[Bo.SHAPE_AABB]=Fc,al[Bo.SHAPE_AABB|Bo.SHAPE_OBB]=kc,al[Bo.SHAPE_AABB|Bo.SHAPE_PLANE]=Vc,al[Bo.SHAPE_AABB|Bo.SHAPE_FRUSTUM]=jc,al[Bo.SHAPE_AABB|Bo.SHAPE_FRUSTUM_ACCURATE]=Wc,al[Bo.SHAPE_OBB]=Qc,al[Bo.SHAPE_OBB|Bo.SHAPE_PLANE]=Yc,al[Bo.SHAPE_OBB|Bo.SHAPE_FRUSTUM]=Xc,al[Bo.SHAPE_OBB|Bo.SHAPE_FRUSTUM_ACCURATE]=Kc,al[Bo.SHAPE_OBB|Bo.SHAPE_CAPSULE]=Zc,al[Bo.SHAPE_CAPSULE]=ol,ve(Uo.prototype,"line",[{name:"mag",newName:"len"},{name:"magnitude",newName:"len"}]),ge(al,"intersect",[{name:"line_quad"}]);var sl=new Un(0,0,0),cl=new Un(0,0,0),ll=c.mat4(),ul=c.v4(),hl=function(){function e(e,t,n,i){void 0===e&&(e=0),void 0===t&&(t=1),void 0===n&&(n=0),void 0===i&&(i=0),this.n=void 0,this.d=void 0,this._type=void 0,this._type=Bo.SHAPE_PLANE,this.n=new Un(e,t,n),this.d=i}return e.create=function(t,n,i,r){return new e(t,n,i,r)},e.clone=function(t){return new e(t.n.x,t.n.y,t.n.z,t.d)},e.copy=function(e,t){return Un.copy(e.n,t.n),e.d=t.d,e},e.fromPoints=function(e,t,n,i){return Un.subtract(sl,n,t),Un.subtract(cl,i,t),Un.normalize(e.n,Un.cross(e.n,sl,cl)),e.d=Un.dot(e.n,t),e},e.set=function(e,t,n,i,r){return e.n.x=t,e.n.y=n,e.n.z=i,e.d=r,e},e.fromNormalAndPoint=function(e,t,n){return Un.copy(e.n,t),e.d=Un.dot(t,n),e},e.normalize=function(e,t){var n=t.n.length();return Un.normalize(e.n,t.n),n>0&&(e.d=t.d/n),e},Z(e,[{key:"type",get:function(){return this._type}},{key:"x",set:function(e){this.n.x=e},get:function(){return this.n.x}},{key:"y",set:function(e){this.n.y=e},get:function(){return this.n.y}},{key:"z",set:function(e){this.n.z=e},get:function(){return this.n.z}},{key:"w",set:function(e){this.d=e},get:function(){return this.d}}]),e.prototype.transform=function(e){ei.invert(ll,e),ei.transpose(ll,ll),ci.set(ul,this.n.x,this.n.y,this.n.z,this.d),ci.transformMat4(ul,ul,ll),Un.set(this.n,ul.x,ul.y,ul.z),this.d=ul.w},e}(),_l=new Un,fl=new Un,ml=new Un,dl=new Un,pl=new Vn,vl=function(e,t,n){pl.m00=Math.abs(n.m00),pl.m01=Math.abs(n.m01),pl.m02=Math.abs(n.m02),pl.m03=Math.abs(n.m04),pl.m04=Math.abs(n.m05),pl.m05=Math.abs(n.m06),pl.m06=Math.abs(n.m08),pl.m07=Math.abs(n.m09),pl.m08=Math.abs(n.m10),Un.transformMat3(e,t,pl)},gl=e("aL",function(){function e(e,t,n,i,r,o){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=1),void 0===r&&(r=1),void 0===o&&(o=1),this.center=void 0,this.halfExtents=void 0,this._type=void 0,this._type=Bo.SHAPE_AABB,this.center=new Un(e,t,n),this.halfExtents=new Un(i,r,o)}e.create=function(t,n,i,r,o,a){return new e(t,n,i,r,o,a)},e.clone=function(t){return new e(t.center.x,t.center.y,t.center.z,t.halfExtents.x,t.halfExtents.y,t.halfExtents.z)},e.copy=function(e,t){return Un.copy(e.center,t.center),Un.copy(e.halfExtents,t.halfExtents),e},e.fromPoints=function(e,t,n){return Un.add(_l,n,t),Un.subtract(fl,n,t),Un.multiplyScalar(e.center,_l,.5),Un.multiplyScalar(e.halfExtents,fl,.5),e},e.set=function(e,t,n,i,r,o,a){return Un.set(e.center,t,n,i),Un.set(e.halfExtents,r,o,a),e},e.merge=function(t,n,i){return Un.subtract(_l,n.center,n.halfExtents),Un.subtract(fl,i.center,i.halfExtents),Un.add(ml,n.center,n.halfExtents),Un.add(dl,i.center,i.halfExtents),Un.max(dl,ml,dl),Un.min(ml,_l,fl),e.fromPoints(t,ml,dl)},e.toBoundingSphere=function(e,t){t.getBoundary(_l,fl),e.center.set(_l),e.radius=0,Un.subtract(ml,fl,e.center);var n=ml.length(),i=.5*n;return e.radius+=i,Un.multiplyScalar(ml,ml,i/n),Un.add(e.center,e.center,ml),e},e.transform=function(e,t,n){return Un.transformMat4(e.center,t.center,n),vl(e.halfExtents,t.halfExtents,n),e},Z(e,[{key:"type",get:function(){return this._type}}]);var t=e.prototype;return t.getBoundary=function(e,t){Un.subtract(e,this.center,this.halfExtents),Un.add(t,this.center,this.halfExtents)},t.transform=function(e,t,n,i,r){Un.transformMat4(r.center,this.center,e),vl(r.halfExtents,this.halfExtents,e)},t.clone=function(){return e.clone(this)},t.copy=function(t){return e.copy(this,t)},e}()),yl=new Un,xl=new Un,El=new Vn,Sl=function(){function e(e,t,n,i,r,o,a,s,c,l,u,h,_,f,m){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=1),void 0===r&&(r=1),void 0===o&&(o=1),void 0===a&&(a=1),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=0),void 0===u&&(u=1),void 0===h&&(h=0),void 0===_&&(_=0),void 0===f&&(f=0),void 0===m&&(m=1),this.center=void 0,this.halfExtents=void 0,this.orientation=void 0,this._type=void 0,this._type=Bo.SHAPE_OBB,this.center=new Un(e,t,n),this.halfExtents=new Un(i,r,o),this.orientation=new Vn(a,s,c,l,u,h,_,f,m)}e.create=function(t,n,i,r,o,a,s,c,l,u,h,_,f,m,d){return new e(t,n,i,r,o,a,s,c,l,u,h,_,f,m,d)},e.clone=function(t){return new e(t.center.x,t.center.y,t.center.z,t.halfExtents.x,t.halfExtents.y,t.halfExtents.z,t.orientation.m00,t.orientation.m01,t.orientation.m02,t.orientation.m03,t.orientation.m04,t.orientation.m05,t.orientation.m06,t.orientation.m07,t.orientation.m08)},e.copy=function(e,t){return Un.copy(e.center,t.center),Un.copy(e.halfExtents,t.halfExtents),Vn.copy(e.orientation,t.orientation),e},e.fromPoints=function(e,t,n){return Un.multiplyScalar(e.center,Un.add(yl,t,n),.5),Un.multiplyScalar(e.halfExtents,Un.subtract(xl,n,t),.5),Vn.identity(e.orientation),e},e.set=function(e,t,n,i,r,o,a,s,c,l,u,h,_,f,m,d){return Un.set(e.center,t,n,i),Un.set(e.halfExtents,r,o,a),Vn.set(e.orientation,s,c,l,u,h,_,f,m,d),e},Z(e,[{key:"type",get:function(){return this._type}}]);var t=e.prototype;return t.getBoundary=function(e,t){!function(e,t,n){El.m00=Math.abs(n.m00),El.m01=Math.abs(n.m01),El.m02=Math.abs(n.m02),El.m03=Math.abs(n.m03),El.m04=Math.abs(n.m04),El.m05=Math.abs(n.m05),El.m06=Math.abs(n.m06),El.m07=Math.abs(n.m07),El.m08=Math.abs(n.m08),Un.transformMat3(e,t,El)}(yl,this.halfExtents,this.orientation),Un.subtract(e,this.center,yl),Un.add(t,this.center,yl)},t.transform=function(e,t,n,i,r){Un.transformMat4(r.center,this.center,e),Vn.fromQuat(r.orientation,n),Un.multiply(r.halfExtents,this.halfExtents,i)},t.translateAndRotate=function(e,t,n){Un.transformMat4(n.center,this.center,e),Vn.fromQuat(n.orientation,t)},t.setScale=function(e,t){Un.multiply(t.halfExtents,this.halfExtents,e)},e}(),Tl=function(){function e(e,t,n){void 0===e&&(e=.5),void 0===t&&(t=.5),void 0===n&&(n=1),this._type=void 0,this.radius=void 0,this.halfHeight=void 0,this.axis=void 0,this.center=void 0,this.rotation=void 0,this.ellipseCenter0=void 0,this.ellipseCenter1=void 0,this._type=Bo.SHAPE_CAPSULE,this.radius=e,this.halfHeight=t,this.axis=n,this.center=new Un,this.rotation=new qn,this.ellipseCenter0=new Un(0,t,0),this.ellipseCenter1=new Un(0,-t,0),this.updateCache()}Z(e,[{key:"type",get:function(){return this._type}}]);var t=e.prototype;return t.transform=function(e,t,n,i,r){var o=i,a=Ln(o);r.radius=this.radius*Math.abs(a);var s=(this.halfHeight+this.radius)*Math.abs(o.y)-r.radius;s<0&&(s=0),r.halfHeight=s,Un.transformMat4(r.center,this.center,e),qn.multiply(r.rotation,this.rotation,n),r.updateCache()},t.updateCache=function(){this.updateLocalCenter(),Un.transformQuat(this.ellipseCenter0,this.ellipseCenter0,this.rotation),Un.transformQuat(this.ellipseCenter1,this.ellipseCenter1,this.rotation),this.ellipseCenter0.add(this.center),this.ellipseCenter1.add(this.center)},t.updateLocalCenter=function(){var e=this.halfHeight;switch(this.axis){case 0:this.ellipseCenter0.set(e,0,0),this.ellipseCenter1.set(-e,0,0);break;case 1:this.ellipseCenter0.set(0,e,0),this.ellipseCenter1.set(0,-e,0);break;case 2:this.ellipseCenter0.set(0,0,e),this.ellipseCenter1.set(0,0,-e)}},e}(),Al=new Array(8);Al[0]=new Un(1,1,1),Al[1]=new Un(-1,1,1),Al[2]=new Un(-1,-1,1),Al[3]=new Un(1,-1,1),Al[4]=new Un(1,1,-1),Al[5]=new Un(-1,1,-1),Al[6]=new Un(-1,-1,-1),Al[7]=new Un(1,-1,-1);var Cl,wl,Il,bl=function(){function e(){this._type=void 0,this.planes=void 0,this.vertices=void 0,this._type=Bo.SHAPE_FRUSTUM,this.planes=new Array(6);for(var e=0;e<6;++e)this.planes[e]=hl.create(0,0,0,0);this.vertices=new Array(8);for(var t=0;t<8;++t)this.vertices[t]=new Un}e.create=function(){return new e},e.clone=function(t){return e.copy(new e,t)},e.copy=function(e,t){e._type=t._type;for(var n=0;n<6;++n)hl.copy(e.planes[n],t.planes[n]);for(var i=0;i<8;++i)Un.copy(e.vertices[i],t.vertices[i]);return e},Z(e,[{key:"accurate",set:function(e){this._type=e?Bo.SHAPE_FRUSTUM_ACCURATE:Bo.SHAPE_FRUSTUM}},{key:"type",get:function(){return this._type}}]);var t=e.prototype;return t.update=function(e,t){if(Un.set(this.planes[0].n,e.m03+e.m00,e.m07+e.m04,e.m11+e.m08),this.planes[0].d=-(e.m15+e.m12),Un.set(this.planes[1].n,e.m03-e.m00,e.m07-e.m04,e.m11-e.m08),this.planes[1].d=-(e.m15-e.m12),Un.set(this.planes[2].n,e.m03+e.m01,e.m07+e.m05,e.m11+e.m09),this.planes[2].d=-(e.m15+e.m13),Un.set(this.planes[3].n,e.m03-e.m01,e.m07-e.m05,e.m11-e.m09),this.planes[3].d=-(e.m15-e.m13),Un.set(this.planes[4].n,e.m03+e.m02,e.m07+e.m06,e.m11+e.m10),this.planes[4].d=-(e.m15+e.m14),Un.set(this.planes[5].n,e.m03-e.m02,e.m07-e.m06,e.m11-e.m10),this.planes[5].d=-(e.m15-e.m14),this._type===Bo.SHAPE_FRUSTUM_ACCURATE){for(var n=0;n<6;n++){var i=this.planes[n],r=1/i.n.length();Un.multiplyScalar(i.n,i.n,r),i.d*=r}for(var o=0;o<8;o++)Un.transformMat4(this.vertices[o],Al[o],t)}},t.transform=function(e){if(this._type===Bo.SHAPE_FRUSTUM_ACCURATE){for(var t=0;t<8;t++)Un.transformMat4(this.vertices[t],this.vertices[t],e);hl.fromPoints(this.planes[0],this.vertices[1],this.vertices[5],this.vertices[6]),hl.fromPoints(this.planes[1],this.vertices[3],this.vertices[7],this.vertices[4]),hl.fromPoints(this.planes[2],this.vertices[6],this.vertices[7],this.vertices[3]),hl.fromPoints(this.planes[3],this.vertices[0],this.vertices[4],this.vertices[5]),hl.fromPoints(this.planes[4],this.vertices[2],this.vertices[3],this.vertices[0]),hl.fromPoints(this.planes[0],this.vertices[7],this.vertices[6],this.vertices[5])}},e}();function Rl(e,t){if(t&&e!==Qi){for(var n=t.vertices,i=Br.VERTICES,r=0;r<8;++r)Vr.setVec3(e,i,n[r]),i+=3;for(var o=t.planes,a=Br.PLANES,s=0;s<6;s++,a+=4)Vr.setVec4(e,a,o[s])}}bl.createOrtho=(Cl=new Un,function(e,t,n,i,r,o){var a=t/2,s=n/2;Un.set(Cl,a,s,i),Un.transformMat4(e.vertices[0],Cl,o),Un.set(Cl,-a,s,i),Un.transformMat4(e.vertices[1],Cl,o),Un.set(Cl,-a,-s,i),Un.transformMat4(e.vertices[2],Cl,o),Un.set(Cl,a,-s,i),Un.transformMat4(e.vertices[3],Cl,o),Un.set(Cl,a,s,r),Un.transformMat4(e.vertices[4],Cl,o),Un.set(Cl,-a,s,r),Un.transformMat4(e.vertices[5],Cl,o),Un.set(Cl,-a,-s,r),Un.transformMat4(e.vertices[6],Cl,o),Un.set(Cl,a,-s,r),Un.transformMat4(e.vertices[7],Cl,o),hl.fromPoints(e.planes[0],e.vertices[1],e.vertices[6],e.vertices[5]),hl.fromPoints(e.planes[1],e.vertices[3],e.vertices[4],e.vertices[7]),hl.fromPoints(e.planes[2],e.vertices[6],e.vertices[3],e.vertices[7]),hl.fromPoints(e.planes[3],e.vertices[0],e.vertices[5],e.vertices[4]),hl.fromPoints(e.planes[4],e.vertices[2],e.vertices[0],e.vertices[3]),hl.fromPoints(e.planes[0],e.vertices[7],e.vertices[5],e.vertices[6])}),function(e){e[e.Default=0]="Default",e[e.Normal=1]="Normal",e[e.Loop=2]="Loop",e[e.ShouldWrap=4]="ShouldWrap",e[e.Clamp=8]="Clamp",e[e.PingPong=22]="PingPong",e[e.Reverse=36]="Reverse"}(wl||(wl={})),function(e){e[e.Default=wl.Default]="Default",e[e.Normal=wl.Normal]="Normal",e[e.Reverse=wl.Reverse]="Reverse",e[e.Loop=wl.Loop]="Loop",e[e.LoopReverse=wl.Loop|wl.Reverse]="LoopReverse",e[e.PingPong=wl.PingPong]="PingPong",e[e.PingPongReverse=wl.PingPong|wl.Reverse]="PingPongReverse"}(Il||(Il={})),Tt(Il);var Ol=function(){function e(e){this.ratio=0,this.time=0,this.direction=1,this.stopped=!0,this.iterations=0,this.frameIndex=void 0,e&&this.set(e)}return e.prototype.set=function(e){this.ratio=e.ratio,this.time=e.time,this.direction=e.direction,this.stopped=e.stopped,this.iterations=e.iterations,this.frameIndex=e.frameIndex},e}(),Nl=xt({Default:wl.Default,Normal:wl.Normal,Clamp:wl.Clamp,Loop:wl.Loop,PingPong:wl.PingPong}),Pl=function(){this.time=0,this.value=0,this.inTangent=0,this.outTangent=0};_n.fastDefine("cc.Keyframe",Pl,{time:0,value:0,inTangent:0,outTangent:0});var Ml=function(){function e(){this.index=void 0,this.time=void 0,this.endTime=void 0,this.coefficient=void 0,this.index=-1,this.time=0,this.endTime=0,this.coefficient=new Float32Array(4)}return e.prototype.evaluate=function(e){return t=e-this.time,n=this.coefficient,t*(t*(t*n[0]+n[1])+n[2])+n[3];var t,n},e}(),Dl=e("cV",function(){function e(t){void 0===t&&(t=null),this.keyFrames=void 0,this.preWrapMode=Nl.Loop,this.postWrapMode=Nl.Clamp,this.cachedKey=void 0,this.keyFrames=t||[].concat(e.defaultKF),this.cachedKey=new Ml}var t=e.prototype;return t.addKey=function(e){null==this.keyFrames&&(this.keyFrames=[]),this.keyFrames.push(e)},t.evaluate_slow=function(e){var t=e,n=e<0?this.preWrapMode:this.postWrapMode,i=this.keyFrames[0].time,r=this.keyFrames[this.keyFrames.length-1].time;switch(n){case Nl.Loop:t=Pn(e-i,r-i)+i;break;case Nl.PingPong:t=Mn(e-i,r-i)+i;break;case Nl.Default:case Nl.Normal:case Nl.Clamp:default:t=xn(e,i,r)}var o=0;if(t>this.keyFrames[0].time)if(t>=this.keyFrames[this.keyFrames.length-1].time)o=this.keyFrames.length-2;else for(var a=0;a<this.keyFrames.length-1;a++)if(t>=this.keyFrames[0].time&&t<=this.keyFrames[a+1].time){o=a;break}var s=this.keyFrames[o],c=this.keyFrames[o+1],l=Dn(s.time,c.time,t),u=c.time-s.time,h=s.outTangent*u,_=c.inTangent*u,f=l*l,m=f*l,d=m-2*f+l,p=m-f,v=-2*m+3*f;return(2*m-3*f+1)*s.value+d*h+p*_+v*c.value},t.evaluate=function(e){var t=e,n=e<0?this.preWrapMode:this.postWrapMode,i=this.keyFrames[0].time,r=this.keyFrames[this.keyFrames.length-1].time;switch(n){case Nl.Loop:t=Pn(e-i,r-i)+i;break;case Nl.PingPong:t=Mn(e-i,r-i)+i;break;case Nl.Default:case Nl.Normal:case Nl.Clamp:default:t=xn(e,i,r)}if(t>=this.cachedKey.time&&t<this.cachedKey.endTime)return this.cachedKey.evaluate(t);var o=this.findIndex(this.cachedKey,t),a=Math.min(o+1,this.keyFrames.length-1);return this.calcOptimizedKey(this.cachedKey,o,a),this.cachedKey.evaluate(t)},t.calcOptimizedKey=function(e,t,n){var i=this.keyFrames[t],r=this.keyFrames[n];e.index=t,e.time=i.time,e.endTime=r.time;var o=r.time-i.time,a=r.value-i.value,s=1/(o*o),c=i.outTangent*o,l=r.inTangent*o;e.coefficient[0]=(c+l-a-a)*s/o,e.coefficient[1]=(a+a+a-c-c-l)*s,e.coefficient[2]=i.outTangent,e.coefficient[3]=i.value},t.findIndex=function(e,t){var n=e.index;if(-1!==n)if(t>this.keyFrames[n].time)for(var i=0;i<3;i++){var r=n+i;if(r+1<this.keyFrames.length&&this.keyFrames[r+1].time>t)return r}else for(var o=0;o<3;o++){var a=n-o;if(a>=0&&this.keyFrames[a-1].time<=t)return a-1}for(var s,c=0,l=this.keyFrames.length;l-c>1;)s=Math.floor((c+l)/2),this.keyFrames[s].time>=t?l=s:c=s;return c},e}());function Ll(e,t){console.warn(e+" is deprecated, please use "+t+" instead.")}Dl.defaultKF=[{time:0,value:1,inTangent:0,outTangent:0},{time:1,value:1,inTangent:0,outTangent:0}],_n.fastDefine("cc.AnimationCurve",Dl,{preWrapMode:Nl.Default,postWrapMode:Nl.Default,keyFrames:[]}),ve(al,"intersect",[{name:"ray_aabb",newName:"rayAABB"},{name:"ray_plane",newName:"rayPlane"},{name:"ray_triangle",newName:"rayTriangle"},{name:"ray_sphere",newName:"raySphere"},{name:"ray_obb",newName:"rayOBB"},{name:"ray_capsule",newName:"rayCapsule"},{name:"ray_subMesh",newName:"raySubMesh"},{name:"ray_mesh",newName:"rayMesh"},{name:"ray_model",newName:"rayModel"},{name:"line_plane",newName:"linePlane"},{name:"line_triangle",newName:"lineTriangle"},{name:"line_aabb",newName:"lineAABB"},{name:"line_obb",newName:"lineOBB"},{name:"line_sphere",newName:"lineSphere"},{name:"aabb_aabb",newName:"aabbWithAABB"},{name:"aabb_obb",newName:"aabbWithOBB"},{name:"aabb_plane",newName:"aabbPlane"},{name:"aabb_frustum",newName:"aabbFrustum"},{name:"aabbFrustum_accurate",newName:"aabbFrustumAccurate"},{name:"obb_point",newName:"obbPoint"},{name:"obb_plane",newName:"obbPlane"},{name:"obb_frustum",newName:"obbFrustum"},{name:"obbFrustum_accurate",newName:"obbFrustumAccurate"},{name:"obb_obb",newName:"obbWithOBB"},{name:"obb_capsule",newName:"obbCapsule"},{name:"sphere_plane",newName:"spherePlane"},{name:"sphere_frustum",newName:"sphereFrustum"},{name:"sphereFrustum_accurate",newName:"sphereFrustumAccurate"},{name:"sphere_sphere",newName:"sphereWithSphere"},{name:"sphere_aabb",newName:"sphereAABB"},{name:"sphere_obb",newName:"sphereOBB"},{name:"sphere_capsule",newName:"sphereCapsule"},{name:"capsule_capsule",newName:"capsuleWithCapsule"}]);var Fl=function(e){function t(){var t;return t=e.call(this)||this,Ll("line","Line"),t}return $(t,e),t}(Uo),zl=function(e){function t(){var t;return t=e.call(this)||this,Ll("plane","Plane"),t}return $(t,e),t}(hl),Bl=function(e){function t(){var t;return t=e.call(this)||this,Ll("ray","Ray"),t}return $(t,e),t}(Go),Ul=function(e){function t(){var t;return t=e.call(this)||this,Ll("triangle","Triangle"),t}return $(t,e),t}(Xo),Gl=function(e){function t(){var t;return t=e.call(this)||this,Ll("sphere","Sphere"),t}return $(t,e),t}(Yo),Hl=function(e){function t(){var t;return t=e.call(this)||this,Ll("aabb","AABB"),t}return $(t,e),t}(gl),kl=function(e){function t(){var t;return t=e.call(this)||this,Ll("obb","OBB"),t}return $(t,e),t}(Sl),Vl=function(e){function t(){var t;return t=e.call(this)||this,Ll("capsule","Capsule"),t}return $(t,e),t}(Tl),jl=function(e){function t(){var t;return t=e.call(this)||this,Ll("frustum","Frustum"),t}return $(t,e),t}(bl),Wl=Object.freeze({__proto__:null,distance:zo,enums:Bo,intersect:al,Line:Uo,Plane:hl,Ray:Go,Triangle:Xo,Sphere:Yo,AABB:gl,OBB:Sl,Capsule:Tl,Frustum:bl,Keyframe:Pl,AnimationCurve:Dl,get ERaycastMode(){return ec},line:Fl,plane:zl,ray:Bl,triangle:Ul,sphere:Gl,aabb:Hl,obb:kl,capsule:Vl,frustum:jl});e("dH",Wl);var ql,Yl,Xl={NONE:0,IGNORE_RAYCAST:1<<20,GIZMOS:1<<21,EDITOR:1<<22,UI_3D:1<<23,SCENE_GIZMO:1<<24,UI_2D:1<<25,PROFILER:1<<28,DEFAULT:1<<30,ALL:4294967295},Kl=e("cn",function(){function e(){}return e.makeMaskInclude=function(e){for(var t,n=0,i=oe(e);!(t=i()).done;)n|=t.value;return n},e.makeMaskExclude=function(t){return~e.makeMaskInclude(t)},e.addLayer=function(t,n){void 0!==n?n>19||n<0?console.warn("maximum layers reached."):(e.Enum[t]=1<<n,e.Enum[n]=t,e.BitMask[t]=1<<n,e.BitMask[n]=t):console.warn("bitNum can't be undefined")},e.deleteLayer=function(t){t>19||t<0?console.warn("do not change buildin layers."):(delete e.Enum[e.Enum[t]],delete e.Enum[t],delete e.BitMask[e.BitMask[t]],delete e.BitMask[t])},e}());Kl.Enum=xt(Xl),Kl.BitMask=yt(J({},Xl)),c.Layers=Kl,function(e){e[e.DEFAULT=100]="DEFAULT",e[e.UI=200]="UI"}(ql||(ql={})),c.RenderPassStage=ql,function(e){e[e.MIN=0]="MIN",e[e.MAX=255]="MAX",e[e.DEFAULT=128]="DEFAULT"}(Yl||(Yl=e("cj",{})));var Ql,Zl={bindings:[],layouts:{}},Jl={bindings:[],layouts:{}};!function(e){e[e.UBO_GLOBAL=0]="UBO_GLOBAL",e[e.UBO_CAMERA=1]="UBO_CAMERA",e[e.UBO_SHADOW=2]="UBO_SHADOW",e[e.SAMPLER_SHADOWMAP=3]="SAMPLER_SHADOWMAP",e[e.SAMPLER_ENVIRONMENT=4]="SAMPLER_ENVIRONMENT",e[e.SAMPLER_SPOT_LIGHTING_MAP=5]="SAMPLER_SPOT_LIGHTING_MAP",e[e.COUNT=6]="COUNT"}(Ql||(Ql={}));var $l,eu=Ql.SAMPLER_SHADOWMAP,tu=Ql.COUNT-eu;!function(e){e[e.UBO_LOCAL=0]="UBO_LOCAL",e[e.UBO_FORWARD_LIGHTS=1]="UBO_FORWARD_LIGHTS",e[e.UBO_SKINNING_ANIMATION=2]="UBO_SKINNING_ANIMATION",e[e.UBO_SKINNING_TEXTURE=3]="UBO_SKINNING_TEXTURE",e[e.UBO_MORPH=4]="UBO_MORPH",e[e.SAMPLER_JOINTS=5]="SAMPLER_JOINTS",e[e.SAMPLER_MORPH_POSITION=6]="SAMPLER_MORPH_POSITION",e[e.SAMPLER_MORPH_NORMAL=7]="SAMPLER_MORPH_NORMAL",e[e.SAMPLER_MORPH_TANGENT=8]="SAMPLER_MORPH_TANGENT",e[e.SAMPLER_LIGHTMAP=9]="SAMPLER_LIGHTMAP",e[e.SAMPLER_SPRITE=10]="SAMPLER_SPRITE",e[e.COUNT=11]="COUNT"}($l||($l=e("cz",{})));var nu,iu=$l.SAMPLER_JOINTS,ru=$l.COUNT-iu;!function(e){e[e.GLOBAL=0]="GLOBAL",e[e.MATERIAL=1]="MATERIAL",e[e.LOCAL=2]="LOCAL"}(nu||(nu={}));var ou=new Qa;ou.bufferOffsets=[0,eu+iu,eu],ou.samplerOffsets=[-eu,tu+ru,tu-iu],ou.flexibleSet=1;var au=function(){};au.SIZE=4*(au.COUNT=4+(au.SCREEN_SIZE_OFFSET=4+(au.NATIVE_SIZE_OFFSET=4+(au.TIME_OFFSET=0)))),au.NAME="CCGlobal",au.BINDING=Ql.UBO_GLOBAL,au.DESCRIPTOR=new qs(au.BINDING,ya.UNIFORM_BUFFER,1,ga.ALL),au.LAYOUT=new Ms(nu.GLOBAL,au.BINDING,au.NAME,[new Ps("cc_time",Zo.FLOAT4,1),new Ps("cc_screenSize",Zo.FLOAT4,1),new Ps("cc_nativeSize",Zo.FLOAT4,1)],1),Zl.layouts[au.NAME]=au.LAYOUT,Zl.bindings[au.BINDING]=au.DESCRIPTOR;var su=function(){};su.SIZE=4*(su.COUNT=4+(su.GLOBAL_FOG_ADD_OFFSET=4+(su.GLOBAL_FOG_BASE_OFFSET=4+(su.GLOBAL_FOG_COLOR_OFFSET=4+(su.AMBIENT_GROUND_OFFSET=4+(su.AMBIENT_SKY_OFFSET=4+(su.MAIN_LIT_COLOR_OFFSET=4+(su.MAIN_LIT_DIR_OFFSET=4+(su.EXPOSURE_OFFSET=4+(su.SCREEN_SCALE_OFFSET=4+(su.CAMERA_POS_OFFSET=16+(su.MAT_VIEW_PROJ_INV_OFFSET=16+(su.MAT_VIEW_PROJ_OFFSET=16+(su.MAT_PROJ_INV_OFFSET=16+(su.MAT_PROJ_OFFSET=16+(su.MAT_VIEW_INV_OFFSET=16+(su.MAT_VIEW_OFFSET=0))))))))))))))))),su.NAME="CCCamera",su.BINDING=Ql.UBO_CAMERA,su.DESCRIPTOR=new qs(su.BINDING,ya.UNIFORM_BUFFER,1,ga.ALL),su.LAYOUT=new Ms(nu.GLOBAL,su.BINDING,su.NAME,[new Ps("cc_matView",Zo.MAT4,1),new Ps("cc_matViewInv",Zo.MAT4,1),new Ps("cc_matProj",Zo.MAT4,1),new Ps("cc_matProjInv",Zo.MAT4,1),new Ps("cc_matViewProj",Zo.MAT4,1),new Ps("cc_matViewProjInv",Zo.MAT4,1),new Ps("cc_cameraPos",Zo.FLOAT4,1),new Ps("cc_screenScale",Zo.FLOAT4,1),new Ps("cc_exposure",Zo.FLOAT4,1),new Ps("cc_mainLitDir",Zo.FLOAT4,1),new Ps("cc_mainLitColor",Zo.FLOAT4,1),new Ps("cc_ambientSky",Zo.FLOAT4,1),new Ps("cc_ambientGround",Zo.FLOAT4,1),new Ps("cc_fogColor",Zo.FLOAT4,1),new Ps("cc_fogBase",Zo.FLOAT4,1),new Ps("cc_fogAdd",Zo.FLOAT4,1)],1),Zl.layouts[su.NAME]=su.LAYOUT,Zl.bindings[su.BINDING]=su.DESCRIPTOR;var cu=function(){};cu.SIZE=4*(cu.COUNT=4+(cu.SHADOW_INFO_OFFSET=4+(cu.SHADOW_COLOR_OFFSET=16+(cu.MAT_LIGHT_VIEW_PROJ_OFFSET=16+(cu.MAT_LIGHT_PLANE_PROJ_OFFSET=0))))),cu.NAME="CCShadow",cu.BINDING=Ql.UBO_SHADOW,cu.DESCRIPTOR=new qs(cu.BINDING,ya.UNIFORM_BUFFER,1,ga.ALL),cu.LAYOUT=new Ms(nu.GLOBAL,cu.BINDING,cu.NAME,[new Ps("cc_matLightPlaneProj",Zo.MAT4,1),new Ps("cc_matLightViewProj",Zo.MAT4,1),new Ps("cc_shadowColor",Zo.FLOAT4,1),new Ps("cc_shadowInfo",Zo.FLOAT4,1)],1),Zl.layouts[cu.NAME]=cu.LAYOUT,Zl.bindings[cu.BINDING]=cu.DESCRIPTOR;var lu=Ql.SAMPLER_SHADOWMAP,uu=new qs(lu,ya.SAMPLER,1,ga.FRAGMENT),hu=new Ds(nu.GLOBAL,lu,"cc_shadowMap",Zo.SAMPLER2D,1);Zl.layouts.cc_shadowMap=hu,Zl.bindings[lu]=uu;var _u=Ql.SAMPLER_ENVIRONMENT,fu=new qs(_u,ya.SAMPLER,1,ga.FRAGMENT),mu=new Ds(nu.GLOBAL,_u,"cc_environment",Zo.SAMPLER_CUBE,1);Zl.layouts.cc_environment=mu,Zl.bindings[_u]=fu;var du=Ql.SAMPLER_SPOT_LIGHTING_MAP,pu=new qs(du,ya.SAMPLER,1,ga.FRAGMENT),vu=new Ds(nu.GLOBAL,du,"cc_spotLightingMap",Zo.SAMPLER2D,1);Zl.layouts.cc_spotLightingMap=vu,Zl.bindings[du]=pu;var gu=e("cx",(function(){}));gu.MAT_WORLD_OFFSET=0,gu.MAT_WORLD_IT_OFFSET=gu.MAT_WORLD_OFFSET+16,gu.LIGHTINGMAP_UVPARAM=gu.MAT_WORLD_IT_OFFSET+16,gu.COUNT=gu.LIGHTINGMAP_UVPARAM+4,gu.SIZE=4*gu.COUNT,gu.NAME="CCLocal",gu.BINDING=$l.UBO_LOCAL,gu.DESCRIPTOR=new qs(gu.BINDING,ya.UNIFORM_BUFFER,1,ga.VERTEX),gu.LAYOUT=new Ms(nu.LOCAL,gu.BINDING,gu.NAME,[new Ps("cc_matWorld",Zo.MAT4,1),new Ps("cc_matWorldIT",Zo.MAT4,1),new Ps("cc_lightingMapUVParam",Zo.FLOAT4,1)],1),Jl.layouts[gu.NAME]=gu.LAYOUT,Jl.bindings[gu.BINDING]=gu.DESCRIPTOR;var yu=function(){};yu.BATCHING_COUNT=10,yu.MAT_WORLDS_OFFSET=0,yu.SIZE=4*(yu.COUNT=16*yu.BATCHING_COUNT),yu.NAME="CCLocalBatched",yu.BINDING=$l.UBO_LOCAL,yu.DESCRIPTOR=new qs(yu.BINDING,ya.UNIFORM_BUFFER,1,ga.VERTEX),yu.LAYOUT=new Ms(nu.LOCAL,yu.BINDING,yu.NAME,[new Ps("cc_matWorlds",Zo.MAT4,yu.BATCHING_COUNT)],1),Jl.layouts[yu.NAME]=yu.LAYOUT,Jl.bindings[yu.BINDING]=yu.DESCRIPTOR;var xu=function(){};xu.LIGHTS_PER_PASS=1,xu.SIZE=4*(xu.COUNT=(xu.LIGHT_DIR_OFFSET=(xu.LIGHT_SIZE_RANGE_ANGLE_OFFSET=(xu.LIGHT_COLOR_OFFSET=(xu.LIGHT_POS_OFFSET=0)+4*xu.LIGHTS_PER_PASS)+4*xu.LIGHTS_PER_PASS)+4*xu.LIGHTS_PER_PASS)+4*xu.LIGHTS_PER_PASS),xu.NAME="CCForwardLight",xu.BINDING=$l.UBO_FORWARD_LIGHTS,xu.DESCRIPTOR=new qs(xu.BINDING,ya.DYNAMIC_UNIFORM_BUFFER,1,ga.FRAGMENT),xu.LAYOUT=new Ms(nu.LOCAL,xu.BINDING,xu.NAME,[new Ps("cc_lightPos",Zo.FLOAT4,xu.LIGHTS_PER_PASS),new Ps("cc_lightColor",Zo.FLOAT4,xu.LIGHTS_PER_PASS),new Ps("cc_lightSizeRangeAngle",Zo.FLOAT4,xu.LIGHTS_PER_PASS),new Ps("cc_lightDir",Zo.FLOAT4,xu.LIGHTS_PER_PASS)],1),Jl.layouts[xu.NAME]=xu.LAYOUT,Jl.bindings[xu.BINDING]=xu.DESCRIPTOR;var Eu=e("bG",(function(){}));Eu.JOINTS_TEXTURE_INFO_OFFSET=0,Eu.COUNT=Eu.JOINTS_TEXTURE_INFO_OFFSET+4,Eu.SIZE=4*Eu.COUNT,Eu.NAME="CCSkinningTexture",Eu.BINDING=$l.UBO_SKINNING_TEXTURE,Eu.DESCRIPTOR=new qs(Eu.BINDING,ya.UNIFORM_BUFFER,1,ga.VERTEX),Eu.LAYOUT=new Ms(nu.LOCAL,Eu.BINDING,Eu.NAME,[new Ps("cc_jointTextureInfo",Zo.FLOAT4,1)],1),Jl.layouts[Eu.NAME]=Eu.LAYOUT,Jl.bindings[Eu.BINDING]=Eu.DESCRIPTOR;var Su=e("by",(function(){}));Su.JOINTS_ANIM_INFO_OFFSET=0,Su.COUNT=Su.JOINTS_ANIM_INFO_OFFSET+4,Su.SIZE=4*Su.COUNT,Su.NAME="CCSkinningAnimation",Su.BINDING=$l.UBO_SKINNING_ANIMATION,Su.DESCRIPTOR=new qs(Su.BINDING,ya.UNIFORM_BUFFER,1,ga.VERTEX),Su.LAYOUT=new Ms(nu.LOCAL,Su.BINDING,Su.NAME,[new Ps("cc_jointAnimInfo",Zo.FLOAT4,1)],1),Jl.layouts[Su.NAME]=Su.LAYOUT,Jl.bindings[Su.BINDING]=Su.DESCRIPTOR;var Tu=e("bI","a_jointAnimInfo"),Au=e("bE",(function(){}));Au.JOINTS_OFFSET=0,Au.COUNT=Au.JOINTS_OFFSET+360,Au.SIZE=4*Au.COUNT,Au.NAME="CCSkinning",Au.BINDING=$l.UBO_SKINNING_TEXTURE,Au.DESCRIPTOR=new qs(Au.BINDING,ya.UNIFORM_BUFFER,1,ga.VERTEX),Au.LAYOUT=new Ms(nu.LOCAL,Au.BINDING,Au.NAME,[new Ps("cc_joints",Zo.FLOAT4,90)],1),Jl.layouts[Au.NAME]=Au.LAYOUT,Jl.bindings[Au.BINDING]=Au.DESCRIPTOR;var Cu=e("aw",(function(){}));Cu.MAX_MORPH_TARGET_COUNT=60,Cu.OFFSET_OF_WEIGHTS=0,Cu.OFFSET_OF_DISPLACEMENT_TEXTURE_WIDTH=4*Cu.MAX_MORPH_TARGET_COUNT,Cu.OFFSET_OF_DISPLACEMENT_TEXTURE_HEIGHT=Cu.OFFSET_OF_DISPLACEMENT_TEXTURE_WIDTH+4,Cu.OFFSET_OF_VERTICES_COUNT=Cu.OFFSET_OF_DISPLACEMENT_TEXTURE_HEIGHT+4,Cu.COUNT_BASE_4_BYTES=4*Math.ceil(Cu.MAX_MORPH_TARGET_COUNT/4)+4,Cu.SIZE=4*Cu.COUNT_BASE_4_BYTES,Cu.NAME="CCMorph",Cu.BINDING=$l.UBO_MORPH,Cu.DESCRIPTOR=new qs(Cu.BINDING,ya.UNIFORM_BUFFER,1,ga.VERTEX),Cu.LAYOUT=new Ms(nu.LOCAL,Cu.BINDING,Cu.NAME,[new Ps("cc_displacementWeights",Zo.FLOAT4,Cu.MAX_MORPH_TARGET_COUNT/4),new Ps("cc_displacementTextureInfo",Zo.FLOAT4,1)],1),Jl.layouts[Cu.NAME]=Cu.LAYOUT,Jl.bindings[Cu.BINDING]=Cu.DESCRIPTOR;var wu=e("bH",$l.SAMPLER_JOINTS),Iu=new qs(wu,ya.SAMPLER,1,ga.VERTEX),bu=new Ds(nu.LOCAL,wu,"cc_jointTexture",Zo.SAMPLER2D,1);Jl.layouts.cc_jointTexture=bu,Jl.bindings[wu]=Iu;var Ru=e("aG",$l.SAMPLER_MORPH_POSITION),Ou=new qs(Ru,ya.SAMPLER,1,ga.VERTEX),Nu=new Ds(nu.LOCAL,Ru,"cc_PositionDisplacements",Zo.SAMPLER2D,1);Jl.layouts.cc_PositionDisplacements=Nu,Jl.bindings[Ru]=Ou;var Pu=e("aF",$l.SAMPLER_MORPH_NORMAL),Mu=new qs(Pu,ya.SAMPLER,1,ga.VERTEX),Du=new Ds(nu.LOCAL,Pu,"cc_NormalDisplacements",Zo.SAMPLER2D,1);Jl.layouts.cc_NormalDisplacements=Du,Jl.bindings[Pu]=Mu;var Lu=e("aE",$l.SAMPLER_MORPH_TANGENT),Fu=new qs(Lu,ya.SAMPLER,1,ga.VERTEX),zu=new Ds(nu.LOCAL,Lu,"cc_TangentDisplacements",Zo.SAMPLER2D,1);Jl.layouts.cc_TangentDisplacements=zu,Jl.bindings[Lu]=Fu;var Bu=$l.SAMPLER_LIGHTMAP,Uu=new qs(Bu,ya.SAMPLER,1,ga.FRAGMENT),Gu=new Ds(nu.LOCAL,Bu,"cc_lightingMap",Zo.SAMPLER2D,1);Jl.layouts.cc_lightingMap=Gu,Jl.bindings[Bu]=Uu;var Hu=$l.SAMPLER_SPRITE,ku=new qs(Hu,ya.SAMPLER,1,ga.FRAGMENT),Vu=new Ds(nu.LOCAL,Hu,"cc_spriteTexture",Zo.SAMPLER2D,1);Jl.layouts.cc_spriteTexture=Vu,Jl.bindings[Hu]=ku;var ju,Wu,qu,Yu,Xu,Ku=Kl.makeMaskExclude([Kl.BitMask.UI_2D,Kl.BitMask.GIZMOS,Kl.BitMask.EDITOR,Kl.BitMask.SCENE_GIZMO,Kl.BitMask.PROFILER]),Qu=Kl.makeMaskExclude([Kl.BitMask.UI_2D,Kl.BitMask.PROFILER]),Zu=Kl.Enum.ALL;e("fb",Object.freeze({__proto__:null,PIPELINE_FLOW_FORWARD:"ForwardFlow",PIPELINE_FLOW_SHADOW:"ShadowFlow",PIPELINE_FLOW_SMAA:"SMAAFlow",PIPELINE_FLOW_TONEMAP:"ToneMapFlow",get RenderPassStage(){return ql},get RenderPriority(){return Yl},globalDescriptorSetLayout:Zl,localDescriptorSetLayout:Jl,get PipelineGlobalBindings(){return Ql},get ModelLocalBindings(){return $l},get SetIndex(){return nu},bindingMappingInfo:ou,UBOGlobal:au,UBOCamera:su,UBOShadow:cu,UNIFORM_SHADOWMAP_BINDING:lu,UNIFORM_ENVIRONMENT_BINDING:_u,UNIFORM_SPOT_LIGHTING_MAP_TEXTURE_BINDING:du,UBOLocal:gu,INST_MAT_WORLD:"a_matWorld0",UBOLocalBatched:yu,UBOForwardLight:xu,JOINT_UNIFORM_CAPACITY:30,UBOSkinningTexture:Eu,UBOSkinningAnimation:Su,INST_JOINT_ANIM_INFO:Tu,UBOSkinning:Au,UBOMorph:Cu,UNIFORM_JOINT_TEXTURE_BINDING:wu,UNIFORM_POSITION_MORPH_TEXTURE_BINDING:Ru,UNIFORM_NORMAL_MORPH_TEXTURE_BINDING:Pu,UNIFORM_TANGENT_MORPH_TEXTURE_BINDING:Lu,UNIFORM_LIGHTMAP_TEXTURE_BINDING:Bu,UNIFORM_SPRITE_TEXTURE_BINDING:Hu,CAMERA_DEFAULT_MASK:Ku,CAMERA_EDITOR_MASK:Qu,MODEL_ALWAYS_MASK:Zu})),function(e){e[e.VERTICAL=0]="VERTICAL",e[e.HORIZONTAL=1]="HORIZONTAL"}(ju||(ju={})),function(e){e[e.ORTHO=0]="ORTHO",e[e.PERSPECTIVE=1]="PERSPECTIVE"}(Wu||(Wu={})),function(e){e[e.F1_8=0]="F1_8",e[e.F2_0=1]="F2_0",e[e.F2_2=2]="F2_2",e[e.F2_5=3]="F2_5",e[e.F2_8=4]="F2_8",e[e.F3_2=5]="F3_2",e[e.F3_5=6]="F3_5",e[e.F4_0=7]="F4_0",e[e.F4_5=8]="F4_5",e[e.F5_0=9]="F5_0",e[e.F5_6=10]="F5_6",e[e.F6_3=11]="F6_3",e[e.F7_1=12]="F7_1",e[e.F8_0=13]="F8_0",e[e.F9_0=14]="F9_0",e[e.F10_0=15]="F10_0",e[e.F11_0=16]="F11_0",e[e.F13_0=17]="F13_0",e[e.F14_0=18]="F14_0",e[e.F16_0=19]="F16_0",e[e.F18_0=20]="F18_0",e[e.F20_0=21]="F20_0",e[e.F22_0=22]="F22_0"}(qu||(qu={})),function(e){e[e.ISO100=0]="ISO100",e[e.ISO200=1]="ISO200",e[e.ISO400=2]="ISO400",e[e.ISO800=3]="ISO800"}(Yu||(Yu={})),function(e){e[e.D1=0]="D1",e[e.D2=1]="D2",e[e.D4=2]="D4",e[e.D8=3]="D8",e[e.D15=4]="D15",e[e.D30=5]="D30",e[e.D60=6]="D60",e[e.D125=7]="D125",e[e.D250=8]="D250",e[e.D500=9]="D500",e[e.D1000=10]="D1000",e[e.D2000=11]="D2000",e[e.D4000=12]="D4000"}(Xu||(Xu={}));var Ju,$u,eh=[1.8,2,2.2,2.5,2.8,3.2,3.5,4,4.5,5,5.6,6.3,7.1,8,9,10,11,13,14,16,18,20,22],th=[1,.5,1/4,1/8,1/15,1/30,1/60,.008,.004,.002,.001,5e-4,1/4e3],nh=[100,200,400,800],ih=new Un,rh=new Un,oh=new ei,ah=ba.STENCIL<<1,sh=[],ch=function(){function e(e){if(this.isWindowSize=!0,this.screenScale=void 0,this._device=void 0,this._scene=null,this._node=null,this._name=null,this._enabled=!1,this._proj=-1,this._aspect=void 0,this._orthoHeight=10,this._fovAxis=ju.VERTICAL,this._fov=Tn(45),this._nearClip=1,this._farClip=1e3,this._clearColor=new ls(.2,.2,.2,1),this._viewport=new fi(0,0,1,1),this._curTransform=Na.IDENTITY,this._isProjDirty=!0,this._matView=new ei,this._matViewInv=null,this._matProj=new ei,this._matProjInv=new ei,this._matViewProj=new ei,this._matViewProjInv=new ei,this._frustum=new bl,this._forward=new Un,this._position=new Un,this._priority=0,this._aperture=qu.F16_0,this._apertureValue=void 0,this._shutter=Xu.D125,this._shutterValue=0,this._iso=Yu.ISO100,this._isoValue=0,this._ec=0,this._poolHandle=Qi,this._frustumHandle=Qi,this._window=null,this._device=e,this._apertureValue=eh[this._aperture],this._shutterValue=th[this._shutter],this._isoValue=nh[this._iso],this._aspect=this.screenScale=1,!sh.length){var t=e.screenSpaceSignY;sh[Na.IDENTITY]=new ei(1,0,0,0,0,t),sh[Na.ROTATE_90]=new ei(0,1,0,0,-t,0),sh[Na.ROTATE_180]=new ei(-1,0,0,0,0,-t),sh[Na.ROTATE_270]=new ei(0,-1,0,0,t,0)}}var t=e.prototype;return t.initialize=function(e){this._name=e.name,this._node=e.node,this._proj=e.projection,this._priority=e.priority||0,this._aspect=this.screenScale=1;var t=this._poolHandle=Nr.alloc();Nr.set(t,wr.WIDTH,1),Nr.set(t,wr.HEIGHT,1),Nr.set(t,wr.CLEAR_FLAG,ba.NONE),Nr.set(t,wr.CLEAR_DEPTH,1),Nr.set(t,wr.NODE,this._node.handle),Nr.set(t,wr.VISIBILITY,Ku),this._scene&&Nr.set(t,wr.SCENE,this._scene.handle),this.updateExposure(),this.changeTargetWindow(e.window),console.log("Created Camera: "+this._name+" "+Nr.get(t,wr.WIDTH)+"x"+Nr.get(t,wr.HEIGHT))},t.destroy=function(){this._window&&this._window.detachCamera(this),this._name=null,this._poolHandle&&(Nr.free(this._poolHandle),this._poolHandle=Qi,this._frustumHandle&&(Vr.free(this._frustumHandle),this._frustumHandle=Qi))},t.attachToScene=function(e){this._scene=e,this._enabled=!0,Nr.set(this._poolHandle,wr.SCENE,e.handle)},t.detachFromScene=function(){this._scene=null,this._enabled=!1,Nr.set(this._poolHandle,wr.SCENE,0)},t.resize=function(e,t){var n=this._poolHandle;Nr.set(n,wr.WIDTH,e),Nr.set(n,wr.HEIGHT,t),this._aspect=e*this._viewport.width/(t*this._viewport.height),this._isProjDirty=!0},t.setFixedSize=function(e,t){var n=this._poolHandle;Nr.set(n,wr.WIDTH,e),Nr.set(n,wr.HEIGHT,t),this._aspect=e*this._viewport.width/(t*this._viewport.height),this.isWindowSize=!1},t.update=function(e){if(void 0===e&&(e=!1),this._node){var t=!1;(this._node.hasChangedFlags||e)&&(ei.invert(this._matView,this._node.worldMatrix),Nr.setMat4(this._poolHandle,wr.MAT_VIEW,this._matView),this._forward.x=-this._matView.m02,this._forward.y=-this._matView.m06,this._forward.z=-this._matView.m10,this._node.getWorldPosition(this._position),Nr.setVec3(this._poolHandle,wr.POSITION,this._position),Nr.setVec3(this._poolHandle,wr.FORWARD,this._forward),t=!0);var n=this._device.surfaceTransform;if(this._isProjDirty||this._curTransform!==n){this._curTransform=n;var i=this._device.screenSpaceSignY;if(this._window&&this._window.hasOffScreenAttachments&&(i*=this._device.UVSpaceSignY,n=Na.IDENTITY),this._proj===Wu.PERSPECTIVE)ei.perspective(this._matProj,this._fov,this._aspect,this._nearClip,this._farClip,this._fovAxis===ju.VERTICAL,this._device.clipSpaceMinZ,i,n);else{var r=this._orthoHeight*this._aspect,o=this._orthoHeight;ei.ortho(this._matProj,-r,r,-o,o,this._nearClip,this._farClip,this._device.clipSpaceMinZ,i,n)}ei.invert(this._matProjInv,this._matProj),Nr.setMat4(this._poolHandle,wr.MAT_PROJ,this._matProj),Nr.setMat4(this._poolHandle,wr.MAT_PROJ_INV,this._matProjInv),t=!0,this._isProjDirty=!1}t&&(ei.multiply(this._matViewProj,this._matProj,this._matView),ei.invert(this._matViewProjInv,this._matViewProj),this._frustum.update(this._matViewProj,this._matViewProjInv),Nr.setMat4(this._poolHandle,wr.MAT_VIEW_PROJ,this._matViewProj),Nr.setMat4(this._poolHandle,wr.MAT_VIEW_PROJ_INV,this._matViewProjInv),Rl(this._frustumHandle,this._frustum))}},t.changeTargetWindow=function(e){void 0===e&&(e=null),this._window&&this._window.detachCamera(this);var t=e||c.director.root.mainWindow;t&&(t.attachCamera(this),this.resize(t.width,t.height),this._window=t,Nr.set(this._poolHandle,wr.WINDOW,t.handle))},t.detachCamera=function(){this._window&&this._window.detachCamera(this)},t.screenPointToRay=function(e,t,n){if(!this._node)return null;var i=this._poolHandle,r=Nr.get(i,wr.WIDTH),o=Nr.get(i,wr.HEIGHT),a=this._viewport.x*r,s=this._viewport.y*o,c=this._viewport.width*r,l=this._viewport.height*o,u=this._proj===Wu.PERSPECTIVE,h=this._device.screenSpaceSignY,_=$n[this._curTransform];Un.set(ih,(t-a)/c*2-1,(n-s)/l*2-1,u?1:-1);var f=ih.x,m=ih.y;return ih.x=f*_[0]+m*_[2]*h,ih.y=f*_[1]+m*_[3]*h,Un.transformMat4(u?ih:e.o,ih,this._matViewProjInv),u?(this._node.getWorldPosition(rh),Go.fromPoints(e,rh,ih)):Un.transformQuat(e.d,Un.FORWARD,this._node.worldRotation),e},t.screenToWorld=function(e,t){var n=this._poolHandle,i=Nr.get(n,wr.WIDTH),r=Nr.get(n,wr.HEIGHT),o=this._viewport.x*i,a=this._viewport.y*r,s=this._viewport.width*i,c=this._viewport.height*r,l=this._device.screenSpaceSignY,u=$n[this._curTransform];if(this._proj===Wu.PERSPECTIVE){Un.set(e,(t.x-o)/s*2-1,(t.y-a)/c*2-1,1);var h=e.x,_=e.y;e.x=h*u[0]+_*u[2]*l,e.y=h*u[1]+_*u[3]*l,Un.transformMat4(e,e,this._matViewProjInv),this._node&&this._node.getWorldPosition(ih),Un.lerp(e,ih,e,Sn(this._nearClip/this._farClip,1,t.z))}else{Un.set(e,(t.x-o)/s*2-1,(t.y-a)/c*2-1,2*t.z-1);var f=e.x,m=e.y;e.x=f*u[0]+m*u[2]*l,e.y=f*u[1]+m*u[3]*l,Un.transformMat4(e,e,this._matViewProjInv)}return e},t.worldToScreen=function(e,t){var n=this._poolHandle,i=Nr.get(n,wr.WIDTH),r=Nr.get(n,wr.HEIGHT),o=this._viewport.x*i,a=this._viewport.y*r,s=this._viewport.width*i,c=this._viewport.height*r,l=this._device.screenSpaceSignY,u=$n[this._curTransform];Un.transformMat4(e,t,this._matViewProj);var h=e.x,_=e.y;return e.x=h*u[0]+_*u[2]*l,e.y=h*u[1]+_*u[3]*l,e.x=o+.5*(e.x+1)*s,e.y=a+.5*(e.y+1)*c,e.z=.5*e.z+.5,e},t.worldMatrixToScreen=function(e,t,n,i){ei.multiply(e,this._matViewProj,t),ei.multiply(e,sh[this._curTransform],e);var r=n/2,o=i/2;return ei.identity(oh),ei.transform(oh,oh,Un.set(ih,r,o,0)),ei.scale(oh,oh,Un.set(ih,r,o,1)),ei.multiply(e,oh,e),e},t.updateExposure=function(){var e=Math.log2(this._apertureValue*this._apertureValue/this._shutterValue*100/this._isoValue);Nr.set(this._poolHandle,wr.EXPOSURE,.833333/Math.pow(2,e))},Z(e,[{key:"node",set:function(e){this._node=e},get:function(){return this._node}},{key:"enabled",set:function(e){this._enabled=e},get:function(){return this._enabled}},{key:"orthoHeight",set:function(e){this._orthoHeight=e,this._isProjDirty=!0},get:function(){return this._orthoHeight}},{key:"projectionType",set:function(e){this._proj=e,this._isProjDirty=!0},get:function(){return this._proj}},{key:"fovAxis",set:function(e){this._fovAxis=e,this._isProjDirty=!0},get:function(){return this._fovAxis}},{key:"fov",set:function(e){this._fov=e,this._isProjDirty=!0},get:function(){return this._fov}},{key:"nearClip",set:function(e){this._nearClip=e,this._isProjDirty=!0},get:function(){return this._nearClip}},{key:"farClip",set:function(e){this._farClip=e,this._isProjDirty=!0},get:function(){return this._farClip}},{key:"clearColor",set:function(e){this._clearColor.x=e.x,this._clearColor.y=e.y,this._clearColor.z=e.z,this._clearColor.w=e.w,Nr.setVec4(this._poolHandle,wr.CLEAR_COLOR,e)},get:function(){return this._clearColor}},{key:"viewport",get:function(){return this._viewport},set:function(e){var t=e.x,n=e.width,i=e.height,r=this._device.screenSpaceSignY<0?1-e.y-i:e.y;switch(this._device.surfaceTransform){case Na.ROTATE_90:this._viewport.x=1-r-i,this._viewport.y=t,this._viewport.width=i,this._viewport.height=n;break;case Na.ROTATE_180:this._viewport.x=1-t-n,this._viewport.y=1-r-i,this._viewport.width=n,this._viewport.height=i;break;case Na.ROTATE_270:this._viewport.x=r,this._viewport.y=1-t-n,this._viewport.width=i,this._viewport.height=n;break;case Na.IDENTITY:this._viewport.x=t,this._viewport.y=r,this._viewport.width=n,this._viewport.height=i}Nr.setVec4(this._poolHandle,wr.VIEW_PORT,this._viewport),this.resize(this.width,this.height)}},{key:"scene",get:function(){return this._scene}},{key:"name",get:function(){return this._name}},{key:"width",get:function(){return Nr.get(this._poolHandle,wr.WIDTH)}},{key:"height",get:function(){return Nr.get(this._poolHandle,wr.HEIGHT)}},{key:"aspect",get:function(){return this._aspect}},{key:"matView",set:function(e){this._matView=e,Nr.setMat4(this._poolHandle,wr.MAT_VIEW,this._matView)},get:function(){return this._matView}},{key:"matViewInv",set:function(e){this._matViewInv=e},get:function(){return this._matViewInv||this._node.worldMatrix}},{key:"matProj",set:function(e){this._matProj=e,Nr.setMat4(this._poolHandle,wr.MAT_PROJ,this._matProj)},get:function(){return this._matProj}},{key:"matProjInv",set:function(e){this._matProjInv=e,Nr.setMat4(this._poolHandle,wr.MAT_PROJ_INV,this._matProjInv)},get:function(){return this._matProjInv}},{key:"matViewProj",set:function(e){this._matViewProj=e,Nr.setMat4(this._poolHandle,wr.MAT_VIEW_PROJ,this._matViewProj)},get:function(){return this._matViewProj}},{key:"matViewProjInv",set:function(e){this._matViewProjInv=e,Nr.setMat4(this._poolHandle,wr.MAT_VIEW_PROJ_INV,this._matViewProjInv)},get:function(){return this._matViewProjInv}},{key:"frustum",set:function(e){this._frustum=e,Rl(this._frustumHandle,e)},get:function(){return this._frustum}},{key:"window",set:function(e){this._window=e,e&&Nr.set(this._poolHandle,wr.WINDOW,e.handle)},get:function(){return this._window}},{key:"forward",set:function(e){this._forward=e,Nr.setVec3(this._poolHandle,wr.FORWARD,this._forward)},get:function(){return this._forward}},{key:"position",set:function(e){this._position=e,Nr.setVec3(this._poolHandle,wr.POSITION,this._position)},get:function(){return this._position}},{key:"visibility",set:function(e){Nr.set(this._poolHandle,wr.VISIBILITY,e)},get:function(){return Nr.get(this._poolHandle,wr.VISIBILITY)}},{key:"priority",get:function(){return this._priority},set:function(e){this._priority=e}},{key:"aperture",set:function(e){this._aperture=e,this._apertureValue=eh[this._aperture],this.updateExposure()},get:function(){return this._aperture}},{key:"apertureValue",get:function(){return this._apertureValue}},{key:"shutter",set:function(e){this._shutter=e,this._shutterValue=th[this._shutter],this.updateExposure()},get:function(){return this._shutter}},{key:"shutterValue",get:function(){return this._shutterValue}},{key:"iso",set:function(e){this._iso=e,this._isoValue=nh[this._iso],this.updateExposure()},get:function(){return this._iso}},{key:"isoValue",get:function(){return this._isoValue}},{key:"ec",set:function(e){this._ec=e},get:function(){return this._ec}},{key:"exposure",get:function(){return Nr.get(this._poolHandle,wr.EXPOSURE)}},{key:"clearFlag",get:function(){return Nr.get(this._poolHandle,wr.CLEAR_FLAG)},set:function(e){Nr.set(this._poolHandle,wr.CLEAR_FLAG,e)}},{key:"clearDepth",get:function(){return Nr.get(this._poolHandle,wr.CLEAR_DEPTH)},set:function(e){Nr.set(this._poolHandle,wr.CLEAR_DEPTH,e)}},{key:"clearStencil",get:function(){return Nr.get(this._poolHandle,wr.CLEAR_STENCIL)},set:function(e){Nr.set(this._poolHandle,wr.CLEAR_STENCIL,e)}},{key:"handle",get:function(){return this._poolHandle}}]),e}();!function(e){e[e.LOCAL=0]="LOCAL",e[e.WORLD=1]="WORLD"}(Ju||(Ju={})),function(e){e[e.NONE=0]="NONE",e[e.POSITION=1]="POSITION",e[e.ROTATION=2]="ROTATION",e[e.SCALE=4]="SCALE",e[e.RS=e.ROTATION|e.SCALE]="RS",e[e.TRS=e.POSITION|e.ROTATION|e.SCALE]="TRS",e[e.TRS_MASK=~e.TRS]="TRS_MASK"}($u||($u=e("b2",{}))),c.internal.TransformBit=$u;var lh=function(){function e(e){this._root=void 0,this._name="",this._cameras=[],this._models=[],this._batches=[],this._directionalLights=[],this._sphereLights=[],this._spotLights=[],this._mainLight=null,this._modelId=0,this._scenePoolHandle=Qi,this._modelArrayHandle=Qi,this._batchArrayHandle=Qi,this._sphereLightsHandle=Qi,this._spotLightsHandle=Qi,this._root=e,this._createHandles()}e.registerCreateFunc=function(t){t._createSceneFun=function(t){return new e(t)}},Z(e,[{key:"root",get:function(){return this._root}},{key:"name",get:function(){return this._name}},{key:"cameras",get:function(){return this._cameras}},{key:"mainLight",get:function(){return this._mainLight}},{key:"sphereLights",get:function(){return this._sphereLights}},{key:"spotLights",get:function(){return this._spotLights}},{key:"models",get:function(){return this._models}},{key:"handle",get:function(){return this._scenePoolHandle}},{key:"batches",get:function(){return this._batches}}]);var t=e.prototype;return t.initialize=function(e){return this._name=e.name,this._createHandles(),!0},t.update=function(e){var t=this._mainLight;t&&t.update();for(var n=this._sphereLights,i=0;i<n.length;i++)n[i].update();for(var r=this._spotLights,o=0;o<r.length;o++)r[o].update();for(var a=this._models,s=0;s<a.length;s++){var c=a[s];c.enabled&&(c.updateTransform(e),c.updateUBOs(e))}},t.destroy=function(){this.removeCameras(),this.removeSphereLights(),this.removeSpotLights(),this.removeModels(),this._modelArrayHandle&&(ir.free(this._modelArrayHandle),this._modelArrayHandle=Qi),this._scenePoolHandle&&(br.free(this._scenePoolHandle),this._scenePoolHandle=Qi),this._sphereLightsHandle&&(ar.free(this._sphereLightsHandle),this._sphereLightsHandle=Qi),this._spotLightsHandle&&(ar.free(this._spotLightsHandle),this._spotLightsHandle=Qi),this._batchArrayHandle&&(cr.free(this._batchArrayHandle),this._batchArrayHandle=Qi)},t.addCamera=function(e){e.attachToScene(this),this._cameras.push(e)},t.removeCamera=function(e){for(var t=0;t<this._cameras.length;++t)if(this._cameras[t]===e)return this._cameras.splice(t,1),void e.detachFromScene()},t.removeCameras=function(){for(var e,t=oe(this._cameras);!(e=t()).done;)e.value.detachFromScene();this._cameras.splice(0)},t.setMainLight=function(e){this._mainLight=e,br.set(this._scenePoolHandle,Tr.MAIN_LIGHT,e.handle)},t.unsetMainLight=function(e){if(this._mainLight===e){var t=this._directionalLights;t.length?(this._mainLight=t[t.length-1],this._mainLight.node&&(this._mainLight.node.hasChangedFlags|=$u.ROTATION)):this._mainLight=null}},t.addDirectionalLight=function(e){e.attachToScene(this),this._directionalLights.push(e)},t.removeDirectionalLight=function(e){for(var t=0;t<this._directionalLights.length;++t)if(this._directionalLights[t]===e)return e.detachFromScene(),void this._directionalLights.splice(t,1)},t.addSphereLight=function(e){e.attachToScene(this),this._sphereLights.push(e),ar.push(this._sphereLightsHandle,e.handle)},t.removeSphereLight=function(e){for(var t=0;t<this._sphereLights.length;++t)if(this._sphereLights[t]===e)return e.detachFromScene(),this._sphereLights.splice(t,1),void ar.erase(this._sphereLightsHandle,t)},t.addSpotLight=function(e){e.attachToScene(this),this._spotLights.push(e),ar.push(this._spotLightsHandle,e.handle)},t.removeSpotLight=function(e){for(var t=0;t<this._spotLights.length;++t)if(this._spotLights[t]===e)return e.detachFromScene(),this._spotLights.splice(t,1),void ar.erase(this._spotLightsHandle,t)},t.removeSphereLights=function(){for(var e=0;e<this._sphereLights.length;++e)this._sphereLights[e].detachFromScene();this._sphereLights.length=0,ar.clear(this._sphereLightsHandle)},t.removeSpotLights=function(){for(var e=0;e<this._spotLights.length;++e)this._spotLights[e].detachFromScene();this._spotLights=[],ar.clear(this._spotLightsHandle)},t.addModel=function(e){e.attachToScene(this),this._models.push(e),ir.push(this._modelArrayHandle,e.handle)},t.removeModel=function(e){for(var t=0;t<this._models.length;++t)if(this._models[t]===e)return e.detachFromScene(),this._models.splice(t,1),void ir.erase(this._modelArrayHandle,t)},t.removeModels=function(){for(var e,t=oe(this._models);!(e=t()).done;){var n=e.value;n.detachFromScene(),n.destroy()}this._models.length=0,ir.clear(this._modelArrayHandle)},t.addBatch=function(e){this._batches.push(e),cr.push(this._batchArrayHandle,e.handle)},t.removeBatch=function(e){for(var t=0;t<this._batches.length;++t)if(this._batches[t]===e)return this._batches.splice(t,1),void cr.erase(this._batchArrayHandle,t)},t.removeBatches=function(){this._batches.length=0,cr.clear(this._batchArrayHandle)},t.onGlobalPipelineStateChanged=function(){for(var e,t=oe(this._models);!(e=t()).done;)e.value.onGlobalPipelineStateChanged()},t.generateModelId=function(){return this._modelId++},t._createHandles=function(){this._modelArrayHandle||(this._modelArrayHandle=ir.alloc(),this._scenePoolHandle=br.alloc(),br.set(this._scenePoolHandle,Tr.MODEL_ARRAY,this._modelArrayHandle),this._spotLightsHandle=ar.alloc(),br.set(this._scenePoolHandle,Tr.SPOT_LIGHT_ARRAY,this._spotLightsHandle),this._sphereLightsHandle=ar.alloc(),br.set(this._scenePoolHandle,Tr.SPHERE_LIGHT_ARRAY,this._sphereLightsHandle)),this._batchArrayHandle||(this._batchArrayHandle=cr.alloc(),br.set(this._scenePoolHandle,Tr.BATCH_ARRAY_2D,this._batchArrayHandle))},e}(),uh=function(){},hh=function(){return uh},_h=fh((function(){}));function fh(e){return function(t){return"function"==typeof t?e(t):function(n){return e(n,t)}}}function mh(e){return function(t){return function(n){!function(e,t,n){var i=dh(e);if(i){var r=ph(i,"proto");ph(r,"editor")[t]=n}}(n,e,t)}}}function dh(e){return ph(e,"__ccclassCache__")}function ph(e,t){return e[t]||(e[t]={})}var vh=e("aI",fh((function(e,t){var n=gt.getSuper(e);n===Object&&(n=null);var i={name:t,extends:n,ctor:e},r=e.__ccclassCache__;if(r){var o=r.proto;o&&gt.mixin(i,o),e.__ccclassCache__=void 0}return _n(i)}))),gh=e("c6",mh("requireComponent")),yh=e("b8",mh("executionOrder")),xh=e("b_",_h);function Eh(e,t,n){var i=null;function r(e,t,n){var r=dh(e.constructor);if(r){var o=ph(r,"proto"),a=ph(o,"properties");!function(e,t,n,i,r,o){var a,s=r&&(r.get||r.set);i&&(a=nn(i,s));var c=t[n],l=gt.mixin(c||{},a||i||{});if(s)r.get&&(l.get=r.get),r.set&&(l.set=r.set);else if(r)r.initializer&&(l.default=function(e){var t;try{t=e()}catch(t){return e}return"object"!=typeof t||null===t?t:e}(r.initializer));else{var u=o.default||(o.default=function(e){var t;try{t=new e}catch(e){return{}}return t}(e));u.hasOwnProperty(n)&&(l.default=u[n])}t[n]=l}(e.constructor,a,t,i,n,r)}}return void 0===e?Eh({type:void 0}):void 0===t?(i=e,r):void r(e,t,n)}var Sh=e("aT",(function(e,t,n){return Eh(Ah({}))(e,t,n)})),Th=e("cQ",(function(e,t,n){return Eh({editorOnly:!0})(e,t,n)}));function Ah(e){return e.__noImplicit=!0,"serializable"in e||(e.serializable=!0),e}var Ch=e("b1",_h),wh=e("b9",hh),Ih=e("dm",_h),bh=hh,Rh=hh,Oh=e("b7",hh),Nh=e("a$",uh),Ph=e("bb",hh),Mh=(e("da",uh),e("c7",hh)),Dh=e("ba",hh),Lh=e("bl",hh),Fh=e("cF",hh),zh=e("cG",hh),Bh=hh,Uh=e("bk",uh),Gh=e("c0",hh),Hh=(e("bo",hh),e("d2",uh),e("c8",uh),e("b5",uh)),kh=qh(qt),Vh=qh(Yt),jh=qh(Xt),Wh=e("bU",qh(Kt));function qh(e){return Eh({type:e})}var Yh=e("bN",(function(e,t,n){return Eh({__noImplicit:!0,override:!0})(e,t,n)})),Xh=function(){function e(e){this._map=null,this._count=0,e?(this._map=e,this._count=Object.keys(e).length):(this._map=gt.createMap(!0),this._count=0)}var t=e.prototype;return t.add=function(e,t){return e in this._map||this._count++,this._map[e]=t},t.get=function(e){return this._map[e]},t.has=function(e){return e in this._map},t.remove=function(e){var t=this._map[e];return e in this._map&&(delete this._map[e],this._count--),t},t.clear=function(){0!==this._count&&(this._map=gt.createMap(!0),this._count=0)},t.forEach=function(e){for(var t in this._map)e(this._map[t],t)},t.find=function(e){for(var t in this._map)if(e(this._map[t],t))return this._map[t];return null},t.destroy=function(){this._map=null},Z(e,[{key:"count",get:function(){return this._count}}]),e}(),Kh=function(){function e(t,n){this.id=e._pipelineId++,this.name="",this.pipes=[],this.name=t;for(var i=0,r=n.length;i<r;i++)this.pipes.push(n[i])}var t=e.prototype;return t.insert=function(e,t){return t>this.pipes.length?(I(4921),this):(this.pipes.splice(t,0,e),this)},t.append=function(e){return this.pipes.push(e),this},t.remove=function(e){return this.pipes.splice(e,1),this},t.sync=function(e){var t=this.pipes;if(0===t.length)return null;e.isFinish=!1;for(var n=0,i=t.length;n<i;){var r=(0,t[n])(e);if(r)return e.isFinish=!0,r;++n!==i&&(e.input=e.output,e.output=null)}return e.isFinish=!0,e.output},t.async=function(e){0!==this.pipes.length&&(e.isFinish=!1,this._flow(0,e))},t._flow=function(e,t){var n=this;(0,this.pipes[e])(t,(function(i){i?(t.isFinish=!0,t.dispatch("complete",i)):++e<n.pipes.length?(t.input=t.output,t.output=null,n._flow(e,t)):(t.isFinish=!0,t.dispatch("complete",i,t.output))}))},e}();Kh._pipelineId=0;var Qh,Zh=new Xh,Jh=new Xh,$h=new Xh,e_=new Xh,t_=new Kh("normal load",[]),n_=new Kh("fetch",[]),i_=new Kh("transform url",[]);!function(e){e.UUID="uuid",e.PATH="path",e.DIR="dir",e.URL="url",e.SCENE="scene"}(Qh||(Qh={}));var r_,o_={default:{priority:0},preload:{maxConcurrency:6,maxRequestsPerFrame:2,priority:-1},scene:{maxConcurrency:20,maxRequestsPerFrame:20,priority:1},bundle:{maxConcurrency:20,maxRequestsPerFrame:20,priority:2},remote:{maxRetryCount:4}};!function(e){e.RESOURCES="resources",e.MAIN="main",e.START_SCENE="start-scene"}(r_||(r_={}));var a_=function(){function e(t){this.id=e._taskId++,this.onComplete=null,this.onProgress=null,this.onError=null,this.source=null,this.output=null,this.input=null,this.progress=null,this.options=null,this.isFinish=!0,this.set(t)}e.create=function(t){var n;return 0!==e._deadPool.length?(n=e._deadPool.pop()).set(t):n=new e(t),n};var t=e.prototype;return t.set=function(e){void 0===e&&(e=Object.create(null)),this.onComplete=e.onComplete||null,this.onProgress=e.onProgress||null,this.onError=e.onError||null,this.source=this.input=e.input,this.output=null,this.progress=e.progress,this.options=e.options||Object.create(null)},t.dispatch=function(e,t,n,i,r){switch(e){case"complete":this.onComplete&&this.onComplete(t,n);break;case"progress":this.onProgress&&this.onProgress(t,n,i,r);break;case"error":this.onError&&this.onError(t,n,i,r);break;default:var o="on"+e[0].toUpperCase()+e.substr(1);"function"==typeof this[o]&&this[o](t,n,i,r)}},t.recycle=function(){e._deadPool.length!==e.MAX_DEAD_NUM&&(this.onComplete=null,this.onProgress=null,this.onError=null,this.source=this.output=this.input=null,this.progress=null,this.options=null,e._deadPool.push(this))},e}();a_.MAX_DEAD_NUM=500,a_._taskId=0,a_._deadPool=[];var s_="0123456789abcdef".split(""),c_=["","","",""],l_=c_.concat(c_,"-",c_,"-",c_,"-",c_,"-",c_,c_,c_),u_=l_.map((function(e,t){return"-"===e?NaN:t})).filter(isFinite);function h_(e){var t=e.split("@")[0];if(22!==t.length)return e;l_[0]=e[0],l_[1]=e[1];for(var n=2,i=2;n<22;n+=2){var r=Ot[e.charCodeAt(n)],o=Ot[e.charCodeAt(n+1)];l_[u_[i++]]=s_[r>>2],l_[u_[i++]]=s_[(3&r)<<2|o>>4],l_[u_[i++]]=s_[15&o]}return e.replace(t,l_.join(""))}var __=/.*[/\\][0-9a-fA-F]{2}[/\\]([0-9a-fA-F-@]{8,}).*/;function f_(e){var t=__.exec(e);return t?t[1]:""}function m_(e,t){(t=t||Object.create(null)).__isNative__=t.isNative,t.ext=t.nativeExt;var n=e_.find((function(t){return!!t.getAssetInfo(e)}));return n&&(t.bundle=n.name),v_(e,t)}function d_(e){return e&&(e instanceof c.SceneAsset||e instanceof c.Scene)}function p_(e){return e&&(46===e.charCodeAt(0)&&47===e.charCodeAt(1)?e=e.slice(2):47===e.charCodeAt(0)&&(e=e.slice(1))),e}function v_(e,t){var n=a_.create({input:e,options:t}),i=[];try{for(var r,o=oe(i_.sync(n));!(r=o()).done;){var a=r.value,s=a.url;a.recycle(),i.push(s)}}catch(e){for(var c,l=oe(n.output);!(c=l()).done;)c.value.recycle();y(e.message,e.stack)}return n.recycle(),i.length>1?i:i[0]}var g_=Object.freeze({__proto__:null,getUuidFromURL:f_,getUrlWithUuid:m_,isScene:d_,normalize:p_,transform:v_,decodeUuid:h_}),y_=e("cO",function(){function e(e,t){this.type=void 0,this.bubbles=void 0,this.target=null,this.currentTarget=null,this.eventPhase=0,this.propagationStopped=!1,this.propagationImmediateStopped=!1,this.type=e,this.bubbles=!!t}var t=e.prototype;return t.unuse=function(){this.type=e.NO_TYPE,this.target=null,this.currentTarget=null,this.eventPhase=e.NONE,this.propagationStopped=!1,this.propagationImmediateStopped=!1},t.reuse=function(e,t){this.type=e,this.bubbles=t||!1},t.isStopped=function(){return this.propagationStopped||this.propagationImmediateStopped},t.getCurrentTarget=function(){return this.currentTarget},t.getType=function(){return this.type},e}());y_.NO_TYPE="no_type",y_.TOUCH="touch",y_.MOUSE="mouse",y_.KEYBOARD="keyboard",y_.ACCELERATION="acceleration",y_.NONE=0,y_.CAPTURING_PHASE=1,y_.AT_TARGET=2,y_.BUBBLING_PHASE=3,c.Event=y_;var x_=e("P",function(){function e(e,t){this._ctor=void 0,this._elementsPerBatch=void 0,this._nextAvail=void 0,this._freepool=[],this._ctor=e,this._elementsPerBatch=Math.max(t,1),this._nextAvail=this._elementsPerBatch-1;for(var n=0;n<this._elementsPerBatch;++n)this._freepool.push(e())}var t=e.prototype;return t.alloc=function(){if(this._nextAvail<0){for(var e=this._elementsPerBatch,t=0;t<e;t++)this._freepool.push(this._ctor());this._nextAvail=e-1}var n=this._freepool[this._nextAvail--];return this._freepool.length--,n},t.free=function(e){this._freepool.push(e),this._nextAvail++},t.freeArray=function(e){Array.prototype.push.apply(this._freepool,e),this._nextAvail+=e.length},t.destroy=function(e){if(e)for(var t=0;t<=this._nextAvail;t++)e(this._freepool[t]);this._freepool.length=0,this._nextAvail=-1},e}()),E_=e("R",function(){function e(e,t){this._fn=void 0,this._count=0,this._data=void 0,this._fn=e,this._data=new Array(t);for(var n=0;n<t;++n)this._data[n]=e()}var t=e.prototype;return t.reset=function(){this._count=0},t.resize=function(e){if(e>this._data.length)for(var t=this._data.length;t<e;++t)this._data[t]=this._fn()},t.add=function(){return this._count>=this._data.length&&this.resize(2*this._data.length),this._data[this._count++]},t.removeAt=function(e){if(!(e>=this._count)){var t=this._count-1,n=this._data[e];this._data[e]=this._data[t],this._data[t]=n,this._count-=1}},Z(e,[{key:"length",get:function(){return this._count}},{key:"data",get:function(){return this._data}}]),e}()),S_=e("C",function(){function e(e,t){this.array=void 0,this.length=0,this._compareFn=void 0,this.array=new Array(e),this.length=0,this._compareFn=void 0!==t?t:function(e,t){return e-t}}var t=e.prototype;return t.push=function(e){this.array[this.length++]=e},t.pop=function(){return this.array[--this.length]},t.get=function(e){return this.array[e]},t.clear=function(){this.length=0},t.destroy=function(){this.length=0,this.array.length=0},t.sort=function(){this.array.length=this.length,this.array.sort(this._compareFn)},t.concat=function(e){for(var t=0;t<e.length;++t)this.array[this.length++]=e[t]},t.fastRemove=function(e){if(!(e>=this.length||e<0)){var t=--this.length;this.array[e]=this.array[t]}},t.indexOf=function(e){return this.array.indexOf(e)},e}()),T_=[],A_=e("dh",function(){function e(e){void 0===e&&(e=""),this._objFlags=void 0,this._name=void 0,this._name=e,this._objFlags=0}e._deferredDestroy=function(){for(var e=T_.length,t=0;t<e;++t){var n=T_[t];1&n._objFlags||n._destroyImmediate()}e===T_.length?T_.length=0:T_.splice(0,e)};var t=e.prototype;return t.destroy=function(){return 1&this._objFlags?(I(5e3),!1):!(4&this._objFlags||(this._objFlags|=4,T_.push(this),0))},t._destruct=function(){var e=this.constructor,t=e.__destruct__;t||(t=function(e,t){var n,i=e instanceof c._BaseNode||e instanceof c.Component,r=i?"_id":null,o={};for(n in e)if(e.hasOwnProperty(n)){if(n===r)continue;switch(typeof e[n]){case"string":o[n]="";break;case"object":case"function":o[n]=null}}if(_n._isCCClass(t))for(var a=c.Class.Attr.getClassAttrs(t),s=t.__props__,l=0;l<s.length;l++){var u=(n=s[l])+c.Class.Attr.DELIMETER+"default";if(u in a){if(i&&"_id"===n)continue;switch(typeof a[u]){case"string":o[n]="";break;case"object":case"function":o[n]=null;break;case"undefined":o[n]=void 0}}}var h="";for(n in o){var _;_=_n.IDENTIFIER_RE.test(n)?"o."+n+"=":"o["+_n.escapeForJS(n)+"]=";var f=o[n];""===f&&(f='""'),h+=_+f+";\n"}return Function("o",h)}(this,e),Be(e,"__destruct__",t,!0)),t(this)},t._destroyImmediate=function(){1&this._objFlags?R(5e3):(this._onPreDestroy&&this._onPreDestroy(),this._destruct(),this._objFlags|=1)},Z(e,[{key:"name",get:function(){return this._name},set:function(e){this._name=e}},{key:"isValid",get:function(){return!(1&this._objFlags)}}]),e}()),C_=A_.prototype;function w_(e,t){return"object"==typeof e?!(!e||e._objFlags&(t?5:1)):void 0!==e}C_._deserialize=null,C_._onPreDestroy=null,_n.fastDefine("cc.Object",A_,{_name:"",_objFlags:0}),Be(A_,"Flags",{Destroyed:1,DontSave:8,EditorOnly:16,Dirty:32,DontDestroy:64,PersistentMask:-4192741,Destroying:128,Deactivating:256,LockedInEditor:512,HideInHierarchy:1024,IsPreloadStarted:8192,IsOnLoadStarted:32768,IsOnLoadCalled:16384,IsOnEnableCalled:2048,IsStartCalled:65536,IsEditorOnEnableCalled:4096,IsPositionLocked:1<<21,IsRotationLocked:1<<17,IsScaleLocked:1<<18,IsAnchorLocked:1<<19,IsSizeLocked:1<<20}),c.isValid=w_,c.Object=A_;var I_=vt.fastRemoveAt;function b_(){}var R_=function(){function e(){this.callback=b_,this.target=void 0,this.once=!1}var t=e.prototype;return t.set=function(e,t,n){this.callback=e||b_,this.target=t,this.once=!!n},t.reset=function(){this.target=void 0,this.callback=b_,this.once=!1},t.check=function(){return!(this.target instanceof A_&&!w_(this.target,!0))},e}(),O_=new x_((function(){return new R_}),32),N_=function(){function e(){this.callbackInfos=[],this.isInvoking=!1,this.containCanceled=!1}var t=e.prototype;return t.removeByCallback=function(e){for(var t=0;t<this.callbackInfos.length;++t){var n=this.callbackInfos[t];n&&n.callback===e&&(n.reset(),O_.free(n),I_(this.callbackInfos,t),--t)}},t.removeByTarget=function(e){for(var t=0;t<this.callbackInfos.length;++t){var n=this.callbackInfos[t];n&&n.target===e&&(n.reset(),O_.free(n),I_(this.callbackInfos,t),--t)}},t.cancel=function(e){var t=this.callbackInfos[e];t&&(t.reset(),this.isInvoking?this.callbackInfos[e]=null:I_(this.callbackInfos,e),O_.free(t)),this.containCanceled=!0},t.cancelAll=function(){for(var e=0;e<this.callbackInfos.length;e++){var t=this.callbackInfos[e];t&&(t.reset(),O_.free(t),this.callbackInfos[e]=null)}this.containCanceled=!0},t.purgeCanceled=function(){for(var e=this.callbackInfos.length-1;e>=0;--e)this.callbackInfos[e]||I_(this.callbackInfos,e);this.containCanceled=!1},t.clear=function(){this.cancelAll(),this.callbackInfos.length=0,this.isInvoking=!1,this.containCanceled=!1},e}(),P_=new x_((function(){return new N_}),16),M_=function(){function e(){this._callbackTable=ke(!0)}var t=e.prototype;return t.on=function(e,t,n,i){if(!this.hasEventListener(e,t,n)){var r=this._callbackTable[e];r||(r=this._callbackTable[e]=P_.alloc());var o=O_.alloc();o.set(t,n,i),r.callbackInfos.push(o)}return t},t.hasEventListener=function(e,t,n){var i=this._callbackTable&&this._callbackTable[e];if(!i)return!1;var r=i.callbackInfos;if(!t){if(i.isInvoking){for(var o=0;o<r.length;++o)if(r[o])return!0;return!1}return r.length>0}for(var a=0;a<r.length;++a){var s=r[a];if(s&&s.check()&&s.callback===t&&s.target===n)return!0}return!1},t.removeAll=function(e){if("string"==typeof e){var t=this._callbackTable&&this._callbackTable[e];t&&(t.isInvoking?t.cancelAll():(t.clear(),P_.free(t),delete this._callbackTable[e]))}else if(e)for(var n in this._callbackTable){var i=this._callbackTable[n];if(i.isInvoking)for(var r=i.callbackInfos,o=0;o<r.length;++o){var a=r[o];a&&a.target===e&&i.cancel(o)}else i.removeByTarget(e)}},t.off=function(e,t,n){var i=this._callbackTable&&this._callbackTable[e];if(i){var r=i.callbackInfos;if(t)for(var o=0;o<r.length;++o){var a=r[o];if(a&&a.callback===t&&a.target===n){i.cancel(o);break}}else this.removeAll(e)}},t.emit=function(e,t,n,i,r,o){var a=this._callbackTable&&this._callbackTable[e];if(a){var s=!a.isInvoking;a.isInvoking=!0;for(var c=a.callbackInfos,l=0,u=c.length;l<u;++l){var h=c[l];if(h){var _=h.callback,f=h.target;h.once&&this.off(e,_,f),h.check()?f?_.call(f,t,n,i,r,o):_(t,n,i,r,o):this.off(e,_,f)}}s&&(a.isInvoking=!1,a.containCanceled&&a.purgeCanceled())}},t.clear=function(){for(var e in this._callbackTable){var t=this._callbackTable[e];t&&(t.clear(),P_.free(t),delete this._callbackTable[e])}},e}();function D_(e){for(var t=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this)._callbackTable=ke(!0),t}$(t,e);var n=t.prototype;return n.once=function(e,t,n){return this.on(e,t,n,!0)},n.targetOff=function(e){this.removeAll(e)},t}(e),n=M_.prototype,i=Object.getOwnPropertyNames(n).concat(Object.getOwnPropertySymbols(n)),r=0;r<i.length;++r){var o=i[r];if(!(o in t.prototype)){var a=Object.getOwnPropertyDescriptor(n,o);a&&Object.defineProperty(t.prototype,o,a)}}return t}var L_,F_,z_,B_,U_,G_=e("dC",D_((function(){})));c.EventTarget=G_;var H_=e("aN",vh("cc.Asset")((U_=B_=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this).loaded=!0,ae(t,"_native",z_,ie(t)),t._nativeUrl="",t.__onLoadedInvoked__=!1,t.__nativeDepend__=null,t.__asyncLoadAssets__=!1,t.__depends__=null,t._file=null,t._ref=0,Object.defineProperty(ie(t),"_uuid",{value:"",writable:!0}),t}$(t,e),t.deserialize=function(e){return c.deserialize(e)},Z(t,[{key:"nativeUrl",get:function(){if(!this._nativeUrl){if(!this._native)return"";var e=this._native;if(47===e.charCodeAt(0))return e.slice(1);46===e.charCodeAt(0)?this._nativeUrl=m_(this._uuid,{nativeExt:e,isNative:!0}):this._nativeUrl=m_(this._uuid,{__nativeName__:e,nativeExt:H(e),isNative:!0})}return this._nativeUrl}},{key:"_nativeAsset",get:function(){return this._file},set:function(e){this._file=e}}]);var n=t.prototype;return n.toString=function(){return this.nativeUrl},n.serialize=function(){},n._setRawAsset=function(e,t){void 0===t&&(t=!0),this._native=!1!==t?e||"":"/"+e},n.addRef=function(){return this._ref++,this},n.decRef=function(e){return void 0===e&&(e=!0),this._ref>0&&this._ref--,e&&c.assetManager._releaseManager.tryRelease(this),this},n.onLoaded=function(){},Z(t,[{key:"_nativeDep",get:function(){if(this._native)return{__isNative__:!0,uuid:this._uuid,ext:this._native}}},{key:"refCount",get:function(){return this._ref}}]),t}(D_(A_)),B_.preventDeferredLoadDependents=!1,B_.preventPreloadNativeObject=!1,z_=se((F_=U_).prototype,"_native",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),se(F_.prototype,"_nativeAsset",[Eh],Object.getOwnPropertyDescriptor(F_.prototype,"_nativeAsset"),F_.prototype),L_=F_))||L_);H_.prototype.createNode=null,c.Asset=H_;var k_,V_,j_,W_,q_,Y_,X_,K_=1024;function Q_(e){return c.sys.capabilities.imageBitmap&&e instanceof ImageBitmap}!function(e){e[e.RGB565=Jo.R5G6B5]="RGB565",e[e.RGB5A1=Jo.RGB5A1]="RGB5A1",e[e.RGBA4444=Jo.RGBA4]="RGBA4444",e[e.RGB888=Jo.RGB8]="RGB888",e[e.RGB32F=Jo.RGB32F]="RGB32F",e[e.RGBA8888=Jo.RGBA8]="RGBA8888",e[e.RGBA32F=Jo.RGBA32F]="RGBA32F",e[e.A8=Jo.A8]="A8",e[e.I8=Jo.L8]="I8",e[e.AI8=Jo.LA8]="AI8",e[e.RGB_PVRTC_2BPPV1=Jo.PVRTC_RGB2]="RGB_PVRTC_2BPPV1",e[e.RGBA_PVRTC_2BPPV1=Jo.PVRTC_RGBA2]="RGBA_PVRTC_2BPPV1",e[e.RGB_A_PVRTC_2BPPV1=K_++]="RGB_A_PVRTC_2BPPV1",e[e.RGB_PVRTC_4BPPV1=Jo.PVRTC_RGB4]="RGB_PVRTC_4BPPV1",e[e.RGBA_PVRTC_4BPPV1=Jo.PVRTC_RGBA4]="RGBA_PVRTC_4BPPV1",e[e.RGB_A_PVRTC_4BPPV1=K_++]="RGB_A_PVRTC_4BPPV1",e[e.RGB_ETC1=Jo.ETC_RGB8]="RGB_ETC1",e[e.RGBA_ETC1=K_++]="RGBA_ETC1",e[e.RGB_ETC2=Jo.ETC2_RGB8]="RGB_ETC2",e[e.RGBA_ETC2=Jo.ETC2_RGBA8]="RGBA_ETC2",e[e.RGBA_ASTC_4x4=Jo.ASTC_RGBA_4x4]="RGBA_ASTC_4x4",e[e.RGBA_ASTC_5x4=Jo.ASTC_RGBA_5x4]="RGBA_ASTC_5x4",e[e.RGBA_ASTC_5x5=Jo.ASTC_RGBA_5x5]="RGBA_ASTC_5x5",e[e.RGBA_ASTC_6x5=Jo.ASTC_RGBA_6x5]="RGBA_ASTC_6x5",e[e.RGBA_ASTC_6x6=Jo.ASTC_RGBA_6x6]="RGBA_ASTC_6x6",e[e.RGBA_ASTC_8x5=Jo.ASTC_RGBA_8x5]="RGBA_ASTC_8x5",e[e.RGBA_ASTC_8x6=Jo.ASTC_RGBA_8x6]="RGBA_ASTC_8x6",e[e.RGBA_ASTC_8x8=Jo.ASTC_RGBA_8x8]="RGBA_ASTC_8x8",e[e.RGBA_ASTC_10x5=Jo.ASTC_RGBA_10x5]="RGBA_ASTC_10x5",e[e.RGBA_ASTC_10x6=Jo.ASTC_RGBA_10x6]="RGBA_ASTC_10x6",e[e.RGBA_ASTC_10x8=Jo.ASTC_RGBA_10x8]="RGBA_ASTC_10x8",e[e.RGBA_ASTC_10x10=Jo.ASTC_RGBA_10x10]="RGBA_ASTC_10x10",e[e.RGBA_ASTC_12x10=Jo.ASTC_RGBA_12x10]="RGBA_ASTC_12x10",e[e.RGBA_ASTC_12x12=Jo.ASTC_RGBA_12x12]="RGBA_ASTC_12x12"}(k_||(k_=e("bM",{}))),function(e){e[e.REPEAT=fa.WRAP]="REPEAT",e[e.CLAMP_TO_EDGE=fa.CLAMP]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=fa.MIRROR]="MIRRORED_REPEAT",e[e.CLAMP_TO_BORDER=fa.BORDER]="CLAMP_TO_BORDER"}(V_||(V_=e("cX",{}))),function(e){e[e.NONE=_a.NONE]="NONE",e[e.LINEAR=_a.LINEAR]="LINEAR",e[e.NEAREST=_a.POINT]="NEAREST"}(j_||(j_=e("bL",{})));var Z_,J_=e("ax",vh("cc.ImageAsset")((X_=Y_=function(e){function t(t){var n;return(n=e.call(this)||this)._nativeData=void 0,n._tex=void 0,n._exportedExts=void 0,n._format=k_.RGBA8888,n._width=0,n._height=0,n.loaded=!1,n._nativeData={_data:null,width:0,height:0,format:0,_compressed:!1},void 0!==t&&n.reset(t),n}$(t,e),Z(t,[{key:"_nativeAsset",get:function(){return this._nativeData},set:function(e){e instanceof HTMLElement||Q_(e)||(e.format=e.format||this._format),this.reset(e)}},{key:"data",get:function(){return this._nativeData&&((e=this._nativeData)instanceof HTMLImageElement||e instanceof HTMLCanvasElement||Q_(e))?this._nativeData:this._nativeData&&this._nativeData._data;var e}},{key:"width",get:function(){return this._nativeData.width||this._width}},{key:"height",get:function(){return this._nativeData.height||this._height}},{key:"format",get:function(){return this._format}},{key:"isCompressed",get:function(){return this._format>=k_.RGB_ETC1&&this._format<=k_.RGBA_ASTC_12x12||this._format>=k_.RGB_A_PVRTC_2BPPV1&&this._format<=k_.RGBA_ETC1}},{key:"url",get:function(){return this.nativeUrl}},{key:"_texture",set:function(e){this._tex=e},get:function(){if(!this._tex){var e=new c.Texture2D;e.name=this.nativeUrl,e.image=this,this._tex=e}return this._tex}}]);var n=t.prototype;return n.reset=function(e){var t=this;Q_(e)?(this._nativeData=e,this._onDataComplete()):e instanceof HTMLElement?(this._nativeData=e,e.complete||e instanceof HTMLCanvasElement?this._onDataComplete():(this.loaded=!1,e.addEventListener("load",(function(){t._onDataComplete()})),e.addEventListener("error",(function(e){I(3119,e.message)})))):(this._nativeData=e,this._format=e.format,this._onDataComplete())},n.destroy=function(){return this.data&&this.data instanceof HTMLImageElement?(this.data.src="",this._setRawAsset("")):Q_(this.data)&&this.data.close&&this.data.close(),e.prototype.destroy.call(this)},n._serialize=function(){},n._deserialize=function(e){var n="";"string"==typeof e?n=e:(this._width=e.w,this._height=e.h,n=e.fmt);for(var i,r=c.director.root?c.director.root.device:null,o=n.split("_"),a="",s=Number.MAX_VALUE,l=this._format,u="",h=c.macro.SUPPORT_TEXTURE_FORMATS,_=oe(o);!(i=_()).done;){var f=i.value.split("@"),m=parseInt(f[0],void 0),d=t.extnames[m]||f[0],p=h.indexOf(d);if(-1!==p&&p<s){var v=f[1]?parseInt(f[1]):this._format;if(!(".astc"!==d||r&&r.hasFeature(Pa.FORMAT_ASTC)))continue;if(!(".pvr"!==d||r&&r.hasFeature(Pa.FORMAT_PVRTC)))continue;if(!(v!==k_.RGB_ETC1&&v!==k_.RGBA_ETC1||r&&r.hasFeature(Pa.FORMAT_ETC1)))continue;if(!(v!==k_.RGB_ETC2&&v!==k_.RGBA_ETC2||r&&r.hasFeature(Pa.FORMAT_ETC2)))continue;if(".webp"===d&&!c.sys.capabilities.webp)continue;s=p,u=d,l=v}else a||(a=d)}u?(this._setRawAsset(u),this._format=l):a?(this._setRawAsset(a),I(3120,a,a)):I(3121)},n._onDataComplete=function(){this.loaded=!0,this.emit("load")},t}(H_),Y_.extnames=[".png",".jpg",".jpeg",".bmp",".webp",".pvr",".pkm",".astc"],se((q_=X_).prototype,"_nativeAsset",[Yh],Object.getOwnPropertyDescriptor(q_.prototype,"_nativeAsset"),q_.prototype),W_=q_))||W_);c.ImageAsset=J_,function(e){e[e.minFilter=0]="minFilter",e[e.magFilter=1]="magFilter",e[e.mipFilter=2]="mipFilter",e[e.addressU=3]="addressU",e[e.addressV=4]="addressV",e[e.addressW=5]="addressW",e[e.maxAnisotropy=6]="maxAnisotropy",e[e.cmpFunc=7]="cmpFunc",e[e.minLOD=8]="minLOD",e[e.maxLOD=9]="maxLOD",e[e.mipLODBias=10]="mipLODBias",e[e.total=11]="total"}(Z_||(Z_={}));var $_=[_a.LINEAR,_a.LINEAR,_a.NONE,fa.WRAP,fa.WRAP,fa.WRAP,8,sa.NEVER,0,0,0],ef=rf($_),tf=new ls,nf=new Rs;function rf(e){for(var t=0,n=0,i=0;i<$_.length;i++)switch(t=e[i]||$_[i],i){case Z_.minFilter:n|=t;break;case Z_.magFilter:n|=t<<2;break;case Z_.mipFilter:n|=t<<4;break;case Z_.addressU:n|=t<<6;break;case Z_.addressV:n|=t<<8;break;case Z_.addressW:n|=t<<10;break;case Z_.maxAnisotropy:n|=t<<12;break;case Z_.cmpFunc:n|=t<<16;break;case Z_.minLOD:n|=t<<20;break;case Z_.maxLOD:n|=t<<24;break;case Z_.mipLODBias:n|=t<<28}return n}var of,af,sf,cf,lf,uf,hf,_f,ff,mf,df,pf,vf=function(){function e(){this._cache={}}return e.prototype.getSampler=function(e,t){return t||(t=ef),this._cache[t]||(nf.minFilter=3&t,nf.magFilter=t>>2&3,nf.mipFilter=t>>4&3,nf.addressU=t>>6&3,nf.addressV=t>>8&3,nf.addressW=t>>10&3,nf.maxAnisotropy=t>>12&15,nf.cmpFunc=t>>16&15,nf.minLOD=t>>20&15,nf.maxLOD=t>>24&15,nf.mipLODBias=t>>28&15,nf.borderColor=tf,this._cache[t]=e.createSampler(nf))},e}(),gf=e("az",new vf);c.samplerLib=gf;var yf=new Ne("Tex"),xf=e("cc",vh("cc.TextureBase")((pf=df=function(e){function t(){var t;return ae(t=e.call(this)||this,"_format",sf,ie(t)),ae(t,"_minFilter",cf,ie(t)),ae(t,"_magFilter",lf,ie(t)),ae(t,"_mipFilter",uf,ie(t)),ae(t,"_wrapS",hf,ie(t)),ae(t,"_wrapT",_f,ie(t)),ae(t,"_wrapR",ff,ie(t)),ae(t,"_anisotropy",mf,ie(t)),t._width=1,t._height=1,t._id=void 0,t._samplerInfo=[],t._samplerHash=0,t._gfxSampler=null,t._gfxDevice=null,t._textureHash=0,t._id=yf.getNewId(),t.loaded=!1,t._gfxDevice=t._getGFXDevice(),t._textureHash=is(t._id,666),t}$(t,e),Z(t,[{key:"isCompressed",get:function(){return this._format>=k_.RGB_ETC1&&this._format<=k_.RGBA_ASTC_12x12||this._format>=k_.RGB_A_PVRTC_2BPPV1&&this._format<=k_.RGBA_ETC1}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}}]);var n=t.prototype;return n.getId=function(){return this._id},n.getPixelFormat=function(){return this._format},n.getAnisotropy=function(){return this._anisotropy},n.setWrapMode=function(e,t,n){this._wrapS=e,this._samplerInfo[Z_.addressU]=e,this._wrapT=t,this._samplerInfo[Z_.addressV]=t,void 0!==n&&(this._wrapR=n,this._samplerInfo[Z_.addressW]=n),this._samplerHash=rf(this._samplerInfo),this._gfxDevice&&(this._gfxSampler=gf.getSampler(this._gfxDevice,this._samplerHash))},n.setFilters=function(e,t){this._minFilter=e,this._samplerInfo[Z_.minFilter]=e,this._magFilter=t,this._samplerInfo[Z_.magFilter]=t,this._samplerHash=rf(this._samplerInfo),this._gfxDevice&&(this._gfxSampler=gf.getSampler(this._gfxDevice,this._samplerHash))},n.setMipFilter=function(e){this._mipFilter=e,this._samplerInfo[Z_.mipFilter]=e,this._samplerInfo[Z_.maxLOD]=e===j_.NONE?0:15,this._samplerHash=rf(this._samplerInfo),this._gfxDevice&&(this._gfxSampler=gf.getSampler(this._gfxDevice,this._samplerHash))},n.setAnisotropy=function(e){this._anisotropy=e,this._samplerInfo[Z_.maxAnisotropy]=e,this._samplerHash=rf(this._samplerInfo),this._gfxDevice&&(this._gfxSampler=gf.getSampler(this._gfxDevice,this._samplerHash))},n.destroy=function(){var t=e.prototype.destroy.call(this);return t&&c.director.root&&c.director.root.batcher2D&&c.director.root.batcher2D._releaseDescriptorSetCache(this._textureHash),t},n.getHash=function(){return this._textureHash},n.getGFXTexture=function(){return null},n.getSamplerHash=function(){return this._samplerHash},n.getGFXSampler=function(){return this._gfxSampler||(this._gfxDevice?this._gfxSampler=gf.getSampler(this._gfxDevice,this._samplerHash):R(9302)),this._gfxSampler},n._serialize=function(){return""},n._deserialize=function(e){var t=e.split(",");t.unshift(""),t.length>=5&&(this.setFilters(parseInt(t[1]),parseInt(t[2])),this.setWrapMode(parseInt(t[3]),parseInt(t[4]))),t.length>=7&&(this.setMipFilter(parseInt(t[5])),this.setAnisotropy(parseInt(t[6])))},n._getGFXDevice=function(){return c.director.root?c.director.root.device:null},n._getGFXFormat=function(){return this._getGFXPixelFormat(this._format)},n._setGFXFormat=function(e){this._format=void 0===e?k_.RGBA8888:e},n._getGFXPixelFormat=function(e){return e===k_.RGBA_ETC1?e=k_.RGB_ETC1:e===k_.RGB_A_PVRTC_4BPPV1?e=k_.RGB_PVRTC_4BPPV1:e===k_.RGB_A_PVRTC_2BPPV1&&(e=k_.RGB_PVRTC_2BPPV1),e},t}(H_),df.PixelFormat=k_,df.WrapMode=V_,df.Filter=j_,sf=se((af=pf).prototype,"_format",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return k_.RGBA8888}}),cf=se(af.prototype,"_minFilter",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return j_.LINEAR}}),lf=se(af.prototype,"_magFilter",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return j_.LINEAR}}),uf=se(af.prototype,"_mipFilter",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return j_.NONE}}),hf=se(af.prototype,"_wrapS",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return V_.REPEAT}}),_f=se(af.prototype,"_wrapT",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return V_.REPEAT}}),ff=se(af.prototype,"_wrapR",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return V_.REPEAT}}),mf=se(af.prototype,"_anisotropy",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 8}}),of=af))||of);c.TextureBase=xf;var Ef=[ri,Un,ci,qn,zn,hi,fi,ei];function Sf(e,t){e.x=t[1],e.y=t[2],e.z=t[3],e.w=t[4]}var Tf=[function(e,t){e.x=t[1],e.y=t[2]},function(e,t){e.x=t[1],e.y=t[2],e.z=t[3]},Sf,Sf,function(e,t){e._val=t[1]},function(e,t){e.width=t[1],e.height=t[2]},function(e,t){e.x=t[1],e.y=t[2],e.width=t[3],e.height=t[4]},function(e,t){ei.fromArray(e,t,1)}],Af=e("eb",function(){function e(){this.uuidObjList=null,this.uuidPropList=null,this.uuidList=null}var t=e.prototype;return t.init=function(e){this.uuidObjList=e[8],this.uuidPropList=e[9],this.uuidList=e[10]},t.reset=function(){this.uuidList=null,this.uuidObjList=null,this.uuidPropList=null},t.push=function(e,t,n){this.uuidObjList.push(e),this.uuidPropList.push(t),this.uuidList.push(n)},e}());function Cf(e,t){for(var n=e[4][t[0]],i=n[0],r=new(0,i[0]),o=i[1],a=i[2],s=n[n.length-1],c=1;c<s;++c)r[o[n[c]]]=t[c];for(;c<t.length;++c){var l=o[n[c]],u=i[n[c]+a];(0,Nf[u])(e,r,l,t[c])}return r}function wf(e,t,n){var i=new t;return i._deserialize?i._deserialize(n,e[0]):R(5303,Ve(t)),i}function If(e,t,n,i){i>=0?t[n]=e[5][i]:e[7][3*~i]=t}function bf(e){return function(t,n,i,r){n[i]=r;for(var o=0;o<r.length;++o)e(t,r,o,r[o])}}function Rf(e,t,n,i){t[n]=null,e[8][i]=t}function Of(e,t,n,i){t[n]=Cf(e,i)}Af.pool=new pt((function(e){e.reset()}),5),Af.pool.get=function(){return this._get()||new Af};var Nf=new Array(13);function Pf(e,t){return e||Ff.reportMissingClass(t),Object}function Mf(e,t,n,i,r,o){var a=e(t);if(!a){if(r)return void(n[i]=function(t,n,i){return function(){var r=e(i)||Pf(o,i);return t[n]=r,new r}}(n,i,t));a=Pf(o,t)}n[i]=a}function Df(e,t,n){for(var i=n||ft,r=e[3],o=0;o<r.length;++o){var a=r[o];"string"!=typeof a?Mf(i,a[0],a,0,t,n):Mf(i,a,r,o,t,n)}}function Lf(e){var t=e[4];if(t)for(var n=e[3],i=0;i<t.length;++i){var r=t[i];r[0]=n[r[0]]}}function Ff(e,t,n){"string"==typeof e&&(e=JSON.parse(e));var i,r=!t;(t=t||Af.pool.get()).init(e),n=n||{};var o=e[0],a=!1;if("object"==typeof o&&(a=o.preprocessed,o=o.version),o<1)throw new Error(M(5304,o));n._version=o,n.result=t,e[0]=n,a||(Df(e,!1,n.classFinder),Lf(e)),c.game._isCloning=!0;var s=e[5],l=function(e){var t=e[5],n=e[6],i=0===n?0:n.length,r=t[t.length-1],o=t.length-i;"number"!=typeof r?r=0:(r<0&&(r=~r),--o);for(var a=0;a<o;++a)t[a]=Cf(e,t[a]);for(var s=e[3],c=0;c<i;++c,++a){var l=n[c],u=t[a];if(l>=0){var h=s[l];t[a]=wf(e,h,u)}else(0,Nf[l=~l])(e,t,a,u)}return r}(e);return c.game._isCloning=!1,e[7]&&function(e,t,n){for(var i=e.length-1,r=0,o=3*e[i];r<o;r+=3){var a=e[r],s=t[e[r+2]],c=e[r+1];c>=0?a[n[c]]=s:a[~c]=s}for(;r<i;r+=3){var l=t[e[r]],u=t[e[r+2]],h=e[r+1];h>=0?l[n[h]]=u:l[~h]=u}}(e[7],s,e[2]),function(e){for(var t=e[5],n=e[2],i=e[1],r=e[8],o=e[9],a=e[10],s=0;s<r.length;++s){var c=r[s];"number"==typeof c&&(r[s]=t[c]);var l=o[s];"number"==typeof l&&(l=l>=0?n[l]:~l,o[s]=l);var u=a[s];"number"==typeof u&&(a[s]=i[u])}}(e),i=s[l],r&&Af.pool.put(t),i}Nf[0]=function(e,t,n,i){t[n]=i},Nf[1]=If,Nf[2]=bf(If),Nf[3]=bf(Rf),Nf[4]=Of,Nf[5]=function(e,t,n,i){Tf[i[0]](t[n],i)},Nf[6]=Rf,Nf[7]=function(e,t,n,i){t[n].set(i)},Nf[8]=function(e,t,n,i){var r=new Ef[i[0]];Tf[i[0]](r,i),t[n]=r},Nf[9]=bf(Of),Nf[10]=function(e,t,n,i){var r=e[3][i[0]];t[n]=wf(e,r,i[1])},Nf[11]=function(e,t,n,i){var r=i[0];t[n]=r;for(var o=1;o<i.length;o+=3){var a=i[o],s=i[o+1],c=i[o+2];(0,Nf[s])(e,r,a,c)}},Nf[12]=function(e,t,n,i){var r=i[0];t[n]=r;for(var o=0;o<r.length;++o){var a=r[o],s=i[o+1];0!==s&&(0,Nf[s])(e,r,o,a)}},Ff.Details=Af,Ff.reportMissingClass=function(e){I(5302,e)};var zf,Bf,Uf,Gf=function(e){this.preprocessed=!0,this.version=e};function Hf(e,t,n){return[1,0,0,[e],0,n?[t,-1]:[t],[0],0,[],[],[]]}c.deserialize=Ff;var kf=e("ek",vh("cc.Script")(zf=function(e){function t(){return e.apply(this,arguments)||this}return $(t,e),t}(H_))||zf);c._Script=kf;var Vf=e("el",vh("cc.JavaScript")(Bf=function(e){function t(){return e.apply(this,arguments)||this}return $(t,e),t}(kf))||Bf);c._JavaScript=Vf;var jf,Wf,qf,Yf,Xf,Kf,Qf,Zf,Jf,$f,em,tm=e("em",vh("cc.TypeScript")(Uf=function(e){function t(){return e.apply(this,arguments)||this}return $(t,e),t}(kf))||Uf);c._TypeScript=tm;var nm,im,rm,om,am=new Ne("Comp"),sm=A_.Flags.IsOnLoadCalled,cm=e("bj",(jf=vh("cc.Component"),Wf=Mh(),qf=qh(kf),Yf=Dh(),jf((em=$f=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ae(t=e.call.apply(e,[this].concat(i))||this,"node",Qf,ie(t)),ae(t,"_enabled",Zf,ie(t)),ae(t,"__prefab",Jf,ie(t)),t._sceneGetter=null,t._id=am.getNewId(),t}$(t,e);var n=t.prototype;return n._getRenderScene=function(){return this._sceneGetter?this._sceneGetter():this.node.scene._renderScene},n.addComponent=function(e){return this.node.addComponent(e)},n.getComponent=function(e){return this.node.getComponent(e)},n.getComponents=function(e){return this.node.getComponents(e)},n.getComponentInChildren=function(e){return this.node.getComponentInChildren(e)},n.getComponentsInChildren=function(e){return this.node.getComponentsInChildren(e)},n.destroy=function(){return!!e.prototype.destroy.call(this)&&(this._enabled&&this.node.activeInHierarchy&&c.director._compScheduler.disableComp(this),!0)},n._onPreDestroy=function(){this.unscheduleAllCallbacks(),c.director._nodeActivator.destroyComp(this),this.node._removeComponent(this)},n._instantiate=function(e){return e||(e=c.instantiate._clone(this,this)),e.node=null,e},n.schedule=function(e,t,n,i){void 0===t&&(t=0),void 0===n&&(n=c.macro.REPEAT_FOREVER),void 0===i&&(i=0),P(e,1619),P((t=t||0)>=0,1620),n=isNaN(n)?c.macro.REPEAT_FOREVER:n,i=i||0;var r=c.director.getScheduler(),o=r.isTargetPaused(this);r.schedule(e,this,t,n,i,o)},n.scheduleOnce=function(e,t){void 0===t&&(t=0),this.schedule(e,0,0,t)},n.unschedule=function(e){e&&c.director.getScheduler().unschedule(e,this)},n.unscheduleAllCallbacks=function(){c.director.getScheduler().unscheduleAllForTarget(this)},Z(t,[{key:"name",get:function(){if(this._name)return this._name;var e=Ve(this),t=e.lastIndexOf(".");return t>=0&&(e=e.slice(t+1)),this.node.name+"<"+e+">"},set:function(e){this._name=e}},{key:"uuid",get:function(){return this._id}},{key:"__scriptAsset",get:function(){return null}},{key:"enabled",get:function(){return this._enabled},set:function(e){if(this._enabled!==e&&(this._enabled=e,this.node.activeInHierarchy)){var t=c.director._compScheduler;e?t.enableComp(this):t.disableComp(this)}}},{key:"enabledInHierarchy",get:function(){return this._enabled&&this.node&&this.node.activeInHierarchy}},{key:"_isOnLoadCalled",get:function(){return this._objFlags&sm}}]),t}(A_),$f.system=null,se((Kf=em).prototype,"__scriptAsset",[Wf,qf,Yf,Hh],Object.getOwnPropertyDescriptor(Kf.prototype,"__scriptAsset"),Kf.prototype),Qf=se(Kf.prototype,"node",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Zf=se(Kf.prototype,"_enabled",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Jf=se(Kf.prototype,"__prefab",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Xf=Kf))||Xf)),lm=cm.prototype;lm.update=null,lm.lateUpdate=null,lm.__preload=null,lm.onLoad=null,lm.start=null,lm.onEnable=null,lm.onDisable=null,lm.onDestroy=null,lm.onFocusInEditor=null,lm.onLostFocusInEditor=null,lm.resetInEditor=null,lm._getLocalBounds=null,lm.onRestore=null,cm._requireComponent=null,cm._executionOrder=0,Be(cm,"_registerEditorProps",(function(e,t){var n=t.requireComponent;n&&(e._requireComponent=n);var i=t.executionOrder;i&&"number"==typeof i&&(e._executionOrder=i)})),c.Component=cm;var um=e("fv",vh("cc.MissingScript")(nm=bh()((om=function(e){function t(){var t;return ae(t=e.call(this)||this,"_$erialized",rm,ie(t)),t}return $(t,e),t.safeFindClass=function(e){var t=ft(e);if(t)return t;c.deserialize.reportMissingClass(e)},t.prototype.onLoad=function(){I(4600,this.node.name)},t}(cm),rm=se((im=om).prototype,"_$erialized",[Sh,Th],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),nm=im))||nm)||nm);function hm(e,t){var n;n=um.safeFindClass;var i,r=Af.pool.get();try{i=Ff(e,r,{classFinder:n,customEnv:t})}catch(e){throw y(e),Af.pool.put(r),e}i._uuid=t.__uuid__||"";for(var o=r.uuidList,a=r.uuidObjList,s=r.uuidPropList,c=[],l=0;l<o.length;l++){var u=o[l];c[l]={uuid:h_(u),owner:a[l],prop:s[l]}}return i.__depends__=c,i._native&&(i.__nativeDepend__=!0),Af.pool.put(r),i}c._MissingScript=um;var _m,fm=new(function(){function e(){this._depends=new Xh}var t=e.prototype;return t.init=function(){this._depends.clear()},t.getNativeDep=function(e){var t=this._depends.get(e);return t&&t.nativeDep?J({},t.nativeDep):null},t.getDeps=function(e){return this._depends.has(e)?this._depends.get(e).deps:[]},t.getDepsRecursively=function(e){var t=Object.create(null),n=[];return this._descend(e,t,n),n},t.remove=function(e){this._depends.remove(e)},t.parse=function(e,t){var n,i,r=null;if(Array.isArray(t)||t.__type__){if(this._depends.has(e))return this._depends.get(e);if(!Array.isArray(t)||"number"==typeof(i=(n=t[5])[n.length-1])&&i<0)try{var o=hm(t,{__uuid__:e});(r=this._parseDepsFromAsset(o)).nativeDep&&(r.nativeDep.uuid=e),$h.add(e+"@import",o)}catch(t){Jh.remove(e+"@import"),r={deps:[]}}else r={deps:this._parseDepsFromJson(t)}}else{if(this._depends.has(e)&&(r=this._depends.get(e)).parsedFromExistAsset)return r;r=this._parseDepsFromAsset(t)}return this._depends.add(e,r),r},t._parseDepsFromAsset=function(e){for(var t={deps:[],parsedFromExistAsset:!0,preventPreloadNativeObject:e.constructor.preventPreloadNativeObject,preventDeferredLoadDependents:e.constructor.preventDeferredLoadDependents},n=e.__depends__,i=0,r=n.length;i<r;i++)t.deps.push(n[i].uuid);return e.__nativeDepend__&&(t.nativeDep=e._nativeDep),t},t._parseDepsFromJson=function(e){var t=null;return(t=function(e){var t=e[1];return e[10].map((function(e){return t[e]}))}(e)).forEach((function(e,n){return t[n]=h_(e)})),t},t._descend=function(e,t,n){for(var i=this.getDeps(e),r=0;r<i.length;r++){var o=i[r];t[o]||(t[o]=!0,n.push(o),this._descend(o,t,n))}},e}()),mm=[new ms];function dm(e){return e&&0==(e&e-1)}var pm,vm,gm,ym,xm,Em,Sm=vh("cc.SimpleTexture")(_m=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this)._gfxTexture=null,t._mipmapLevel=1,t._textureWidth=0,t._textureHeight=0,t}$(t,e);var n=t.prototype;return n.getGFXTexture=function(){return this._gfxTexture},n.destroy=function(){return this._tryDestroyTexture(),e.prototype.destroy.call(this)},n.updateImage=function(){this.updateMipmaps(0)},n.updateMipmaps=function(){},n.uploadData=function(e,t,n){if(void 0===t&&(t=0),void 0===n&&(n=0),this._gfxTexture&&!(this._mipmapLevel<=t)){var i=this._getGFXDevice();if(i){var r=mm[0];r.texExtent.width=this._textureWidth>>t,r.texExtent.height=this._textureHeight>>t,r.texSubres.mipLevel=t,r.texSubres.baseArrayLayer=n,ArrayBuffer.isView(e)?i.copyBuffersToTexture([e],this._gfxTexture,mm):i.copyTexImagesToTexture([e],this._gfxTexture,mm)}}},n._assignImage=function(e,t,n){var i=this,r=function(){var r=e.data;if(r&&(i.uploadData(r,t,n),i._checkTextureLoaded(),Ct.CLEANUP_IMAGE_CACHE)){var o=fm.getDeps(i._uuid),a=o.indexOf(e._uuid);-1!==a&&(Ie(o,a),e.decRef())}};if(e.loaded)r();else{if(e.once("load",(function(){r()})),!this.isCompressed){var o=c.builtinResMgr.get("black-texture").image;this.uploadData(o.data,t,n)}c.assetManager.postLoadNative(e)}},n._checkTextureLoaded=function(){this._textureReady()},n._textureReady=function(){this.loaded=!0,this.emit("load")},n._setMipmapLevel=function(e){this._mipmapLevel=e<1?1:e},n._getGfxTextureCreateInfo=function(){return null},n._tryReset=function(){if(this._tryDestroyTexture(),0!==this._mipmapLevel){var e=this._getGFXDevice();e&&this._createTexture(e)}},n._createTexture=function(e){if(0!==this._width&&0!==this._height){var t=va.NONE;this._mipFilter!==j_.NONE&&function(e,t,n){return!(e.gfxAPI===Oa.WEBGL)||dm(t)&&dm(n)}(e,this._width,this._height)&&(this._mipmapLevel=function(e,t){for(var n=Math.max(e,t),i=0;n;)n>>=1,i++;return i}(this._width,this._height),t=va.GEN_MIPMAP);var n=this._getGfxTextureCreateInfo({usage:da.SAMPLED|da.TRANSFER_DST,format:this._getGFXFormat(),levelCount:this._mipmapLevel,flags:t|va.IMMUTABLE});if(n){var i=e.createTexture(n);this._textureWidth=n.width,this._textureHeight=n.height,this._gfxTexture=i}}},n._tryDestroyTexture=function(){this._gfxTexture&&(this._gfxTexture.destroy(),this._gfxTexture=null)},Z(t,[{key:"mipmapLevel",get:function(){return this._mipmapLevel}}]),t}(xf))||_m;c.SimpleTexture=Sm;var Tm,Am,Cm,wm,Im,bm,Rm=e("ay",(pm=vh("cc.Texture2D"),vm=qh([J_]),pm((Em=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ae(t=e.call.apply(e,[this].concat(i))||this,"_mipmaps",xm,ie(t)),t}$(t,e);var n=t.prototype;return n.initialize=function(){this.mipmaps=this._mipmaps},n.onLoaded=function(){this.initialize()},n.reset=function(e){this._width=e.width,this._height=e.height,this._setGFXFormat(e.format),this._setMipmapLevel(e.mipmapLevel||1),this._tryReset()},n.create=function(e,t,n,i){void 0===n&&(n=k_.RGBA8888),void 0===i&&(i=1),this.reset({width:e,height:t,format:n,mipmapLevel:i})},n.toString=function(){return 0!==this._mipmaps.length?this._mipmaps[0].url:""},n.updateMipmaps=function(e,t){if(void 0===e&&(e=0),!(e>=this._mipmaps.length))for(var n=Math.min(void 0===t?this._mipmaps.length:t,this._mipmaps.length-e),i=0;i<n;++i){var r=e+i;this._assignImage(this._mipmaps[r],r)}},n.getHtmlElementObj=function(){return this._mipmaps[0]&&this._mipmaps[0].data instanceof HTMLElement?this._mipmaps[0].data:null},n.destroy=function(){return this._mipmaps=[],e.prototype.destroy.call(this)},n.description=function(){return"<cc.Texture2D | Name = "+(this._mipmaps[0]?this._mipmaps[0].url:"")+" | Dimension = "+this.width+" x "+this.height+">"},n.releaseTexture=function(){this.destroy()},n._serialize=function(){},n._deserialize=function(t,n){var i=t;e.prototype._deserialize.call(this,i.base,n),this._mipmaps=new Array(i.mipmaps.length);for(var r=0;r<i.mipmaps.length;++r)if(this._mipmaps[r]=new J_,i.mipmaps[r]){var o=i.mipmaps[r];n.result.push(this._mipmaps,""+r,o),this._mipmaps[r]._texture=this}},n._getGfxTextureCreateInfo=function(e){var t=new zs(ma.TEX2D);return t.width=this._width,t.height=this._height,Object.assign(t,e)},n._checkTextureLoaded=function(){for(var t=!0,n=0;n<this._mipmaps.length;++n)if(!this._mipmaps[n].loaded){t=!1;break}t&&e.prototype._textureReady.call(this)},Z(t,[{key:"mipmaps",get:function(){return this._mipmaps},set:function(e){var t=this;if(this._mipmaps=e,this._setMipmapLevel(this._mipmaps.length),this._mipmaps.length>0){var n=this._mipmaps[0];this.reset({width:n.width,height:n.height,format:n.format,mipmapLevel:this._mipmaps.length}),this._mipmaps.forEach((function(e,n){t._assignImage(e,n)}))}else this.reset({width:0,height:0,mipmapLevel:this._mipmaps.length})}},{key:"image",get:function(){return 0===this._mipmaps.length?null:this._mipmaps[0]},set:function(e){this.mipmaps=e?[e]:[]}}]),t}(Sm),xm=se((ym=Em).prototype,"_mipmaps",[vm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),gm=ym))||gm));c.Texture2D=Rm,function(e){e[e.right=0]="right",e[e.left=1]="left",e[e.top=2]="top",e[e.bottom=3]="bottom",e[e.front=4]="front",e[e.back=5]="back"}(bm||(bm={}));var Om=e("ei",vh("cc.TextureCube")((Im=wm=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ae(t=e.call.apply(e,[this].concat(i))||this,"_mipmaps",Cm,ie(t)),t}$(t,e),t.fromTexture2DArray=function(e,n){for(var i=[],r=e.length/6,o=0;o<r;o++){var a=6*o;i.push({front:e[a+bm.front].image,back:e[a+bm.back].image,left:e[a+bm.left].image,right:e[a+bm.right].image,top:e[a+bm.top].image,bottom:e[a+bm.bottom].image})}return(n=n||new t).mipmaps=i,n};var n=t.prototype;return n.onLoaded=function(){this.mipmaps=this._mipmaps,this.loaded=!0,this.emit("load")},n.reset=function(e){this._width=e.width,this._height=e.height,this._setGFXFormat(e.format),this._setMipmapLevel(e.mipmapLevel||1),this._tryReset()},n.updateMipmaps=function(e,t){var n=this;if(void 0===e&&(e=0),!(e>=this._mipmaps.length))for(var i=Math.min(void 0===t?this._mipmaps.length:t,this._mipmaps.length-e),r=function(t){var i=e+t;Nm(n._mipmaps[i],(function(e,t){n._assignImage(e,i,t)}))},o=0;o<i;++o)r(o)},n.destroy=function(){return this._mipmaps=[],e.prototype.destroy.call(this)},n.releaseTexture=function(){this.mipmaps=[]},n._serialize=function(){},n._deserialize=function(t,n){var i=t;e.prototype._deserialize.call(this,i.base,n),this._mipmaps=new Array(i.mipmaps.length);for(var r=0;r<i.mipmaps.length;++r){this._mipmaps[r]={front:new J_,back:new J_,left:new J_,right:new J_,top:new J_,bottom:new J_};var o=i.mipmaps[r];n.result.push(this._mipmaps[r],"front",o.front),n.result.push(this._mipmaps[r],"back",o.back),n.result.push(this._mipmaps[r],"left",o.left),n.result.push(this._mipmaps[r],"right",o.right),n.result.push(this._mipmaps[r],"top",o.top),n.result.push(this._mipmaps[r],"bottom",o.bottom)}},n._getGfxTextureCreateInfo=function(e){var t=new zs(ma.CUBE);return t.width=this._width,t.height=this._height,t.layerCount=6,Object.assign(t,e),t.flags|=va.CUBEMAP,t},Z(t,[{key:"mipmaps",get:function(){return this._mipmaps},set:function(e){var t=this;if(this._mipmaps=e,this._setMipmapLevel(this._mipmaps.length),this._mipmaps.length>0){var n=this._mipmaps[0].front;this.reset({width:n.width,height:n.height,format:n.format,mipmapLevel:this._mipmaps.length}),this._mipmaps.forEach((function(e,n){Nm(e,(function(e,i){t._assignImage(e,n,i)}))}))}else this.reset({width:0,height:0,mipmapLevel:this._mipmaps.length})}},{key:"image",get:function(){return 0===this._mipmaps.length?null:this._mipmaps[0]},set:function(e){this.mipmaps=e?[e]:[]}}]),t}(Sm),wm.FaceIndex=bm,Cm=se((Am=Im).prototype,"_mipmaps",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Tm=Am))||Tm);function Nm(e,t){t(e.front,bm.front),t(e.back,bm.back),t(e.left,bm.left),t(e.right,bm.right),t(e.top,bm.top),t(e.bottom,bm.bottom)}c.TextureCube=Om;var Pm,Mm,Dm,Lm=e("fw",[{name:"billboard",techniques:[{name:"add",passes:[{rasterizerState:{cullMode:0},blendState:{targets:[{blend:!0,blendSrc:2,blendDst:1,blendSrcAlpha:2,blendDstAlpha:1}]},program:"billboard|vert:vs_main|tinted-fs:add",depthStencilState:{depthTest:!0,depthWrite:!1},properties:{mainTexture:{value:"grey",type:28},mainTiling_Offset:{value:[1,1,0,0],type:16},tintColor:{value:[.5,.5,.5,.5],type:16}}}]}],shaders:[{name:"billboard|vert:vs_main|tinted-fs:add",hash:2143664850,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplers:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplers:[]}},defines:[{name:"CC_USE_HDR",type:"boolean"}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:1,members:[{name:"mainTiling_Offset",type:16,count:1},{name:"frameTile_velLenScale",type:16,count:1},{name:"scale",type:16,count:1}]},{name:"builtin",defines:[],binding:1,stageFlags:1,members:[{name:"cc_size_rotation",type:16,count:1}]},{name:"FragConstants",defines:[],binding:2,stageFlags:16,members:[{name:"tintColor",type:16,count:1}]}],samplers:[{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:3}],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:1},{name:"a_color",type:16,count:1,defines:[],stageFlags:1,format:44,location:2}]}]},{name:"clear-stencil",techniques:[{passes:[{blendState:{targets:[{blend:!0}]},rasterizerState:{cullMode:0},program:"clear-stencil|sprite-vs:vert|sprite-fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1}}]}],shaders:[{name:"clear-stencil|sprite-vs:vert|sprite-fs:frag",hash:1062464958,builtins:{globals:{blocks:[],samplers:[]},locals:{blocks:[],samplers:[]}},defines:[],blocks:[],samplers:[],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0}]}]},{name:"graphics",techniques:[{passes:[{blendState:{targets:[{blend:!0,blendSrc:1,blendDst:4,blendSrcAlpha:1,blendDstAlpha:4}]},rasterizerState:{cullMode:0},program:"graphics|vs:vert|fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1}}]}],shaders:[{name:"graphics|vs:vert|fs:frag",hash:3946667351,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplers:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplers:[]}},defines:[],blocks:[],samplers:[],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_color",type:16,count:1,defines:[],stageFlags:1,format:44,location:1},{name:"a_dist",type:13,count:1,defines:[],stageFlags:1,format:11,location:2}]}]},{name:"particle-gpu",techniques:[{name:"add",passes:[{rasterizerState:{cullMode:0},blendState:{targets:[{blend:!0,blendSrc:2,blendDst:1,blendSrcAlpha:2,blendDstAlpha:1}]},program:"particle-gpu|particle-vs-gpu:gpvs_main|tinted-fs:add",depthStencilState:{depthTest:!0,depthWrite:!1},properties:{mainTexture:{value:"grey",type:28},mainTiling_Offset:{value:[1,1,0,0],type:16},tintColor:{value:[.5,.5,.5,.5],type:16}}}]}],shaders:[{name:"particle-gpu|particle-vs-gpu:gpvs_main|tinted-fs:add",hash:3696836305,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplers:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplers:[]}},defines:[{name:"CC_RENDER_MODE",type:"number",range:[0,4]},{name:"COLOR_OVER_TIME_MODULE_ENABLE",type:"boolean"},{name:"ROTATION_OVER_TIME_MODULE_ENABLE",type:"boolean"},{name:"SIZE_OVER_TIME_MODULE_ENABLE",type:"boolean"},{name:"FORCE_OVER_TIME_MODULE_ENABLE",type:"boolean"},{name:"VELOCITY_OVER_TIME_MODULE_ENABLE",type:"boolean"},{name:"TEXTURE_ANIMATION_MODULE_ENABLE",type:"boolean"},{name:"CC_USE_WORLD_SPACE",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:1,members:[{name:"mainTiling_Offset",type:16,count:1},{name:"frameTile_velLenScale",type:16,count:1},{name:"scale",type:16,count:1}]},{name:"SampleConstants",defines:[],binding:1,stageFlags:1,members:[{name:"u_sampleInfo",type:16,count:1}]},{name:"TickConstants",defines:[],binding:2,stageFlags:1,members:[{name:"u_worldRot",type:16,count:1},{name:"u_timeDelta",type:16,count:1}]},{name:"ColorConstant",defines:["COLOR_OVER_TIME_MODULE_ENABLE"],binding:3,stageFlags:1,members:[{name:"u_color_mode",type:5,count:1}]},{name:"RotationConstant",defines:["ROTATION_OVER_TIME_MODULE_ENABLE"],binding:4,stageFlags:1,members:[{name:"u_rotation_mode",type:5,count:1}]},{name:"SizeConstant",defines:["SIZE_OVER_TIME_MODULE_ENABLE"],binding:5,stageFlags:1,members:[{name:"u_size_mode",type:5,count:1}]},{name:"ForceConstant",defines:["FORCE_OVER_TIME_MODULE_ENABLE"],binding:6,stageFlags:1,members:[{name:"u_force_mode",type:5,count:1},{name:"u_force_space",type:5,count:1}]},{name:"VelocityConstant",defines:["VELOCITY_OVER_TIME_MODULE_ENABLE"],binding:7,stageFlags:1,members:[{name:"u_velocity_mode",type:5,count:1},{name:"u_velocity_space",type:5,count:1}]},{name:"AnimationConstant",defines:["TEXTURE_ANIMATION_MODULE_ENABLE"],binding:8,stageFlags:1,members:[{name:"u_anim_info",type:16,count:1}]},{name:"FragConstants",defines:[],binding:9,stageFlags:16,members:[{name:"tintColor",type:16,count:1}]}],samplers:[{name:"color_over_time_tex0",type:28,count:1,defines:["COLOR_OVER_TIME_MODULE_ENABLE"],stageFlags:1,binding:10},{name:"rotation_over_time_tex0",type:28,count:1,defines:["ROTATION_OVER_TIME_MODULE_ENABLE"],stageFlags:1,binding:11},{name:"size_over_time_tex0",type:28,count:1,defines:["SIZE_OVER_TIME_MODULE_ENABLE"],stageFlags:1,binding:12},{name:"force_over_time_tex0",type:28,count:1,defines:["FORCE_OVER_TIME_MODULE_ENABLE"],stageFlags:1,binding:13},{name:"velocity_over_time_tex0",type:28,count:1,defines:["VELOCITY_OVER_TIME_MODULE_ENABLE"],stageFlags:1,binding:14},{name:"texture_animation_tex0",type:28,count:1,defines:["TEXTURE_ANIMATION_MODULE_ENABLE"],stageFlags:1,binding:15},{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:16}],attributes:[{name:"a_position_starttime",type:16,count:1,defines:[],stageFlags:1,format:44,location:0},{name:"a_size_uv",type:16,count:1,defines:[],stageFlags:1,format:44,location:1},{name:"a_rotation_uv",type:16,count:1,defines:[],stageFlags:1,format:44,location:2},{name:"a_color",type:16,count:1,defines:[],stageFlags:1,format:44,location:3},{name:"a_dir_life",type:16,count:1,defines:[],stageFlags:1,format:44,location:4},{name:"a_rndSeed",type:13,count:1,defines:[],stageFlags:1,format:11,location:5},{name:"a_texCoord",type:15,count:1,defines:["CC_RENDER_MODE"],stageFlags:1,format:32,location:6},{name:"a_texCoord3",type:15,count:1,defines:["CC_RENDER_MODE"],stageFlags:1,format:32,location:7},{name:"a_normal",type:15,count:1,defines:["CC_RENDER_MODE"],stageFlags:1,format:32,location:8},{name:"a_color1",type:16,count:1,defines:["CC_RENDER_MODE"],stageFlags:1,format:44,location:9}]}]},{name:"particle-trail",techniques:[{name:"add",passes:[{rasterizerState:{cullMode:0},blendState:{targets:[{blend:!0,blendSrc:2,blendDst:1,blendSrcAlpha:2,blendDstAlpha:1}]},program:"particle-trail|particle-trail:vs_main|tinted-fs:add",depthStencilState:{depthTest:!0,depthWrite:!1},properties:{mainTexture:{value:"grey",type:28},mainTiling_Offset:{value:[1,1,0,0],type:16},frameTile_velLenScale:{value:[1,1,0,0],type:16},tintColor:{value:[.5,.5,.5,.5],type:16}}}]}],shaders:[{name:"particle-trail|particle-trail:vs_main|tinted-fs:add",hash:4115155772,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplers:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplers:[]}},defines:[{name:"CC_RENDER_MODE",type:"number",range:[0,4]},{name:"CC_DRAW_WIRE_FRAME",type:"boolean"},{name:"CC_USE_WORLD_SPACE",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:1,members:[{name:"mainTiling_Offset",type:16,count:1},{name:"frameTile_velLenScale",type:16,count:1},{name:"scale",type:16,count:1}]},{name:"FragConstants",defines:[],binding:1,stageFlags:16,members:[{name:"tintColor",type:16,count:1}]}],samplers:[{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:2}],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_texCoord",type:16,count:1,defines:[],stageFlags:1,format:44,location:1},{name:"a_texCoord1",type:15,count:1,defines:[],stageFlags:1,format:32,location:2},{name:"a_texCoord2",type:15,count:1,defines:[],stageFlags:1,format:32,location:3},{name:"a_color",type:16,count:1,defines:[],stageFlags:1,format:44,location:4}]}]},{name:"particle",techniques:[{name:"add",passes:[{rasterizerState:{cullMode:0},blendState:{targets:[{blend:!0,blendSrc:2,blendDst:1,blendSrcAlpha:2,blendDstAlpha:1}]},program:"particle|particle-vs-legacy:lpvs_main|tinted-fs:add",depthStencilState:{depthTest:!0,depthWrite:!1},properties:{mainTexture:{value:"grey",type:28},mainTiling_Offset:{value:[1,1,0,0],type:16},tintColor:{value:[.5,.5,.5,.5],type:16}}}]}],shaders:[{name:"particle|particle-vs-legacy:lpvs_main|tinted-fs:add",hash:66662317,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplers:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplers:[]}},defines:[{name:"CC_RENDER_MODE",type:"number",range:[0,4]},{name:"CC_USE_WORLD_SPACE",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:1,members:[{name:"mainTiling_Offset",type:16,count:1},{name:"frameTile_velLenScale",type:16,count:1},{name:"scale",type:16,count:1}]},{name:"FragConstants",defines:[],binding:1,stageFlags:16,members:[{name:"tintColor",type:16,count:1}]}],samplers:[{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:2}],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_texCoord",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord1",type:15,count:1,defines:[],stageFlags:1,format:32,location:2},{name:"a_texCoord2",type:15,count:1,defines:[],stageFlags:1,format:32,location:3},{name:"a_color",type:16,count:1,defines:[],stageFlags:1,format:44,location:4},{name:"a_color1",type:15,count:1,defines:["CC_RENDER_MODE"],stageFlags:1,format:32,location:8},{name:"a_texCoord3",type:15,count:1,defines:["CC_RENDER_MODE"],stageFlags:1,format:32,location:6},{name:"a_normal",type:15,count:1,defines:["CC_RENDER_MODE"],stageFlags:1,format:32,location:7}]}]},{name:"spine",techniques:[{passes:[{blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},rasterizerState:{cullMode:0},program:"spine|sprite-vs:vert|sprite-fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1},properties:{alphaThreshold:{value:[.5],type:13}}}]}],shaders:[{name:"spine|sprite-vs:vert|sprite-fs:frag",hash:4078504952,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplers:[]},locals:{blocks:[{name:"CCLocal",defines:["USE_LOCAL"]}],samplers:[{name:"cc_spriteTexture",defines:[]}]}},defines:[{name:"USE_LOCAL",type:"boolean"},{name:"TWO_COLORED",type:"boolean"},{name:"USE_ALPHA_TEST",type:"boolean"}],blocks:[{name:"ALPHA_TEST_DATA",defines:["USE_ALPHA_TEST"],binding:0,stageFlags:16,members:[{name:"alphaThreshold",type:13,count:1}]}],samplers:[],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:1},{name:"a_color",type:16,count:1,defines:[],stageFlags:1,format:44,location:2},{name:"a_color2",type:16,count:1,defines:["TWO_COLORED"],stageFlags:1,format:44,location:3}]}]},{name:"sprite",techniques:[{passes:[{blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},rasterizerState:{cullMode:0},program:"sprite|sprite-vs:vert|sprite-fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1},properties:{alphaThreshold:{value:[.5],type:13}}}]}],shaders:[{name:"sprite|sprite-vs:vert|sprite-fs:frag",hash:3990469549,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplers:[]},locals:{blocks:[{name:"CCLocal",defines:["USE_LOCAL"]}],samplers:[{name:"cc_spriteTexture",defines:["USE_TEXTURE"]}]}},defines:[{name:"USE_LOCAL",type:"boolean"},{name:"USE_PIXEL_ALIGNMENT",type:"boolean"},{name:"CC_USE_EMBEDDED_ALPHA",type:"boolean"},{name:"USE_ALPHA_TEST",type:"boolean"},{name:"USE_TEXTURE",type:"boolean"},{name:"IS_GRAY",type:"boolean"}],blocks:[{name:"ALPHA_TEST_DATA",defines:["USE_ALPHA_TEST"],binding:0,stageFlags:16,members:[{name:"alphaThreshold",type:13,count:1}]}],samplers:[],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:1},{name:"a_color",type:16,count:1,defines:[],stageFlags:1,format:44,location:2}]}]},{name:"standard",techniques:[{name:"opaque",passes:[{program:"standard|standard-vs:vert|standard-fs:frag",properties:{tilingOffset:{value:[1,1,0,0],type:16},mainColor:{value:[1,1,1,1],type:16,handleInfo:["albedo",0,16]},albedoScale:{value:[1,1,1],type:15,handleInfo:["albedoScaleAndCutoff",0,15]},alphaThreshold:{value:[.5],type:13,handleInfo:["albedoScaleAndCutoff",3,13]},occlusion:{value:[1],type:13,handleInfo:["pbrParams",0,13]},roughness:{value:[.8],type:13,handleInfo:["pbrParams",1,13]},metallic:{value:[.6],type:13,handleInfo:["pbrParams",2,13]},normalStrenth:{value:[1],type:13,handleInfo:["pbrParams",3,13]},emissive:{value:[0,0,0,1],type:16},emissiveScale:{value:[1,1,1],type:15,handleInfo:["emissiveScaleParam",0,15]},mainTexture:{value:"grey",type:28,handleInfo:["albedoMap",0,28]},normalMap:{value:"normal",type:28},pbrMap:{value:"grey",type:28},metallicRoughnessMap:{value:"grey",type:28},occlusionMap:{value:"white",type:28},emissiveMap:{value:"grey",type:28},albedo:{type:16,value:[1,1,1,1]},albedoScaleAndCutoff:{type:16,value:[1,1,1,.5]},pbrParams:{type:16,value:[1,.8,.6,1]},emissiveScaleParam:{type:16,value:[1,1,1,0]},albedoMap:{type:28,value:"grey"}}},{phase:"forward-add",propertyIndex:0,embeddedMacros:{CC_FORWARD_ADD:!0},blendState:{targets:[{blend:!0,blendSrc:1,blendDst:1,blendSrcAlpha:0,blendDstAlpha:1}]},program:"standard|standard-vs:vert|standard-fs:frag",depthStencilState:{depthFunc:2,depthTest:!0,depthWrite:!1},properties:{tilingOffset:{value:[1,1,0,0],type:16},mainColor:{value:[1,1,1,1],type:16,handleInfo:["albedo",0,16]},albedoScale:{value:[1,1,1],type:15,handleInfo:["albedoScaleAndCutoff",0,15]},alphaThreshold:{value:[.5],type:13,handleInfo:["albedoScaleAndCutoff",3,13]},occlusion:{value:[1],type:13,handleInfo:["pbrParams",0,13]},roughness:{value:[.8],type:13,handleInfo:["pbrParams",1,13]},metallic:{value:[.6],type:13,handleInfo:["pbrParams",2,13]},normalStrenth:{value:[1],type:13,handleInfo:["pbrParams",3,13]},emissive:{value:[0,0,0,1],type:16},emissiveScale:{value:[1,1,1],type:15,handleInfo:["emissiveScaleParam",0,15]},mainTexture:{value:"grey",type:28,handleInfo:["albedoMap",0,28]},normalMap:{value:"normal",type:28},pbrMap:{value:"grey",type:28},metallicRoughnessMap:{value:"grey",type:28},occlusionMap:{value:"white",type:28},emissiveMap:{value:"grey",type:28},albedo:{type:16,value:[1,1,1,1]},albedoScaleAndCutoff:{type:16,value:[1,1,1,.5]},pbrParams:{type:16,value:[1,.8,.6,1]},emissiveScaleParam:{type:16,value:[1,1,1,0]},albedoMap:{type:28,value:"grey"}}},{phase:"shadow-caster",propertyIndex:0,rasterizerState:{cullMode:1},program:"standard|shadow-caster-vs:vert|shadow-caster-fs:frag",properties:{tilingOffset:{value:[1,1,0,0],type:16},mainColor:{value:[1,1,1,1],type:16,handleInfo:["albedo",0,16]},albedoScale:{value:[1,1,1],type:15,handleInfo:["albedoScaleAndCutoff",0,15]},alphaThreshold:{value:[.5],type:13,handleInfo:["albedoScaleAndCutoff",3,13]},occlusion:{value:[1],type:13,handleInfo:["pbrParams",0,13]},roughness:{value:[.8],type:13,handleInfo:["pbrParams",1,13]},metallic:{value:[.6],type:13,handleInfo:["pbrParams",2,13]},normalStrenth:{value:[1],type:13,handleInfo:["pbrParams",3,13]},emissive:{value:[0,0,0,1],type:16},emissiveScale:{value:[1,1,1],type:15,handleInfo:["emissiveScaleParam",0,15]},mainTexture:{value:"grey",type:28,handleInfo:["albedoMap",0,28]},albedo:{type:16,value:[1,1,1,1]},albedoScaleAndCutoff:{type:16,value:[1,1,1,.5]},pbrParams:{type:16,value:[1,.8,.6,1]},emissiveScaleParam:{type:16,value:[1,1,1,0]},albedoMap:{type:28,value:"grey"}}}]}],shaders:[{name:"standard|standard-vs:vert|standard-fs:frag",hash:2668109714,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]},{name:"CCShadow",defines:[]}],samplers:[{name:"cc_environment",defines:["CC_USE_IBL"]},{name:"cc_shadowMap",defines:["CC_RECEIVE_SHADOW"]},{name:"cc_spotLightingMap",defines:["CC_RECEIVE_SHADOW"]}]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]},{name:"CCLocalBatched",defines:["!USE_INSTANCING","USE_BATCHING"]},{name:"CCLocal",defines:["!USE_INSTANCING","!USE_BATCHING"]},{name:"CCForwardLight",defines:["CC_FORWARD_ADD"]}],samplers:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"cc_lightingMap",defines:["USE_LIGHTMAP","!USE_BATCHING","!CC_FORWARD_ADD"]}]}},defines:[{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_SUPPORT_FLOAT_TEXTURE",type:"boolean"},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"USE_LIGHTMAP",type:"boolean"},{name:"CC_USE_FOG",type:"number",range:[0,4]},{name:"CC_FORWARD_ADD",type:"boolean"},{name:"USE_VERTEX_COLOR",type:"boolean"},{name:"USE_NORMAL_MAP",type:"boolean"},{name:"HAS_SECOND_UV",type:"boolean"},{name:"CC_USE_IBL",type:"number",range:[0,2]},{name:"CC_RECEIVE_SHADOW",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"},{name:"USE_ALBEDO_MAP",type:"boolean"},{name:"ALBEDO_UV",type:"string",options:["v_uv","v_uv1"]},{name:"NORMAL_UV",type:"string",options:["v_uv","v_uv1"]},{name:"PBR_UV",type:"string",options:["v_uv","v_uv1"]},{name:"USE_PBR_MAP",type:"boolean"},{name:"USE_METALLIC_ROUGHNESS_MAP",type:"boolean"},{name:"USE_OCCLUSION_MAP",type:"boolean"},{name:"USE_EMISSIVE_MAP",type:"boolean"},{name:"EMISSIVE_UV",type:"string",options:["v_uv","v_uv1"]},{name:"USE_ALPHA_TEST",type:"boolean"},{name:"ALPHA_TEST_CHANNEL",type:"string",options:["a","r"]}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:17,members:[{name:"tilingOffset",type:16,count:1},{name:"albedo",type:16,count:1},{name:"albedoScaleAndCutoff",type:16,count:1},{name:"pbrParams",type:16,count:1},{name:"emissive",type:16,count:1},{name:"emissiveScaleParam",type:16,count:1}]}],samplers:[{name:"albedoMap",type:28,count:1,defines:["USE_ALBEDO_MAP"],stageFlags:16,binding:1},{name:"normalMap",type:28,count:1,defines:["USE_NORMAL_MAP"],stageFlags:16,binding:2},{name:"pbrMap",type:28,count:1,defines:["USE_PBR_MAP"],stageFlags:16,binding:3},{name:"metallicRoughnessMap",type:28,count:1,defines:["USE_METALLIC_ROUGHNESS_MAP"],stageFlags:16,binding:4},{name:"occlusionMap",type:28,count:1,defines:["USE_OCCLUSION_MAP"],stageFlags:16,binding:5},{name:"emissiveMap",type:28,count:1,defines:["USE_EMISSIVE_MAP"],stageFlags:16,binding:6}],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_normal",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:2},{name:"a_tangent",type:16,count:1,defines:[],stageFlags:1,format:44,location:3},{name:"a_vertexId",type:13,count:1,defines:["CC_USE_MORPH"],stageFlags:1,format:11,location:6},{name:"a_joints",type:12,count:1,defines:["CC_USE_SKINNING"],stageFlags:1,format:42,location:4},{name:"a_weights",type:16,count:1,defines:["CC_USE_SKINNING"],stageFlags:1,format:44,location:5},{name:"a_jointAnimInfo",type:16,count:1,defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION","USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:7},{name:"a_matWorld0",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:8},{name:"a_matWorld1",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:9},{name:"a_matWorld2",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:10},{name:"a_lightingMapUVParam",type:16,count:1,defines:["USE_INSTANCING","USE_LIGHTMAP"],stageFlags:1,format:44,isInstanced:!0,location:11},{name:"a_dyn_batch_id",type:13,count:1,defines:["!USE_INSTANCING","USE_BATCHING"],stageFlags:1,format:11,location:12},{name:"a_color",type:16,count:1,defines:["USE_VERTEX_COLOR"],stageFlags:1,format:44,location:13},{name:"a_texCoord1",type:14,count:1,defines:[],stageFlags:1,format:21,location:14}]},{name:"standard|shadow-caster-vs:vert|shadow-caster-fs:frag",hash:3020491,builtins:{globals:{blocks:[{name:"CCShadow",defines:[]}],samplers:[]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]},{name:"CCLocalBatched",defines:["!USE_INSTANCING","USE_BATCHING"]},{name:"CCLocal",defines:["!USE_INSTANCING","!USE_BATCHING"]}],samplers:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]}]}},defines:[{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_SUPPORT_FLOAT_TEXTURE",type:"boolean"},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"USE_LIGHTMAP",type:"boolean"},{name:"HAS_SECOND_UV",type:"boolean"},{name:"USE_ALBEDO_MAP",type:"boolean"},{name:"ALBEDO_UV",type:"string",options:["v_uv","v_uv1"]},{name:"USE_ALPHA_TEST",type:"boolean"},{name:"ALPHA_TEST_CHANNEL",type:"string",options:["a","r"]}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:17,members:[{name:"tilingOffset",type:16,count:1},{name:"albedo",type:16,count:1},{name:"albedoScaleAndCutoff",type:16,count:1},{name:"pbrParams",type:16,count:1},{name:"emissive",type:16,count:1},{name:"emissiveScaleParam",type:16,count:1}]}],samplers:[{name:"albedoMap",type:28,count:1,defines:["USE_ALBEDO_MAP"],stageFlags:16,binding:1}],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_normal",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:2},{name:"a_tangent",type:16,count:1,defines:[],stageFlags:1,format:44,location:3},{name:"a_vertexId",type:13,count:1,defines:["CC_USE_MORPH"],stageFlags:1,format:11,location:6},{name:"a_joints",type:12,count:1,defines:["CC_USE_SKINNING"],stageFlags:1,format:42,location:4},{name:"a_weights",type:16,count:1,defines:["CC_USE_SKINNING"],stageFlags:1,format:44,location:5},{name:"a_jointAnimInfo",type:16,count:1,defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION","USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:7},{name:"a_matWorld0",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:8},{name:"a_matWorld1",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:9},{name:"a_matWorld2",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:10},{name:"a_lightingMapUVParam",type:16,count:1,defines:["USE_INSTANCING","USE_LIGHTMAP"],stageFlags:1,format:44,isInstanced:!0,location:11},{name:"a_dyn_batch_id",type:13,count:1,defines:["!USE_INSTANCING","USE_BATCHING"],stageFlags:1,format:11,location:12},{name:"a_texCoord1",type:14,count:1,defines:[],stageFlags:1,format:21,location:13}]}]},{name:"terrain",techniques:[{name:"opaque",passes:[{program:"terrain|terrain-vs:vert|terrain-fs:frag",properties:{UVScale:{value:[1,1,1,1],type:16},lightMapUVParam:{value:[0,0,0,0],type:16},metallic:{value:[0,0,0,0],type:16},roughness:{value:[1,1,1,1],type:16},weightMap:{value:"black",type:28},detailMap0:{value:"grey",type:28},detailMap1:{value:"grey",type:28},detailMap2:{value:"grey",type:28},detailMap3:{value:"grey",type:28},normalMap0:{value:"normal-texture",type:28},normalMap1:{value:"normal-texture",type:28},normalMap2:{value:"normal-texture",type:28},normalMap3:{value:"normal-texture",type:28},lightMap:{value:"grey",type:28}}},{phase:"forward-add",propertyIndex:0,embeddedMacros:{CC_FORWARD_ADD:!0},blendState:{targets:[{blend:!0,blendSrc:1,blendDst:1,blendSrcAlpha:0,blendDstAlpha:1}]},program:"terrain|terrain-vs:vert|terrain-fs:frag",depthStencilState:{depthFunc:2,depthTest:!0,depthWrite:!1},properties:{UVScale:{value:[1,1,1,1],type:16},lightMapUVParam:{value:[0,0,0,0],type:16},metallic:{value:[0,0,0,0],type:16},roughness:{value:[1,1,1,1],type:16},weightMap:{value:"black",type:28},detailMap0:{value:"grey",type:28},detailMap1:{value:"grey",type:28},detailMap2:{value:"grey",type:28},detailMap3:{value:"grey",type:28},normalMap0:{value:"normal-texture",type:28},normalMap1:{value:"normal-texture",type:28},normalMap2:{value:"normal-texture",type:28},normalMap3:{value:"normal-texture",type:28},lightMap:{value:"grey",type:28}}},{phase:"shadow-add",propertyIndex:0,rasterizerState:{cullMode:2},program:"terrain|shadow-caster-vs:vert|shadow-caster-fs:frag"}]}],shaders:[{name:"terrain|terrain-vs:vert|terrain-fs:frag",hash:2952542850,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]},{name:"CCShadow",defines:[]}],samplers:[{name:"cc_environment",defines:["CC_USE_IBL"]},{name:"cc_shadowMap",defines:["CC_RECEIVE_SHADOW"]},{name:"cc_spotLightingMap",defines:["CC_RECEIVE_SHADOW"]}]},locals:{blocks:[{name:"CCLocal",defines:[]},{name:"CCForwardLight",defines:["CC_FORWARD_ADD"]}],samplers:[]}},defines:[{name:"CC_USE_FOG",type:"number",range:[0,4]},{name:"CC_FORWARD_ADD",type:"boolean"},{name:"USE_NORMALMAP",type:"boolean"},{name:"USE_LIGHTMAP",type:"boolean"},{name:"CC_USE_IBL",type:"number",range:[0,2]},{name:"CC_RECEIVE_SHADOW",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"},{name:"LAYERS",type:"number",range:[0,4]},{name:"USE_PBR",type:"boolean"}],blocks:[{name:"TexCoords",defines:[],binding:0,stageFlags:1,members:[{name:"UVScale",type:16,count:1},{name:"lightMapUVParam",type:16,count:1}]},{name:"PbrParams",defines:[],binding:1,stageFlags:16,members:[{name:"metallic",type:16,count:1},{name:"roughness",type:16,count:1}]}],samplers:[{name:"weightMap",type:28,count:1,defines:[],stageFlags:16,binding:2},{name:"detailMap0",type:28,count:1,defines:[],stageFlags:16,binding:3},{name:"detailMap1",type:28,count:1,defines:[],stageFlags:16,binding:4},{name:"detailMap2",type:28,count:1,defines:[],stageFlags:16,binding:5},{name:"detailMap3",type:28,count:1,defines:[],stageFlags:16,binding:6},{name:"normalMap0",type:28,count:1,defines:[],stageFlags:16,binding:7},{name:"normalMap1",type:28,count:1,defines:[],stageFlags:16,binding:8},{name:"normalMap2",type:28,count:1,defines:[],stageFlags:16,binding:9},{name:"normalMap3",type:28,count:1,defines:[],stageFlags:16,binding:10},{name:"lightMap",type:28,count:1,defines:[],stageFlags:16,binding:11}],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_normal",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:2}]},{name:"terrain|shadow-caster-vs:vert|shadow-caster-fs:frag",hash:3874167763,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]},{name:"CCShadow",defines:[]}],samplers:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplers:[]}},defines:[],blocks:[],samplers:[],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_normal",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:2}]}]},{name:"unlit",techniques:[{name:"opaque",passes:[{program:"unlit|unlit-vs:vert|unlit-fs:frag",properties:{mainTexture:{value:"grey",type:28},tilingOffset:{value:[1,1,0,0],type:16},mainColor:{value:[1,1,1,1],type:16},colorScale:{value:[1,1,1],type:15,handleInfo:["colorScaleAndCutoff",0,15]},alphaThreshold:{value:[.5],type:13,handleInfo:["colorScaleAndCutoff",3,13]},color:{type:16,handleInfo:["mainColor",0,16]},colorScaleAndCutoff:{type:16,value:[1,1,1,.5]}}}]}],shaders:[{name:"unlit|unlit-vs:vert|unlit-fs:frag",hash:3822871803,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplers:[]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]},{name:"CCLocalBatched",defines:["!USE_INSTANCING","USE_BATCHING"]},{name:"CCLocal",defines:["!USE_INSTANCING","!USE_BATCHING"]}],samplers:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]}]}},defines:[{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_SUPPORT_FLOAT_TEXTURE",type:"boolean"},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"USE_LIGHTMAP",type:"boolean"},{name:"CC_USE_FOG",type:"number",range:[0,4]},{name:"CC_FORWARD_ADD",type:"boolean"},{name:"USE_VERTEX_COLOR",type:"boolean"},{name:"USE_TEXTURE",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"},{name:"USE_ALPHA_TEST",type:"boolean"},{name:"ALPHA_TEST_CHANNEL",type:"string",options:["a","r","g","b"]}],blocks:[{name:"TexCoords",defines:["USE_TEXTURE"],binding:0,stageFlags:1,members:[{name:"tilingOffset",type:16,count:1}]},{name:"Constant",defines:[],binding:1,stageFlags:16,members:[{name:"mainColor",type:16,count:1},{name:"colorScaleAndCutoff",type:16,count:1}]}],samplers:[{name:"mainTexture",type:28,count:1,defines:["USE_TEXTURE"],stageFlags:16,binding:2}],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_normal",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:2},{name:"a_tangent",type:16,count:1,defines:[],stageFlags:1,format:44,location:3},{name:"a_vertexId",type:13,count:1,defines:["CC_USE_MORPH"],stageFlags:1,format:11,location:6},{name:"a_joints",type:12,count:1,defines:["CC_USE_SKINNING"],stageFlags:1,format:42,location:4},{name:"a_weights",type:16,count:1,defines:["CC_USE_SKINNING"],stageFlags:1,format:44,location:5},{name:"a_jointAnimInfo",type:16,count:1,defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION","USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:7},{name:"a_matWorld0",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:8},{name:"a_matWorld1",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:9},{name:"a_matWorld2",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:10},{name:"a_lightingMapUVParam",type:16,count:1,defines:["USE_INSTANCING","USE_LIGHTMAP"],stageFlags:1,format:44,isInstanced:!0,location:11},{name:"a_dyn_batch_id",type:13,count:1,defines:["!USE_INSTANCING","USE_BATCHING"],stageFlags:1,format:11,location:12},{name:"a_color",type:16,count:1,defines:["USE_VERTEX_COLOR"],stageFlags:1,format:44,location:13}]}]},{name:"planar-shadow",techniques:[{passes:[{phase:"planarShadow",blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},program:"planar-shadow|planar-shadow-vs:vert|planar-shadow-fs:frag",depthStencilState:{depthTest:!0,depthWrite:!1,stencilTestFront:!0,stencilFuncFront:5,stencilPassOpFront:2,stencilRefBack:128,stencilRefFront:128,stencilReadMaskBack:128,stencilReadMaskFront:128,stencilWriteMaskBack:128,stencilWriteMaskFront:128}}]}],shaders:[{name:"planar-shadow|planar-shadow-vs:vert|planar-shadow-fs:frag",hash:2901856202,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]},{name:"CCShadow",defines:[]}],samplers:[]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]},{name:"CCLocalBatched",defines:["!USE_INSTANCING","USE_BATCHING"]},{name:"CCLocal",defines:["!USE_INSTANCING","!USE_BATCHING"]}],samplers:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]}]}},defines:[{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_SUPPORT_FLOAT_TEXTURE",type:"boolean"},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"USE_LIGHTMAP",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"}],blocks:[],samplers:[],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_normal",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:2},{name:"a_tangent",type:16,count:1,defines:[],stageFlags:1,format:44,location:3},{name:"a_vertexId",type:13,count:1,defines:["CC_USE_MORPH"],stageFlags:1,format:11,location:6},{name:"a_joints",type:12,count:1,defines:["CC_USE_SKINNING"],stageFlags:1,format:42,location:4},{name:"a_weights",type:16,count:1,defines:["CC_USE_SKINNING"],stageFlags:1,format:44,location:5},{name:"a_jointAnimInfo",type:16,count:1,defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION","USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:7},{name:"a_matWorld0",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:8},{name:"a_matWorld1",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:9},{name:"a_matWorld2",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:10},{name:"a_lightingMapUVParam",type:16,count:1,defines:["USE_INSTANCING","USE_LIGHTMAP"],stageFlags:1,format:44,isInstanced:!0,location:11},{name:"a_dyn_batch_id",type:13,count:1,defines:["!USE_INSTANCING","USE_BATCHING"],stageFlags:1,format:11,location:12}]}]},{name:"skybox",techniques:[{passes:[{rasterizerState:{cullMode:0},program:"skybox|sky-vs:vert|sky-fs:frag",priority:245,depthStencilState:{depthTest:!0,depthWrite:!1}}]}],shaders:[{name:"skybox|sky-vs:vert|sky-fs:frag",hash:2319917655,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplers:[{name:"cc_environment",defines:[]}]},locals:{blocks:[],samplers:[]}},defines:[{name:"CC_USE_IBL",type:"number",range:[0,2]},{name:"CC_USE_HDR",type:"boolean"},{name:"USE_RGBE_CUBEMAP",type:"boolean"}],blocks:[],samplers:[],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_normal",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:2},{name:"a_tangent",type:16,count:1,defines:[],stageFlags:1,format:44,location:3}]}]},{name:"profiler",techniques:[{passes:[{blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},rasterizerState:{cullMode:0},program:"profiler|profiler-vs:vert|profiler-fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1}}]}],shaders:[{name:"profiler|profiler-vs:vert|profiler-fs:frag",hash:2029303284,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplers:[]},locals:{blocks:[],samplers:[]}},defines:[{name:"CC_USE_HDR",type:"boolean"}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:1,members:[{name:"offset",type:16,count:1}]},{name:"PerFrameInfo",defines:[],binding:1,stageFlags:1,members:[{name:"digits",type:16,count:20}]}],samplers:[{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:2}],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_color",type:16,count:1,defines:[],stageFlags:1,format:44,location:1}]}]},{name:"splash-screen",techniques:[{passes:[{blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},rasterizerState:{cullMode:0},program:"splash-screen|splash-screen-vs:vert|splash-screen-fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1}}]}],shaders:[{name:"splash-screen|splash-screen-vs:vert|splash-screen-fs:frag",hash:2106901053,builtins:{globals:{blocks:[],samplers:[]},locals:{blocks:[],samplers:[]}},defines:[],blocks:[{name:"splashFrag",defines:[],binding:0,stageFlags:16,members:[{name:"u_precent",type:13,count:1}]}],samplers:[{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:1}],attributes:[{name:"a_position",type:14,count:1,defines:[],stageFlags:1,format:21,location:0},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:1}]}]}]);!function(e){e[e.UBO=0]="UBO",e[e.SAMPLER=1]="SAMPLER"}(Dm||(Dm={}));var Fm=function(e,t,n,i,r){return void 0===r&&(r=0),e<<28&4026531840|i<<22&264241152|t<<20&3145728|n<<14&1032192|16383&r},zm=function(e){return(4026531840&e)>>>28},Bm=function(e){return(264241152&e)>>>22},Um=function(e){return(1032192&e)>>>14},Gm=function(e){return 16383&e},Hm=function(e,t){return-264241153&e|t<<22&264241152},km=((Pm={})[Zo.UNKNOWN]=function(){return console.warn("illegal uniform handle")},Pm[Zo.INT]=function(e,t,n){return void 0===n&&(n=0),e[n]},Pm[Zo.INT2]=function(e,t,n){return void 0===n&&(n=0),ri.fromArray(t,e,n)},Pm[Zo.INT3]=function(e,t,n){return void 0===n&&(n=0),Un.fromArray(t,e,n)},Pm[Zo.INT4]=function(e,t,n){return void 0===n&&(n=0),ci.fromArray(t,e,n)},Pm[Zo.FLOAT]=function(e,t,n){return void 0===n&&(n=0),e[n]},Pm[Zo.FLOAT2]=function(e,t,n){return void 0===n&&(n=0),ri.fromArray(t,e,n)},Pm[Zo.FLOAT3]=function(e,t,n){return void 0===n&&(n=0),Un.fromArray(t,e,n)},Pm[Zo.FLOAT4]=function(e,t,n){return void 0===n&&(n=0),ci.fromArray(t,e,n)},Pm[Zo.MAT3]=function(e,t,n){return void 0===n&&(n=0),Vn.fromArray(t,e,n)},Pm[Zo.MAT4]=function(e,t,n){return void 0===n&&(n=0),ei.fromArray(t,e,n)},Pm),Vm=((Mm={})[Zo.UNKNOWN]=function(){return console.warn("illegal uniform handle")},Mm[Zo.INT]=function(e,t,n){return void 0===n&&(n=0),e[n]=t},Mm[Zo.INT2]=function(e,t,n){return void 0===n&&(n=0),ri.toArray(e,t,n)},Mm[Zo.INT3]=function(e,t,n){return void 0===n&&(n=0),Un.toArray(e,t,n)},Mm[Zo.INT4]=function(e,t,n){return void 0===n&&(n=0),ci.toArray(e,t,n)},Mm[Zo.FLOAT]=function(e,t,n){return void 0===n&&(n=0),e[n]=t},Mm[Zo.FLOAT2]=function(e,t,n){return void 0===n&&(n=0),ri.toArray(e,t,n)},Mm[Zo.FLOAT3]=function(e,t,n){return void 0===n&&(n=0),Un.toArray(e,t,n)},Mm[Zo.FLOAT4]=function(e,t,n){return void 0===n&&(n=0),ci.toArray(e,t,n)},Mm[Zo.MAT3]=function(e,t,n){return void 0===n&&(n=0),Vn.toArray(e,t,n)},Mm[Zo.MAT4]=function(e,t,n){return void 0===n&&(n=0),ei.toArray(e,t,n)},Mm),jm=[Object.freeze([0]),Object.freeze([0,0]),Object.freeze([0,0,0,0]),Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])];function Wm(e){switch(e){case Zo.BOOL:case Zo.INT:case Zo.UINT:case Zo.FLOAT:return jm[0];case Zo.BOOL2:case Zo.INT2:case Zo.UINT2:case Zo.FLOAT2:return jm[1];case Zo.BOOL4:case Zo.INT4:case Zo.UINT4:case Zo.FLOAT4:return jm[2];case Zo.MAT4:return jm[3];case Zo.SAMPLER2D:return"default-texture";case Zo.SAMPLER_CUBE:return"default-cube-texture"}return jm[0]}function qm(e,t){for(var n=Object.entries(t),i=!1,r=0;r<n.length;r++)e[n[r][0]]!==n[r][1]&&(e[n[r][0]]=n[r][1],i=!0);return i}var Ym=new Ys;function Xm(e){return Math.ceil(Math.log2(Math.max(e,2)))}function Km(e,t){switch(e.type){case"boolean":return"number"==typeof t?t.toString():t?"1":"0";case"string":return void 0!==t?t:e.options[0];case"number":return void 0!==t?t.toString():e.range[0].toString();default:return console.warn("unknown define type '"+e.type+"'"),"-1"}}function Qm(e,t,n,i,r){for(var o=e.builtins[i],a=[],s=function(e){var t=o.blocks[e],i=n.layouts[t.name],s=i&&n.bindings.find((function(e){return e.binding===i.binding}));if(!(i&&s&&s.descriptorType&ks))return console.warn("builtin UBO '"+t.name+"' not available!"),"continue";a.push(i),r&&!r.includes(s)&&r.push(s)},c=0;c<o.blocks.length;c++)s(c);Array.prototype.unshift.apply(t.gfxBlocks,a);for(var l=[],u=function(e){var t=o.samplers[e],i=n.layouts[t.name],a=i&&n.bindings.find((function(e){return e.binding===i.binding}));if(!(i&&a&&a.descriptorType&Vs))return console.warn("builtin sampler '"+t.name+"' not available!"),"continue";l.push(i),r&&!r.includes(a)&&r.push(a)},h=0;h<o.samplers.length;h++)u(h);Array.prototype.unshift.apply(t.gfxSamplers,l),r&&r.sort((function(e,t){return e.binding-t.binding}))}function Zm(e){return e.members.reduce((function(e,t){return e+Ga(t.type)*t.count}),0)}function Jm(e,t){for(var n=0;n<e.length;n++){var i=e[n];if("!"===i[0]){if(t[i.slice(1)])return!1}else if(!t[i])return!1}return!0}function $m(e){switch(e.gfxAPI){case Oa.GLES2:case Oa.WEBGL:return"glsl1";case Oa.GLES3:case Oa.WEBGL2:return"glsl3";default:return"glsl4"}}var ed=new(function(){function e(){this._templates={},this._cache={},this._templateInfos={}}var t=e.prototype;return t.register=function(e){for(var t=0;t<e.shaders.length;t++)this.define(e.shaders[t]).effectName=e.name},t.define=function(e){var t=this._templates[e.name];if(t&&t.hash===e.hash)return t;for(var n=J({},e),i=0,r=function(e){var t=n.defines[e],r=1;if("number"===t.type){var o=t.range;r=Xm(o[1]-o[0]+1),t._map=function(e){return e-o[0]}}else"string"===t.type?(r=Xm(t.options.length),t._map=function(e){return Math.max(0,t.options.findIndex((function(t){return t===e})))}):"boolean"===t.type&&(t._map=function(e){return e?1:0});t._offset=i,i+=r},o=0;o<n.defines.length;o++)r(o);if(i>31&&(n.uber=!0),this._templates[e.name]=n,!this._templateInfos[n.hash]){var a={};a.samplerStartBinding=n.blocks.length,a.gfxBlocks=[],a.gfxSamplers=[],a.bindings=[],a.blockSizes=[];for(var s=0;s<n.blocks.length;s++){var c=n.blocks[s];a.blockSizes.push(Zm(c)),a.bindings.push(new qs(c.binding,c.descriptorType||ya.UNIFORM_BUFFER,1,c.stageFlags)),a.gfxBlocks.push(new Ms(nu.MATERIAL,c.binding,c.name,c.members.map((function(e){return new Ps(e.name,e.type,e.count)})),1))}for(var l=0;l<n.samplers.length;l++){var u=n.samplers[l];a.bindings.push(new qs(u.binding,u.descriptorType||ya.SAMPLER,u.count,u.stageFlags)),a.gfxSamplers.push(new Ds(nu.MATERIAL,u.binding,u.name,u.type,u.count))}a.gfxAttributes=[];for(var h=0;h<n.attributes.length;h++){var _=n.attributes[h];a.gfxAttributes.push(new rs(_.name,_.format,_.isNormalized,0,_.isInstanced,_.location))}Qm(n,a,Jl,"locals"),a.gfxStages=[],a.gfxStages.push(new Ns(ga.VERTEX,"")),a.gfxStages.push(new Ns(ga.FRAGMENT,"")),a.handleMap=function(e){for(var t={},n=0;n<e.blocks.length;n++)for(var i=e.blocks[n],r=i.members,o=0,a=0;a<r.length;a++){var s=r[a];t[s.name]=Fm(Dm.UBO,nu.MATERIAL,i.binding,s.type,o),o+=(Ga(s.type)>>2)*s.count}for(var c=0;c<e.samplers.length;c++){var l=e.samplers[c];t[l.name]=Fm(Dm.SAMPLER,nu.MATERIAL,l.binding,l.type)}return t}(n),a.hPipelineLayout=Qi,a.setLayouts=[],this._templateInfos[n.hash]=a}return n},t.getTemplate=function(e){return this._templates[e]},t.getTemplateInfo=function(e){var t=this._templates[e].hash;return this._templateInfos[t]},t.getDescriptorSetLayout=function(e,t,n){void 0===n&&(n=!1);var i=this._templates[t],r=this._templateInfos[i.hash];return r.setLayouts.length||(Ym.bindings=r.bindings,r.setLayouts[nu.MATERIAL]=e.createDescriptorSetLayout(Ym),Ym.bindings=Jl.bindings,r.setLayouts[nu.LOCAL]=e.createDescriptorSetLayout(Ym)),r.setLayouts[n?nu.LOCAL:nu.MATERIAL]},t.hasProgram=function(e){return void 0!==this._templates[e]},t.getKey=function(e,t){var n=this._templates[e],i=n.defines;if(n.uber){for(var r="",o=0;o<i.length;o++){var a=i[o],s=t[a.name];if(s&&a._map){var c=a._map(s);r+=""+a._offset+c+"|"}}return""+r+n.hash}for(var l=0,u=0;u<i.length;u++){var h=i[u],_=t[h.name];_&&h._map&&(l|=h._map(_)<<h._offset)}return l.toString(16)+"|"+n.hash},t.destroyShaderByDefines=function(e){var t=this,n=Object.keys(e);if(n.length)for(var i=n.map((function(t){var n=e[t];return"boolean"==typeof n&&(n=n?"1":"0"),new RegExp(""+t+n)})),r=Object.keys(this._cache).filter((function(e){return i.every((function(n){return n.test(Zi.get(t._cache[e]).name)}))})),o=0;o<r.length;o++){var a=r[o],s=Zi.get(this._cache[a]);console.log("destroyed shader "+s.name),s.destroy(),delete this._cache[a]}},t.getGFXShader=function(e,t,n,i,r){Object.assign(n,i.macros),r||(r=this.getKey(t,n));var o=this._cache[r];if(o)return o;var a=this._templates[t],s=this._templateInfos[a.hash];s.hPipelineLayout||(this.getDescriptorSetLayout(e,t),Qm(a,s,Zl,"globals"),s.setLayouts[nu.GLOBAL]=i.descriptorSetLayout,s.hPipelineLayout=er.alloc(e,new Qs(s.setLayouts)));var c=function(e,t){for(var n=[],i=0;i<t.length;i++){var r=t[i],o=r.name,a=e[o],s=Km(r,a),c=!a||"0"===a;n.push({name:o,value:s,isDefault:c})}return n}(n,a.defines),l=c.reduce((function(e,t){return e+"#define "+t.name+" "+t.value+"\n"}),"")+"\n",u=a.glsl3,h=$m(e);h?u=a[h]:console.error("Invalid GFX API!"),s.gfxStages[0].source=l+u.vert,s.gfxStages[1].source=l+u.frag;var _=function(e,t,n){for(var i=[],r=e.attributes,o=t.gfxAttributes,a=0;a<r.length;a++)Jm(r[a].defines,n)&&i.push(o[a]);return i}(a,s,n),f=function(e,t){return e+t.reduce((function(e,t){return t.isDefault?e:e+"|"+t.name+t.value}),"")}(t,c),m=new Ls(f,s.gfxStages,_,s.gfxBlocks,s.gfxSamplers);return this._cache[r]=Zi.alloc(e,m)},e}());c.programLib=ed;var td,nd,id,rd={glsl1:[[{vert:"\nprecision mediump float;\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matViewInv;\nuniform highp mat4 cc_matViewProj;\nuniform highp mat4 cc_matWorld;\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\n  mat3 m = mat3(xAxis,yAxis,zAxis);\n  float trace = m[0][0] + m[1][1] + m[2][2];\n  vec4 quat;\n  if (trace > 0.) {\n    float s = 0.5 / sqrt(trace + 1.0);\n    quat.w = 0.25 / s;\n    quat.x = (m[2][1] - m[1][2]) * s;\n    quat.y = (m[0][2] - m[2][0]) * s;\n    quat.z = (m[1][0] - m[0][1]) * s;\n  } else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\n    float s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\n    quat.w = (m[2][1] - m[1][2]) / s;\n    quat.x = 0.25 * s;\n    quat.y = (m[0][1] + m[1][0]) / s;\n    quat.z = (m[0][2] + m[2][0]) / s;\n  } else if (m[1][1] > m[2][2]) {\n    float s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\n    quat.w = (m[0][2] - m[2][0]) / s;\n    quat.x = (m[0][1] + m[1][0]) / s;\n    quat.y = 0.25 * s;\n    quat.z = (m[1][2] + m[2][1]) / s;\n  } else {\n    float s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\n    quat.w = (m[1][0] - m[0][1]) / s;\n    quat.x = (m[0][2] + m[2][0]) / s;\n    quat.y = (m[1][2] + m[2][1]) / s;\n    quat.z = 0.25 * s;\n  }\n  float len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\n  if (len > 0.) {\n    len = 1. / sqrt(len);\n    quat.x = quat.x * len;\n    quat.y = quat.y * len;\n    quat.z = quat.z * len;\n    quat.w = quat.w * len;\n  }\n  return quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\n  float x = angle.x / 2.;\n  float y = angle.y / 2.;\n  float z = angle.z / 2.;\n  float sx = sin(x);\n  float cx = cos(x);\n  float sy = sin(y);\n  float cy = cos(y);\n  float sz = sin(z);\n  float cz = cos(z);\n  vec4 quat = vec4(0);\n  quat.x = sx * cy * cz + cx * sy * sz;\n  quat.y = cx * sy * cz + sx * cy * sz;\n  quat.z = cx * cy * sz - sx * sy * cz;\n  quat.w = cx * cy * cz - sx * sy * sz;\n  return quat;\n}\nvec4 quatMultiply (vec4 a, vec4 b){\n  vec4 quat;\n  quat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\n  quat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\n  quat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\n  quat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\n  return quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\n  float ix = q.w * v.x + q.y * v.z - q.z * v.y;\n  float iy = q.w * v.y + q.z * v.x - q.x * v.z;\n  float iz = q.w * v.z + q.x * v.y - q.y * v.x;\n  float iw = -q.x * v.x - q.y * v.y - q.z * v.z;\n  v.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\n  v.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\n  v.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\n  vec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\n  vec4 rotQuat = quatMultiply(viewQuat, q);\n  rotateVecFromQuat(pos, rotQuat);\n  return pos;\n}\nvoid rotateCorner (inout vec2 corner, float angle){\n  float xOS = cos(angle) * corner.x - sin(angle) * corner.y;\n  float yOS = sin(angle) * corner.x + cos(angle) * corner.y;\n  corner.x = xOS;\n  corner.y = yOS;\n}\nvarying mediump vec2 uv;\nvarying mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n  , mat4 viewInv\n) {\n  vec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\n  vec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\n  vec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\n  vec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\n  pos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n}\nattribute vec3 a_position;\nattribute vec2 a_texCoord;\nattribute vec4 a_color;\nuniform vec4 cc_size_rotation;\nvec4 vs_main() {\n  vec4 pos = vec4(a_position, 1);\n  pos = cc_matWorld * pos;\n  vec2 vertOffset = a_texCoord.xy - 0.5;\n  computeVertPos(pos, vertOffset, quaternionFromEuler(vec3(0., 0., cc_size_rotation.z)), vec3(cc_size_rotation.xy, 0.), cc_matViewInv);\n  pos = cc_matViewProj * pos;\n  uv = a_texCoord.xy;\n  color = a_color;\n  return pos;\n}\nvoid main() { gl_Position = vs_main(); }",frag:"\nprecision mediump float;\nuniform mediump vec4 cc_exposure;\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n  #if CC_USE_HDR\n    color.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n  #endif\n  return color;\n}\nvarying vec2 uv;\nvarying vec4 color;\nuniform sampler2D mainTexture;\nuniform vec4 tintColor;\nvec4 add () {\n  vec4 col = 2.0 * color * tintColor * texture2D(mainTexture, uv);\n  return CCFragOutput(col);\n}\nvoid main() { gl_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nattribute vec3 a_position;\nvec4 vert () {\n  vec4 pos = vec4(a_position, 1);\n  return pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 frag () {\n  vec4 o = vec4(1.0);\n  return o;\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nuniform highp mat4 cc_matViewProj;\nuniform highp mat4 cc_matWorld;\nattribute vec3 a_position;\nattribute vec4 a_color;\nvarying vec4 v_color;\nattribute float a_dist;\nvarying float v_dist;\nvec4 vert () {\n  vec4 pos = vec4(a_position, 1);\n  pos = cc_matViewProj * cc_matWorld * pos;\n  v_color = a_color;\n  v_dist = a_dist;\n  return pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives: enable\n#endif\nprecision highp float;\nvarying vec4 v_color;\nvarying float v_dist;\nvec4 frag () {\n  vec4 o = v_color;\n    #ifdef GL_OES_standard_derivatives\n      float aa = fwidth(v_dist);\n    #else\n      float aa = 0.05;\n    #endif\n  float alpha = 1. - smoothstep(-aa, 0., abs(v_dist) - 1.0);\n  o.rgb *= o.a;\n  o *= alpha;\n  return o;\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\n  mat3 m = mat3(xAxis,yAxis,zAxis);\n  float trace = m[0][0] + m[1][1] + m[2][2];\n  vec4 quat;\n  if (trace > 0.) {\n    float s = 0.5 / sqrt(trace + 1.0);\n    quat.w = 0.25 / s;\n    quat.x = (m[2][1] - m[1][2]) * s;\n    quat.y = (m[0][2] - m[2][0]) * s;\n    quat.z = (m[1][0] - m[0][1]) * s;\n  } else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\n    float s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\n    quat.w = (m[2][1] - m[1][2]) / s;\n    quat.x = 0.25 * s;\n    quat.y = (m[0][1] + m[1][0]) / s;\n    quat.z = (m[0][2] + m[2][0]) / s;\n  } else if (m[1][1] > m[2][2]) {\n    float s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\n    quat.w = (m[0][2] - m[2][0]) / s;\n    quat.x = (m[0][1] + m[1][0]) / s;\n    quat.y = 0.25 * s;\n    quat.z = (m[1][2] + m[2][1]) / s;\n  } else {\n    float s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\n    quat.w = (m[1][0] - m[0][1]) / s;\n    quat.x = (m[0][2] + m[2][0]) / s;\n    quat.y = (m[1][2] + m[2][1]) / s;\n    quat.z = 0.25 * s;\n  }\n  float len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\n  if (len > 0.) {\n    len = 1. / sqrt(len);\n    quat.x = quat.x * len;\n    quat.y = quat.y * len;\n    quat.z = quat.z * len;\n    quat.w = quat.w * len;\n  }\n  return quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\n  float x = angle.x / 2.;\n  float y = angle.y / 2.;\n  float z = angle.z / 2.;\n  float sx = sin(x);\n  float cx = cos(x);\n  float sy = sin(y);\n  float cy = cos(y);\n  float sz = sin(z);\n  float cz = cos(z);\n  vec4 quat = vec4(0);\n  quat.x = sx * cy * cz + cx * sy * sz;\n  quat.y = cx * sy * cz + sx * cy * sz;\n  quat.z = cx * cy * sz - sx * sy * cz;\n  quat.w = cx * cy * cz - sx * sy * sz;\n  return quat;\n}\nmat4 matrixFromRT (vec4 q, vec3 p){\n  float x2 = q.x + q.x;\n  float y2 = q.y + q.y;\n  float z2 = q.z + q.z;\n  float xx = q.x * x2;\n  float xy = q.x * y2;\n  float xz = q.x * z2;\n  float yy = q.y * y2;\n  float yz = q.y * z2;\n  float zz = q.z * z2;\n  float wx = q.w * x2;\n  float wy = q.w * y2;\n  float wz = q.w * z2;\n  return mat4(\n    1. - (yy + zz), xy + wz, xz - wy, 0,\n    xy - wz, 1. - (xx + zz), yz + wx, 0,\n    xz + wy, yz - wx, 1. - (xx + yy), 0,\n    p.x, p.y, p.z, 1\n  );\n}\nmat4 matFromRTS (vec4 q, vec3 t, vec3 s){\n  float x = q.x, y = q.y, z = q.z, w = q.w;\n  float x2 = x + x;\n  float y2 = y + y;\n  float z2 = z + z;\n  float xx = x * x2;\n  float xy = x * y2;\n  float xz = x * z2;\n  float yy = y * y2;\n  float yz = y * z2;\n  float zz = z * z2;\n  float wx = w * x2;\n  float wy = w * y2;\n  float wz = w * z2;\n  float sx = s.x;\n  float sy = s.y;\n  float sz = s.z;\n  return mat4((1. - (yy + zz)) * sx, (xy + wz) * sx, (xz - wy) * sx, 0,\n    (xy - wz) * sy, (1. - (xx + zz)) * sy, (yz + wx) * sy, 0,\n    (xz + wy) * sz, (yz - wx) * sz, (1. - (xx + yy)) * sz, 0,\n    t.x, t.y, t.z, 1);\n}\nvec4 quatMultiply (vec4 a, vec4 b){\n  vec4 quat;\n  quat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\n  quat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\n  quat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\n  quat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\n  return quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\n  float ix = q.w * v.x + q.y * v.z - q.z * v.y;\n  float iy = q.w * v.y + q.z * v.x - q.x * v.z;\n  float iz = q.w * v.z + q.x * v.y - q.y * v.x;\n  float iw = -q.x * v.x - q.y * v.y - q.z * v.z;\n  v.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\n  v.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\n  v.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\n  vec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\n  vec4 rotQuat = quatMultiply(viewQuat, q);\n  rotateVecFromQuat(pos, rotQuat);\n  return pos;\n}\nvoid rotateCorner (inout vec2 corner, float angle){\n  float xOS = cos(angle) * corner.x - sin(angle) * corner.y;\n  float yOS = sin(angle) * corner.x + cos(angle) * corner.y;\n  corner.x = xOS;\n  corner.y = yOS;\n}\nuniform vec4 mainTiling_Offset;\nuniform vec4 frameTile_velLenScale;\nuniform vec4 scale;\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matViewInv;\nuniform highp mat4 cc_matViewProj;\nuniform highp vec4 cc_cameraPos;\nuniform highp mat4 cc_matWorld;\nvarying mediump vec2 uv;\nvarying mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n  , mat4 viewInv\n#endif\n#if CC_RENDER_MODE == 1\n  , vec3 eye\n  , vec4 velocity\n  , float velocityScale\n  , float lengthScale\n  , float xIndex\n#endif\n) {\n#if CC_RENDER_MODE == 0\n  vec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\n  vec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\n  vec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\n  vec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\n  pos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n#elif CC_RENDER_MODE == 1\n  vec3 camRight = normalize(cross(pos.xyz - eye, velocity.xyz)) * s.x;\n  vec3 camUp = velocity.xyz * velocityScale + normalize(velocity.xyz) * lengthScale * s.y;\n  pos.xyz += (camRight * abs(vertOffset.x) * sign(vertOffset.y)) - camUp * xIndex;\n#elif CC_RENDER_MODE == 2\n  vec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\n  vec3 camX = vec3(1, 0, 0);\n  vec3 camY = vec3(0, 0, -1);\n  pos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, cross(camX, camY), q);\n#elif CC_RENDER_MODE == 3\n  vec2 viewSpaceVert = vec2(vertOffset.x * s.x, vertOffset.y * s.y);\n  rotateCorner(viewSpaceVert, q.z);\n  vec3 camX = normalize(vec3(cc_matView[0][0], cc_matView[1][0], cc_matView[2][0]));\n  vec3 camY = vec3(0, 1, 0);\n  vec3 offset = camX * viewSpaceVert.x + camY * viewSpaceVert.y;\n  pos.xyz += offset;\n#else\n  pos.x += vertOffset.x;\n  pos.y += vertOffset.y;\n#endif\n}\nvec2 computeUV (float frameIndex, vec2 vertIndex, vec2 frameTile){\n  vec2 aniUV = vec2(0, floor(frameIndex * frameTile.y));\n  aniUV.x = floor(frameIndex * frameTile.x * frameTile.y - aniUV.y * frameTile.x);\n#if CC_RENDER_MODE != 4\n  vertIndex.y = 1. - vertIndex.y;\n#endif\n  return (aniUV.xy + vertIndex) / vec2(frameTile.x, frameTile.y);\n}\nuniform vec4 u_sampleInfo;\nuniform vec4 u_worldRot;\nuniform vec4 u_timeDelta;\nattribute vec4 a_position_starttime;\nattribute vec4 a_size_uv;\nattribute vec4 a_rotation_uv;\nattribute vec4 a_color;\nattribute vec4 a_dir_life;\nattribute float a_rndSeed;\n#if CC_RENDER_MODE == 4\n  attribute vec3 a_texCoord;\n  attribute vec3 a_texCoord3;\n  attribute vec3 a_normal;\n  attribute vec4 a_color1;\n#endif\nvec3 unpackCurveData (sampler2D tex, vec2 coord) {\n    vec4 a = texture2D(tex, coord);\n    vec4 b = texture2D(tex, coord + u_sampleInfo.y);\n    float c = fract(coord.x * u_sampleInfo.x);\n    return mix(a.xyz, b.xyz, c);\n}\nvec3 unpackCurveData (sampler2D tex, vec2 coord, out float w) {\n    vec4 a = texture2D(tex, coord);\n    vec4 b = texture2D(tex, coord + u_sampleInfo.y);\n    float c = fract(coord.x * u_sampleInfo.x);\n    w = mix(a.w, b.w, c);\n    return mix(a.xyz, b.xyz, c);\n}\nfloat pseudoRandom (float seed) {\n  seed = mod(seed, 233280.);\n  float q = (seed * 9301. + 49297.) / 233280.;\n  return fract(q);\n}\n#if COLOR_OVER_TIME_MODULE_ENABLE\n  uniform sampler2D color_over_time_tex0;\n  uniform int u_color_mode;\n#endif\n#if ROTATION_OVER_TIME_MODULE_ENABLE\n  uniform sampler2D rotation_over_time_tex0;\n  uniform int u_rotation_mode;\n#endif\n#if SIZE_OVER_TIME_MODULE_ENABLE\n  uniform sampler2D size_over_time_tex0;\n  uniform int u_size_mode;\n#endif\n#if FORCE_OVER_TIME_MODULE_ENABLE\n  uniform sampler2D force_over_time_tex0;\n  uniform int u_force_mode;\nuniform int u_force_space;\n#endif\n#if VELOCITY_OVER_TIME_MODULE_ENABLE\n  uniform sampler2D velocity_over_time_tex0;\n  uniform int u_velocity_mode;\nuniform int u_velocity_space;\n#endif\n#if TEXTURE_ANIMATION_MODULE_ENABLE\n  uniform sampler2D texture_animation_tex0;\n  uniform vec4 u_anim_info;\n#endif\nfloat repeat (float t, float length) {\n  return t - floor(t / length) * length;\n}\nvec4 rotateQuat (vec4 p, vec4 q) {\n  vec3 iv = cross(q.xyz, p.xyz) + q.w * p.xyz;\n  vec3 res = p.xyz + 2.0 * cross(q.xyz, iv);\n  return vec4(res.xyz, p.w);\n}\nvec4 gpvs_main () {\n  float activeTime = u_timeDelta.x - a_position_starttime.w;\n  float normalizedTime = clamp(activeTime / a_dir_life.w, 0.0, 1.0);\n  vec2 timeCoord0 = vec2(normalizedTime, 0.);\n  vec2 timeCoord1 = vec2(normalizedTime, 1.);\n  #if CC_RENDER_MODE == 4\n    vec2 vertIdx = vec2(a_texCoord.x, a_texCoord.y);\n  #else\n    vec2 vertIdx = vec2(a_size_uv.w, a_rotation_uv.w);\n  #endif\n  vec4 velocity = vec4(a_dir_life.xyz, 0.);\n  vec4 pos = vec4(a_position_starttime.xyz, 1.);\n  vec3 size = a_size_uv.xyz;\n  #if SIZE_OVER_TIME_MODULE_ENABLE\n    if (u_size_mode == 1) {\n      size *= unpackCurveData(size_over_time_tex0, timeCoord0);\n    } else {\n      vec3 size_0 = unpackCurveData(size_over_time_tex0, timeCoord0);\n      vec3 size_1 = unpackCurveData(size_over_time_tex0, timeCoord1);\n      float factor_s = pseudoRandom(a_rndSeed + 39825.);\n      size *= mix(size_0, size_1, factor_s);\n    }\n  #endif\n  vec3 compScale = scale.xyz * size;\n  #if FORCE_OVER_TIME_MODULE_ENABLE\n    vec3 forceAnim = vec3(0.);\n    if (u_force_mode == 1) {\n      forceAnim = unpackCurveData(force_over_time_tex0, timeCoord0);\n    } else {\n      vec3 force_0 = unpackCurveData(force_over_time_tex0, timeCoord0);\n      vec3 force_1 = unpackCurveData(force_over_time_tex0, timeCoord1);\n      float factor_f =  pseudoRandom(a_rndSeed + 212165.);\n      forceAnim = mix(force_0, force_1, factor_f);\n    }\n    vec4 forceTrack = vec4(forceAnim, 0.);\n    if (u_force_space == 0) {\n      forceTrack = rotateQuat(forceTrack, u_worldRot);\n    }\n    velocity.xyz += forceTrack.xyz;\n  #endif\n  #if VELOCITY_OVER_TIME_MODULE_ENABLE\n    float speedModifier0 = 1.;\n    float speedModifier1 = 1.;\n    vec3 velocityAnim = vec3(0.);\n    if (u_velocity_mode == 1) {\n      velocityAnim = unpackCurveData(velocity_over_time_tex0, timeCoord0, speedModifier0);\n    } else {\n      vec3 vectory_0 = unpackCurveData(velocity_over_time_tex0, timeCoord0, speedModifier0);\n      vec3 vectory_1 = unpackCurveData(velocity_over_time_tex0, timeCoord1, speedModifier1);\n      float factor_v = pseudoRandom(a_rndSeed + 197866.);\n      velocityAnim = mix(vectory_0, vectory_1, factor_v);\n      speedModifier0 = mix(speedModifier0, speedModifier1, factor_v);\n    }\n    vec4 velocityTrack = vec4(velocityAnim, 0.);\n    if (u_velocity_space == 0) {\n      velocityTrack = rotateQuat(velocityTrack, u_worldRot);\n    }\n    velocity.xyz += velocityTrack.xyz;\n    velocity.xyz *= speedModifier0;\n  #endif\n  pos.xyz += velocity.xyz * normalizedTime * a_dir_life.w;\n  #if !CC_USE_WORLD_SPACE\n    pos = cc_matWorld * pos;\n    #if CC_RENDER_MODE == 1\n      velocity = rotateQuat(velocity, u_worldRot);\n    #endif\n  #endif\n  vec3 rotation = a_rotation_uv.xyz;\n  #if ROTATION_OVER_TIME_MODULE_ENABLE\n    if (u_rotation_mode == 1) {\n      rotation += unpackCurveData(rotation_over_time_tex0, timeCoord0) * normalizedTime * a_dir_life.w;\n    } else {\n      vec3 rotation_0 = unpackCurveData(rotation_over_time_tex0, timeCoord0);\n      vec3 rotation_1 = unpackCurveData(rotation_over_time_tex0, timeCoord1);\n      float factor_r = pseudoRandom(a_rndSeed + 125292.);\n      rotation += mix(rotation_0, rotation_1, factor_r) * normalizedTime * a_dir_life.w;\n    }\n  #endif\n  #if COLOR_OVER_TIME_MODULE_ENABLE\n    if (u_color_mode == 1) {\n      color = a_color * texture2D(color_over_time_tex0, timeCoord0);\n    } else {\n      vec4 color_0 = texture2D(color_over_time_tex0, timeCoord0);\n      vec4 color_1 = texture2D(color_over_time_tex0, timeCoord1);\n      float factor_c = pseudoRandom(a_rndSeed + 91041.);\n      color = a_color * mix(color_0, color_1, factor_c);\n    }\n  #else\n    color = a_color;\n  #endif\n  #if CC_RENDER_MODE != 4\n    vec2 cornerOffset = vec2((vertIdx - 0.5));\n    #if CC_RENDER_MODE == 0\n      vec3 rotEuler = rotation.xyz;\n    #elif CC_RENDER_MODE == 1\n      vec3 rotEuler = vec3(0.);\n    #else\n      vec3 rotEuler = vec3(0., 0., rotation.z);\n    #endif\n    computeVertPos(pos, cornerOffset, quaternionFromEuler(rotEuler), compScale\n      #if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n        , cc_matViewInv\n      #endif\n      #if CC_RENDER_MODE == 1\n        , cc_cameraPos.xyz\n        , velocity\n        , frameTile_velLenScale.z\n        , frameTile_velLenScale.w\n        , a_size_uv.w\n      #endif\n    );\n  #else\n    mat4 xformNoScale = matrixFromRT(quaternionFromEuler(rotation), pos.xyz);\n    mat4 xform = matFromRTS(quaternionFromEuler(rotation), pos.xyz, compScale);\n    pos = xform * vec4(a_texCoord3, 1);\n    vec4 normal = xformNoScale * vec4(a_normal, 0);\n    color *= a_color1;\n  #endif\n  pos = cc_matViewProj * pos;\n  float frameIndex = 0.;\n  #if TEXTURE_ANIMATION_MODULE_ENABLE\n    float startFrame = 0.;\n    vec3 frameInfo = vec3(0.);\n    if (int(u_anim_info.x) == 1) {\n      frameInfo = unpackCurveData(texture_animation_tex0, timeCoord0);\n    } else {\n      vec3 frameInfo0 = unpackCurveData(texture_animation_tex0, timeCoord0);\n      vec3 frameInfo1 = unpackCurveData(texture_animation_tex0, timeCoord1);\n      float factor_t = pseudoRandom(a_rndSeed + 90794.);\n      frameInfo = mix(frameInfo0, frameInfo1, factor_t);\n    }\n    startFrame = frameInfo.x / u_anim_info.y;\n    frameIndex = repeat(u_anim_info.z * (frameInfo.y + startFrame), 1.);\n  #endif\n  uv = computeUV(frameIndex, vertIdx, frameTile_velLenScale.xy) * mainTiling_Offset.xy + mainTiling_Offset.zw;\n  return pos;\n}\nvoid main() { gl_Position = gpvs_main(); }",frag:"\nprecision mediump float;\nuniform mediump vec4 cc_exposure;\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n  #if CC_USE_HDR\n    color.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n  #endif\n  return color;\n}\nvarying vec2 uv;\nvarying vec4 color;\nuniform sampler2D mainTexture;\nuniform vec4 tintColor;\nvec4 add () {\n  vec4 col = 2.0 * color * tintColor * texture2D(mainTexture, uv);\n  return CCFragOutput(col);\n}\nvoid main() { gl_FragColor = add(); }"}],[{vert:"\nprecision mediump float;\nuniform vec4 mainTiling_Offset;\nuniform highp mat4 cc_matViewProj;\nuniform highp vec4 cc_cameraPos;\nuniform highp mat4 cc_matWorld;\nvarying mediump vec2 uv;\nvarying mediump vec4 color;\nattribute vec3 a_position;\nattribute vec4 a_texCoord;\nattribute vec3 a_texCoord1;\nattribute vec3 a_texCoord2;\nattribute vec4 a_color;\n#if CC_DRAW_WIRE_FRAME\n  varying vec3 vBarycentric;\n#endif\nvec4 vs_main() {\n  highp vec4 pos = vec4(a_position, 1);\n  vec4 velocity = vec4(a_texCoord1.xyz, 0);\n  #if !CC_USE_WORLD_SPACE\n    pos = cc_matWorld * pos;\n    velocity = cc_matWorld * velocity;\n  #endif\n  float vertOffset = (a_texCoord.x - 0.5) * a_texCoord.y;\n  vec3 camUp = normalize(cross(pos.xyz - cc_cameraPos.xyz, velocity.xyz));\n  pos.xyz += camUp * vertOffset;\n  pos = cc_matViewProj * pos;\n  uv = a_texCoord.zw * mainTiling_Offset.xy + mainTiling_Offset.zw;;\n  color = a_color;\n  #if CC_DRAW_WIRE_FRAME\n    vBarycentric = a_texCoord2;\n  #endif\n  return pos;\n}\nvoid main() { gl_Position = vs_main(); }",frag:"\n  precision mediump float;\nuniform mediump vec4 cc_exposure;\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n  #if CC_USE_HDR\n    color.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n  #endif\n  return color;\n}\n  varying vec2 uv;\n  varying vec4 color;\n  #if CC_DRAW_WIRE_FRAME\n    varying vec3 vBarycentric;\n  #endif\n  uniform sampler2D mainTexture;\n  uniform vec4 tintColor;\n  vec4 add () {\n    vec4 col = 2.0 * color * tintColor * texture2D(mainTexture, uv);\n#if CC_DRAW_WIRE_FRAME\n    if (any(lessThan(vBarycentric, vec3(0.02)))) {\n        col = vec4(0., 1., 1., 1.);\n    }\n#endif\n    return CCFragOutput(col);\n  }\nvoid main() { gl_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\n  mat3 m = mat3(xAxis,yAxis,zAxis);\n  float trace = m[0][0] + m[1][1] + m[2][2];\n  vec4 quat;\n  if (trace > 0.) {\n    float s = 0.5 / sqrt(trace + 1.0);\n    quat.w = 0.25 / s;\n    quat.x = (m[2][1] - m[1][2]) * s;\n    quat.y = (m[0][2] - m[2][0]) * s;\n    quat.z = (m[1][0] - m[0][1]) * s;\n  } else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\n    float s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\n    quat.w = (m[2][1] - m[1][2]) / s;\n    quat.x = 0.25 * s;\n    quat.y = (m[0][1] + m[1][0]) / s;\n    quat.z = (m[0][2] + m[2][0]) / s;\n  } else if (m[1][1] > m[2][2]) {\n    float s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\n    quat.w = (m[0][2] - m[2][0]) / s;\n    quat.x = (m[0][1] + m[1][0]) / s;\n    quat.y = 0.25 * s;\n    quat.z = (m[1][2] + m[2][1]) / s;\n  } else {\n    float s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\n    quat.w = (m[1][0] - m[0][1]) / s;\n    quat.x = (m[0][2] + m[2][0]) / s;\n    quat.y = (m[1][2] + m[2][1]) / s;\n    quat.z = 0.25 * s;\n  }\n  float len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\n  if (len > 0.) {\n    len = 1. / sqrt(len);\n    quat.x = quat.x * len;\n    quat.y = quat.y * len;\n    quat.z = quat.z * len;\n    quat.w = quat.w * len;\n  }\n  return quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\n  float x = angle.x / 2.;\n  float y = angle.y / 2.;\n  float z = angle.z / 2.;\n  float sx = sin(x);\n  float cx = cos(x);\n  float sy = sin(y);\n  float cy = cos(y);\n  float sz = sin(z);\n  float cz = cos(z);\n  vec4 quat = vec4(0);\n  quat.x = sx * cy * cz + cx * sy * sz;\n  quat.y = cx * sy * cz + sx * cy * sz;\n  quat.z = cx * cy * sz - sx * sy * cz;\n  quat.w = cx * cy * cz - sx * sy * sz;\n  return quat;\n}\nmat4 matrixFromRT (vec4 q, vec3 p){\n  float x2 = q.x + q.x;\n  float y2 = q.y + q.y;\n  float z2 = q.z + q.z;\n  float xx = q.x * x2;\n  float xy = q.x * y2;\n  float xz = q.x * z2;\n  float yy = q.y * y2;\n  float yz = q.y * z2;\n  float zz = q.z * z2;\n  float wx = q.w * x2;\n  float wy = q.w * y2;\n  float wz = q.w * z2;\n  return mat4(\n    1. - (yy + zz), xy + wz, xz - wy, 0,\n    xy - wz, 1. - (xx + zz), yz + wx, 0,\n    xz + wy, yz - wx, 1. - (xx + yy), 0,\n    p.x, p.y, p.z, 1\n  );\n}\nmat4 matFromRTS (vec4 q, vec3 t, vec3 s){\n  float x = q.x, y = q.y, z = q.z, w = q.w;\n  float x2 = x + x;\n  float y2 = y + y;\n  float z2 = z + z;\n  float xx = x * x2;\n  float xy = x * y2;\n  float xz = x * z2;\n  float yy = y * y2;\n  float yz = y * z2;\n  float zz = z * z2;\n  float wx = w * x2;\n  float wy = w * y2;\n  float wz = w * z2;\n  float sx = s.x;\n  float sy = s.y;\n  float sz = s.z;\n  return mat4((1. - (yy + zz)) * sx, (xy + wz) * sx, (xz - wy) * sx, 0,\n    (xy - wz) * sy, (1. - (xx + zz)) * sy, (yz + wx) * sy, 0,\n    (xz + wy) * sz, (yz - wx) * sz, (1. - (xx + yy)) * sz, 0,\n    t.x, t.y, t.z, 1);\n}\nvec4 quatMultiply (vec4 a, vec4 b){\n  vec4 quat;\n  quat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\n  quat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\n  quat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\n  quat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\n  return quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\n  float ix = q.w * v.x + q.y * v.z - q.z * v.y;\n  float iy = q.w * v.y + q.z * v.x - q.x * v.z;\n  float iz = q.w * v.z + q.x * v.y - q.y * v.x;\n  float iw = -q.x * v.x - q.y * v.y - q.z * v.z;\n  v.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\n  v.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\n  v.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\n  vec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\n  vec4 rotQuat = quatMultiply(viewQuat, q);\n  rotateVecFromQuat(pos, rotQuat);\n  return pos;\n}\nvoid rotateCorner (inout vec2 corner, float angle){\n  float xOS = cos(angle) * corner.x - sin(angle) * corner.y;\n  float yOS = sin(angle) * corner.x + cos(angle) * corner.y;\n  corner.x = xOS;\n  corner.y = yOS;\n}\nuniform vec4 mainTiling_Offset;\nuniform vec4 frameTile_velLenScale;\nuniform vec4 scale;\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matViewInv;\nuniform highp mat4 cc_matViewProj;\nuniform highp vec4 cc_cameraPos;\nuniform highp mat4 cc_matWorld;\nvarying mediump vec2 uv;\nvarying mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n  , mat4 viewInv\n#endif\n#if CC_RENDER_MODE == 1\n  , vec3 eye\n  , vec4 velocity\n  , float velocityScale\n  , float lengthScale\n  , float xIndex\n#endif\n) {\n#if CC_RENDER_MODE == 0\n  vec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\n  vec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\n  vec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\n  vec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\n  pos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n#elif CC_RENDER_MODE == 1\n  vec3 camRight = normalize(cross(pos.xyz - eye, velocity.xyz)) * s.x;\n  vec3 camUp = velocity.xyz * velocityScale + normalize(velocity.xyz) * lengthScale * s.y;\n  pos.xyz += (camRight * abs(vertOffset.x) * sign(vertOffset.y)) - camUp * xIndex;\n#elif CC_RENDER_MODE == 2\n  vec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\n  vec3 camX = vec3(1, 0, 0);\n  vec3 camY = vec3(0, 0, -1);\n  pos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, cross(camX, camY), q);\n#elif CC_RENDER_MODE == 3\n  vec2 viewSpaceVert = vec2(vertOffset.x * s.x, vertOffset.y * s.y);\n  rotateCorner(viewSpaceVert, q.z);\n  vec3 camX = normalize(vec3(cc_matView[0][0], cc_matView[1][0], cc_matView[2][0]));\n  vec3 camY = vec3(0, 1, 0);\n  vec3 offset = camX * viewSpaceVert.x + camY * viewSpaceVert.y;\n  pos.xyz += offset;\n#else\n  pos.x += vertOffset.x;\n  pos.y += vertOffset.y;\n#endif\n}\nvec2 computeUV (float frameIndex, vec2 vertIndex, vec2 frameTile){\n  vec2 aniUV = vec2(0, floor(frameIndex * frameTile.y));\n  aniUV.x = floor(frameIndex * frameTile.x * frameTile.y - aniUV.y * frameTile.x);\n#if CC_RENDER_MODE != 4\n  vertIndex.y = 1. - vertIndex.y;\n#endif\n  return (aniUV.xy + vertIndex) / vec2(frameTile.x, frameTile.y);\n}\nattribute vec3 a_position;\nattribute vec3 a_texCoord;\nattribute vec3 a_texCoord1;\nattribute vec3 a_texCoord2;\nattribute vec4 a_color;\n#if CC_RENDER_MODE == 1\n  attribute vec3 a_color1;\n#endif\n#if CC_RENDER_MODE == 4\n  attribute vec3 a_texCoord3;\n  attribute vec3 a_normal;\n  attribute vec4 a_color1;\n#endif\nvec4 lpvs_main () {\n  vec3 compScale = scale.xyz * a_texCoord1;\n  vec4 pos = vec4(a_position, 1);\n  #if CC_RENDER_MODE == 1\n    vec4 velocity = vec4(a_color1.xyz, 0);\n  #endif\n  #if !CC_USE_WORLD_SPACE\n    pos = cc_matWorld * pos;\n    #if CC_RENDER_MODE == 1\n      velocity = cc_matWorld * velocity;\n    #endif\n  #endif\n  #if CC_RENDER_MODE != 4\n    vec2 cornerOffset = vec2((a_texCoord.xy - 0.5));\n    #if CC_RENDER_MODE == 0\n      vec3 rotEuler = a_texCoord2;\n    #elif CC_RENDER_MODE == 1\n      vec3 rotEuler = vec3(0.);\n    #else\n      vec3 rotEuler = vec3(0., 0., a_texCoord2.z);\n    #endif\n    computeVertPos(pos, cornerOffset, quaternionFromEuler(rotEuler), compScale\n    #if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n      , cc_matViewInv\n    #endif\n    #if CC_RENDER_MODE == 1\n      , cc_cameraPos.xyz\n      , velocity\n      , frameTile_velLenScale.z\n      , frameTile_velLenScale.w\n      , a_texCoord.x\n    #endif\n    );\n    color = a_color;\n  #else\n    mat4 xformNoScale = matrixFromRT(quaternionFromEuler(a_texCoord2), pos.xyz);\n    mat4 xform = matFromRTS(quaternionFromEuler(a_texCoord2), pos.xyz, compScale);\n    pos = xform * vec4(a_texCoord3, 1);\n    vec4 normal = xformNoScale * vec4(a_normal, 0);\n    color = a_color * a_color1;\n  #endif\n  uv = computeUV(a_texCoord.z, a_texCoord.xy, frameTile_velLenScale.xy) * mainTiling_Offset.xy + mainTiling_Offset.zw;\n  pos = cc_matViewProj * pos;\n  return pos;\n}\nvoid main() { gl_Position = lpvs_main(); }",frag:"\nprecision mediump float;\nuniform mediump vec4 cc_exposure;\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n  #if CC_USE_HDR\n    color.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n  #endif\n  return color;\n}\nvarying vec2 uv;\nvarying vec4 color;\nuniform sampler2D mainTexture;\nuniform vec4 tintColor;\nvec4 add () {\n  vec4 col = 2.0 * color * tintColor * texture2D(mainTexture, uv);\n  return CCFragOutput(col);\n}\nvoid main() { gl_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nuniform highp mat4 cc_matViewProj;\n#if USE_LOCAL\nuniform highp mat4 cc_matWorld;\n#endif\nattribute vec3 a_position;\nattribute vec2 a_texCoord;\nattribute vec4 a_color;\nvarying vec4 v_light;\nvarying vec2 uv0;\n#if TWO_COLORED\n  attribute vec4 a_color2;\n  varying vec4 v_dark;\n#endif\nvec4 vert () {\n  vec4 pos = vec4(a_position, 1);\n  #if USE_LOCAL\n    pos = cc_matWorld * pos;\n  #endif\n  pos = cc_matViewProj * pos;\n  uv0 = a_texCoord;\n  v_light = a_color;\n  #if TWO_COLORED\n    v_dark = a_color2;\n  #endif\n  return pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\n#if USE_ALPHA_TEST\n  uniform float alphaThreshold;\n#endif\nvoid ALPHA_TEST (in vec4 color) {\n  #if USE_ALPHA_TEST\n      if (color.a < alphaThreshold) discard;\n  #endif\n}\nvoid ALPHA_TEST (in float alpha) {\n  #if USE_ALPHA_TEST\n      if (alpha < alphaThreshold) discard;\n  #endif\n}\nvarying vec4 v_light;\n#if TWO_COLORED\n  varying vec4 v_dark;\n#endif\nvarying vec2 uv0;\nuniform sampler2D cc_spriteTexture;\nvec4 frag () {\n  vec4 o = vec4(1, 1, 1, 1);\n  #if TWO_COLORED\n    vec4 texColor = vec4(1, 1, 1, 1);\n    texColor *= texture2D(cc_spriteTexture, uv0);\n     o.a = texColor.a * v_light.a;\n    o.rgb = ((texColor.a - 1.0) * v_dark.a + 1.0 - texColor.rgb) * v_dark.rgb + texColor.rgb * v_light.rgb;\n  #else\n    o *= texture2D(cc_spriteTexture, uv0);\n    o *= v_light;\n  #endif\n  ALPHA_TEST(o);\n  return o;\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matProj;\nuniform highp mat4 cc_matViewProj;\n#if USE_LOCAL\nuniform highp mat4 cc_matWorld;\n#endif\nattribute vec3 a_position;\nattribute vec2 a_texCoord;\nattribute vec4 a_color;\nvarying vec4 color;\nvarying vec2 uv0;\nvec4 vert () {\n  vec4 pos = vec4(a_position, 1);\n  #if USE_LOCAL\n    pos = cc_matWorld * pos;\n  #endif\n  #if USE_PIXEL_ALIGNMENT\n    pos = cc_matView * pos;\n    pos.xyz = floor(pos.xyz);\n    pos = cc_matProj * pos;\n  #else\n    pos = cc_matViewProj * pos;\n  #endif\n  uv0 = a_texCoord;\n  color = a_color;\n  return pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 CCSampleWithAlphaSeparated(sampler2D tex, vec2 uv) {\n#if CC_USE_EMBEDDED_ALPHA\n    return vec4(texture2D(tex, uv).rgb, texture2D(tex, uv + vec2(0.0, 0.5)).r);\n#else\n    return texture2D(tex, uv);\n#endif\n}\n#if USE_ALPHA_TEST\n  uniform float alphaThreshold;\n#endif\nvoid ALPHA_TEST (in vec4 color) {\n  #if USE_ALPHA_TEST\n      if (color.a < alphaThreshold) discard;\n  #endif\n}\nvoid ALPHA_TEST (in float alpha) {\n  #if USE_ALPHA_TEST\n      if (alpha < alphaThreshold) discard;\n  #endif\n}\nvarying vec4 color;\n#if USE_TEXTURE\n  varying vec2 uv0;\n  uniform sampler2D cc_spriteTexture;\n#endif\nvec4 frag () {\n  vec4 o = vec4(1, 1, 1, 1);\n  #if USE_TEXTURE\n    o *= CCSampleWithAlphaSeparated(cc_spriteTexture, uv0);\n    #if IS_GRAY\n      float gray  = 0.2126 * o.r + 0.7152 * o.g + 0.0722 * o.b;\n      o.r = o.g = o.b = gray;\n    #endif\n  #endif\n  o *= color;\n  ALPHA_TEST(o);\n  return o;\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\n  rgba = rgba * 255.0;\n  highp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\n  highp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\n  highp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\n  return Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\n  highp vec4 position;\n  vec3 normal;\n  vec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_MORPH\n    attribute float a_vertexId;\n    int getVertexId() {\n        return int(a_vertexId);\n    }\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\n    float pixelIndexF = float(pixelIndex);\n    float x = mod(pixelIndexF, textureResolution.x);\n    float y = floor(pixelIndexF / textureResolution.x);\n    return vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\n    return (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_SUPPORT_FLOAT_TEXTURE\n        vec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\n            int pixelIndex = elementIndex;\n            vec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\n            vec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\n            return texture2D(tex, uv);\n        }\n#else\n    vec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\n        int pixelIndex = elementIndex * 4;\n        vec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\n        vec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\n        return vec4(\n            decode32(texture2D(tex, x)),\n            decode32(texture2D(tex, y)),\n            decode32(texture2D(tex, z)),\n            1.0\n        );\n    }\n#endif\nfloat getDisplacementWeight(int index) {\n    int quot = index / 4;\n    int remainder = index - quot * 4;\n    if (remainder == 0) {\n        return cc_displacementWeights[quot].x;\n    } else if (remainder == 1) {\n        return cc_displacementWeights[quot].y;\n    } else if (remainder == 2) {\n        return cc_displacementWeights[quot].z;\n    } else {\n        return cc_displacementWeights[quot].w;\n    }\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\n    return fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\n    vec3 result = vec3(0, 0, 0);\n    int nVertices = int(cc_displacementTextureInfo.z);\n    for (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\n        result += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n    }\n    return result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\n    uniform sampler2D cc_PositionDisplacements;\n    vec3 getPositionDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    uniform sampler2D cc_NormalDisplacements;\n    vec3 getNormalDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    uniform sampler2D cc_TangentDisplacements;\n    vec3 getTangentDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n    }\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\n    int vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\n    attr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    attr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    attr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\n    position.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n  attribute vec4 a_joints;\nattribute vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n  #if USE_INSTANCING\n    attribute highp vec4 a_jointAnimInfo;\n  #endif\n  uniform highp vec4 cc_jointTextureInfo;\n  uniform highp vec4 cc_jointAnimInfo;\n  uniform highp sampler2D cc_jointTexture;\n  #else\n  uniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n  #if CC_SUPPORT_FLOAT_TEXTURE\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\n      vec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\n      vec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #else\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = vec4(\n        decode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n      );\n      vec4 v2 = vec4(\n        decode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n      );\n      vec4 v3 = vec4(\n        decode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n      );\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #endif\n#else\n  mat4 getJointMatrix (float i) {\n    int idx = int(i);\n    vec4 v1 = cc_joints[idx * 3];\n    vec4 v2 = cc_joints[idx * 3 + 1];\n    vec4 v3 = cc_joints[idx * 3 + 2];\n    return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n  }\n#endif\nmat4 skinMatrix () {\n  vec4 joints = vec4(a_joints);\n  return getJointMatrix(joints.x) * a_weights.x\n       + getJointMatrix(joints.y) * a_weights.y\n       + getJointMatrix(joints.z) * a_weights.z\n       + getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\n  mat4 m = skinMatrix();\n  position = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\n  mat4 m = skinMatrix();\n  attr.position = m * attr.position;\n  attr.normal = (m * vec4(attr.normal, 0.0)).xyz;\n  attr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matProj;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_fogBase;\nuniform mediump vec4 cc_fogAdd;\n#if USE_INSTANCING\n  attribute vec4 a_matWorld0;\n  attribute vec4 a_matWorld1;\n  attribute vec4 a_matWorld2;\n  #if USE_LIGHTMAP\n    attribute vec4 a_lightingMapUVParam;\n  #endif\n#elif USE_BATCHING\n  attribute float a_dyn_batch_id;\n  uniform highp mat4 cc_matWorlds[10];\n#else\nuniform highp mat4 cc_matWorld;\nuniform highp mat4 cc_matWorldIT;\nuniform highp vec4 cc_lightingMapUVParam;\n#endif\nuniform vec4 tilingOffset;\nfloat LinearFog(vec4 pos) {\n    vec4 wPos = pos;\n    float cam_dis = distance(cc_cameraPos, wPos);\n    float fogStart = cc_fogBase.x;\n    float fogEnd = cc_fogBase.y;\n    return clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float fogDensity = cc_fogBase.z;\n    float cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\n    float f = exp(-cam_dis * fogDensity);\n    return f;\n}\nfloat ExpSquaredFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float fogDensity = cc_fogBase.z;\n    float cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\n    float f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\n    return f;\n}\nfloat LayeredFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float _FogTop = cc_fogAdd.x;\n    float _FogRange = cc_fogAdd.y;\n    vec3 camWorldProj = cc_cameraPos.xyz;\n    camWorldProj.y = 0.;\n    vec3 worldPosProj = wPos.xyz;\n    worldPosProj.y = 0.;\n    float fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\n    float fDeltaY, fDensityIntegral;\n    if (cc_cameraPos.y > _FogTop) {\n        if (wPos.y < _FogTop) {\n            fDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\n            fDensityIntegral = fDeltaY * fDeltaY * 0.5;\n        } else {\n            fDeltaY = 0.;\n            fDensityIntegral = 0.;\n        }\n    } else {\n        if (wPos.y < _FogTop) {\n            float fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\n            float fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\n            fDeltaY = abs(fDeltaA - fDeltaB);\n            fDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n        } else {\n            fDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\n            fDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n        }\n    }\n    float fDensity;\n    if (fDeltaY != 0.) {\n        fDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n    } else {\n        fDensity = 0.;\n    }\n    float f = exp(-fDensity);\n    return f;\n}\nfloat CC_TRANSFER_FOG(vec4 pos) {\n    #if CC_USE_FOG == 0\n        return LinearFog(pos);\n\t#elif CC_USE_FOG == 1\n        return ExpFog(pos);\n    #elif CC_USE_FOG == 2\n        return ExpSquaredFog(pos);\n    #elif CC_USE_FOG == 3\n        return LayeredFog(pos);\n    #endif\n    return 1.;\n}\nvarying highp vec4 v_shadowPos;\nuniform highp mat4 cc_matLightViewProj;\n#if USE_VERTEX_COLOR\n  attribute vec4 a_color;\n  varying vec4 v_color;\n#endif\nvarying vec3 v_position;\nvarying vec3 v_normal;\nvarying vec2 v_uv;\nvarying vec2 v_uv1;\nvarying float v_fog_factor;\n#if USE_NORMAL_MAP\n  varying vec3 v_tangent;\n  varying vec3 v_bitangent;\n#endif\n#if HAS_SECOND_UV || USE_LIGHTMAP\n  attribute vec2 a_texCoord1;\n#endif\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\n  varying vec2 v_luv;\nvoid CCLightingMapCaclUV()\n{\n#if !USE_INSTANCING\n      v_luv = cc_lightingMapUVParam.xy + a_texCoord1 * cc_lightingMapUVParam.zw;\n#else\n      v_luv = a_lightingMapUVParam.xy + a_texCoord1 * a_lightingMapUVParam.zw;\n#endif\n}\n#endif\nvec4 vert () {\n  StandardVertInput In;\n  In.position = vec4(a_position, 1.0);\n  In.normal = a_normal;\n  In.tangent = a_tangent;\n  #if CC_USE_MORPH\n    applyMorph(In);\n  #endif\n  #if CC_USE_SKINNING\n    CCSkin(In);\n  #endif\n  mat4 matWorld, matWorldIT;\n  #if USE_INSTANCING\n    matWorld = mat4(\n      vec4(a_matWorld0.xyz, 0.0),\n      vec4(a_matWorld1.xyz, 0.0),\n      vec4(a_matWorld2.xyz, 0.0),\n      vec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n    );\n    matWorldIT = matWorld;\n  #elif USE_BATCHING\n    matWorld = cc_matWorlds[int(a_dyn_batch_id)];\n    matWorldIT = matWorld;\n  #else\n    matWorld = cc_matWorld;\n    matWorldIT = cc_matWorldIT;\n  #endif\n  vec4 pos = matWorld * In.position;\n  v_position = pos.xyz;\n  v_normal = normalize((matWorldIT * vec4(In.normal, 0.0)).xyz);\n  #if USE_NORMAL_MAP\n    v_tangent = normalize((matWorld * vec4(In.tangent.xyz, 0.0)).xyz);\n    v_bitangent = cross(v_normal, v_tangent) * In.tangent.w;\n  #endif\n  v_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n  #if HAS_SECOND_UV\n    v_uv1 = a_texCoord1 * tilingOffset.xy + tilingOffset.zw;\n  #endif\n  #if USE_VERTEX_COLOR\n    v_color = a_color;\n  #endif\n  v_fog_factor = CC_TRANSFER_FOG(pos);\n  #if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\n    CCLightingMapCaclUV();\n  #endif\n    v_shadowPos = cc_matLightViewProj * pos;\n  return cc_matProj * (cc_matView * matWorld) * In.position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\n#ifdef GL_EXT_shader_texture_lod\n#extension GL_EXT_shader_texture_lod: enable\n#endif\nprecision highp float;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_exposure;\nuniform mediump vec4 cc_mainLitDir;\nuniform mediump vec4 cc_mainLitColor;\nuniform mediump vec4 cc_ambientSky;\nuniform mediump vec4 cc_ambientGround;\nuniform mediump vec4 cc_fogColor;\nuniform lowp vec4 cc_shadowColor;\nuniform lowp vec4 cc_shadowInfo;\n#if CC_USE_IBL\nuniform samplerCube cc_environment;\nvec3 unpackRGBE (vec4 rgbe) {\n  return rgbe.rgb * pow(2.0, rgbe.a * 255.0 - 128.0);\n}\nvec4 fragTextureLod (sampler2D tex, vec2 coord, float lod) {\n    #ifdef GL_EXT_shader_texture_lod\n      return texture2DLodEXT(tex, coord, lod);\n    #else\n      return texture2D(tex, coord, lod);\n    #endif\n}\nvec4 fragTextureLod (samplerCube tex, vec3 coord, float lod) {\n    #ifdef GL_EXT_shader_texture_lod\n      return textureCubeLodEXT(tex, coord, lod);\n    #else\n      return textureCube(tex, coord, lod);\n    #endif\n}\n#endif\n#if CC_RECEIVE_SHADOW\nvarying highp vec4 v_shadowPos;\n#if CC_RECEIVE_SHADOW\n  uniform sampler2D cc_shadowMap;\n  uniform sampler2D cc_spotLightingMap;\n  float CCGetShadowFactorX1 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float closestDepth = dot(texture2D(cc_shadowMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    float shadow = step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    return shadow;\n  }\n  float CCGetShadowFactorX5 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    float closestDepth = 0.0;\n    closestDepth = dot(texture2D(cc_shadowMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_shadowMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_shadowMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_shadowMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    return shadow / 5.0;\n  }\n  float CCGetShadowFactorX9 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -1; i <= 1; i++) {\n      for (int j = -1; j <= 1; j++) {\n        float closestDepth = dot(texture2D(cc_shadowMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 9.0;\n  }\n  float CCGetShadowFactorX25 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -2; i <= 2; i++) {\n      for (int j = -2; j <= 2; j++) {\n        float closestDepth = dot(texture2D(cc_shadowMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 25.0;\n  }\n  float CCGetDirLightShadowFactorX1 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float closestDepth = dot(texture2D(cc_spotLightingMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    float shadow = step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    return shadow;\n  }\n  float CCGetDirLightShadowFactorX5 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    float closestDepth = 0.0;\n    closestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    return shadow / 5.0;\n  }\n  float CCGetDirLightShadowFactorX9 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -1; i <= 1; i++) {\n      for (int j = -1; j <= 1; j++) {\n        float closestDepth = dot(texture2D(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 9.0;\n  }\n  float CCGetDirLightShadowFactorX25 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -2; i <= 2; i++) {\n      for (int j = -2; j <= 2; j++) {\n        float closestDepth = dot(texture2D(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 25.0;\n  }\n#endif\n#endif\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nfloat GGXMobile (float roughness, float NoH, vec3 H, vec3 N) {\n  vec3 NxH = cross(N, H);\n  float OneMinusNoHSqr = dot(NxH, NxH);\n  float a = roughness * roughness;\n  float n = NoH * a;\n  float p = a / (OneMinusNoHSqr + n * n);\n  return p * p;\n}\nfloat CalcSpecular (float roughness, float NoH, vec3 H, vec3 N) {\n  return (roughness*0.25 + 0.25) * GGXMobile(roughness, NoH, H, N);\n}\nvec3 BRDFApprox (vec3 specular, float roughness, float NoV) {\n  const vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\n  const vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\n  vec4 r = roughness * c0 + c1;\n  float a004 = min( r.x * r.x, exp2( -9.28 * NoV ) ) * r.x + r.y;\n  vec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n  AB.y *= clamp(50.0 * specular.g, 0.0, 1.0);\n  return specular * AB.x + AB.y;\n}\nstruct StandardSurface {\n  vec4 albedo;\n  vec3 position;\n  vec3 normal;\n  vec3 emissive;\n  vec4 lightmap;\n  float roughness;\n  float metallic;\n  float occlusion;\n};\n#if CC_FORWARD_ADD\nuniform highp vec4 cc_lightPos[1];\nuniform vec4 cc_lightColor[1];\nuniform vec4 cc_lightSizeRangeAngle[1];\nuniform vec4 cc_lightDir[1];\nfloat SmoothDistAtt (float distSqr, float invSqrAttRadius) {\n  float factor = distSqr * invSqrAttRadius;\n  float smoothFactor = clamp(1.0 - factor * factor, 0.0, 1.0);\n  return smoothFactor * smoothFactor;\n}\nfloat GetDistAtt (float distSqr, float invSqrAttRadius) {\n  float attenuation = 1.0 / max(distSqr, 0.01*0.01);\n  attenuation *= SmoothDistAtt(distSqr , invSqrAttRadius);\n  return attenuation;\n}\nfloat GetAngleAtt (vec3 L, vec3 litDir, float litAngleScale, float litAngleOffset) {\n  float cd = dot(litDir, L);\n  float attenuation = clamp(cd * litAngleScale + litAngleOffset, 0.0, 1.0);\n  return (attenuation * attenuation);\n}\n  vec4 CCStandardShading (StandardSurface s) {\n    vec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\n    vec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\n    vec3 diffuseContrib = diffuse / 3.14159265359;\n    vec3 N = normalize(s.normal);\n    vec3 V = normalize(cc_cameraPos.xyz - s.position);\n    float NV = max(abs(dot(N, V)), 0.001);\n    specular = BRDFApprox(specular, s.roughness, NV);\n    vec3 finalColor = vec3(0.0);\n    for (int i = 0; i < 1; i++) {\n      vec3 SLU = cc_lightPos[i].xyz - s.position;\n      vec3 SL = normalize(SLU);\n      vec3 SH = normalize(SL + V);\n      float SNL = max(dot(N, SL), 0.001);\n      float SNH = max(dot(N, SH), 0.0);\n      float distSqr = dot(SLU, SLU);\n      float litRadius = cc_lightSizeRangeAngle[i].x;\n      float litRadiusSqr = litRadius * litRadius;\n      float illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\n      float attRadiusSqrInv = 1.0 / max(cc_lightSizeRangeAngle[i].y, 0.01);\n      attRadiusSqrInv *= attRadiusSqrInv;\n      float att = GetDistAtt(distSqr, attRadiusSqrInv);\n      vec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\n      if (cc_lightPos[i].w > 0.0) {\n        float cosInner = max(dot(-cc_lightDir[i].xyz, SL), 0.01);\n        float cosOuter = cc_lightSizeRangeAngle[i].z;\n        float litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\n        float litAngleOffset = -cosOuter * litAngleScale;\n        att *= GetAngleAtt(SL, -cc_lightDir[i].xyz, litAngleScale, litAngleOffset);\n      }\n      vec3 lightColor = cc_lightColor[i].rgb;\n    #if CC_RECEIVE_SHADOW\n      if (cc_lightPos[i].w > 0.0) {\n    {\n      float pcf = cc_shadowInfo.z + 0.001;\n      float shadowAttenuation = 0.0;\n      if (pcf > 3.0) shadowAttenuation = CCGetDirLightShadowFactorX25();\n      else if (3.0 > pcf && pcf > 2.0) shadowAttenuation = CCGetDirLightShadowFactorX9();\n      else if (2.0 > pcf && pcf > 1.0) shadowAttenuation = CCGetDirLightShadowFactorX5();\n      else shadowAttenuation = CCGetDirLightShadowFactorX1();\n      lightColor *= 1.0 - shadowAttenuation;\n    }\n      }\n    #endif\n      finalColor += SNL * lightColor * cc_lightColor[i].w * illum * att * (diffuseContrib + lspec);\n    }\n    finalColor = finalColor * s.occlusion;\n    return vec4(finalColor, 0.0);\n  }\n#else\n  vec4 CCStandardShading (StandardSurface s) {\n    vec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\n    vec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\n    vec3 N = normalize(s.normal);\n    vec3 V = normalize(cc_cameraPos.xyz - s.position);\n    float NV = max(abs(dot(N, V)), 0.001);\n    specular = BRDFApprox(specular, s.roughness, NV);\n    vec3 L = normalize(-cc_mainLitDir.xyz);\n    vec3 H = normalize(L+V);\n    float NH = max(dot(N, H), 0.0);\n    float NL = max(dot(N, L), 0.001);\n    vec3 finalColor = NL * cc_mainLitColor.rgb * cc_mainLitColor.w;\n    #if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\n      finalColor = s.lightmap.a * s.lightmap.rgb + (1.0 - s.lightmap.a) * finalColor;\n    #endif\n    vec3 diffuseContrib = diffuse / 3.14159265359;\n    vec3 specularContrib = specular * CalcSpecular(s.roughness, NH, H, N);\n    finalColor *= (diffuseContrib + specularContrib);\n    float fAmb = 0.5 - N.y * 0.5;\n    vec3 ambDiff = mix(cc_ambientSky.rgb, cc_ambientGround.rgb, fAmb) * cc_ambientSky.w;\n    finalColor += (ambDiff.rgb * diffuse);\n    #if CC_USE_IBL\n      vec3 R = normalize(reflect(-V, N));\n      vec4 envmap = fragTextureLod(cc_environment, R, s.roughness * cc_ambientGround.w);\n      #if CC_USE_IBL == 2\n        vec3 env = unpackRGBE(envmap);\n      #else\n        vec3 env = SRGBToLinear(envmap.rgb);\n      #endif\n      finalColor += env * cc_ambientSky.w * specular;\n    #endif\n    finalColor = finalColor * s.occlusion;\n    #if CC_USE_HDR\n      s.emissive *= cc_exposure.w;\n    #endif\n    finalColor += s.emissive;\n    #if CC_RECEIVE_SHADOW\n    {\n      float pcf = cc_shadowInfo.z + 0.001;\n      float shadowAttenuation = 0.0;\n      if (pcf > 3.0) shadowAttenuation = CCGetShadowFactorX25();\n      else if (3.0 > pcf && pcf > 2.0) shadowAttenuation = CCGetShadowFactorX9();\n      else if (2.0 > pcf && pcf > 1.0) shadowAttenuation = CCGetShadowFactorX5();\n      else shadowAttenuation = CCGetShadowFactorX1();\n      vec3 shadowColor = cc_shadowColor.rgb * cc_shadowColor.a + finalColor.rgb * (1.0 - cc_shadowColor.a);\n      finalColor.rgb = shadowColor.rgb * shadowAttenuation * NL + finalColor.rgb * (1.0 - shadowAttenuation * NL);\n    }\n    #endif\n    return vec4(finalColor, s.albedo.a);\n  }\n#endif\nvec3 ACESToneMap (vec3 color) {\n  color = min(color, vec3(8.0));\n  const float A = 2.51;\n  const float B = 0.03;\n  const float C = 2.43;\n  const float D = 0.59;\n  const float E = 0.14;\n  return (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n  #if !CC_USE_HDR\n    color.rgb = sqrt(ACESToneMap(color.rgb));\n  #endif\n  return color;\n}\nuniform vec4 albedo;\nuniform vec4 albedoScaleAndCutoff;\nuniform vec4 pbrParams;\nuniform vec4 emissive;\nuniform vec4 emissiveScaleParam;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\n  varying vec2 v_luv;\nuniform sampler2D cc_lightingMap;\n#endif\nvarying vec3 v_position;\nvarying vec2 v_uv;\nvarying vec2 v_uv1;\nvarying vec3 v_normal;\nvarying float v_fog_factor;\n#if USE_VERTEX_COLOR\n  varying vec4 v_color;\n#endif\n#if USE_ALBEDO_MAP\n  uniform sampler2D albedoMap;\n#endif\n#if USE_NORMAL_MAP\n  varying vec3 v_tangent;\n  varying vec3 v_bitangent;\n  uniform sampler2D normalMap;\n#endif\n#if USE_PBR_MAP\n  uniform sampler2D pbrMap;\n#endif\n#if USE_METALLIC_ROUGHNESS_MAP\n  uniform sampler2D metallicRoughnessMap;\n#endif\n#if USE_OCCLUSION_MAP\n  uniform sampler2D occlusionMap;\n#endif\n#if USE_EMISSIVE_MAP\n  uniform sampler2D emissiveMap;\n#endif\n#if USE_ALPHA_TEST\n#endif\nvoid surf (out StandardSurface s) {\n  vec4 baseColor = albedo;\n  #if USE_VERTEX_COLOR\n    baseColor *= v_color;\n  #endif\n  #if USE_ALBEDO_MAP\n    vec4 texColor = texture2D(albedoMap, ALBEDO_UV);\n    texColor.rgb = SRGBToLinear(texColor.rgb);\n    baseColor *= texColor;\n  #endif\n  s.albedo = baseColor;\n  s.albedo.rgb *= albedoScaleAndCutoff.xyz;\n  #if USE_ALPHA_TEST\n    if (s.albedo.ALPHA_TEST_CHANNEL < albedoScaleAndCutoff.w) discard;\n  #endif\n  #if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\n    s.lightmap = texture2D(cc_lightingMap, v_luv);\n  #endif\n  s.normal = v_normal;\n  #if USE_NORMAL_MAP\n    vec3 nmmp = texture2D(normalMap, NORMAL_UV).xyz - vec3(0.5);\n    s.normal =\n      (nmmp.x * pbrParams.w) * normalize(v_tangent) +\n      (nmmp.y * pbrParams.w) * normalize(v_bitangent) +\n      nmmp.z * normalize(s.normal);\n  #endif\n  s.position = v_position;\n  vec4 pbr = pbrParams;\n  #if USE_PBR_MAP\n    vec4 res = texture2D(pbrMap, PBR_UV);\n    pbr.x *= res.r;\n    pbr.y *= res.g;\n    pbr.z *= res.b;\n  #endif\n  #if USE_METALLIC_ROUGHNESS_MAP\n    vec4 metallicRoughness = texture2D(metallicRoughnessMap, PBR_UV);\n    pbr.z *= metallicRoughness.b;\n    pbr.y *= metallicRoughness.g;\n  #endif\n  #if USE_OCCLUSION_MAP\n    pbr.x *= texture2D(occlusionMap, PBR_UV).r;\n  #endif\n  s.occlusion = clamp(pbr.x, 0.0, 0.96);\n  s.roughness = clamp(pbr.y, 0.04, 1.0);\n  s.metallic = pbr.z;\n  s.emissive = emissive.rgb * emissiveScaleParam.xyz;\n  #if USE_EMISSIVE_MAP\n    s.emissive *= SRGBToLinear(texture2D(emissiveMap, EMISSIVE_UV).rgb);\n  #endif\n}\nvec4 frag () {\n  StandardSurface s; surf(s);\n  vec4 color = CCStandardShading(s);\n  color = vec4(mix(CC_FORWARD_ADD > 0 ? vec3(0.0) : cc_fogColor.rgb, color.rgb, v_fog_factor), color.a);\n  return CCFragOutput(color);\n}\nvoid main() { gl_FragColor = frag(); }"},{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\n  rgba = rgba * 255.0;\n  highp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\n  highp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\n  highp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\n  return Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\n  highp vec4 position;\n  vec3 normal;\n  vec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_MORPH\n    attribute float a_vertexId;\n    int getVertexId() {\n        return int(a_vertexId);\n    }\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\n    float pixelIndexF = float(pixelIndex);\n    float x = mod(pixelIndexF, textureResolution.x);\n    float y = floor(pixelIndexF / textureResolution.x);\n    return vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\n    return (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_SUPPORT_FLOAT_TEXTURE\n        vec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\n            int pixelIndex = elementIndex;\n            vec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\n            vec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\n            return texture2D(tex, uv);\n        }\n#else\n    vec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\n        int pixelIndex = elementIndex * 4;\n        vec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\n        vec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\n        return vec4(\n            decode32(texture2D(tex, x)),\n            decode32(texture2D(tex, y)),\n            decode32(texture2D(tex, z)),\n            1.0\n        );\n    }\n#endif\nfloat getDisplacementWeight(int index) {\n    int quot = index / 4;\n    int remainder = index - quot * 4;\n    if (remainder == 0) {\n        return cc_displacementWeights[quot].x;\n    } else if (remainder == 1) {\n        return cc_displacementWeights[quot].y;\n    } else if (remainder == 2) {\n        return cc_displacementWeights[quot].z;\n    } else {\n        return cc_displacementWeights[quot].w;\n    }\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\n    return fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\n    vec3 result = vec3(0, 0, 0);\n    int nVertices = int(cc_displacementTextureInfo.z);\n    for (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\n        result += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n    }\n    return result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\n    uniform sampler2D cc_PositionDisplacements;\n    vec3 getPositionDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    uniform sampler2D cc_NormalDisplacements;\n    vec3 getNormalDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    uniform sampler2D cc_TangentDisplacements;\n    vec3 getTangentDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n    }\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\n    int vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\n    attr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    attr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    attr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\n    position.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n  attribute vec4 a_joints;\nattribute vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n  #if USE_INSTANCING\n    attribute highp vec4 a_jointAnimInfo;\n  #endif\n  uniform highp vec4 cc_jointTextureInfo;\n  uniform highp vec4 cc_jointAnimInfo;\n  uniform highp sampler2D cc_jointTexture;\n  #else\n  uniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n  #if CC_SUPPORT_FLOAT_TEXTURE\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\n      vec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\n      vec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #else\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = vec4(\n        decode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n      );\n      vec4 v2 = vec4(\n        decode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n      );\n      vec4 v3 = vec4(\n        decode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n      );\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #endif\n#else\n  mat4 getJointMatrix (float i) {\n    int idx = int(i);\n    vec4 v1 = cc_joints[idx * 3];\n    vec4 v2 = cc_joints[idx * 3 + 1];\n    vec4 v3 = cc_joints[idx * 3 + 2];\n    return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n  }\n#endif\nmat4 skinMatrix () {\n  vec4 joints = vec4(a_joints);\n  return getJointMatrix(joints.x) * a_weights.x\n       + getJointMatrix(joints.y) * a_weights.y\n       + getJointMatrix(joints.z) * a_weights.z\n       + getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\n  mat4 m = skinMatrix();\n  position = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\n  mat4 m = skinMatrix();\n  attr.position = m * attr.position;\n  attr.normal = (m * vec4(attr.normal, 0.0)).xyz;\n  attr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\n#if USE_INSTANCING\n  attribute vec4 a_matWorld0;\n  attribute vec4 a_matWorld1;\n  attribute vec4 a_matWorld2;\n  #if USE_LIGHTMAP\n    attribute vec4 a_lightingMapUVParam;\n  #endif\n#elif USE_BATCHING\n  attribute float a_dyn_batch_id;\n  uniform highp mat4 cc_matWorlds[10];\n#else\nuniform highp mat4 cc_matWorld;\nuniform highp mat4 cc_matWorldIT;\n#endif\nuniform vec4 tilingOffset;\nuniform highp mat4 cc_matLightViewProj;\n#if HAS_SECOND_UV || USE_LIGHTMAP\n  attribute vec2 a_texCoord1;\n#endif\nvarying vec2 v_uv;\nvarying vec2 v_uv1;\nvarying float v_clip_depth;\nvec4 vert () {\n  StandardVertInput In;\n  In.position = vec4(a_position, 1.0);\n  In.normal = a_normal;\n  In.tangent = a_tangent;\n  #if CC_USE_MORPH\n    applyMorph(In);\n  #endif\n  #if CC_USE_SKINNING\n    CCSkin(In);\n  #endif\n  mat4 matWorld, matWorldIT;\n  #if USE_INSTANCING\n    matWorld = mat4(\n      vec4(a_matWorld0.xyz, 0.0),\n      vec4(a_matWorld1.xyz, 0.0),\n      vec4(a_matWorld2.xyz, 0.0),\n      vec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n    );\n    matWorldIT = matWorld;\n  #elif USE_BATCHING\n    matWorld = cc_matWorlds[int(a_dyn_batch_id)];\n    matWorldIT = matWorld;\n  #else\n    matWorld = cc_matWorld;\n    matWorldIT = cc_matWorldIT;\n  #endif\n  vec4 worldPos = matWorld * In.position;\n  vec4 clipPos = cc_matLightViewProj * worldPos;\n  v_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n  #if HAS_SECOND_UV\n    v_uv1 = a_texCoord1 * tilingOffset.xy + tilingOffset.zw;\n  #endif\n  v_clip_depth = clipPos.z / clipPos.w * 0.5 + 0.5;\n  return clipPos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nuniform vec4 albedo;\nuniform vec4 albedoScaleAndCutoff;\nvec4 packDepthToRGBA (float depth) {\n  vec4 ret = vec4(1.0, 255.0, 65025.0, 160581375.0) * depth;\n  ret = fract(ret);\n  ret -= ret.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);\n  return ret;\n}\nvarying vec2 v_uv;\nvarying vec2 v_uv1;\nvarying float v_clip_depth;\n#if USE_ALBEDO_MAP\n  uniform sampler2D albedoMap;\n#endif\n#if USE_ALPHA_TEST\n#endif\nvec4 frag () {\n  vec4 baseColor = albedo;\n  #if USE_ALBEDO_MAP\n    baseColor *= texture2D(albedoMap, ALBEDO_UV);\n  #endif\n  #if USE_ALPHA_TEST\n    if (baseColor.ALPHA_TEST_CHANNEL < albedoScaleAndCutoff.w) discard;\n  #endif\n  return packDepthToRGBA(v_clip_depth);\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nuniform highp mat4 cc_matViewProj;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_fogBase;\nuniform mediump vec4 cc_fogAdd;\nuniform highp mat4 cc_matWorld;\nfloat LinearFog(vec4 pos) {\n    vec4 wPos = pos;\n    float cam_dis = distance(cc_cameraPos, wPos);\n    float fogStart = cc_fogBase.x;\n    float fogEnd = cc_fogBase.y;\n    return clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float fogDensity = cc_fogBase.z;\n    float cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\n    float f = exp(-cam_dis * fogDensity);\n    return f;\n}\nfloat ExpSquaredFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float fogDensity = cc_fogBase.z;\n    float cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\n    float f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\n    return f;\n}\nfloat LayeredFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float _FogTop = cc_fogAdd.x;\n    float _FogRange = cc_fogAdd.y;\n    vec3 camWorldProj = cc_cameraPos.xyz;\n    camWorldProj.y = 0.;\n    vec3 worldPosProj = wPos.xyz;\n    worldPosProj.y = 0.;\n    float fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\n    float fDeltaY, fDensityIntegral;\n    if (cc_cameraPos.y > _FogTop) {\n        if (wPos.y < _FogTop) {\n            fDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\n            fDensityIntegral = fDeltaY * fDeltaY * 0.5;\n        } else {\n            fDeltaY = 0.;\n            fDensityIntegral = 0.;\n        }\n    } else {\n        if (wPos.y < _FogTop) {\n            float fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\n            float fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\n            fDeltaY = abs(fDeltaA - fDeltaB);\n            fDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n        } else {\n            fDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\n            fDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n        }\n    }\n    float fDensity;\n    if (fDeltaY != 0.) {\n        fDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n    } else {\n        fDensity = 0.;\n    }\n    float f = exp(-fDensity);\n    return f;\n}\nfloat CC_TRANSFER_FOG(vec4 pos) {\n    #if CC_USE_FOG == 0\n        return LinearFog(pos);\n\t#elif CC_USE_FOG == 1\n        return ExpFog(pos);\n    #elif CC_USE_FOG == 2\n        return ExpSquaredFog(pos);\n    #elif CC_USE_FOG == 3\n        return LayeredFog(pos);\n    #endif\n    return 1.;\n}\nvarying highp vec4 v_shadowPos;\nuniform highp mat4 cc_matLightViewProj;\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nvarying highp vec3 v_position;\nvarying mediump vec3 v_normal;\n#if USE_NORMALMAP\n  varying mediump vec3 v_tangent;\n  varying mediump vec3 v_binormal;\n#endif\nvarying mediump vec2 uvw;\nvarying mediump vec2 uv0;\nvarying mediump vec2 uv1;\nvarying mediump vec2 uv2;\nvarying mediump vec2 uv3;\nvarying mediump vec2 luv;\nvarying mediump vec3 diffuse;\nvarying mediump float v_fog_factor;\nuniform vec4 UVScale;\nuniform vec4 lightMapUVParam;\nvec4 vert () {\n  vec3 worldPos;\n  worldPos.x = cc_matWorld[3][0] + a_position.x;\n  worldPos.y = cc_matWorld[3][1] + a_position.y;\n  worldPos.z = cc_matWorld[3][2] + a_position.z;\n  vec4 pos = vec4(worldPos, 1.0);\n  pos = cc_matViewProj * pos;\n  uvw = a_texCoord;\n  uv0 = a_position.xz * UVScale.x;\n  uv1 = a_position.xz * UVScale.y;\n  uv2 = a_position.xz * UVScale.z;\n  uv3 = a_position.xz * UVScale.w;\n  #if USE_LIGHTMAP\n    luv = lightMapUVParam.xy + a_texCoord * lightMapUVParam.zw;\n  #endif\n  v_position = worldPos;\n  v_normal = a_normal;\n  v_fog_factor = CC_TRANSFER_FOG(vec4(worldPos, 1.0));\n  #if USE_NORMALMAP\n    v_tangent = vec3(1.0, 0.0, 0.0);\n    v_binormal = vec3(0.0, 0.0, 1.0);\n    v_binormal = cross(v_tangent, a_normal);\n    v_tangent = cross(a_normal, v_binormal);\n  #endif\n    v_shadowPos = cc_matLightViewProj * vec4(worldPos, 1.0);\n  return pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\n#ifdef GL_EXT_shader_texture_lod\n#extension GL_EXT_shader_texture_lod: enable\n#endif\nprecision highp float;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_exposure;\nuniform mediump vec4 cc_mainLitDir;\nuniform mediump vec4 cc_mainLitColor;\nuniform mediump vec4 cc_ambientSky;\nuniform mediump vec4 cc_ambientGround;\nuniform mediump vec4 cc_fogColor;\nuniform lowp vec4 cc_shadowColor;\nuniform lowp vec4 cc_shadowInfo;\n#if CC_USE_IBL\nuniform samplerCube cc_environment;\nvec3 unpackRGBE (vec4 rgbe) {\n  return rgbe.rgb * pow(2.0, rgbe.a * 255.0 - 128.0);\n}\nvec4 fragTextureLod (sampler2D tex, vec2 coord, float lod) {\n    #ifdef GL_EXT_shader_texture_lod\n      return texture2DLodEXT(tex, coord, lod);\n    #else\n      return texture2D(tex, coord, lod);\n    #endif\n}\nvec4 fragTextureLod (samplerCube tex, vec3 coord, float lod) {\n    #ifdef GL_EXT_shader_texture_lod\n      return textureCubeLodEXT(tex, coord, lod);\n    #else\n      return textureCube(tex, coord, lod);\n    #endif\n}\n#endif\n#if CC_RECEIVE_SHADOW\nvarying highp vec4 v_shadowPos;\n#if CC_RECEIVE_SHADOW\n  uniform sampler2D cc_shadowMap;\n  uniform sampler2D cc_spotLightingMap;\n  float CCGetShadowFactorX1 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float closestDepth = dot(texture2D(cc_shadowMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    float shadow = step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    return shadow;\n  }\n  float CCGetShadowFactorX5 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    float closestDepth = 0.0;\n    closestDepth = dot(texture2D(cc_shadowMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_shadowMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_shadowMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_shadowMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    return shadow / 5.0;\n  }\n  float CCGetShadowFactorX9 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -1; i <= 1; i++) {\n      for (int j = -1; j <= 1; j++) {\n        float closestDepth = dot(texture2D(cc_shadowMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 9.0;\n  }\n  float CCGetShadowFactorX25 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -2; i <= 2; i++) {\n      for (int j = -2; j <= 2; j++) {\n        float closestDepth = dot(texture2D(cc_shadowMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 25.0;\n  }\n  float CCGetDirLightShadowFactorX1 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float closestDepth = dot(texture2D(cc_spotLightingMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    float shadow = step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    return shadow;\n  }\n  float CCGetDirLightShadowFactorX5 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    float closestDepth = 0.0;\n    closestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    return shadow / 5.0;\n  }\n  float CCGetDirLightShadowFactorX9 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -1; i <= 1; i++) {\n      for (int j = -1; j <= 1; j++) {\n        float closestDepth = dot(texture2D(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 9.0;\n  }\n  float CCGetDirLightShadowFactorX25 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -2; i <= 2; i++) {\n      for (int j = -2; j <= 2; j++) {\n        float closestDepth = dot(texture2D(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 25.0;\n  }\n#endif\n#endif\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nfloat GGXMobile (float roughness, float NoH, vec3 H, vec3 N) {\n  vec3 NxH = cross(N, H);\n  float OneMinusNoHSqr = dot(NxH, NxH);\n  float a = roughness * roughness;\n  float n = NoH * a;\n  float p = a / (OneMinusNoHSqr + n * n);\n  return p * p;\n}\nfloat CalcSpecular (float roughness, float NoH, vec3 H, vec3 N) {\n  return (roughness*0.25 + 0.25) * GGXMobile(roughness, NoH, H, N);\n}\nvec3 BRDFApprox (vec3 specular, float roughness, float NoV) {\n  const vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\n  const vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\n  vec4 r = roughness * c0 + c1;\n  float a004 = min( r.x * r.x, exp2( -9.28 * NoV ) ) * r.x + r.y;\n  vec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n  AB.y *= clamp(50.0 * specular.g, 0.0, 1.0);\n  return specular * AB.x + AB.y;\n}\nstruct StandardSurface {\n  vec4 albedo;\n  vec3 position;\n  vec3 normal;\n  vec3 emissive;\n  vec4 lightmap;\n  float roughness;\n  float metallic;\n  float occlusion;\n};\n#if CC_FORWARD_ADD\nuniform highp vec4 cc_lightPos[1];\nuniform vec4 cc_lightColor[1];\nuniform vec4 cc_lightSizeRangeAngle[1];\nuniform vec4 cc_lightDir[1];\nfloat SmoothDistAtt (float distSqr, float invSqrAttRadius) {\n  float factor = distSqr * invSqrAttRadius;\n  float smoothFactor = clamp(1.0 - factor * factor, 0.0, 1.0);\n  return smoothFactor * smoothFactor;\n}\nfloat GetDistAtt (float distSqr, float invSqrAttRadius) {\n  float attenuation = 1.0 / max(distSqr, 0.01*0.01);\n  attenuation *= SmoothDistAtt(distSqr , invSqrAttRadius);\n  return attenuation;\n}\nfloat GetAngleAtt (vec3 L, vec3 litDir, float litAngleScale, float litAngleOffset) {\n  float cd = dot(litDir, L);\n  float attenuation = clamp(cd * litAngleScale + litAngleOffset, 0.0, 1.0);\n  return (attenuation * attenuation);\n}\n  vec4 CCStandardShading (StandardSurface s) {\n    vec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\n    vec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\n    vec3 diffuseContrib = diffuse / 3.14159265359;\n    vec3 N = normalize(s.normal);\n    vec3 V = normalize(cc_cameraPos.xyz - s.position);\n    float NV = max(abs(dot(N, V)), 0.001);\n    specular = BRDFApprox(specular, s.roughness, NV);\n    vec3 finalColor = vec3(0.0);\n    for (int i = 0; i < 1; i++) {\n      vec3 SLU = cc_lightPos[i].xyz - s.position;\n      vec3 SL = normalize(SLU);\n      vec3 SH = normalize(SL + V);\n      float SNL = max(dot(N, SL), 0.001);\n      float SNH = max(dot(N, SH), 0.0);\n      float distSqr = dot(SLU, SLU);\n      float litRadius = cc_lightSizeRangeAngle[i].x;\n      float litRadiusSqr = litRadius * litRadius;\n      float illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\n      float attRadiusSqrInv = 1.0 / max(cc_lightSizeRangeAngle[i].y, 0.01);\n      attRadiusSqrInv *= attRadiusSqrInv;\n      float att = GetDistAtt(distSqr, attRadiusSqrInv);\n      vec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\n      if (cc_lightPos[i].w > 0.0) {\n        float cosInner = max(dot(-cc_lightDir[i].xyz, SL), 0.01);\n        float cosOuter = cc_lightSizeRangeAngle[i].z;\n        float litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\n        float litAngleOffset = -cosOuter * litAngleScale;\n        att *= GetAngleAtt(SL, -cc_lightDir[i].xyz, litAngleScale, litAngleOffset);\n      }\n      vec3 lightColor = cc_lightColor[i].rgb;\n    #if CC_RECEIVE_SHADOW\n      if (cc_lightPos[i].w > 0.0) {\n    {\n      float pcf = cc_shadowInfo.z + 0.001;\n      float shadowAttenuation = 0.0;\n      if (pcf > 3.0) shadowAttenuation = CCGetDirLightShadowFactorX25();\n      else if (3.0 > pcf && pcf > 2.0) shadowAttenuation = CCGetDirLightShadowFactorX9();\n      else if (2.0 > pcf && pcf > 1.0) shadowAttenuation = CCGetDirLightShadowFactorX5();\n      else shadowAttenuation = CCGetDirLightShadowFactorX1();\n      lightColor *= 1.0 - shadowAttenuation;\n    }\n      }\n    #endif\n      finalColor += SNL * lightColor * cc_lightColor[i].w * illum * att * (diffuseContrib + lspec);\n    }\n    finalColor = finalColor * s.occlusion;\n    return vec4(finalColor, 0.0);\n  }\n#else\n  vec4 CCStandardShading (StandardSurface s) {\n    vec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\n    vec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\n    vec3 N = normalize(s.normal);\n    vec3 V = normalize(cc_cameraPos.xyz - s.position);\n    float NV = max(abs(dot(N, V)), 0.001);\n    specular = BRDFApprox(specular, s.roughness, NV);\n    vec3 L = normalize(-cc_mainLitDir.xyz);\n    vec3 H = normalize(L+V);\n    float NH = max(dot(N, H), 0.0);\n    float NL = max(dot(N, L), 0.001);\n    vec3 finalColor = NL * cc_mainLitColor.rgb * cc_mainLitColor.w;\n    #if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\n      finalColor = s.lightmap.a * s.lightmap.rgb + (1.0 - s.lightmap.a) * finalColor;\n    #endif\n    vec3 diffuseContrib = diffuse / 3.14159265359;\n    vec3 specularContrib = specular * CalcSpecular(s.roughness, NH, H, N);\n    finalColor *= (diffuseContrib + specularContrib);\n    float fAmb = 0.5 - N.y * 0.5;\n    vec3 ambDiff = mix(cc_ambientSky.rgb, cc_ambientGround.rgb, fAmb) * cc_ambientSky.w;\n    finalColor += (ambDiff.rgb * diffuse);\n    #if CC_USE_IBL\n      vec3 R = normalize(reflect(-V, N));\n      vec4 envmap = fragTextureLod(cc_environment, R, s.roughness * cc_ambientGround.w);\n      #if CC_USE_IBL == 2\n        vec3 env = unpackRGBE(envmap);\n      #else\n        vec3 env = SRGBToLinear(envmap.rgb);\n      #endif\n      finalColor += env * cc_ambientSky.w * specular;\n    #endif\n    finalColor = finalColor * s.occlusion;\n    #if CC_USE_HDR\n      s.emissive *= cc_exposure.w;\n    #endif\n    finalColor += s.emissive;\n    #if CC_RECEIVE_SHADOW\n    {\n      float pcf = cc_shadowInfo.z + 0.001;\n      float shadowAttenuation = 0.0;\n      if (pcf > 3.0) shadowAttenuation = CCGetShadowFactorX25();\n      else if (3.0 > pcf && pcf > 2.0) shadowAttenuation = CCGetShadowFactorX9();\n      else if (2.0 > pcf && pcf > 1.0) shadowAttenuation = CCGetShadowFactorX5();\n      else shadowAttenuation = CCGetShadowFactorX1();\n      vec3 shadowColor = cc_shadowColor.rgb * cc_shadowColor.a + finalColor.rgb * (1.0 - cc_shadowColor.a);\n      finalColor.rgb = shadowColor.rgb * shadowAttenuation * NL + finalColor.rgb * (1.0 - shadowAttenuation * NL);\n    }\n    #endif\n    return vec4(finalColor, s.albedo.a);\n  }\n#endif\nvec3 ACESToneMap (vec3 color) {\n  color = min(color, vec3(8.0));\n  const float A = 2.51;\n  const float B = 0.03;\n  const float C = 2.43;\n  const float D = 0.59;\n  const float E = 0.14;\n  return (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n  #if !CC_USE_HDR\n    color.rgb = sqrt(ACESToneMap(color.rgb));\n  #endif\n  return color;\n}\nvarying highp vec3 v_position;\nvarying mediump vec3 v_normal;\n#if USE_NORMALMAP\n  varying mediump vec3 v_tangent;\n  varying mediump vec3 v_binormal;\n#endif\nvarying mediump vec2 uvw;\nvarying mediump vec2 uv0;\nvarying mediump vec2 uv1;\nvarying mediump vec2 uv2;\nvarying mediump vec2 uv3;\nvarying mediump vec3 diffuse;\nvarying mediump vec2 luv;\nvarying mediump float v_fog_factor;\nuniform vec4 metallic;\nuniform vec4 roughness;\nuniform sampler2D weightMap;\nuniform sampler2D detailMap0;\nuniform sampler2D detailMap1;\nuniform sampler2D detailMap2;\nuniform sampler2D detailMap3;\nuniform sampler2D normalMap0;\nuniform sampler2D normalMap1;\nuniform sampler2D normalMap2;\nuniform sampler2D normalMap3;\nuniform sampler2D lightMap;\nvoid surf (out StandardSurface s) {\n  #if LAYERS > 1\n    vec4 w = texture2D(weightMap, uvw);\n  #endif\n  vec4 baseColor = vec4(0, 0, 0, 0);\n  #if LAYERS == 1\n    baseColor = texture2D(detailMap0, uv0);\n  #elif LAYERS == 2\n    baseColor += texture2D(detailMap0, uv0) * w.r;\n    baseColor += texture2D(detailMap1, uv1) * w.g;\n  #elif LAYERS == 3\n    baseColor += texture2D(detailMap0, uv0) * w.r;\n    baseColor += texture2D(detailMap1, uv1) * w.g;\n    baseColor += texture2D(detailMap2, uv2) * w.b;\n  #elif LAYERS == 4\n    baseColor += texture2D(detailMap0, uv0) * w.r;\n    baseColor += texture2D(detailMap1, uv1) * w.g;\n    baseColor += texture2D(detailMap2, uv2) * w.b;\n    baseColor += texture2D(detailMap3, uv3) * w.a;\n  #else\n    baseColor = texture2D(detailMap0, uv0);\n  #endif\n  s.position = v_position;\n  #if USE_NORMALMAP\n    vec4 baseNormal = vec4(0, 0, 0, 0);\n    #if LAYERS == 1\n      baseNormal = texture2D(normalMap0, uv0);\n    #elif LAYERS == 2\n      baseNormal += texture2D(normalMap0, uv0) * w.r;\n      baseNormal += texture2D(normalMap1, uv1) * w.g;\n    #elif LAYERS == 3\n      baseNormal += texture2D(normalMap0, uv0) * w.r;\n      baseNormal += texture2D(normalMap1, uv1) * w.g;\n      baseNormal += texture2D(normalMap2, uv2) * w.b;\n    #elif LAYERS == 4\n      baseNormal += texture2D(normalMap0, uv0) * w.r;\n      baseNormal += texture2D(normalMap1, uv1) * w.g;\n      baseNormal += texture2D(normalMap2, uv2) * w.b;\n      baseNormal += texture2D(normalMap3, uv3) * w.a;\n    #else\n      baseNormal = texture2D(normalMap0, uv0);\n    #endif\n    vec3 nmmp = baseNormal.xyz - vec3(0.5);\n    s.normal =\n      nmmp.x * normalize(v_tangent) +\n      nmmp.y * normalize(v_binormal) +\n      nmmp.z * normalize(v_normal);\n  #else\n    s.normal = v_normal;\n  #endif\n  s.albedo = vec4(SRGBToLinear(baseColor.rgb), 1.0);\n  s.occlusion = 1.0;\n  #if USE_PBR\n    s.roughness = 0.0;\n    #if LAYERS == 1\n      s.roughness = roughness.x;\n    #elif LAYERS == 2\n      s.roughness += roughness.x * w.r;\n      s.roughness += roughness.y * w.g;\n    #elif LAYERS == 3\n      s.roughness += roughness.x * w.r;\n      s.roughness += roughness.y * w.g;\n      s.roughness += roughness.z * w.b;\n    #elif LAYERS == 4\n      s.roughness += roughness.x * w.r;\n      s.roughness += roughness.y * w.g;\n      s.roughness += roughness.z * w.b;\n      s.roughness += roughness.w * w.a;\n    #else\n      s.roughness = 1.0;\n    #endif\n    s.metallic = 0.0;\n    #if LAYERS == 1\n      s.metallic = metallic.x;\n    #elif LAYERS == 2\n      s.metallic += metallic.x * w.r;\n      s.metallic += metallic.y * w.g;\n    #elif LAYERS == 3\n      s.metallic += metallic.x * w.r;\n      s.metallic += metallic.y * w.g;\n      s.metallic += metallic.z * w.b;\n    #elif LAYERS == 4\n      s.metallic += metallic.x * w.r;\n      s.metallic += metallic.y * w.g;\n      s.metallic += metallic.z * w.b;\n      s.metallic += metallic.w * w.a;\n    #else\n      s.metallic = 0.0;\n    #endif\n  #else\n    s.roughness = 1.0;\n    s.metallic = 0.0;\n  #endif\n  s.emissive = vec3(0.0, 0.0, 0.0);\n  #if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\n    s.lightmap = texture2D(lightMap, luv);\n  #else\n    s.lightmap = vec4(0.0, 0.0, 0.0, 0.0);\n  #endif\n}\nvec4 frag () {\n  StandardSurface s; surf(s);\n  vec4 color = CCStandardShading(s);\n  color = vec4(mix(CC_FORWARD_ADD > 0 ? vec3(0.0) : cc_fogColor.rgb, color.rgb, v_fog_factor), color.a);\n  return CCFragOutput(color);\n}\nvoid main() { gl_FragColor = frag(); }"},{vert:"\nprecision highp float;\nuniform highp mat4 cc_matWorld;\nuniform highp mat4 cc_matLightViewProj;\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nvarying vec2 v_clip_depth;\nvec4 vert () {\n  vec4 worldPos;\n  worldPos.x = cc_matWorld[3][0] + a_position.x;\n  worldPos.y = cc_matWorld[3][1] + a_position.y;\n  worldPos.z = cc_matWorld[3][2] + a_position.z;\n  worldPos.w = 1.0;\n  vec4 clipPos = cc_matLightViewProj * worldPos;\n  v_clip_depth = clipPos.zw;\n  return clipPos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 packDepthToRGBA (float depth) {\n  vec4 ret = vec4(1.0, 255.0, 65025.0, 160581375.0) * depth;\n  ret = fract(ret);\n  ret -= ret.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);\n  return ret;\n}\nvarying vec2 v_clip_depth;\nvec4 frag () {\n  return packDepthToRGBA(v_clip_depth.x / v_clip_depth.y * 0.5 + 0.5);\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\n  rgba = rgba * 255.0;\n  highp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\n  highp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\n  highp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\n  return Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\n  highp vec4 position;\n  vec3 normal;\n  vec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_MORPH\n    attribute float a_vertexId;\n    int getVertexId() {\n        return int(a_vertexId);\n    }\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\n    float pixelIndexF = float(pixelIndex);\n    float x = mod(pixelIndexF, textureResolution.x);\n    float y = floor(pixelIndexF / textureResolution.x);\n    return vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\n    return (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_SUPPORT_FLOAT_TEXTURE\n        vec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\n            int pixelIndex = elementIndex;\n            vec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\n            vec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\n            return texture2D(tex, uv);\n        }\n#else\n    vec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\n        int pixelIndex = elementIndex * 4;\n        vec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\n        vec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\n        return vec4(\n            decode32(texture2D(tex, x)),\n            decode32(texture2D(tex, y)),\n            decode32(texture2D(tex, z)),\n            1.0\n        );\n    }\n#endif\nfloat getDisplacementWeight(int index) {\n    int quot = index / 4;\n    int remainder = index - quot * 4;\n    if (remainder == 0) {\n        return cc_displacementWeights[quot].x;\n    } else if (remainder == 1) {\n        return cc_displacementWeights[quot].y;\n    } else if (remainder == 2) {\n        return cc_displacementWeights[quot].z;\n    } else {\n        return cc_displacementWeights[quot].w;\n    }\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\n    return fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\n    vec3 result = vec3(0, 0, 0);\n    int nVertices = int(cc_displacementTextureInfo.z);\n    for (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\n        result += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n    }\n    return result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\n    uniform sampler2D cc_PositionDisplacements;\n    vec3 getPositionDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    uniform sampler2D cc_NormalDisplacements;\n    vec3 getNormalDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    uniform sampler2D cc_TangentDisplacements;\n    vec3 getTangentDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n    }\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\n    int vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\n    attr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    attr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    attr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\n    position.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n  attribute vec4 a_joints;\nattribute vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n  #if USE_INSTANCING\n    attribute highp vec4 a_jointAnimInfo;\n  #endif\n  uniform highp vec4 cc_jointTextureInfo;\n  uniform highp vec4 cc_jointAnimInfo;\n  uniform highp sampler2D cc_jointTexture;\n  #else\n  uniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n  #if CC_SUPPORT_FLOAT_TEXTURE\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\n      vec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\n      vec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #else\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = vec4(\n        decode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n      );\n      vec4 v2 = vec4(\n        decode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n      );\n      vec4 v3 = vec4(\n        decode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n      );\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #endif\n#else\n  mat4 getJointMatrix (float i) {\n    int idx = int(i);\n    vec4 v1 = cc_joints[idx * 3];\n    vec4 v2 = cc_joints[idx * 3 + 1];\n    vec4 v3 = cc_joints[idx * 3 + 2];\n    return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n  }\n#endif\nmat4 skinMatrix () {\n  vec4 joints = vec4(a_joints);\n  return getJointMatrix(joints.x) * a_weights.x\n       + getJointMatrix(joints.y) * a_weights.y\n       + getJointMatrix(joints.z) * a_weights.z\n       + getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\n  mat4 m = skinMatrix();\n  position = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\n  mat4 m = skinMatrix();\n  attr.position = m * attr.position;\n  attr.normal = (m * vec4(attr.normal, 0.0)).xyz;\n  attr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matProj;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_fogBase;\nuniform mediump vec4 cc_fogAdd;\n#if USE_INSTANCING\n  attribute vec4 a_matWorld0;\n  attribute vec4 a_matWorld1;\n  attribute vec4 a_matWorld2;\n  #if USE_LIGHTMAP\n    attribute vec4 a_lightingMapUVParam;\n  #endif\n#elif USE_BATCHING\n  attribute float a_dyn_batch_id;\n  uniform highp mat4 cc_matWorlds[10];\n#else\nuniform highp mat4 cc_matWorld;\n#endif\nfloat LinearFog(vec4 pos) {\n    vec4 wPos = pos;\n    float cam_dis = distance(cc_cameraPos, wPos);\n    float fogStart = cc_fogBase.x;\n    float fogEnd = cc_fogBase.y;\n    return clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float fogDensity = cc_fogBase.z;\n    float cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\n    float f = exp(-cam_dis * fogDensity);\n    return f;\n}\nfloat ExpSquaredFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float fogDensity = cc_fogBase.z;\n    float cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\n    float f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\n    return f;\n}\nfloat LayeredFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float _FogTop = cc_fogAdd.x;\n    float _FogRange = cc_fogAdd.y;\n    vec3 camWorldProj = cc_cameraPos.xyz;\n    camWorldProj.y = 0.;\n    vec3 worldPosProj = wPos.xyz;\n    worldPosProj.y = 0.;\n    float fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\n    float fDeltaY, fDensityIntegral;\n    if (cc_cameraPos.y > _FogTop) {\n        if (wPos.y < _FogTop) {\n            fDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\n            fDensityIntegral = fDeltaY * fDeltaY * 0.5;\n        } else {\n            fDeltaY = 0.;\n            fDensityIntegral = 0.;\n        }\n    } else {\n        if (wPos.y < _FogTop) {\n            float fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\n            float fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\n            fDeltaY = abs(fDeltaA - fDeltaB);\n            fDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n        } else {\n            fDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\n            fDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n        }\n    }\n    float fDensity;\n    if (fDeltaY != 0.) {\n        fDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n    } else {\n        fDensity = 0.;\n    }\n    float f = exp(-fDensity);\n    return f;\n}\nfloat CC_TRANSFER_FOG(vec4 pos) {\n    #if CC_USE_FOG == 0\n        return LinearFog(pos);\n\t#elif CC_USE_FOG == 1\n        return ExpFog(pos);\n    #elif CC_USE_FOG == 2\n        return ExpSquaredFog(pos);\n    #elif CC_USE_FOG == 3\n        return LayeredFog(pos);\n    #endif\n    return 1.;\n}\n#if USE_VERTEX_COLOR\n  attribute lowp vec4 a_color;\n  varying lowp vec4 v_color;\n#endif\n#if USE_TEXTURE\n  varying vec2 v_uv;\n  uniform vec4 tilingOffset;\n#endif\nvarying float factor_fog;\nvec4 vert () {\n  vec4 position;\n  position = vec4(a_position, 1.0);\n  #if CC_USE_MORPH\n    applyMorph(position);\n  #endif\n  #if CC_USE_SKINNING\n    CCSkin(position);\n  #endif\n  mat4 matWorld;\n  #if USE_INSTANCING\n    matWorld = mat4(\n      vec4(a_matWorld0.xyz, 0.0),\n      vec4(a_matWorld1.xyz, 0.0),\n      vec4(a_matWorld2.xyz, 0.0),\n      vec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n    );\n  #elif USE_BATCHING\n    matWorld = cc_matWorlds[int(a_dyn_batch_id)];\n  #else\n    matWorld = cc_matWorld;\n  #endif\n  #if USE_TEXTURE\n    v_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n  #endif\n  #if USE_VERTEX_COLOR\n    v_color = a_color;\n  #endif\n  factor_fog = CC_TRANSFER_FOG(matWorld * position);\n  return cc_matProj * (cc_matView * matWorld) * position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nuniform mediump vec4 cc_exposure;\nuniform mediump vec4 cc_fogColor;\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n  #if CC_USE_HDR\n    color.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n  #endif\n  return color;\n}\n#if USE_ALPHA_TEST\n#endif\n#if USE_TEXTURE\n  varying vec2 v_uv;\n  uniform sampler2D mainTexture;\n#endif\nuniform vec4 mainColor;\nuniform vec4 colorScaleAndCutoff;\n#if USE_VERTEX_COLOR\n  varying lowp vec4 v_color;\n#endif\nvarying float factor_fog;\nvec4 frag () {\n  vec4 o = mainColor;\n  o.rgb *= colorScaleAndCutoff.xyz;\n  #if USE_VERTEX_COLOR\n    o *= v_color;\n  #endif\n  #if USE_TEXTURE\n    o *= texture2D(mainTexture, v_uv);\n  #endif\n  #if USE_ALPHA_TEST\n    if (o.ALPHA_TEST_CHANNEL < colorScaleAndCutoff.w) discard;\n  #endif\n  o = vec4(mix(CC_FORWARD_ADD > 0 ? vec3(0.0) : cc_fogColor.rgb, o.rgb, factor_fog), o.a);\n  return CCFragOutput(o);\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\n  rgba = rgba * 255.0;\n  highp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\n  highp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\n  highp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\n  return Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\n  highp vec4 position;\n  vec3 normal;\n  vec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_MORPH\n    attribute float a_vertexId;\n    int getVertexId() {\n        return int(a_vertexId);\n    }\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\n    float pixelIndexF = float(pixelIndex);\n    float x = mod(pixelIndexF, textureResolution.x);\n    float y = floor(pixelIndexF / textureResolution.x);\n    return vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\n    return (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_SUPPORT_FLOAT_TEXTURE\n        vec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\n            int pixelIndex = elementIndex;\n            vec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\n            vec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\n            return texture2D(tex, uv);\n        }\n#else\n    vec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\n        int pixelIndex = elementIndex * 4;\n        vec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\n        vec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\n        return vec4(\n            decode32(texture2D(tex, x)),\n            decode32(texture2D(tex, y)),\n            decode32(texture2D(tex, z)),\n            1.0\n        );\n    }\n#endif\nfloat getDisplacementWeight(int index) {\n    int quot = index / 4;\n    int remainder = index - quot * 4;\n    if (remainder == 0) {\n        return cc_displacementWeights[quot].x;\n    } else if (remainder == 1) {\n        return cc_displacementWeights[quot].y;\n    } else if (remainder == 2) {\n        return cc_displacementWeights[quot].z;\n    } else {\n        return cc_displacementWeights[quot].w;\n    }\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\n    return fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\n    vec3 result = vec3(0, 0, 0);\n    int nVertices = int(cc_displacementTextureInfo.z);\n    for (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\n        result += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n    }\n    return result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\n    uniform sampler2D cc_PositionDisplacements;\n    vec3 getPositionDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    uniform sampler2D cc_NormalDisplacements;\n    vec3 getNormalDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    uniform sampler2D cc_TangentDisplacements;\n    vec3 getTangentDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n    }\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\n    int vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\n    attr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    attr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    attr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\n    position.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n  attribute vec4 a_joints;\nattribute vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n  #if USE_INSTANCING\n    attribute highp vec4 a_jointAnimInfo;\n  #endif\n  uniform highp vec4 cc_jointTextureInfo;\n  uniform highp vec4 cc_jointAnimInfo;\n  uniform highp sampler2D cc_jointTexture;\n  #else\n  uniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n  #if CC_SUPPORT_FLOAT_TEXTURE\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\n      vec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\n      vec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #else\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = vec4(\n        decode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n      );\n      vec4 v2 = vec4(\n        decode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n      );\n      vec4 v3 = vec4(\n        decode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n      );\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #endif\n#else\n  mat4 getJointMatrix (float i) {\n    int idx = int(i);\n    vec4 v1 = cc_joints[idx * 3];\n    vec4 v2 = cc_joints[idx * 3 + 1];\n    vec4 v3 = cc_joints[idx * 3 + 2];\n    return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n  }\n#endif\nmat4 skinMatrix () {\n  vec4 joints = vec4(a_joints);\n  return getJointMatrix(joints.x) * a_weights.x\n       + getJointMatrix(joints.y) * a_weights.y\n       + getJointMatrix(joints.z) * a_weights.z\n       + getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\n  mat4 m = skinMatrix();\n  position = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\n  mat4 m = skinMatrix();\n  attr.position = m * attr.position;\n  attr.normal = (m * vec4(attr.normal, 0.0)).xyz;\n  attr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matProj;\n#if USE_INSTANCING\n  attribute vec4 a_matWorld0;\n  attribute vec4 a_matWorld1;\n  attribute vec4 a_matWorld2;\n  #if USE_LIGHTMAP\n    attribute vec4 a_lightingMapUVParam;\n  #endif\n#elif USE_BATCHING\n  attribute float a_dyn_batch_id;\n  uniform highp mat4 cc_matWorlds[10];\n#else\nuniform highp mat4 cc_matWorld;\n#endif\nuniform highp mat4 cc_matLightPlaneProj;\nvec4 vert () {\n  vec4 position;\n  position = vec4(a_position, 1.0);\n  #if CC_USE_MORPH\n    applyMorph(position);\n  #endif\n  #if CC_USE_SKINNING\n    CCSkin(position);\n  #endif\n  mat4 matWorld;\n  #if USE_INSTANCING\n    matWorld = mat4(\n      vec4(a_matWorld0.xyz, 0.0),\n      vec4(a_matWorld1.xyz, 0.0),\n      vec4(a_matWorld2.xyz, 0.0),\n      vec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n    );\n  #elif USE_BATCHING\n    matWorld = cc_matWorlds[int(a_dyn_batch_id)];\n  #else\n    matWorld = cc_matWorld;\n  #endif\n  position = cc_matProj * (cc_matView * cc_matLightPlaneProj * matWorld) * position;\n  position.z -= 0.0001;\n  return position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nuniform lowp vec4 cc_shadowColor;\nuniform mediump vec4 cc_exposure;\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n  #if CC_USE_HDR\n    color.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n  #endif\n  return color;\n}\nvec4 frag () {\n  return CCFragOutput(cc_shadowColor);\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matProj;\nstruct StandardVertInput {\n  highp vec4 position;\n  vec3 normal;\n  vec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\nvarying mediump vec4 viewDir;\nvec4 vert () {\n  viewDir = vec4(a_position, 1.0);\n  mat4 matViewRotOnly = mat4(mat3(cc_matView));\n  mat4 matProj = cc_matProj;\n  if (matProj[3].w > 0.0) {\n    vec2 scale = vec2(48.0, 24.0);\n    matProj[0].xy *= scale;\n    matProj[1].xy *= scale;\n    matProj[2].zw = vec2(-1.0);\n    matProj[3].zw = vec2(0.0);\n  }\n  vec4 pos = matProj * matViewRotOnly * viewDir;\n  pos.z = 0.99999 * pos.w;\n  return pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nuniform mediump vec4 cc_ambientSky;\nuniform samplerCube cc_environment;\nvec3 unpackRGBE (vec4 rgbe) {\n  return rgbe.rgb * pow(2.0, rgbe.a * 255.0 - 128.0);\n}\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec3 ACESToneMap (vec3 color) {\n  color = min(color, vec3(8.0));\n  const float A = 2.51;\n  const float B = 0.03;\n  const float C = 2.43;\n  const float D = 0.59;\n  const float E = 0.14;\n  return (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n  #if !CC_USE_HDR\n    color.rgb = sqrt(ACESToneMap(color.rgb));\n  #endif\n  return color;\n}\nvarying mediump vec4 viewDir;\nvec4 frag () {\n  #if USE_RGBE_CUBEMAP\n    vec3 c = unpackRGBE(textureCube(cc_environment, viewDir.xyz));\n  #else\n    vec3 c = SRGBToLinear(textureCube(cc_environment, viewDir.xyz).rgb);\n  #endif\n  return CCFragOutput(vec4(c * cc_ambientSky.w, 1.0));\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nuniform highp mat4 cc_matViewProj;\nattribute vec3 a_position;\nattribute vec4 a_color;\nvarying vec2 v_uv;\nuniform vec4 offset;\nuniform vec4 digits[20];\nfloat getComponent(vec4 v, float i) {\n  if (i < 1.0) { return v.x; }\n  else if (i < 2.0) { return v.y; }\n  else if (i < 3.0) { return v.z; }\n  else { return v.w; }\n}\nvec4 vert () {\n  vec4 position = cc_matViewProj * vec4(a_position, 1.0);\n  position.xy += offset.xy;\n  v_uv = a_color.xy;\n  if (a_color.z >= 0.0) {\n    float n = getComponent(digits[int(a_color.z)], a_color.w);\n    v_uv += vec2(offset.z * n, 0.0);\n  }\n  return position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nuniform mediump vec4 cc_exposure;\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n  #if CC_USE_HDR\n    color.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n  #endif\n  return color;\n}\nvarying vec2 v_uv;\nuniform sampler2D mainTexture;\nvec4 frag () {\n  return CCFragOutput(texture2D(mainTexture, v_uv));\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nattribute vec2 a_position;\nattribute vec2 a_texCoord;\nvarying vec2 v_uv;\nvec4 vert () {\n  vec4 pos = vec4(a_position, 0, 1);\n  v_uv = a_texCoord;\n  return pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nvarying vec2 v_uv;\nuniform sampler2D mainTexture;\nuniform float u_precent;\nvec4 frag () {\n  vec4 color = texture2D(mainTexture, v_uv);\n  float precent = clamp(u_precent, 0.0, 1.0);\n  color.xyz *= precent;\n  return color;\n}\nvoid main() { gl_FragColor = frag(); }"}]],glsl3:[[{vert:"\nprecision mediump float;\nlayout(std140) uniform Constants {\n  vec4 mainTiling_Offset;\n  vec4 frameTile_velLenScale;\n  vec4 scale;\n};\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nlayout(std140) uniform CCLocal {\n  highp mat4 cc_matWorld;\n  highp mat4 cc_matWorldIT;\n  highp vec4 cc_lightingMapUVParam;\n};\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\n  mat3 m = mat3(xAxis,yAxis,zAxis);\n  float trace = m[0][0] + m[1][1] + m[2][2];\n  vec4 quat;\n  if (trace > 0.) {\n    float s = 0.5 / sqrt(trace + 1.0);\n    quat.w = 0.25 / s;\n    quat.x = (m[2][1] - m[1][2]) * s;\n    quat.y = (m[0][2] - m[2][0]) * s;\n    quat.z = (m[1][0] - m[0][1]) * s;\n  } else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\n    float s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\n    quat.w = (m[2][1] - m[1][2]) / s;\n    quat.x = 0.25 * s;\n    quat.y = (m[0][1] + m[1][0]) / s;\n    quat.z = (m[0][2] + m[2][0]) / s;\n  } else if (m[1][1] > m[2][2]) {\n    float s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\n    quat.w = (m[0][2] - m[2][0]) / s;\n    quat.x = (m[0][1] + m[1][0]) / s;\n    quat.y = 0.25 * s;\n    quat.z = (m[1][2] + m[2][1]) / s;\n  } else {\n    float s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\n    quat.w = (m[1][0] - m[0][1]) / s;\n    quat.x = (m[0][2] + m[2][0]) / s;\n    quat.y = (m[1][2] + m[2][1]) / s;\n    quat.z = 0.25 * s;\n  }\n  float len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\n  if (len > 0.) {\n    len = 1. / sqrt(len);\n    quat.x = quat.x * len;\n    quat.y = quat.y * len;\n    quat.z = quat.z * len;\n    quat.w = quat.w * len;\n  }\n  return quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\n  float x = angle.x / 2.;\n  float y = angle.y / 2.;\n  float z = angle.z / 2.;\n  float sx = sin(x);\n  float cx = cos(x);\n  float sy = sin(y);\n  float cy = cos(y);\n  float sz = sin(z);\n  float cz = cos(z);\n  vec4 quat = vec4(0);\n  quat.x = sx * cy * cz + cx * sy * sz;\n  quat.y = cx * sy * cz + sx * cy * sz;\n  quat.z = cx * cy * sz - sx * sy * cz;\n  quat.w = cx * cy * cz - sx * sy * sz;\n  return quat;\n}\nvec4 quatMultiply (vec4 a, vec4 b){\n  vec4 quat;\n  quat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\n  quat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\n  quat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\n  quat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\n  return quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\n  float ix = q.w * v.x + q.y * v.z - q.z * v.y;\n  float iy = q.w * v.y + q.z * v.x - q.x * v.z;\n  float iz = q.w * v.z + q.x * v.y - q.y * v.x;\n  float iw = -q.x * v.x - q.y * v.y - q.z * v.z;\n  v.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\n  v.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\n  v.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\n  vec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\n  vec4 rotQuat = quatMultiply(viewQuat, q);\n  rotateVecFromQuat(pos, rotQuat);\n  return pos;\n}\nvoid rotateCorner (inout vec2 corner, float angle){\n  float xOS = cos(angle) * corner.x - sin(angle) * corner.y;\n  float yOS = sin(angle) * corner.x + cos(angle) * corner.y;\n  corner.x = xOS;\n  corner.y = yOS;\n}\nout mediump vec2 uv;\nout mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n  , mat4 viewInv\n) {\n  vec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\n  vec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\n  vec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\n  vec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\n  pos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n}\nin vec3 a_position;\nin vec2 a_texCoord;\nin vec4 a_color;\nlayout(std140) uniform builtin {\n  vec4 cc_size_rotation;\n};\nvec4 vs_main() {\n  vec4 pos = vec4(a_position, 1);\n  pos = cc_matWorld * pos;\n  vec2 vertOffset = a_texCoord.xy - 0.5;\n  computeVertPos(pos, vertOffset, quaternionFromEuler(vec3(0., 0., cc_size_rotation.z)), vec3(cc_size_rotation.xy, 0.), cc_matViewInv);\n  pos = cc_matViewProj * pos;\n  uv = a_texCoord.xy;\n  color = a_color;\n  return pos;\n}\nvoid main() { gl_Position = vs_main(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n  #if CC_USE_HDR\n    color.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n  #endif\n  return color;\n}\nin vec2 uv;\nin vec4 color;\nuniform sampler2D mainTexture;\nlayout(std140) uniform FragConstants {\n  vec4 tintColor;\n};\nvec4 add () {\n  vec4 col = 2.0 * color * tintColor * texture(mainTexture, uv);\n  return CCFragOutput(col);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nin vec3 a_position;\nvec4 vert () {\n  vec4 pos = vec4(a_position, 1);\n  return pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 frag () {\n  vec4 o = vec4(1.0);\n  return o;\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nlayout(std140) uniform CCLocal {\n  highp mat4 cc_matWorld;\n  highp mat4 cc_matWorldIT;\n  highp vec4 cc_lightingMapUVParam;\n};\nin vec3 a_position;\nin vec4 a_color;\nout vec4 v_color;\nin float a_dist;\nout float v_dist;\nvec4 vert () {\n  vec4 pos = vec4(a_position, 1);\n  pos = cc_matViewProj * cc_matWorld * pos;\n  v_color = a_color;\n  v_dist = a_dist;\n  return pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nin vec4 v_color;\nin float v_dist;\nvec4 frag () {\n  vec4 o = v_color;\n    float aa = fwidth(v_dist);\n  float alpha = 1. - smoothstep(-aa, 0., abs(v_dist) - 1.0);\n  o.rgb *= o.a;\n  o *= alpha;\n  return o;\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\n  mat3 m = mat3(xAxis,yAxis,zAxis);\n  float trace = m[0][0] + m[1][1] + m[2][2];\n  vec4 quat;\n  if (trace > 0.) {\n    float s = 0.5 / sqrt(trace + 1.0);\n    quat.w = 0.25 / s;\n    quat.x = (m[2][1] - m[1][2]) * s;\n    quat.y = (m[0][2] - m[2][0]) * s;\n    quat.z = (m[1][0] - m[0][1]) * s;\n  } else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\n    float s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\n    quat.w = (m[2][1] - m[1][2]) / s;\n    quat.x = 0.25 * s;\n    quat.y = (m[0][1] + m[1][0]) / s;\n    quat.z = (m[0][2] + m[2][0]) / s;\n  } else if (m[1][1] > m[2][2]) {\n    float s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\n    quat.w = (m[0][2] - m[2][0]) / s;\n    quat.x = (m[0][1] + m[1][0]) / s;\n    quat.y = 0.25 * s;\n    quat.z = (m[1][2] + m[2][1]) / s;\n  } else {\n    float s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\n    quat.w = (m[1][0] - m[0][1]) / s;\n    quat.x = (m[0][2] + m[2][0]) / s;\n    quat.y = (m[1][2] + m[2][1]) / s;\n    quat.z = 0.25 * s;\n  }\n  float len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\n  if (len > 0.) {\n    len = 1. / sqrt(len);\n    quat.x = quat.x * len;\n    quat.y = quat.y * len;\n    quat.z = quat.z * len;\n    quat.w = quat.w * len;\n  }\n  return quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\n  float x = angle.x / 2.;\n  float y = angle.y / 2.;\n  float z = angle.z / 2.;\n  float sx = sin(x);\n  float cx = cos(x);\n  float sy = sin(y);\n  float cy = cos(y);\n  float sz = sin(z);\n  float cz = cos(z);\n  vec4 quat = vec4(0);\n  quat.x = sx * cy * cz + cx * sy * sz;\n  quat.y = cx * sy * cz + sx * cy * sz;\n  quat.z = cx * cy * sz - sx * sy * cz;\n  quat.w = cx * cy * cz - sx * sy * sz;\n  return quat;\n}\nmat4 matrixFromRT (vec4 q, vec3 p){\n  float x2 = q.x + q.x;\n  float y2 = q.y + q.y;\n  float z2 = q.z + q.z;\n  float xx = q.x * x2;\n  float xy = q.x * y2;\n  float xz = q.x * z2;\n  float yy = q.y * y2;\n  float yz = q.y * z2;\n  float zz = q.z * z2;\n  float wx = q.w * x2;\n  float wy = q.w * y2;\n  float wz = q.w * z2;\n  return mat4(\n    1. - (yy + zz), xy + wz, xz - wy, 0,\n    xy - wz, 1. - (xx + zz), yz + wx, 0,\n    xz + wy, yz - wx, 1. - (xx + yy), 0,\n    p.x, p.y, p.z, 1\n  );\n}\nmat4 matFromRTS (vec4 q, vec3 t, vec3 s){\n  float x = q.x, y = q.y, z = q.z, w = q.w;\n  float x2 = x + x;\n  float y2 = y + y;\n  float z2 = z + z;\n  float xx = x * x2;\n  float xy = x * y2;\n  float xz = x * z2;\n  float yy = y * y2;\n  float yz = y * z2;\n  float zz = z * z2;\n  float wx = w * x2;\n  float wy = w * y2;\n  float wz = w * z2;\n  float sx = s.x;\n  float sy = s.y;\n  float sz = s.z;\n  return mat4((1. - (yy + zz)) * sx, (xy + wz) * sx, (xz - wy) * sx, 0,\n    (xy - wz) * sy, (1. - (xx + zz)) * sy, (yz + wx) * sy, 0,\n    (xz + wy) * sz, (yz - wx) * sz, (1. - (xx + yy)) * sz, 0,\n    t.x, t.y, t.z, 1);\n}\nvec4 quatMultiply (vec4 a, vec4 b){\n  vec4 quat;\n  quat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\n  quat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\n  quat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\n  quat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\n  return quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\n  float ix = q.w * v.x + q.y * v.z - q.z * v.y;\n  float iy = q.w * v.y + q.z * v.x - q.x * v.z;\n  float iz = q.w * v.z + q.x * v.y - q.y * v.x;\n  float iw = -q.x * v.x - q.y * v.y - q.z * v.z;\n  v.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\n  v.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\n  v.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\n  vec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\n  vec4 rotQuat = quatMultiply(viewQuat, q);\n  rotateVecFromQuat(pos, rotQuat);\n  return pos;\n}\nvoid rotateCorner (inout vec2 corner, float angle){\n  float xOS = cos(angle) * corner.x - sin(angle) * corner.y;\n  float yOS = sin(angle) * corner.x + cos(angle) * corner.y;\n  corner.x = xOS;\n  corner.y = yOS;\n}\nlayout(std140) uniform Constants {\n  vec4 mainTiling_Offset;\n  vec4 frameTile_velLenScale;\n  vec4 scale;\n};\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nlayout(std140) uniform CCLocal {\n  highp mat4 cc_matWorld;\n  highp mat4 cc_matWorldIT;\n  highp vec4 cc_lightingMapUVParam;\n};\nout mediump vec2 uv;\nout mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n  , mat4 viewInv\n#endif\n#if CC_RENDER_MODE == 1\n  , vec3 eye\n  , vec4 velocity\n  , float velocityScale\n  , float lengthScale\n  , float xIndex\n#endif\n) {\n#if CC_RENDER_MODE == 0\n  vec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\n  vec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\n  vec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\n  vec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\n  pos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n#elif CC_RENDER_MODE == 1\n  vec3 camRight = normalize(cross(pos.xyz - eye, velocity.xyz)) * s.x;\n  vec3 camUp = velocity.xyz * velocityScale + normalize(velocity.xyz) * lengthScale * s.y;\n  pos.xyz += (camRight * abs(vertOffset.x) * sign(vertOffset.y)) - camUp * xIndex;\n#elif CC_RENDER_MODE == 2\n  vec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\n  vec3 camX = vec3(1, 0, 0);\n  vec3 camY = vec3(0, 0, -1);\n  pos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, cross(camX, camY), q);\n#elif CC_RENDER_MODE == 3\n  vec2 viewSpaceVert = vec2(vertOffset.x * s.x, vertOffset.y * s.y);\n  rotateCorner(viewSpaceVert, q.z);\n  vec3 camX = normalize(vec3(cc_matView[0][0], cc_matView[1][0], cc_matView[2][0]));\n  vec3 camY = vec3(0, 1, 0);\n  vec3 offset = camX * viewSpaceVert.x + camY * viewSpaceVert.y;\n  pos.xyz += offset;\n#else\n  pos.x += vertOffset.x;\n  pos.y += vertOffset.y;\n#endif\n}\nvec2 computeUV (float frameIndex, vec2 vertIndex, vec2 frameTile){\n  vec2 aniUV = vec2(0, floor(frameIndex * frameTile.y));\n  aniUV.x = floor(frameIndex * frameTile.x * frameTile.y - aniUV.y * frameTile.x);\n#if CC_RENDER_MODE != 4\n  vertIndex.y = 1. - vertIndex.y;\n#endif\n  return (aniUV.xy + vertIndex) / vec2(frameTile.x, frameTile.y);\n}\nlayout(std140) uniform SampleConstants {\n  vec4 u_sampleInfo;\n};\nlayout(std140) uniform TickConstants {\n  vec4 u_worldRot;\n  vec4 u_timeDelta;\n};\nin vec4 a_position_starttime;\nin vec4 a_size_uv;\nin vec4 a_rotation_uv;\nin vec4 a_color;\nin vec4 a_dir_life;\nin float a_rndSeed;\n#if CC_RENDER_MODE == 4\n  in vec3 a_texCoord;\n  in vec3 a_texCoord3;\n  in vec3 a_normal;\n  in vec4 a_color1;\n#endif\nvec3 unpackCurveData (sampler2D tex, vec2 coord) {\n    vec4 a = texture(tex, coord);\n    vec4 b = texture(tex, coord + u_sampleInfo.y);\n    float c = fract(coord.x * u_sampleInfo.x);\n    return mix(a.xyz, b.xyz, c);\n}\nvec3 unpackCurveData (sampler2D tex, vec2 coord, out float w) {\n    vec4 a = texture(tex, coord);\n    vec4 b = texture(tex, coord + u_sampleInfo.y);\n    float c = fract(coord.x * u_sampleInfo.x);\n    w = mix(a.w, b.w, c);\n    return mix(a.xyz, b.xyz, c);\n}\nfloat pseudoRandom (float seed) {\n  seed = mod(seed, 233280.);\n  float q = (seed * 9301. + 49297.) / 233280.;\n  return fract(q);\n}\n#if COLOR_OVER_TIME_MODULE_ENABLE\n  uniform sampler2D color_over_time_tex0;\n  layout(std140) uniform ColorConstant {\n    int u_color_mode;\n  };\n#endif\n#if ROTATION_OVER_TIME_MODULE_ENABLE\n  uniform sampler2D rotation_over_time_tex0;\n  layout(std140) uniform RotationConstant {\n    int u_rotation_mode;\n  };\n#endif\n#if SIZE_OVER_TIME_MODULE_ENABLE\n  uniform sampler2D size_over_time_tex0;\n  layout(std140) uniform SizeConstant {\n    int u_size_mode;\n  };\n#endif\n#if FORCE_OVER_TIME_MODULE_ENABLE\n  uniform sampler2D force_over_time_tex0;\n  layout(std140) uniform ForceConstant {\n    int u_force_mode;\n    int u_force_space;\n  };\n#endif\n#if VELOCITY_OVER_TIME_MODULE_ENABLE\n  uniform sampler2D velocity_over_time_tex0;\n  layout(std140) uniform VelocityConstant {\n    int u_velocity_mode;\n    int u_velocity_space;\n  };\n#endif\n#if TEXTURE_ANIMATION_MODULE_ENABLE\n  uniform sampler2D texture_animation_tex0;\n  layout(std140) uniform AnimationConstant {\n    vec4 u_anim_info;\n  };\n#endif\nfloat repeat (float t, float length) {\n  return t - floor(t / length) * length;\n}\nvec4 rotateQuat (vec4 p, vec4 q) {\n  vec3 iv = cross(q.xyz, p.xyz) + q.w * p.xyz;\n  vec3 res = p.xyz + 2.0 * cross(q.xyz, iv);\n  return vec4(res.xyz, p.w);\n}\nvec4 gpvs_main () {\n  float activeTime = u_timeDelta.x - a_position_starttime.w;\n  float normalizedTime = clamp(activeTime / a_dir_life.w, 0.0, 1.0);\n  vec2 timeCoord0 = vec2(normalizedTime, 0.);\n  vec2 timeCoord1 = vec2(normalizedTime, 1.);\n  #if CC_RENDER_MODE == 4\n    vec2 vertIdx = vec2(a_texCoord.x, a_texCoord.y);\n  #else\n    vec2 vertIdx = vec2(a_size_uv.w, a_rotation_uv.w);\n  #endif\n  vec4 velocity = vec4(a_dir_life.xyz, 0.);\n  vec4 pos = vec4(a_position_starttime.xyz, 1.);\n  vec3 size = a_size_uv.xyz;\n  #if SIZE_OVER_TIME_MODULE_ENABLE\n    if (u_size_mode == 1) {\n      size *= unpackCurveData(size_over_time_tex0, timeCoord0);\n    } else {\n      vec3 size_0 = unpackCurveData(size_over_time_tex0, timeCoord0);\n      vec3 size_1 = unpackCurveData(size_over_time_tex0, timeCoord1);\n      float factor_s = pseudoRandom(a_rndSeed + 39825.);\n      size *= mix(size_0, size_1, factor_s);\n    }\n  #endif\n  vec3 compScale = scale.xyz * size;\n  #if FORCE_OVER_TIME_MODULE_ENABLE\n    vec3 forceAnim = vec3(0.);\n    if (u_force_mode == 1) {\n      forceAnim = unpackCurveData(force_over_time_tex0, timeCoord0);\n    } else {\n      vec3 force_0 = unpackCurveData(force_over_time_tex0, timeCoord0);\n      vec3 force_1 = unpackCurveData(force_over_time_tex0, timeCoord1);\n      float factor_f =  pseudoRandom(a_rndSeed + 212165.);\n      forceAnim = mix(force_0, force_1, factor_f);\n    }\n    vec4 forceTrack = vec4(forceAnim, 0.);\n    if (u_force_space == 0) {\n      forceTrack = rotateQuat(forceTrack, u_worldRot);\n    }\n    velocity.xyz += forceTrack.xyz;\n  #endif\n  #if VELOCITY_OVER_TIME_MODULE_ENABLE\n    float speedModifier0 = 1.;\n    float speedModifier1 = 1.;\n    vec3 velocityAnim = vec3(0.);\n    if (u_velocity_mode == 1) {\n      velocityAnim = unpackCurveData(velocity_over_time_tex0, timeCoord0, speedModifier0);\n    } else {\n      vec3 vectory_0 = unpackCurveData(velocity_over_time_tex0, timeCoord0, speedModifier0);\n      vec3 vectory_1 = unpackCurveData(velocity_over_time_tex0, timeCoord1, speedModifier1);\n      float factor_v = pseudoRandom(a_rndSeed + 197866.);\n      velocityAnim = mix(vectory_0, vectory_1, factor_v);\n      speedModifier0 = mix(speedModifier0, speedModifier1, factor_v);\n    }\n    vec4 velocityTrack = vec4(velocityAnim, 0.);\n    if (u_velocity_space == 0) {\n      velocityTrack = rotateQuat(velocityTrack, u_worldRot);\n    }\n    velocity.xyz += velocityTrack.xyz;\n    velocity.xyz *= speedModifier0;\n  #endif\n  pos.xyz += velocity.xyz * normalizedTime * a_dir_life.w;\n  #if !CC_USE_WORLD_SPACE\n    pos = cc_matWorld * pos;\n    #if CC_RENDER_MODE == 1\n      velocity = rotateQuat(velocity, u_worldRot);\n    #endif\n  #endif\n  vec3 rotation = a_rotation_uv.xyz;\n  #if ROTATION_OVER_TIME_MODULE_ENABLE\n    if (u_rotation_mode == 1) {\n      rotation += unpackCurveData(rotation_over_time_tex0, timeCoord0) * normalizedTime * a_dir_life.w;\n    } else {\n      vec3 rotation_0 = unpackCurveData(rotation_over_time_tex0, timeCoord0);\n      vec3 rotation_1 = unpackCurveData(rotation_over_time_tex0, timeCoord1);\n      float factor_r = pseudoRandom(a_rndSeed + 125292.);\n      rotation += mix(rotation_0, rotation_1, factor_r) * normalizedTime * a_dir_life.w;\n    }\n  #endif\n  #if COLOR_OVER_TIME_MODULE_ENABLE\n    if (u_color_mode == 1) {\n      color = a_color * texture(color_over_time_tex0, timeCoord0);\n    } else {\n      vec4 color_0 = texture(color_over_time_tex0, timeCoord0);\n      vec4 color_1 = texture(color_over_time_tex0, timeCoord1);\n      float factor_c = pseudoRandom(a_rndSeed + 91041.);\n      color = a_color * mix(color_0, color_1, factor_c);\n    }\n  #else\n    color = a_color;\n  #endif\n  #if CC_RENDER_MODE != 4\n    vec2 cornerOffset = vec2((vertIdx - 0.5));\n    #if CC_RENDER_MODE == 0\n      vec3 rotEuler = rotation.xyz;\n    #elif CC_RENDER_MODE == 1\n      vec3 rotEuler = vec3(0.);\n    #else\n      vec3 rotEuler = vec3(0., 0., rotation.z);\n    #endif\n    computeVertPos(pos, cornerOffset, quaternionFromEuler(rotEuler), compScale\n      #if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n        , cc_matViewInv\n      #endif\n      #if CC_RENDER_MODE == 1\n        , cc_cameraPos.xyz\n        , velocity\n        , frameTile_velLenScale.z\n        , frameTile_velLenScale.w\n        , a_size_uv.w\n      #endif\n    );\n  #else\n    mat4 xformNoScale = matrixFromRT(quaternionFromEuler(rotation), pos.xyz);\n    mat4 xform = matFromRTS(quaternionFromEuler(rotation), pos.xyz, compScale);\n    pos = xform * vec4(a_texCoord3, 1);\n    vec4 normal = xformNoScale * vec4(a_normal, 0);\n    color *= a_color1;\n  #endif\n  pos = cc_matViewProj * pos;\n  float frameIndex = 0.;\n  #if TEXTURE_ANIMATION_MODULE_ENABLE\n    float startFrame = 0.;\n    vec3 frameInfo = vec3(0.);\n    if (int(u_anim_info.x) == 1) {\n      frameInfo = unpackCurveData(texture_animation_tex0, timeCoord0);\n    } else {\n      vec3 frameInfo0 = unpackCurveData(texture_animation_tex0, timeCoord0);\n      vec3 frameInfo1 = unpackCurveData(texture_animation_tex0, timeCoord1);\n      float factor_t = pseudoRandom(a_rndSeed + 90794.);\n      frameInfo = mix(frameInfo0, frameInfo1, factor_t);\n    }\n    startFrame = frameInfo.x / u_anim_info.y;\n    frameIndex = repeat(u_anim_info.z * (frameInfo.y + startFrame), 1.);\n  #endif\n  uv = computeUV(frameIndex, vertIdx, frameTile_velLenScale.xy) * mainTiling_Offset.xy + mainTiling_Offset.zw;\n  return pos;\n}\nvoid main() { gl_Position = gpvs_main(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n  #if CC_USE_HDR\n    color.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n  #endif\n  return color;\n}\nin vec2 uv;\nin vec4 color;\nuniform sampler2D mainTexture;\nlayout(std140) uniform FragConstants {\n  vec4 tintColor;\n};\nvec4 add () {\n  vec4 col = 2.0 * color * tintColor * texture(mainTexture, uv);\n  return CCFragOutput(col);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = add(); }"}],[{vert:"\nprecision mediump float;\nlayout(std140) uniform Constants {\n  vec4 mainTiling_Offset;\n  vec4 frameTile_velLenScale;\n  vec4 scale;\n};\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nlayout(std140) uniform CCLocal {\n  highp mat4 cc_matWorld;\n  highp mat4 cc_matWorldIT;\n  highp vec4 cc_lightingMapUVParam;\n};\nout mediump vec2 uv;\nout mediump vec4 color;\nin vec3 a_position;\nin vec4 a_texCoord;\nin vec3 a_texCoord1;\nin vec3 a_texCoord2;\nin vec4 a_color;\n#if CC_DRAW_WIRE_FRAME\n  out vec3 vBarycentric;\n#endif\nvec4 vs_main() {\n  highp vec4 pos = vec4(a_position, 1);\n  vec4 velocity = vec4(a_texCoord1.xyz, 0);\n  #if !CC_USE_WORLD_SPACE\n    pos = cc_matWorld * pos;\n    velocity = cc_matWorld * velocity;\n  #endif\n  float vertOffset = (a_texCoord.x - 0.5) * a_texCoord.y;\n  vec3 camUp = normalize(cross(pos.xyz - cc_cameraPos.xyz, velocity.xyz));\n  pos.xyz += camUp * vertOffset;\n  pos = cc_matViewProj * pos;\n  uv = a_texCoord.zw * mainTiling_Offset.xy + mainTiling_Offset.zw;;\n  color = a_color;\n  #if CC_DRAW_WIRE_FRAME\n    vBarycentric = a_texCoord2;\n  #endif\n  return pos;\n}\nvoid main() { gl_Position = vs_main(); }",frag:"\n  precision mediump float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n  #if CC_USE_HDR\n    color.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n  #endif\n  return color;\n}\n  in vec2 uv;\n  in vec4 color;\n  #if CC_DRAW_WIRE_FRAME\n    in vec3 vBarycentric;\n  #endif\n  uniform sampler2D mainTexture;\n  layout(std140) uniform FragConstants {\n    vec4 tintColor;\n  };\n  vec4 add () {\n    vec4 col = 2.0 * color * tintColor * texture(mainTexture, uv);\n#if CC_DRAW_WIRE_FRAME\n    if (any(lessThan(vBarycentric, vec3(0.02)))) {\n        col = vec4(0., 1., 1., 1.);\n    }\n#endif\n    return CCFragOutput(col);\n  }\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\n  mat3 m = mat3(xAxis,yAxis,zAxis);\n  float trace = m[0][0] + m[1][1] + m[2][2];\n  vec4 quat;\n  if (trace > 0.) {\n    float s = 0.5 / sqrt(trace + 1.0);\n    quat.w = 0.25 / s;\n    quat.x = (m[2][1] - m[1][2]) * s;\n    quat.y = (m[0][2] - m[2][0]) * s;\n    quat.z = (m[1][0] - m[0][1]) * s;\n  } else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\n    float s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\n    quat.w = (m[2][1] - m[1][2]) / s;\n    quat.x = 0.25 * s;\n    quat.y = (m[0][1] + m[1][0]) / s;\n    quat.z = (m[0][2] + m[2][0]) / s;\n  } else if (m[1][1] > m[2][2]) {\n    float s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\n    quat.w = (m[0][2] - m[2][0]) / s;\n    quat.x = (m[0][1] + m[1][0]) / s;\n    quat.y = 0.25 * s;\n    quat.z = (m[1][2] + m[2][1]) / s;\n  } else {\n    float s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\n    quat.w = (m[1][0] - m[0][1]) / s;\n    quat.x = (m[0][2] + m[2][0]) / s;\n    quat.y = (m[1][2] + m[2][1]) / s;\n    quat.z = 0.25 * s;\n  }\n  float len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\n  if (len > 0.) {\n    len = 1. / sqrt(len);\n    quat.x = quat.x * len;\n    quat.y = quat.y * len;\n    quat.z = quat.z * len;\n    quat.w = quat.w * len;\n  }\n  return quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\n  float x = angle.x / 2.;\n  float y = angle.y / 2.;\n  float z = angle.z / 2.;\n  float sx = sin(x);\n  float cx = cos(x);\n  float sy = sin(y);\n  float cy = cos(y);\n  float sz = sin(z);\n  float cz = cos(z);\n  vec4 quat = vec4(0);\n  quat.x = sx * cy * cz + cx * sy * sz;\n  quat.y = cx * sy * cz + sx * cy * sz;\n  quat.z = cx * cy * sz - sx * sy * cz;\n  quat.w = cx * cy * cz - sx * sy * sz;\n  return quat;\n}\nmat4 matrixFromRT (vec4 q, vec3 p){\n  float x2 = q.x + q.x;\n  float y2 = q.y + q.y;\n  float z2 = q.z + q.z;\n  float xx = q.x * x2;\n  float xy = q.x * y2;\n  float xz = q.x * z2;\n  float yy = q.y * y2;\n  float yz = q.y * z2;\n  float zz = q.z * z2;\n  float wx = q.w * x2;\n  float wy = q.w * y2;\n  float wz = q.w * z2;\n  return mat4(\n    1. - (yy + zz), xy + wz, xz - wy, 0,\n    xy - wz, 1. - (xx + zz), yz + wx, 0,\n    xz + wy, yz - wx, 1. - (xx + yy), 0,\n    p.x, p.y, p.z, 1\n  );\n}\nmat4 matFromRTS (vec4 q, vec3 t, vec3 s){\n  float x = q.x, y = q.y, z = q.z, w = q.w;\n  float x2 = x + x;\n  float y2 = y + y;\n  float z2 = z + z;\n  float xx = x * x2;\n  float xy = x * y2;\n  float xz = x * z2;\n  float yy = y * y2;\n  float yz = y * z2;\n  float zz = z * z2;\n  float wx = w * x2;\n  float wy = w * y2;\n  float wz = w * z2;\n  float sx = s.x;\n  float sy = s.y;\n  float sz = s.z;\n  return mat4((1. - (yy + zz)) * sx, (xy + wz) * sx, (xz - wy) * sx, 0,\n    (xy - wz) * sy, (1. - (xx + zz)) * sy, (yz + wx) * sy, 0,\n    (xz + wy) * sz, (yz - wx) * sz, (1. - (xx + yy)) * sz, 0,\n    t.x, t.y, t.z, 1);\n}\nvec4 quatMultiply (vec4 a, vec4 b){\n  vec4 quat;\n  quat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\n  quat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\n  quat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\n  quat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\n  return quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\n  float ix = q.w * v.x + q.y * v.z - q.z * v.y;\n  float iy = q.w * v.y + q.z * v.x - q.x * v.z;\n  float iz = q.w * v.z + q.x * v.y - q.y * v.x;\n  float iw = -q.x * v.x - q.y * v.y - q.z * v.z;\n  v.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\n  v.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\n  v.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\n  vec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\n  vec4 rotQuat = quatMultiply(viewQuat, q);\n  rotateVecFromQuat(pos, rotQuat);\n  return pos;\n}\nvoid rotateCorner (inout vec2 corner, float angle){\n  float xOS = cos(angle) * corner.x - sin(angle) * corner.y;\n  float yOS = sin(angle) * corner.x + cos(angle) * corner.y;\n  corner.x = xOS;\n  corner.y = yOS;\n}\nlayout(std140) uniform Constants {\n  vec4 mainTiling_Offset;\n  vec4 frameTile_velLenScale;\n  vec4 scale;\n};\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nlayout(std140) uniform CCLocal {\n  highp mat4 cc_matWorld;\n  highp mat4 cc_matWorldIT;\n  highp vec4 cc_lightingMapUVParam;\n};\nout mediump vec2 uv;\nout mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n  , mat4 viewInv\n#endif\n#if CC_RENDER_MODE == 1\n  , vec3 eye\n  , vec4 velocity\n  , float velocityScale\n  , float lengthScale\n  , float xIndex\n#endif\n) {\n#if CC_RENDER_MODE == 0\n  vec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\n  vec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\n  vec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\n  vec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\n  pos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n#elif CC_RENDER_MODE == 1\n  vec3 camRight = normalize(cross(pos.xyz - eye, velocity.xyz)) * s.x;\n  vec3 camUp = velocity.xyz * velocityScale + normalize(velocity.xyz) * lengthScale * s.y;\n  pos.xyz += (camRight * abs(vertOffset.x) * sign(vertOffset.y)) - camUp * xIndex;\n#elif CC_RENDER_MODE == 2\n  vec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\n  vec3 camX = vec3(1, 0, 0);\n  vec3 camY = vec3(0, 0, -1);\n  pos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, cross(camX, camY), q);\n#elif CC_RENDER_MODE == 3\n  vec2 viewSpaceVert = vec2(vertOffset.x * s.x, vertOffset.y * s.y);\n  rotateCorner(viewSpaceVert, q.z);\n  vec3 camX = normalize(vec3(cc_matView[0][0], cc_matView[1][0], cc_matView[2][0]));\n  vec3 camY = vec3(0, 1, 0);\n  vec3 offset = camX * viewSpaceVert.x + camY * viewSpaceVert.y;\n  pos.xyz += offset;\n#else\n  pos.x += vertOffset.x;\n  pos.y += vertOffset.y;\n#endif\n}\nvec2 computeUV (float frameIndex, vec2 vertIndex, vec2 frameTile){\n  vec2 aniUV = vec2(0, floor(frameIndex * frameTile.y));\n  aniUV.x = floor(frameIndex * frameTile.x * frameTile.y - aniUV.y * frameTile.x);\n#if CC_RENDER_MODE != 4\n  vertIndex.y = 1. - vertIndex.y;\n#endif\n  return (aniUV.xy + vertIndex) / vec2(frameTile.x, frameTile.y);\n}\nin vec3 a_position;\nin vec3 a_texCoord;\nin vec3 a_texCoord1;\nin vec3 a_texCoord2;\nin vec4 a_color;\n#if CC_RENDER_MODE == 1\n  in vec3 a_color1;\n#endif\n#if CC_RENDER_MODE == 4\n  in vec3 a_texCoord3;\n  in vec3 a_normal;\n  in vec4 a_color1;\n#endif\nvec4 lpvs_main () {\n  vec3 compScale = scale.xyz * a_texCoord1;\n  vec4 pos = vec4(a_position, 1);\n  #if CC_RENDER_MODE == 1\n    vec4 velocity = vec4(a_color1.xyz, 0);\n  #endif\n  #if !CC_USE_WORLD_SPACE\n    pos = cc_matWorld * pos;\n    #if CC_RENDER_MODE == 1\n      velocity = cc_matWorld * velocity;\n    #endif\n  #endif\n  #if CC_RENDER_MODE != 4\n    vec2 cornerOffset = vec2((a_texCoord.xy - 0.5));\n    #if CC_RENDER_MODE == 0\n      vec3 rotEuler = a_texCoord2;\n    #elif CC_RENDER_MODE == 1\n      vec3 rotEuler = vec3(0.);\n    #else\n      vec3 rotEuler = vec3(0., 0., a_texCoord2.z);\n    #endif\n    computeVertPos(pos, cornerOffset, quaternionFromEuler(rotEuler), compScale\n    #if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n      , cc_matViewInv\n    #endif\n    #if CC_RENDER_MODE == 1\n      , cc_cameraPos.xyz\n      , velocity\n      , frameTile_velLenScale.z\n      , frameTile_velLenScale.w\n      , a_texCoord.x\n    #endif\n    );\n    color = a_color;\n  #else\n    mat4 xformNoScale = matrixFromRT(quaternionFromEuler(a_texCoord2), pos.xyz);\n    mat4 xform = matFromRTS(quaternionFromEuler(a_texCoord2), pos.xyz, compScale);\n    pos = xform * vec4(a_texCoord3, 1);\n    vec4 normal = xformNoScale * vec4(a_normal, 0);\n    color = a_color * a_color1;\n  #endif\n  uv = computeUV(a_texCoord.z, a_texCoord.xy, frameTile_velLenScale.xy) * mainTiling_Offset.xy + mainTiling_Offset.zw;\n  pos = cc_matViewProj * pos;\n  return pos;\n}\nvoid main() { gl_Position = lpvs_main(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n  #if CC_USE_HDR\n    color.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n  #endif\n  return color;\n}\nin vec2 uv;\nin vec4 color;\nuniform sampler2D mainTexture;\nlayout(std140) uniform FragConstants {\n  vec4 tintColor;\n};\nvec4 add () {\n  vec4 col = 2.0 * color * tintColor * texture(mainTexture, uv);\n  return CCFragOutput(col);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\n#if USE_LOCAL\nlayout(std140) uniform CCLocal {\n  highp mat4 cc_matWorld;\n  highp mat4 cc_matWorldIT;\n  highp vec4 cc_lightingMapUVParam;\n};\n#endif\nin vec3 a_position;\nin vec2 a_texCoord;\nin vec4 a_color;\nout vec4 v_light;\nout vec2 uv0;\n#if TWO_COLORED\n  in vec4 a_color2;\n  out vec4 v_dark;\n#endif\nvec4 vert () {\n  vec4 pos = vec4(a_position, 1);\n  #if USE_LOCAL\n    pos = cc_matWorld * pos;\n  #endif\n  pos = cc_matViewProj * pos;\n  uv0 = a_texCoord;\n  v_light = a_color;\n  #if TWO_COLORED\n    v_dark = a_color2;\n  #endif\n  return pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\n#if USE_ALPHA_TEST\n  layout(std140) uniform ALPHA_TEST_DATA {\n    float alphaThreshold;\n  };\n#endif\nvoid ALPHA_TEST (in vec4 color) {\n  #if USE_ALPHA_TEST\n      if (color.a < alphaThreshold) discard;\n  #endif\n}\nvoid ALPHA_TEST (in float alpha) {\n  #if USE_ALPHA_TEST\n      if (alpha < alphaThreshold) discard;\n  #endif\n}\nin vec4 v_light;\n#if TWO_COLORED\n  in vec4 v_dark;\n#endif\nin vec2 uv0;\nuniform sampler2D cc_spriteTexture;\nvec4 frag () {\n  vec4 o = vec4(1, 1, 1, 1);\n  #if TWO_COLORED\n    vec4 texColor = vec4(1, 1, 1, 1);\n    texColor *= texture(cc_spriteTexture, uv0);\n     o.a = texColor.a * v_light.a;\n    o.rgb = ((texColor.a - 1.0) * v_dark.a + 1.0 - texColor.rgb) * v_dark.rgb + texColor.rgb * v_light.rgb;\n  #else\n    o *= texture(cc_spriteTexture, uv0);\n    o *= v_light;\n  #endif\n  ALPHA_TEST(o);\n  return o;\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\n#if USE_LOCAL\nlayout(std140) uniform CCLocal {\n  highp mat4 cc_matWorld;\n  highp mat4 cc_matWorldIT;\n  highp vec4 cc_lightingMapUVParam;\n};\n#endif\nin vec3 a_position;\nin vec2 a_texCoord;\nin vec4 a_color;\nout vec4 color;\nout vec2 uv0;\nvec4 vert () {\n  vec4 pos = vec4(a_position, 1);\n  #if USE_LOCAL\n    pos = cc_matWorld * pos;\n  #endif\n  #if USE_PIXEL_ALIGNMENT\n    pos = cc_matView * pos;\n    pos.xyz = floor(pos.xyz);\n    pos = cc_matProj * pos;\n  #else\n    pos = cc_matViewProj * pos;\n  #endif\n  uv0 = a_texCoord;\n  color = a_color;\n  return pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 CCSampleWithAlphaSeparated(sampler2D tex, vec2 uv) {\n#if CC_USE_EMBEDDED_ALPHA\n    return vec4(texture(tex, uv).rgb, texture(tex, uv + vec2(0.0, 0.5)).r);\n#else\n    return texture(tex, uv);\n#endif\n}\n#if USE_ALPHA_TEST\n  layout(std140) uniform ALPHA_TEST_DATA {\n    float alphaThreshold;\n  };\n#endif\nvoid ALPHA_TEST (in vec4 color) {\n  #if USE_ALPHA_TEST\n      if (color.a < alphaThreshold) discard;\n  #endif\n}\nvoid ALPHA_TEST (in float alpha) {\n  #if USE_ALPHA_TEST\n      if (alpha < alphaThreshold) discard;\n  #endif\n}\nin vec4 color;\n#if USE_TEXTURE\n  in vec2 uv0;\n  uniform sampler2D cc_spriteTexture;\n#endif\nvec4 frag () {\n  vec4 o = vec4(1, 1, 1, 1);\n  #if USE_TEXTURE\n    o *= CCSampleWithAlphaSeparated(cc_spriteTexture, uv0);\n    #if IS_GRAY\n      float gray  = 0.2126 * o.r + 0.7152 * o.g + 0.0722 * o.b;\n      o.r = o.g = o.b = gray;\n    #endif\n  #endif\n  o *= color;\n  ALPHA_TEST(o);\n  return o;\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\n  rgba = rgba * 255.0;\n  highp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\n  highp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\n  highp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\n  return Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\n  highp vec4 position;\n  vec3 normal;\n  vec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_MORPH\n    in float a_vertexId;\n    int getVertexId() {\n        return int(a_vertexId);\n    }\nlayout(std140) uniform CCMorph {\n    vec4 cc_displacementWeights[15];\n    vec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\n    float pixelIndexF = float(pixelIndex);\n    float x = mod(pixelIndexF, textureResolution.x);\n    float y = floor(pixelIndexF / textureResolution.x);\n    return vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\n    return (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_SUPPORT_FLOAT_TEXTURE\n        vec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\n            ivec2 texSize = textureSize(tex, 0);\n            return texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n        }\n#else\n    vec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\n        int pixelIndex = elementIndex * 4;\n        vec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\n        vec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\n        return vec4(\n            decode32(texture(tex, x)),\n            decode32(texture(tex, y)),\n            decode32(texture(tex, z)),\n            1.0\n        );\n    }\n#endif\nfloat getDisplacementWeight(int index) {\n    int quot = index / 4;\n    int remainder = index - quot * 4;\n    if (remainder == 0) {\n        return cc_displacementWeights[quot].x;\n    } else if (remainder == 1) {\n        return cc_displacementWeights[quot].y;\n    } else if (remainder == 2) {\n        return cc_displacementWeights[quot].z;\n    } else {\n        return cc_displacementWeights[quot].w;\n    }\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\n    return fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\n    vec3 result = vec3(0, 0, 0);\n    int nVertices = int(cc_displacementTextureInfo.z);\n    for (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\n        result += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n    }\n    return result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\n    uniform sampler2D cc_PositionDisplacements;\n    vec3 getPositionDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    uniform sampler2D cc_NormalDisplacements;\n    vec3 getNormalDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    uniform sampler2D cc_TangentDisplacements;\n    vec3 getTangentDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n    }\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\n    int vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\n    attr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    attr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    attr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\n    position.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n  in vec4 a_joints;\nin vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n  #if USE_INSTANCING\n    in highp vec4 a_jointAnimInfo;\n  #endif\n  layout(std140) uniform CCSkinningTexture {\n    highp vec4 cc_jointTextureInfo;\n  };\n  layout(std140) uniform CCSkinningAnimation {\n    highp vec4 cc_jointAnimInfo;\n  };\n  uniform highp sampler2D cc_jointTexture;\n  #else\n  layout(std140) uniform CCSkinning {\n    highp vec4 cc_joints[30 * 3];\n  };\n#endif\n#if CC_USE_BAKED_ANIMATION\n  #if CC_SUPPORT_FLOAT_TEXTURE\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\n      vec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\n      vec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #else\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = vec4(\n        decode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n      );\n      vec4 v2 = vec4(\n        decode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n      );\n      vec4 v3 = vec4(\n        decode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n      );\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #endif\n#else\n  mat4 getJointMatrix (float i) {\n    int idx = int(i);\n    vec4 v1 = cc_joints[idx * 3];\n    vec4 v2 = cc_joints[idx * 3 + 1];\n    vec4 v3 = cc_joints[idx * 3 + 2];\n    return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n  }\n#endif\nmat4 skinMatrix () {\n  vec4 joints = vec4(a_joints);\n  return getJointMatrix(joints.x) * a_weights.x\n       + getJointMatrix(joints.y) * a_weights.y\n       + getJointMatrix(joints.z) * a_weights.z\n       + getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\n  mat4 m = skinMatrix();\n  position = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\n  mat4 m = skinMatrix();\n  attr.position = m * attr.position;\n  attr.normal = (m * vec4(attr.normal, 0.0)).xyz;\n  attr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\n#if USE_INSTANCING\n  in vec4 a_matWorld0;\n  in vec4 a_matWorld1;\n  in vec4 a_matWorld2;\n  #if USE_LIGHTMAP\n    in vec4 a_lightingMapUVParam;\n  #endif\n#elif USE_BATCHING\n  in float a_dyn_batch_id;\n  layout(std140) uniform CCLocalBatched {\n    highp mat4 cc_matWorlds[10];\n  };\n#else\nlayout(std140) uniform CCLocal {\n  highp mat4 cc_matWorld;\n  highp mat4 cc_matWorldIT;\n  highp vec4 cc_lightingMapUVParam;\n};\n#endif\nlayout(std140) uniform Constants {\n  vec4 tilingOffset;\n  vec4 albedo;\n  vec4 albedoScaleAndCutoff;\n  vec4 pbrParams;\n  vec4 emissive;\n  vec4 emissiveScaleParam;\n};\nfloat LinearFog(vec4 pos) {\n    vec4 wPos = pos;\n    float cam_dis = distance(cc_cameraPos, wPos);\n    float fogStart = cc_fogBase.x;\n    float fogEnd = cc_fogBase.y;\n    return clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float fogDensity = cc_fogBase.z;\n    float cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\n    float f = exp(-cam_dis * fogDensity);\n    return f;\n}\nfloat ExpSquaredFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float fogDensity = cc_fogBase.z;\n    float cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\n    float f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\n    return f;\n}\nfloat LayeredFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float _FogTop = cc_fogAdd.x;\n    float _FogRange = cc_fogAdd.y;\n    vec3 camWorldProj = cc_cameraPos.xyz;\n    camWorldProj.y = 0.;\n    vec3 worldPosProj = wPos.xyz;\n    worldPosProj.y = 0.;\n    float fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\n    float fDeltaY, fDensityIntegral;\n    if (cc_cameraPos.y > _FogTop) {\n        if (wPos.y < _FogTop) {\n            fDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\n            fDensityIntegral = fDeltaY * fDeltaY * 0.5;\n        } else {\n            fDeltaY = 0.;\n            fDensityIntegral = 0.;\n        }\n    } else {\n        if (wPos.y < _FogTop) {\n            float fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\n            float fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\n            fDeltaY = abs(fDeltaA - fDeltaB);\n            fDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n        } else {\n            fDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\n            fDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n        }\n    }\n    float fDensity;\n    if (fDeltaY != 0.) {\n        fDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n    } else {\n        fDensity = 0.;\n    }\n    float f = exp(-fDensity);\n    return f;\n}\nfloat CC_TRANSFER_FOG(vec4 pos) {\n    #if CC_USE_FOG == 0\n        return LinearFog(pos);\n\t#elif CC_USE_FOG == 1\n        return ExpFog(pos);\n    #elif CC_USE_FOG == 2\n        return ExpSquaredFog(pos);\n    #elif CC_USE_FOG == 3\n        return LayeredFog(pos);\n    #endif\n    return 1.;\n}\nout highp vec4 v_shadowPos;\nlayout(std140) uniform CCShadow {\n  highp mat4 cc_matLightPlaneProj;\n  highp mat4 cc_matLightViewProj;\n  lowp  vec4 cc_shadowColor;\n  lowp  vec4 cc_shadowInfo;\n};\n#if USE_VERTEX_COLOR\n  in vec4 a_color;\n  out vec4 v_color;\n#endif\nout vec3 v_position;\nout vec3 v_normal;\nout vec2 v_uv;\nout vec2 v_uv1;\nout float v_fog_factor;\n#if USE_NORMAL_MAP\n  out vec3 v_tangent;\n  out vec3 v_bitangent;\n#endif\n#if HAS_SECOND_UV || USE_LIGHTMAP\n  in vec2 a_texCoord1;\n#endif\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\n  out vec2 v_luv;\nvoid CCLightingMapCaclUV()\n{\n#if !USE_INSTANCING\n      v_luv = cc_lightingMapUVParam.xy + a_texCoord1 * cc_lightingMapUVParam.zw;\n#else\n      v_luv = a_lightingMapUVParam.xy + a_texCoord1 * a_lightingMapUVParam.zw;\n#endif\n}\n#endif\nvec4 vert () {\n  StandardVertInput In;\n  In.position = vec4(a_position, 1.0);\n  In.normal = a_normal;\n  In.tangent = a_tangent;\n  #if CC_USE_MORPH\n    applyMorph(In);\n  #endif\n  #if CC_USE_SKINNING\n    CCSkin(In);\n  #endif\n  mat4 matWorld, matWorldIT;\n  #if USE_INSTANCING\n    matWorld = mat4(\n      vec4(a_matWorld0.xyz, 0.0),\n      vec4(a_matWorld1.xyz, 0.0),\n      vec4(a_matWorld2.xyz, 0.0),\n      vec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n    );\n    matWorldIT = matWorld;\n  #elif USE_BATCHING\n    matWorld = cc_matWorlds[int(a_dyn_batch_id)];\n    matWorldIT = matWorld;\n  #else\n    matWorld = cc_matWorld;\n    matWorldIT = cc_matWorldIT;\n  #endif\n  vec4 pos = matWorld * In.position;\n  v_position = pos.xyz;\n  v_normal = normalize((matWorldIT * vec4(In.normal, 0.0)).xyz);\n  #if USE_NORMAL_MAP\n    v_tangent = normalize((matWorld * vec4(In.tangent.xyz, 0.0)).xyz);\n    v_bitangent = cross(v_normal, v_tangent) * In.tangent.w;\n  #endif\n  v_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n  #if HAS_SECOND_UV\n    v_uv1 = a_texCoord1 * tilingOffset.xy + tilingOffset.zw;\n  #endif\n  #if USE_VERTEX_COLOR\n    v_color = a_color;\n  #endif\n  v_fog_factor = CC_TRANSFER_FOG(pos);\n  #if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\n    CCLightingMapCaclUV();\n  #endif\n    v_shadowPos = cc_matLightViewProj * pos;\n  return cc_matProj * (cc_matView * matWorld) * In.position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nlayout(std140) uniform CCShadow {\n  highp mat4 cc_matLightPlaneProj;\n  highp mat4 cc_matLightViewProj;\n  lowp  vec4 cc_shadowColor;\n  lowp  vec4 cc_shadowInfo;\n};\n#if CC_USE_IBL\nuniform samplerCube cc_environment;\nvec3 unpackRGBE (vec4 rgbe) {\n  return rgbe.rgb * pow(2.0, rgbe.a * 255.0 - 128.0);\n}\nvec4 fragTextureLod (sampler2D tex, vec2 coord, float lod) {\n    return textureLod(tex, coord, lod);\n}\nvec4 fragTextureLod (samplerCube tex, vec3 coord, float lod) {\n    return textureLod(tex, coord, lod);\n}\n#endif\n#if CC_RECEIVE_SHADOW\nin highp vec4 v_shadowPos;\n#if CC_RECEIVE_SHADOW\n  uniform sampler2D cc_shadowMap;\n  uniform sampler2D cc_spotLightingMap;\n  float CCGetShadowFactorX1 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float closestDepth = dot(texture(cc_shadowMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    float shadow = step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    return shadow;\n  }\n  float CCGetShadowFactorX5 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    float closestDepth = 0.0;\n    closestDepth = dot(texture(cc_shadowMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_shadowMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_shadowMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_shadowMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    return shadow / 5.0;\n  }\n  float CCGetShadowFactorX9 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -1; i <= 1; i++) {\n      for (int j = -1; j <= 1; j++) {\n        float closestDepth = dot(texture(cc_shadowMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 9.0;\n  }\n  float CCGetShadowFactorX25 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -2; i <= 2; i++) {\n      for (int j = -2; j <= 2; j++) {\n        float closestDepth = dot(texture(cc_shadowMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 25.0;\n  }\n  float CCGetDirLightShadowFactorX1 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float closestDepth = dot(texture(cc_spotLightingMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    float shadow = step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    return shadow;\n  }\n  float CCGetDirLightShadowFactorX5 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    float closestDepth = 0.0;\n    closestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    return shadow / 5.0;\n  }\n  float CCGetDirLightShadowFactorX9 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -1; i <= 1; i++) {\n      for (int j = -1; j <= 1; j++) {\n        float closestDepth = dot(texture(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 9.0;\n  }\n  float CCGetDirLightShadowFactorX25 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -2; i <= 2; i++) {\n      for (int j = -2; j <= 2; j++) {\n        float closestDepth = dot(texture(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 25.0;\n  }\n#endif\n#endif\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nfloat GGXMobile (float roughness, float NoH, vec3 H, vec3 N) {\n  vec3 NxH = cross(N, H);\n  float OneMinusNoHSqr = dot(NxH, NxH);\n  float a = roughness * roughness;\n  float n = NoH * a;\n  float p = a / (OneMinusNoHSqr + n * n);\n  return p * p;\n}\nfloat CalcSpecular (float roughness, float NoH, vec3 H, vec3 N) {\n  return (roughness*0.25 + 0.25) * GGXMobile(roughness, NoH, H, N);\n}\nvec3 BRDFApprox (vec3 specular, float roughness, float NoV) {\n  const vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\n  const vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\n  vec4 r = roughness * c0 + c1;\n  float a004 = min( r.x * r.x, exp2( -9.28 * NoV ) ) * r.x + r.y;\n  vec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n  AB.y *= clamp(50.0 * specular.g, 0.0, 1.0);\n  return specular * AB.x + AB.y;\n}\nstruct StandardSurface {\n  vec4 albedo;\n  vec3 position;\n  vec3 normal;\n  vec3 emissive;\n  vec4 lightmap;\n  float roughness;\n  float metallic;\n  float occlusion;\n};\n#if CC_FORWARD_ADD\nlayout(std140) uniform CCForwardLight {\n  highp vec4 cc_lightPos[1];\n  vec4 cc_lightColor[1];\n  vec4 cc_lightSizeRangeAngle[1];\n  vec4 cc_lightDir[1];\n};\nfloat SmoothDistAtt (float distSqr, float invSqrAttRadius) {\n  float factor = distSqr * invSqrAttRadius;\n  float smoothFactor = clamp(1.0 - factor * factor, 0.0, 1.0);\n  return smoothFactor * smoothFactor;\n}\nfloat GetDistAtt (float distSqr, float invSqrAttRadius) {\n  float attenuation = 1.0 / max(distSqr, 0.01*0.01);\n  attenuation *= SmoothDistAtt(distSqr , invSqrAttRadius);\n  return attenuation;\n}\nfloat GetAngleAtt (vec3 L, vec3 litDir, float litAngleScale, float litAngleOffset) {\n  float cd = dot(litDir, L);\n  float attenuation = clamp(cd * litAngleScale + litAngleOffset, 0.0, 1.0);\n  return (attenuation * attenuation);\n}\n  vec4 CCStandardShading (StandardSurface s) {\n    vec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\n    vec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\n    vec3 diffuseContrib = diffuse / 3.14159265359;\n    vec3 N = normalize(s.normal);\n    vec3 V = normalize(cc_cameraPos.xyz - s.position);\n    float NV = max(abs(dot(N, V)), 0.001);\n    specular = BRDFApprox(specular, s.roughness, NV);\n    vec3 finalColor = vec3(0.0);\n    for (int i = 0; i < 1; i++) {\n      vec3 SLU = cc_lightPos[i].xyz - s.position;\n      vec3 SL = normalize(SLU);\n      vec3 SH = normalize(SL + V);\n      float SNL = max(dot(N, SL), 0.001);\n      float SNH = max(dot(N, SH), 0.0);\n      float distSqr = dot(SLU, SLU);\n      float litRadius = cc_lightSizeRangeAngle[i].x;\n      float litRadiusSqr = litRadius * litRadius;\n      float illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\n      float attRadiusSqrInv = 1.0 / max(cc_lightSizeRangeAngle[i].y, 0.01);\n      attRadiusSqrInv *= attRadiusSqrInv;\n      float att = GetDistAtt(distSqr, attRadiusSqrInv);\n      vec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\n      if (cc_lightPos[i].w > 0.0) {\n        float cosInner = max(dot(-cc_lightDir[i].xyz, SL), 0.01);\n        float cosOuter = cc_lightSizeRangeAngle[i].z;\n        float litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\n        float litAngleOffset = -cosOuter * litAngleScale;\n        att *= GetAngleAtt(SL, -cc_lightDir[i].xyz, litAngleScale, litAngleOffset);\n      }\n      vec3 lightColor = cc_lightColor[i].rgb;\n    #if CC_RECEIVE_SHADOW\n      if (cc_lightPos[i].w > 0.0) {\n    {\n      float pcf = cc_shadowInfo.z + 0.001;\n      float shadowAttenuation = 0.0;\n      if (pcf > 3.0) shadowAttenuation = CCGetDirLightShadowFactorX25();\n      else if (3.0 > pcf && pcf > 2.0) shadowAttenuation = CCGetDirLightShadowFactorX9();\n      else if (2.0 > pcf && pcf > 1.0) shadowAttenuation = CCGetDirLightShadowFactorX5();\n      else shadowAttenuation = CCGetDirLightShadowFactorX1();\n      lightColor *= 1.0 - shadowAttenuation;\n    }\n      }\n    #endif\n      finalColor += SNL * lightColor * cc_lightColor[i].w * illum * att * (diffuseContrib + lspec);\n    }\n    finalColor = finalColor * s.occlusion;\n    return vec4(finalColor, 0.0);\n  }\n#else\n  vec4 CCStandardShading (StandardSurface s) {\n    vec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\n    vec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\n    vec3 N = normalize(s.normal);\n    vec3 V = normalize(cc_cameraPos.xyz - s.position);\n    float NV = max(abs(dot(N, V)), 0.001);\n    specular = BRDFApprox(specular, s.roughness, NV);\n    vec3 L = normalize(-cc_mainLitDir.xyz);\n    vec3 H = normalize(L+V);\n    float NH = max(dot(N, H), 0.0);\n    float NL = max(dot(N, L), 0.001);\n    vec3 finalColor = NL * cc_mainLitColor.rgb * cc_mainLitColor.w;\n    #if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\n      finalColor = s.lightmap.a * s.lightmap.rgb + (1.0 - s.lightmap.a) * finalColor;\n    #endif\n    vec3 diffuseContrib = diffuse / 3.14159265359;\n    vec3 specularContrib = specular * CalcSpecular(s.roughness, NH, H, N);\n    finalColor *= (diffuseContrib + specularContrib);\n    float fAmb = 0.5 - N.y * 0.5;\n    vec3 ambDiff = mix(cc_ambientSky.rgb, cc_ambientGround.rgb, fAmb) * cc_ambientSky.w;\n    finalColor += (ambDiff.rgb * diffuse);\n    #if CC_USE_IBL\n      vec3 R = normalize(reflect(-V, N));\n      vec4 envmap = fragTextureLod(cc_environment, R, s.roughness * cc_ambientGround.w);\n      #if CC_USE_IBL == 2\n        vec3 env = unpackRGBE(envmap);\n      #else\n        vec3 env = SRGBToLinear(envmap.rgb);\n      #endif\n      finalColor += env * cc_ambientSky.w * specular;\n    #endif\n    finalColor = finalColor * s.occlusion;\n    #if CC_USE_HDR\n      s.emissive *= cc_exposure.w;\n    #endif\n    finalColor += s.emissive;\n    #if CC_RECEIVE_SHADOW\n    {\n      float pcf = cc_shadowInfo.z + 0.001;\n      float shadowAttenuation = 0.0;\n      if (pcf > 3.0) shadowAttenuation = CCGetShadowFactorX25();\n      else if (3.0 > pcf && pcf > 2.0) shadowAttenuation = CCGetShadowFactorX9();\n      else if (2.0 > pcf && pcf > 1.0) shadowAttenuation = CCGetShadowFactorX5();\n      else shadowAttenuation = CCGetShadowFactorX1();\n      vec3 shadowColor = cc_shadowColor.rgb * cc_shadowColor.a + finalColor.rgb * (1.0 - cc_shadowColor.a);\n      finalColor.rgb = shadowColor.rgb * shadowAttenuation * NL + finalColor.rgb * (1.0 - shadowAttenuation * NL);\n    }\n    #endif\n    return vec4(finalColor, s.albedo.a);\n  }\n#endif\nvec3 ACESToneMap (vec3 color) {\n  color = min(color, vec3(8.0));\n  const float A = 2.51;\n  const float B = 0.03;\n  const float C = 2.43;\n  const float D = 0.59;\n  const float E = 0.14;\n  return (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n  #if !CC_USE_HDR\n    color.rgb = sqrt(ACESToneMap(color.rgb));\n  #endif\n  return color;\n}\nlayout(std140) uniform Constants {\n  vec4 tilingOffset;\n  vec4 albedo;\n  vec4 albedoScaleAndCutoff;\n  vec4 pbrParams;\n  vec4 emissive;\n  vec4 emissiveScaleParam;\n};\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\n  in vec2 v_luv;\nuniform sampler2D cc_lightingMap;\n#endif\nin vec3 v_position;\nin vec2 v_uv;\nin vec2 v_uv1;\nin vec3 v_normal;\nin float v_fog_factor;\n#if USE_VERTEX_COLOR\n  in vec4 v_color;\n#endif\n#if USE_ALBEDO_MAP\n  uniform sampler2D albedoMap;\n#endif\n#if USE_NORMAL_MAP\n  in vec3 v_tangent;\n  in vec3 v_bitangent;\n  uniform sampler2D normalMap;\n#endif\n#if USE_PBR_MAP\n  uniform sampler2D pbrMap;\n#endif\n#if USE_METALLIC_ROUGHNESS_MAP\n  uniform sampler2D metallicRoughnessMap;\n#endif\n#if USE_OCCLUSION_MAP\n  uniform sampler2D occlusionMap;\n#endif\n#if USE_EMISSIVE_MAP\n  uniform sampler2D emissiveMap;\n#endif\n#if USE_ALPHA_TEST\n#endif\nvoid surf (out StandardSurface s) {\n  vec4 baseColor = albedo;\n  #if USE_VERTEX_COLOR\n    baseColor *= v_color;\n  #endif\n  #if USE_ALBEDO_MAP\n    vec4 texColor = texture(albedoMap, ALBEDO_UV);\n    texColor.rgb = SRGBToLinear(texColor.rgb);\n    baseColor *= texColor;\n  #endif\n  s.albedo = baseColor;\n  s.albedo.rgb *= albedoScaleAndCutoff.xyz;\n  #if USE_ALPHA_TEST\n    if (s.albedo.ALPHA_TEST_CHANNEL < albedoScaleAndCutoff.w) discard;\n  #endif\n  #if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\n    s.lightmap = texture(cc_lightingMap, v_luv);\n  #endif\n  s.normal = v_normal;\n  #if USE_NORMAL_MAP\n    vec3 nmmp = texture(normalMap, NORMAL_UV).xyz - vec3(0.5);\n    s.normal =\n      (nmmp.x * pbrParams.w) * normalize(v_tangent) +\n      (nmmp.y * pbrParams.w) * normalize(v_bitangent) +\n      nmmp.z * normalize(s.normal);\n  #endif\n  s.position = v_position;\n  vec4 pbr = pbrParams;\n  #if USE_PBR_MAP\n    vec4 res = texture(pbrMap, PBR_UV);\n    pbr.x *= res.r;\n    pbr.y *= res.g;\n    pbr.z *= res.b;\n  #endif\n  #if USE_METALLIC_ROUGHNESS_MAP\n    vec4 metallicRoughness = texture(metallicRoughnessMap, PBR_UV);\n    pbr.z *= metallicRoughness.b;\n    pbr.y *= metallicRoughness.g;\n  #endif\n  #if USE_OCCLUSION_MAP\n    pbr.x *= texture(occlusionMap, PBR_UV).r;\n  #endif\n  s.occlusion = clamp(pbr.x, 0.0, 0.96);\n  s.roughness = clamp(pbr.y, 0.04, 1.0);\n  s.metallic = pbr.z;\n  s.emissive = emissive.rgb * emissiveScaleParam.xyz;\n  #if USE_EMISSIVE_MAP\n    s.emissive *= SRGBToLinear(texture(emissiveMap, EMISSIVE_UV).rgb);\n  #endif\n}\nvec4 frag () {\n  StandardSurface s; surf(s);\n  vec4 color = CCStandardShading(s);\n  color = vec4(mix(CC_FORWARD_ADD > 0 ? vec3(0.0) : cc_fogColor.rgb, color.rgb, v_fog_factor), color.a);\n  return CCFragOutput(color);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"},{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\n  rgba = rgba * 255.0;\n  highp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\n  highp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\n  highp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\n  return Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\n  highp vec4 position;\n  vec3 normal;\n  vec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_MORPH\n    in float a_vertexId;\n    int getVertexId() {\n        return int(a_vertexId);\n    }\nlayout(std140) uniform CCMorph {\n    vec4 cc_displacementWeights[15];\n    vec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\n    float pixelIndexF = float(pixelIndex);\n    float x = mod(pixelIndexF, textureResolution.x);\n    float y = floor(pixelIndexF / textureResolution.x);\n    return vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\n    return (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_SUPPORT_FLOAT_TEXTURE\n        vec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\n            ivec2 texSize = textureSize(tex, 0);\n            return texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n        }\n#else\n    vec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\n        int pixelIndex = elementIndex * 4;\n        vec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\n        vec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\n        return vec4(\n            decode32(texture(tex, x)),\n            decode32(texture(tex, y)),\n            decode32(texture(tex, z)),\n            1.0\n        );\n    }\n#endif\nfloat getDisplacementWeight(int index) {\n    int quot = index / 4;\n    int remainder = index - quot * 4;\n    if (remainder == 0) {\n        return cc_displacementWeights[quot].x;\n    } else if (remainder == 1) {\n        return cc_displacementWeights[quot].y;\n    } else if (remainder == 2) {\n        return cc_displacementWeights[quot].z;\n    } else {\n        return cc_displacementWeights[quot].w;\n    }\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\n    return fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\n    vec3 result = vec3(0, 0, 0);\n    int nVertices = int(cc_displacementTextureInfo.z);\n    for (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\n        result += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n    }\n    return result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\n    uniform sampler2D cc_PositionDisplacements;\n    vec3 getPositionDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    uniform sampler2D cc_NormalDisplacements;\n    vec3 getNormalDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    uniform sampler2D cc_TangentDisplacements;\n    vec3 getTangentDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n    }\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\n    int vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\n    attr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    attr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    attr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\n    position.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n  in vec4 a_joints;\nin vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n  #if USE_INSTANCING\n    in highp vec4 a_jointAnimInfo;\n  #endif\n  layout(std140) uniform CCSkinningTexture {\n    highp vec4 cc_jointTextureInfo;\n  };\n  layout(std140) uniform CCSkinningAnimation {\n    highp vec4 cc_jointAnimInfo;\n  };\n  uniform highp sampler2D cc_jointTexture;\n  #else\n  layout(std140) uniform CCSkinning {\n    highp vec4 cc_joints[30 * 3];\n  };\n#endif\n#if CC_USE_BAKED_ANIMATION\n  #if CC_SUPPORT_FLOAT_TEXTURE\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\n      vec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\n      vec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #else\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = vec4(\n        decode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n      );\n      vec4 v2 = vec4(\n        decode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n      );\n      vec4 v3 = vec4(\n        decode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n      );\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #endif\n#else\n  mat4 getJointMatrix (float i) {\n    int idx = int(i);\n    vec4 v1 = cc_joints[idx * 3];\n    vec4 v2 = cc_joints[idx * 3 + 1];\n    vec4 v3 = cc_joints[idx * 3 + 2];\n    return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n  }\n#endif\nmat4 skinMatrix () {\n  vec4 joints = vec4(a_joints);\n  return getJointMatrix(joints.x) * a_weights.x\n       + getJointMatrix(joints.y) * a_weights.y\n       + getJointMatrix(joints.z) * a_weights.z\n       + getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\n  mat4 m = skinMatrix();\n  position = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\n  mat4 m = skinMatrix();\n  attr.position = m * attr.position;\n  attr.normal = (m * vec4(attr.normal, 0.0)).xyz;\n  attr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\n#if USE_INSTANCING\n  in vec4 a_matWorld0;\n  in vec4 a_matWorld1;\n  in vec4 a_matWorld2;\n  #if USE_LIGHTMAP\n    in vec4 a_lightingMapUVParam;\n  #endif\n#elif USE_BATCHING\n  in float a_dyn_batch_id;\n  layout(std140) uniform CCLocalBatched {\n    highp mat4 cc_matWorlds[10];\n  };\n#else\nlayout(std140) uniform CCLocal {\n  highp mat4 cc_matWorld;\n  highp mat4 cc_matWorldIT;\n  highp vec4 cc_lightingMapUVParam;\n};\n#endif\nlayout(std140) uniform Constants {\n  vec4 tilingOffset;\n  vec4 albedo;\n  vec4 albedoScaleAndCutoff;\n  vec4 pbrParams;\n  vec4 emissive;\n  vec4 emissiveScaleParam;\n};\nlayout(std140) uniform CCShadow {\n  highp mat4 cc_matLightPlaneProj;\n  highp mat4 cc_matLightViewProj;\n  lowp  vec4 cc_shadowColor;\n  lowp  vec4 cc_shadowInfo;\n};\n#if HAS_SECOND_UV || USE_LIGHTMAP\n  in vec2 a_texCoord1;\n#endif\nout vec2 v_uv;\nout vec2 v_uv1;\nout float v_clip_depth;\nvec4 vert () {\n  StandardVertInput In;\n  In.position = vec4(a_position, 1.0);\n  In.normal = a_normal;\n  In.tangent = a_tangent;\n  #if CC_USE_MORPH\n    applyMorph(In);\n  #endif\n  #if CC_USE_SKINNING\n    CCSkin(In);\n  #endif\n  mat4 matWorld, matWorldIT;\n  #if USE_INSTANCING\n    matWorld = mat4(\n      vec4(a_matWorld0.xyz, 0.0),\n      vec4(a_matWorld1.xyz, 0.0),\n      vec4(a_matWorld2.xyz, 0.0),\n      vec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n    );\n    matWorldIT = matWorld;\n  #elif USE_BATCHING\n    matWorld = cc_matWorlds[int(a_dyn_batch_id)];\n    matWorldIT = matWorld;\n  #else\n    matWorld = cc_matWorld;\n    matWorldIT = cc_matWorldIT;\n  #endif\n  vec4 worldPos = matWorld * In.position;\n  vec4 clipPos = cc_matLightViewProj * worldPos;\n  v_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n  #if HAS_SECOND_UV\n    v_uv1 = a_texCoord1 * tilingOffset.xy + tilingOffset.zw;\n  #endif\n  v_clip_depth = clipPos.z / clipPos.w * 0.5 + 0.5;\n  return clipPos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nlayout(std140) uniform Constants {\n  vec4 tilingOffset;\n  vec4 albedo;\n  vec4 albedoScaleAndCutoff;\n  vec4 pbrParams;\n  vec4 emissive;\n  vec4 emissiveScaleParam;\n};\nvec4 packDepthToRGBA (float depth) {\n  vec4 ret = vec4(1.0, 255.0, 65025.0, 160581375.0) * depth;\n  ret = fract(ret);\n  ret -= ret.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);\n  return ret;\n}\nin vec2 v_uv;\nin vec2 v_uv1;\nin float v_clip_depth;\n#if USE_ALBEDO_MAP\n  uniform sampler2D albedoMap;\n#endif\n#if USE_ALPHA_TEST\n#endif\nvec4 frag () {\n  vec4 baseColor = albedo;\n  #if USE_ALBEDO_MAP\n    baseColor *= texture(albedoMap, ALBEDO_UV);\n  #endif\n  #if USE_ALPHA_TEST\n    if (baseColor.ALPHA_TEST_CHANNEL < albedoScaleAndCutoff.w) discard;\n  #endif\n  return packDepthToRGBA(v_clip_depth);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nlayout(std140) uniform CCLocal {\n  highp mat4 cc_matWorld;\n  highp mat4 cc_matWorldIT;\n  highp vec4 cc_lightingMapUVParam;\n};\nfloat LinearFog(vec4 pos) {\n    vec4 wPos = pos;\n    float cam_dis = distance(cc_cameraPos, wPos);\n    float fogStart = cc_fogBase.x;\n    float fogEnd = cc_fogBase.y;\n    return clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float fogDensity = cc_fogBase.z;\n    float cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\n    float f = exp(-cam_dis * fogDensity);\n    return f;\n}\nfloat ExpSquaredFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float fogDensity = cc_fogBase.z;\n    float cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\n    float f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\n    return f;\n}\nfloat LayeredFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float _FogTop = cc_fogAdd.x;\n    float _FogRange = cc_fogAdd.y;\n    vec3 camWorldProj = cc_cameraPos.xyz;\n    camWorldProj.y = 0.;\n    vec3 worldPosProj = wPos.xyz;\n    worldPosProj.y = 0.;\n    float fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\n    float fDeltaY, fDensityIntegral;\n    if (cc_cameraPos.y > _FogTop) {\n        if (wPos.y < _FogTop) {\n            fDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\n            fDensityIntegral = fDeltaY * fDeltaY * 0.5;\n        } else {\n            fDeltaY = 0.;\n            fDensityIntegral = 0.;\n        }\n    } else {\n        if (wPos.y < _FogTop) {\n            float fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\n            float fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\n            fDeltaY = abs(fDeltaA - fDeltaB);\n            fDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n        } else {\n            fDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\n            fDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n        }\n    }\n    float fDensity;\n    if (fDeltaY != 0.) {\n        fDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n    } else {\n        fDensity = 0.;\n    }\n    float f = exp(-fDensity);\n    return f;\n}\nfloat CC_TRANSFER_FOG(vec4 pos) {\n    #if CC_USE_FOG == 0\n        return LinearFog(pos);\n\t#elif CC_USE_FOG == 1\n        return ExpFog(pos);\n    #elif CC_USE_FOG == 2\n        return ExpSquaredFog(pos);\n    #elif CC_USE_FOG == 3\n        return LayeredFog(pos);\n    #endif\n    return 1.;\n}\nout highp vec4 v_shadowPos;\nlayout(std140) uniform CCShadow {\n  highp mat4 cc_matLightPlaneProj;\n  highp mat4 cc_matLightViewProj;\n  lowp  vec4 cc_shadowColor;\n  lowp  vec4 cc_shadowInfo;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nout highp vec3 v_position;\nout mediump vec3 v_normal;\n#if USE_NORMALMAP\n  out mediump vec3 v_tangent;\n  out mediump vec3 v_binormal;\n#endif\nout mediump vec2 uvw;\nout mediump vec2 uv0;\nout mediump vec2 uv1;\nout mediump vec2 uv2;\nout mediump vec2 uv3;\nout mediump vec2 luv;\nout mediump vec3 diffuse;\nout mediump float v_fog_factor;\nlayout(std140) uniform TexCoords {\n  vec4 UVScale;\n  vec4 lightMapUVParam;\n};\nvec4 vert () {\n  vec3 worldPos;\n  worldPos.x = cc_matWorld[3][0] + a_position.x;\n  worldPos.y = cc_matWorld[3][1] + a_position.y;\n  worldPos.z = cc_matWorld[3][2] + a_position.z;\n  vec4 pos = vec4(worldPos, 1.0);\n  pos = cc_matViewProj * pos;\n  uvw = a_texCoord;\n  uv0 = a_position.xz * UVScale.x;\n  uv1 = a_position.xz * UVScale.y;\n  uv2 = a_position.xz * UVScale.z;\n  uv3 = a_position.xz * UVScale.w;\n  #if USE_LIGHTMAP\n    luv = lightMapUVParam.xy + a_texCoord * lightMapUVParam.zw;\n  #endif\n  v_position = worldPos;\n  v_normal = a_normal;\n  v_fog_factor = CC_TRANSFER_FOG(vec4(worldPos, 1.0));\n  #if USE_NORMALMAP\n    v_tangent = vec3(1.0, 0.0, 0.0);\n    v_binormal = vec3(0.0, 0.0, 1.0);\n    v_binormal = cross(v_tangent, a_normal);\n    v_tangent = cross(a_normal, v_binormal);\n  #endif\n    v_shadowPos = cc_matLightViewProj * vec4(worldPos, 1.0);\n  return pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nlayout(std140) uniform CCShadow {\n  highp mat4 cc_matLightPlaneProj;\n  highp mat4 cc_matLightViewProj;\n  lowp  vec4 cc_shadowColor;\n  lowp  vec4 cc_shadowInfo;\n};\n#if CC_USE_IBL\nuniform samplerCube cc_environment;\nvec3 unpackRGBE (vec4 rgbe) {\n  return rgbe.rgb * pow(2.0, rgbe.a * 255.0 - 128.0);\n}\nvec4 fragTextureLod (sampler2D tex, vec2 coord, float lod) {\n    return textureLod(tex, coord, lod);\n}\nvec4 fragTextureLod (samplerCube tex, vec3 coord, float lod) {\n    return textureLod(tex, coord, lod);\n}\n#endif\n#if CC_RECEIVE_SHADOW\nin highp vec4 v_shadowPos;\n#if CC_RECEIVE_SHADOW\n  uniform sampler2D cc_shadowMap;\n  uniform sampler2D cc_spotLightingMap;\n  float CCGetShadowFactorX1 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float closestDepth = dot(texture(cc_shadowMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    float shadow = step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    return shadow;\n  }\n  float CCGetShadowFactorX5 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    float closestDepth = 0.0;\n    closestDepth = dot(texture(cc_shadowMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_shadowMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_shadowMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_shadowMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    return shadow / 5.0;\n  }\n  float CCGetShadowFactorX9 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -1; i <= 1; i++) {\n      for (int j = -1; j <= 1; j++) {\n        float closestDepth = dot(texture(cc_shadowMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 9.0;\n  }\n  float CCGetShadowFactorX25 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -2; i <= 2; i++) {\n      for (int j = -2; j <= 2; j++) {\n        float closestDepth = dot(texture(cc_shadowMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 25.0;\n  }\n  float CCGetDirLightShadowFactorX1 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float closestDepth = dot(texture(cc_spotLightingMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    float shadow = step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    return shadow;\n  }\n  float CCGetDirLightShadowFactorX5 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    float closestDepth = 0.0;\n    closestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    return shadow / 5.0;\n  }\n  float CCGetDirLightShadowFactorX9 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -1; i <= 1; i++) {\n      for (int j = -1; j <= 1; j++) {\n        float closestDepth = dot(texture(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 9.0;\n  }\n  float CCGetDirLightShadowFactorX25 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -2; i <= 2; i++) {\n      for (int j = -2; j <= 2; j++) {\n        float closestDepth = dot(texture(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 25.0;\n  }\n#endif\n#endif\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nfloat GGXMobile (float roughness, float NoH, vec3 H, vec3 N) {\n  vec3 NxH = cross(N, H);\n  float OneMinusNoHSqr = dot(NxH, NxH);\n  float a = roughness * roughness;\n  float n = NoH * a;\n  float p = a / (OneMinusNoHSqr + n * n);\n  return p * p;\n}\nfloat CalcSpecular (float roughness, float NoH, vec3 H, vec3 N) {\n  return (roughness*0.25 + 0.25) * GGXMobile(roughness, NoH, H, N);\n}\nvec3 BRDFApprox (vec3 specular, float roughness, float NoV) {\n  const vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\n  const vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\n  vec4 r = roughness * c0 + c1;\n  float a004 = min( r.x * r.x, exp2( -9.28 * NoV ) ) * r.x + r.y;\n  vec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n  AB.y *= clamp(50.0 * specular.g, 0.0, 1.0);\n  return specular * AB.x + AB.y;\n}\nstruct StandardSurface {\n  vec4 albedo;\n  vec3 position;\n  vec3 normal;\n  vec3 emissive;\n  vec4 lightmap;\n  float roughness;\n  float metallic;\n  float occlusion;\n};\n#if CC_FORWARD_ADD\nlayout(std140) uniform CCForwardLight {\n  highp vec4 cc_lightPos[1];\n  vec4 cc_lightColor[1];\n  vec4 cc_lightSizeRangeAngle[1];\n  vec4 cc_lightDir[1];\n};\nfloat SmoothDistAtt (float distSqr, float invSqrAttRadius) {\n  float factor = distSqr * invSqrAttRadius;\n  float smoothFactor = clamp(1.0 - factor * factor, 0.0, 1.0);\n  return smoothFactor * smoothFactor;\n}\nfloat GetDistAtt (float distSqr, float invSqrAttRadius) {\n  float attenuation = 1.0 / max(distSqr, 0.01*0.01);\n  attenuation *= SmoothDistAtt(distSqr , invSqrAttRadius);\n  return attenuation;\n}\nfloat GetAngleAtt (vec3 L, vec3 litDir, float litAngleScale, float litAngleOffset) {\n  float cd = dot(litDir, L);\n  float attenuation = clamp(cd * litAngleScale + litAngleOffset, 0.0, 1.0);\n  return (attenuation * attenuation);\n}\n  vec4 CCStandardShading (StandardSurface s) {\n    vec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\n    vec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\n    vec3 diffuseContrib = diffuse / 3.14159265359;\n    vec3 N = normalize(s.normal);\n    vec3 V = normalize(cc_cameraPos.xyz - s.position);\n    float NV = max(abs(dot(N, V)), 0.001);\n    specular = BRDFApprox(specular, s.roughness, NV);\n    vec3 finalColor = vec3(0.0);\n    for (int i = 0; i < 1; i++) {\n      vec3 SLU = cc_lightPos[i].xyz - s.position;\n      vec3 SL = normalize(SLU);\n      vec3 SH = normalize(SL + V);\n      float SNL = max(dot(N, SL), 0.001);\n      float SNH = max(dot(N, SH), 0.0);\n      float distSqr = dot(SLU, SLU);\n      float litRadius = cc_lightSizeRangeAngle[i].x;\n      float litRadiusSqr = litRadius * litRadius;\n      float illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\n      float attRadiusSqrInv = 1.0 / max(cc_lightSizeRangeAngle[i].y, 0.01);\n      attRadiusSqrInv *= attRadiusSqrInv;\n      float att = GetDistAtt(distSqr, attRadiusSqrInv);\n      vec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\n      if (cc_lightPos[i].w > 0.0) {\n        float cosInner = max(dot(-cc_lightDir[i].xyz, SL), 0.01);\n        float cosOuter = cc_lightSizeRangeAngle[i].z;\n        float litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\n        float litAngleOffset = -cosOuter * litAngleScale;\n        att *= GetAngleAtt(SL, -cc_lightDir[i].xyz, litAngleScale, litAngleOffset);\n      }\n      vec3 lightColor = cc_lightColor[i].rgb;\n    #if CC_RECEIVE_SHADOW\n      if (cc_lightPos[i].w > 0.0) {\n    {\n      float pcf = cc_shadowInfo.z + 0.001;\n      float shadowAttenuation = 0.0;\n      if (pcf > 3.0) shadowAttenuation = CCGetDirLightShadowFactorX25();\n      else if (3.0 > pcf && pcf > 2.0) shadowAttenuation = CCGetDirLightShadowFactorX9();\n      else if (2.0 > pcf && pcf > 1.0) shadowAttenuation = CCGetDirLightShadowFactorX5();\n      else shadowAttenuation = CCGetDirLightShadowFactorX1();\n      lightColor *= 1.0 - shadowAttenuation;\n    }\n      }\n    #endif\n      finalColor += SNL * lightColor * cc_lightColor[i].w * illum * att * (diffuseContrib + lspec);\n    }\n    finalColor = finalColor * s.occlusion;\n    return vec4(finalColor, 0.0);\n  }\n#else\n  vec4 CCStandardShading (StandardSurface s) {\n    vec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\n    vec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\n    vec3 N = normalize(s.normal);\n    vec3 V = normalize(cc_cameraPos.xyz - s.position);\n    float NV = max(abs(dot(N, V)), 0.001);\n    specular = BRDFApprox(specular, s.roughness, NV);\n    vec3 L = normalize(-cc_mainLitDir.xyz);\n    vec3 H = normalize(L+V);\n    float NH = max(dot(N, H), 0.0);\n    float NL = max(dot(N, L), 0.001);\n    vec3 finalColor = NL * cc_mainLitColor.rgb * cc_mainLitColor.w;\n    #if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\n      finalColor = s.lightmap.a * s.lightmap.rgb + (1.0 - s.lightmap.a) * finalColor;\n    #endif\n    vec3 diffuseContrib = diffuse / 3.14159265359;\n    vec3 specularContrib = specular * CalcSpecular(s.roughness, NH, H, N);\n    finalColor *= (diffuseContrib + specularContrib);\n    float fAmb = 0.5 - N.y * 0.5;\n    vec3 ambDiff = mix(cc_ambientSky.rgb, cc_ambientGround.rgb, fAmb) * cc_ambientSky.w;\n    finalColor += (ambDiff.rgb * diffuse);\n    #if CC_USE_IBL\n      vec3 R = normalize(reflect(-V, N));\n      vec4 envmap = fragTextureLod(cc_environment, R, s.roughness * cc_ambientGround.w);\n      #if CC_USE_IBL == 2\n        vec3 env = unpackRGBE(envmap);\n      #else\n        vec3 env = SRGBToLinear(envmap.rgb);\n      #endif\n      finalColor += env * cc_ambientSky.w * specular;\n    #endif\n    finalColor = finalColor * s.occlusion;\n    #if CC_USE_HDR\n      s.emissive *= cc_exposure.w;\n    #endif\n    finalColor += s.emissive;\n    #if CC_RECEIVE_SHADOW\n    {\n      float pcf = cc_shadowInfo.z + 0.001;\n      float shadowAttenuation = 0.0;\n      if (pcf > 3.0) shadowAttenuation = CCGetShadowFactorX25();\n      else if (3.0 > pcf && pcf > 2.0) shadowAttenuation = CCGetShadowFactorX9();\n      else if (2.0 > pcf && pcf > 1.0) shadowAttenuation = CCGetShadowFactorX5();\n      else shadowAttenuation = CCGetShadowFactorX1();\n      vec3 shadowColor = cc_shadowColor.rgb * cc_shadowColor.a + finalColor.rgb * (1.0 - cc_shadowColor.a);\n      finalColor.rgb = shadowColor.rgb * shadowAttenuation * NL + finalColor.rgb * (1.0 - shadowAttenuation * NL);\n    }\n    #endif\n    return vec4(finalColor, s.albedo.a);\n  }\n#endif\nvec3 ACESToneMap (vec3 color) {\n  color = min(color, vec3(8.0));\n  const float A = 2.51;\n  const float B = 0.03;\n  const float C = 2.43;\n  const float D = 0.59;\n  const float E = 0.14;\n  return (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n  #if !CC_USE_HDR\n    color.rgb = sqrt(ACESToneMap(color.rgb));\n  #endif\n  return color;\n}\nin highp vec3 v_position;\nin mediump vec3 v_normal;\n#if USE_NORMALMAP\n  in mediump vec3 v_tangent;\n  in mediump vec3 v_binormal;\n#endif\nin mediump vec2 uvw;\nin mediump vec2 uv0;\nin mediump vec2 uv1;\nin mediump vec2 uv2;\nin mediump vec2 uv3;\nin mediump vec3 diffuse;\nin mediump vec2 luv;\nin mediump float v_fog_factor;\nlayout(std140) uniform PbrParams {\n  vec4 metallic;\n  vec4 roughness;\n};\nuniform sampler2D weightMap;\nuniform sampler2D detailMap0;\nuniform sampler2D detailMap1;\nuniform sampler2D detailMap2;\nuniform sampler2D detailMap3;\nuniform sampler2D normalMap0;\nuniform sampler2D normalMap1;\nuniform sampler2D normalMap2;\nuniform sampler2D normalMap3;\nuniform sampler2D lightMap;\nvoid surf (out StandardSurface s) {\n  #if LAYERS > 1\n    vec4 w = texture(weightMap, uvw);\n  #endif\n  vec4 baseColor = vec4(0, 0, 0, 0);\n  #if LAYERS == 1\n    baseColor = texture(detailMap0, uv0);\n  #elif LAYERS == 2\n    baseColor += texture(detailMap0, uv0) * w.r;\n    baseColor += texture(detailMap1, uv1) * w.g;\n  #elif LAYERS == 3\n    baseColor += texture(detailMap0, uv0) * w.r;\n    baseColor += texture(detailMap1, uv1) * w.g;\n    baseColor += texture(detailMap2, uv2) * w.b;\n  #elif LAYERS == 4\n    baseColor += texture(detailMap0, uv0) * w.r;\n    baseColor += texture(detailMap1, uv1) * w.g;\n    baseColor += texture(detailMap2, uv2) * w.b;\n    baseColor += texture(detailMap3, uv3) * w.a;\n  #else\n    baseColor = texture(detailMap0, uv0);\n  #endif\n  s.position = v_position;\n  #if USE_NORMALMAP\n    vec4 baseNormal = vec4(0, 0, 0, 0);\n    #if LAYERS == 1\n      baseNormal = texture(normalMap0, uv0);\n    #elif LAYERS == 2\n      baseNormal += texture(normalMap0, uv0) * w.r;\n      baseNormal += texture(normalMap1, uv1) * w.g;\n    #elif LAYERS == 3\n      baseNormal += texture(normalMap0, uv0) * w.r;\n      baseNormal += texture(normalMap1, uv1) * w.g;\n      baseNormal += texture(normalMap2, uv2) * w.b;\n    #elif LAYERS == 4\n      baseNormal += texture(normalMap0, uv0) * w.r;\n      baseNormal += texture(normalMap1, uv1) * w.g;\n      baseNormal += texture(normalMap2, uv2) * w.b;\n      baseNormal += texture(normalMap3, uv3) * w.a;\n    #else\n      baseNormal = texture(normalMap0, uv0);\n    #endif\n    vec3 nmmp = baseNormal.xyz - vec3(0.5);\n    s.normal =\n      nmmp.x * normalize(v_tangent) +\n      nmmp.y * normalize(v_binormal) +\n      nmmp.z * normalize(v_normal);\n  #else\n    s.normal = v_normal;\n  #endif\n  s.albedo = vec4(SRGBToLinear(baseColor.rgb), 1.0);\n  s.occlusion = 1.0;\n  #if USE_PBR\n    s.roughness = 0.0;\n    #if LAYERS == 1\n      s.roughness = roughness.x;\n    #elif LAYERS == 2\n      s.roughness += roughness.x * w.r;\n      s.roughness += roughness.y * w.g;\n    #elif LAYERS == 3\n      s.roughness += roughness.x * w.r;\n      s.roughness += roughness.y * w.g;\n      s.roughness += roughness.z * w.b;\n    #elif LAYERS == 4\n      s.roughness += roughness.x * w.r;\n      s.roughness += roughness.y * w.g;\n      s.roughness += roughness.z * w.b;\n      s.roughness += roughness.w * w.a;\n    #else\n      s.roughness = 1.0;\n    #endif\n    s.metallic = 0.0;\n    #if LAYERS == 1\n      s.metallic = metallic.x;\n    #elif LAYERS == 2\n      s.metallic += metallic.x * w.r;\n      s.metallic += metallic.y * w.g;\n    #elif LAYERS == 3\n      s.metallic += metallic.x * w.r;\n      s.metallic += metallic.y * w.g;\n      s.metallic += metallic.z * w.b;\n    #elif LAYERS == 4\n      s.metallic += metallic.x * w.r;\n      s.metallic += metallic.y * w.g;\n      s.metallic += metallic.z * w.b;\n      s.metallic += metallic.w * w.a;\n    #else\n      s.metallic = 0.0;\n    #endif\n  #else\n    s.roughness = 1.0;\n    s.metallic = 0.0;\n  #endif\n  s.emissive = vec3(0.0, 0.0, 0.0);\n  #if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\n    s.lightmap = texture(lightMap, luv);\n  #else\n    s.lightmap = vec4(0.0, 0.0, 0.0, 0.0);\n  #endif\n}\nvec4 frag () {\n  StandardSurface s; surf(s);\n  vec4 color = CCStandardShading(s);\n  color = vec4(mix(CC_FORWARD_ADD > 0 ? vec3(0.0) : cc_fogColor.rgb, color.rgb, v_fog_factor), color.a);\n  return CCFragOutput(color);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"},{vert:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nlayout(std140) uniform CCLocal {\n  highp mat4 cc_matWorld;\n  highp mat4 cc_matWorldIT;\n  highp vec4 cc_lightingMapUVParam;\n};\nlayout(std140) uniform CCShadow {\n  highp mat4 cc_matLightPlaneProj;\n  highp mat4 cc_matLightViewProj;\n  lowp  vec4 cc_shadowColor;\n  lowp  vec4 cc_shadowInfo;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nout vec2 v_clip_depth;\nvec4 vert () {\n  vec4 worldPos;\n  worldPos.x = cc_matWorld[3][0] + a_position.x;\n  worldPos.y = cc_matWorld[3][1] + a_position.y;\n  worldPos.z = cc_matWorld[3][2] + a_position.z;\n  worldPos.w = 1.0;\n  vec4 clipPos = cc_matLightViewProj * worldPos;\n  v_clip_depth = clipPos.zw;\n  return clipPos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 packDepthToRGBA (float depth) {\n  vec4 ret = vec4(1.0, 255.0, 65025.0, 160581375.0) * depth;\n  ret = fract(ret);\n  ret -= ret.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);\n  return ret;\n}\nin vec2 v_clip_depth;\nvec4 frag () {\n  return packDepthToRGBA(v_clip_depth.x / v_clip_depth.y * 0.5 + 0.5);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\n  rgba = rgba * 255.0;\n  highp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\n  highp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\n  highp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\n  return Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\n  highp vec4 position;\n  vec3 normal;\n  vec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_MORPH\n    in float a_vertexId;\n    int getVertexId() {\n        return int(a_vertexId);\n    }\nlayout(std140) uniform CCMorph {\n    vec4 cc_displacementWeights[15];\n    vec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\n    float pixelIndexF = float(pixelIndex);\n    float x = mod(pixelIndexF, textureResolution.x);\n    float y = floor(pixelIndexF / textureResolution.x);\n    return vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\n    return (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_SUPPORT_FLOAT_TEXTURE\n        vec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\n            ivec2 texSize = textureSize(tex, 0);\n            return texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n        }\n#else\n    vec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\n        int pixelIndex = elementIndex * 4;\n        vec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\n        vec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\n        return vec4(\n            decode32(texture(tex, x)),\n            decode32(texture(tex, y)),\n            decode32(texture(tex, z)),\n            1.0\n        );\n    }\n#endif\nfloat getDisplacementWeight(int index) {\n    int quot = index / 4;\n    int remainder = index - quot * 4;\n    if (remainder == 0) {\n        return cc_displacementWeights[quot].x;\n    } else if (remainder == 1) {\n        return cc_displacementWeights[quot].y;\n    } else if (remainder == 2) {\n        return cc_displacementWeights[quot].z;\n    } else {\n        return cc_displacementWeights[quot].w;\n    }\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\n    return fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\n    vec3 result = vec3(0, 0, 0);\n    int nVertices = int(cc_displacementTextureInfo.z);\n    for (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\n        result += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n    }\n    return result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\n    uniform sampler2D cc_PositionDisplacements;\n    vec3 getPositionDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    uniform sampler2D cc_NormalDisplacements;\n    vec3 getNormalDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    uniform sampler2D cc_TangentDisplacements;\n    vec3 getTangentDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n    }\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\n    int vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\n    attr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    attr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    attr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\n    position.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n  in vec4 a_joints;\nin vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n  #if USE_INSTANCING\n    in highp vec4 a_jointAnimInfo;\n  #endif\n  layout(std140) uniform CCSkinningTexture {\n    highp vec4 cc_jointTextureInfo;\n  };\n  layout(std140) uniform CCSkinningAnimation {\n    highp vec4 cc_jointAnimInfo;\n  };\n  uniform highp sampler2D cc_jointTexture;\n  #else\n  layout(std140) uniform CCSkinning {\n    highp vec4 cc_joints[30 * 3];\n  };\n#endif\n#if CC_USE_BAKED_ANIMATION\n  #if CC_SUPPORT_FLOAT_TEXTURE\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\n      vec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\n      vec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #else\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = vec4(\n        decode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n      );\n      vec4 v2 = vec4(\n        decode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n      );\n      vec4 v3 = vec4(\n        decode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n      );\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #endif\n#else\n  mat4 getJointMatrix (float i) {\n    int idx = int(i);\n    vec4 v1 = cc_joints[idx * 3];\n    vec4 v2 = cc_joints[idx * 3 + 1];\n    vec4 v3 = cc_joints[idx * 3 + 2];\n    return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n  }\n#endif\nmat4 skinMatrix () {\n  vec4 joints = vec4(a_joints);\n  return getJointMatrix(joints.x) * a_weights.x\n       + getJointMatrix(joints.y) * a_weights.y\n       + getJointMatrix(joints.z) * a_weights.z\n       + getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\n  mat4 m = skinMatrix();\n  position = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\n  mat4 m = skinMatrix();\n  attr.position = m * attr.position;\n  attr.normal = (m * vec4(attr.normal, 0.0)).xyz;\n  attr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\n#if USE_INSTANCING\n  in vec4 a_matWorld0;\n  in vec4 a_matWorld1;\n  in vec4 a_matWorld2;\n  #if USE_LIGHTMAP\n    in vec4 a_lightingMapUVParam;\n  #endif\n#elif USE_BATCHING\n  in float a_dyn_batch_id;\n  layout(std140) uniform CCLocalBatched {\n    highp mat4 cc_matWorlds[10];\n  };\n#else\nlayout(std140) uniform CCLocal {\n  highp mat4 cc_matWorld;\n  highp mat4 cc_matWorldIT;\n  highp vec4 cc_lightingMapUVParam;\n};\n#endif\nfloat LinearFog(vec4 pos) {\n    vec4 wPos = pos;\n    float cam_dis = distance(cc_cameraPos, wPos);\n    float fogStart = cc_fogBase.x;\n    float fogEnd = cc_fogBase.y;\n    return clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float fogDensity = cc_fogBase.z;\n    float cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\n    float f = exp(-cam_dis * fogDensity);\n    return f;\n}\nfloat ExpSquaredFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float fogDensity = cc_fogBase.z;\n    float cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\n    float f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\n    return f;\n}\nfloat LayeredFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float _FogTop = cc_fogAdd.x;\n    float _FogRange = cc_fogAdd.y;\n    vec3 camWorldProj = cc_cameraPos.xyz;\n    camWorldProj.y = 0.;\n    vec3 worldPosProj = wPos.xyz;\n    worldPosProj.y = 0.;\n    float fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\n    float fDeltaY, fDensityIntegral;\n    if (cc_cameraPos.y > _FogTop) {\n        if (wPos.y < _FogTop) {\n            fDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\n            fDensityIntegral = fDeltaY * fDeltaY * 0.5;\n        } else {\n            fDeltaY = 0.;\n            fDensityIntegral = 0.;\n        }\n    } else {\n        if (wPos.y < _FogTop) {\n            float fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\n            float fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\n            fDeltaY = abs(fDeltaA - fDeltaB);\n            fDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n        } else {\n            fDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\n            fDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n        }\n    }\n    float fDensity;\n    if (fDeltaY != 0.) {\n        fDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n    } else {\n        fDensity = 0.;\n    }\n    float f = exp(-fDensity);\n    return f;\n}\nfloat CC_TRANSFER_FOG(vec4 pos) {\n    #if CC_USE_FOG == 0\n        return LinearFog(pos);\n\t#elif CC_USE_FOG == 1\n        return ExpFog(pos);\n    #elif CC_USE_FOG == 2\n        return ExpSquaredFog(pos);\n    #elif CC_USE_FOG == 3\n        return LayeredFog(pos);\n    #endif\n    return 1.;\n}\n#if USE_VERTEX_COLOR\n  in lowp vec4 a_color;\n  out lowp vec4 v_color;\n#endif\n#if USE_TEXTURE\n  out vec2 v_uv;\n  layout(std140) uniform TexCoords {\n    vec4 tilingOffset;\n  };\n#endif\nout float factor_fog;\nvec4 vert () {\n  vec4 position;\n  position = vec4(a_position, 1.0);\n  #if CC_USE_MORPH\n    applyMorph(position);\n  #endif\n  #if CC_USE_SKINNING\n    CCSkin(position);\n  #endif\n  mat4 matWorld;\n  #if USE_INSTANCING\n    matWorld = mat4(\n      vec4(a_matWorld0.xyz, 0.0),\n      vec4(a_matWorld1.xyz, 0.0),\n      vec4(a_matWorld2.xyz, 0.0),\n      vec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n    );\n  #elif USE_BATCHING\n    matWorld = cc_matWorlds[int(a_dyn_batch_id)];\n  #else\n    matWorld = cc_matWorld;\n  #endif\n  #if USE_TEXTURE\n    v_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n  #endif\n  #if USE_VERTEX_COLOR\n    v_color = a_color;\n  #endif\n  factor_fog = CC_TRANSFER_FOG(matWorld * position);\n  return cc_matProj * (cc_matView * matWorld) * position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n  #if CC_USE_HDR\n    color.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n  #endif\n  return color;\n}\n#if USE_ALPHA_TEST\n#endif\n#if USE_TEXTURE\n  in vec2 v_uv;\n  uniform sampler2D mainTexture;\n#endif\nlayout(std140) uniform Constant {\n  vec4 mainColor;\n  vec4 colorScaleAndCutoff;\n};\n#if USE_VERTEX_COLOR\n  in lowp vec4 v_color;\n#endif\nin float factor_fog;\nvec4 frag () {\n  vec4 o = mainColor;\n  o.rgb *= colorScaleAndCutoff.xyz;\n  #if USE_VERTEX_COLOR\n    o *= v_color;\n  #endif\n  #if USE_TEXTURE\n    o *= texture(mainTexture, v_uv);\n  #endif\n  #if USE_ALPHA_TEST\n    if (o.ALPHA_TEST_CHANNEL < colorScaleAndCutoff.w) discard;\n  #endif\n  o = vec4(mix(CC_FORWARD_ADD > 0 ? vec3(0.0) : cc_fogColor.rgb, o.rgb, factor_fog), o.a);\n  return CCFragOutput(o);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\n  rgba = rgba * 255.0;\n  highp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\n  highp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\n  highp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\n  return Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\n  highp vec4 position;\n  vec3 normal;\n  vec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_MORPH\n    in float a_vertexId;\n    int getVertexId() {\n        return int(a_vertexId);\n    }\nlayout(std140) uniform CCMorph {\n    vec4 cc_displacementWeights[15];\n    vec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\n    float pixelIndexF = float(pixelIndex);\n    float x = mod(pixelIndexF, textureResolution.x);\n    float y = floor(pixelIndexF / textureResolution.x);\n    return vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\n    return (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_SUPPORT_FLOAT_TEXTURE\n        vec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\n            ivec2 texSize = textureSize(tex, 0);\n            return texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n        }\n#else\n    vec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\n        int pixelIndex = elementIndex * 4;\n        vec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\n        vec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\n        return vec4(\n            decode32(texture(tex, x)),\n            decode32(texture(tex, y)),\n            decode32(texture(tex, z)),\n            1.0\n        );\n    }\n#endif\nfloat getDisplacementWeight(int index) {\n    int quot = index / 4;\n    int remainder = index - quot * 4;\n    if (remainder == 0) {\n        return cc_displacementWeights[quot].x;\n    } else if (remainder == 1) {\n        return cc_displacementWeights[quot].y;\n    } else if (remainder == 2) {\n        return cc_displacementWeights[quot].z;\n    } else {\n        return cc_displacementWeights[quot].w;\n    }\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\n    return fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\n    vec3 result = vec3(0, 0, 0);\n    int nVertices = int(cc_displacementTextureInfo.z);\n    for (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\n        result += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n    }\n    return result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\n    uniform sampler2D cc_PositionDisplacements;\n    vec3 getPositionDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    uniform sampler2D cc_NormalDisplacements;\n    vec3 getNormalDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    uniform sampler2D cc_TangentDisplacements;\n    vec3 getTangentDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n    }\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\n    int vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\n    attr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    attr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    attr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\n    position.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n  in vec4 a_joints;\nin vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n  #if USE_INSTANCING\n    in highp vec4 a_jointAnimInfo;\n  #endif\n  layout(std140) uniform CCSkinningTexture {\n    highp vec4 cc_jointTextureInfo;\n  };\n  layout(std140) uniform CCSkinningAnimation {\n    highp vec4 cc_jointAnimInfo;\n  };\n  uniform highp sampler2D cc_jointTexture;\n  #else\n  layout(std140) uniform CCSkinning {\n    highp vec4 cc_joints[30 * 3];\n  };\n#endif\n#if CC_USE_BAKED_ANIMATION\n  #if CC_SUPPORT_FLOAT_TEXTURE\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\n      vec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\n      vec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #else\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = vec4(\n        decode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n      );\n      vec4 v2 = vec4(\n        decode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n      );\n      vec4 v3 = vec4(\n        decode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n      );\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #endif\n#else\n  mat4 getJointMatrix (float i) {\n    int idx = int(i);\n    vec4 v1 = cc_joints[idx * 3];\n    vec4 v2 = cc_joints[idx * 3 + 1];\n    vec4 v3 = cc_joints[idx * 3 + 2];\n    return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n  }\n#endif\nmat4 skinMatrix () {\n  vec4 joints = vec4(a_joints);\n  return getJointMatrix(joints.x) * a_weights.x\n       + getJointMatrix(joints.y) * a_weights.y\n       + getJointMatrix(joints.z) * a_weights.z\n       + getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\n  mat4 m = skinMatrix();\n  position = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\n  mat4 m = skinMatrix();\n  attr.position = m * attr.position;\n  attr.normal = (m * vec4(attr.normal, 0.0)).xyz;\n  attr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\n#if USE_INSTANCING\n  in vec4 a_matWorld0;\n  in vec4 a_matWorld1;\n  in vec4 a_matWorld2;\n  #if USE_LIGHTMAP\n    in vec4 a_lightingMapUVParam;\n  #endif\n#elif USE_BATCHING\n  in float a_dyn_batch_id;\n  layout(std140) uniform CCLocalBatched {\n    highp mat4 cc_matWorlds[10];\n  };\n#else\nlayout(std140) uniform CCLocal {\n  highp mat4 cc_matWorld;\n  highp mat4 cc_matWorldIT;\n  highp vec4 cc_lightingMapUVParam;\n};\n#endif\nlayout(std140) uniform CCShadow {\n  highp mat4 cc_matLightPlaneProj;\n  highp mat4 cc_matLightViewProj;\n  lowp  vec4 cc_shadowColor;\n  lowp  vec4 cc_shadowInfo;\n};\nvec4 vert () {\n  vec4 position;\n  position = vec4(a_position, 1.0);\n  #if CC_USE_MORPH\n    applyMorph(position);\n  #endif\n  #if CC_USE_SKINNING\n    CCSkin(position);\n  #endif\n  mat4 matWorld;\n  #if USE_INSTANCING\n    matWorld = mat4(\n      vec4(a_matWorld0.xyz, 0.0),\n      vec4(a_matWorld1.xyz, 0.0),\n      vec4(a_matWorld2.xyz, 0.0),\n      vec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n    );\n  #elif USE_BATCHING\n    matWorld = cc_matWorlds[int(a_dyn_batch_id)];\n  #else\n    matWorld = cc_matWorld;\n  #endif\n  position = cc_matProj * (cc_matView * cc_matLightPlaneProj * matWorld) * position;\n  position.z -= 0.0001;\n  return position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCShadow {\n  highp mat4 cc_matLightPlaneProj;\n  highp mat4 cc_matLightViewProj;\n  lowp  vec4 cc_shadowColor;\n  lowp  vec4 cc_shadowInfo;\n};\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n  #if CC_USE_HDR\n    color.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n  #endif\n  return color;\n}\nvec4 frag () {\n  return CCFragOutput(cc_shadowColor);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nstruct StandardVertInput {\n  highp vec4 position;\n  vec3 normal;\n  vec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\nout mediump vec4 viewDir;\nvec4 vert () {\n  viewDir = vec4(a_position, 1.0);\n  mat4 matViewRotOnly = mat4(mat3(cc_matView));\n  mat4 matProj = cc_matProj;\n  if (matProj[3].w > 0.0) {\n    vec2 scale = vec2(48.0, 24.0);\n    matProj[0].xy *= scale;\n    matProj[1].xy *= scale;\n    matProj[2].zw = vec2(-1.0);\n    matProj[3].zw = vec2(0.0);\n  }\n  vec4 pos = matProj * matViewRotOnly * viewDir;\n  pos.z = 0.99999 * pos.w;\n  return pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nuniform samplerCube cc_environment;\nvec3 unpackRGBE (vec4 rgbe) {\n  return rgbe.rgb * pow(2.0, rgbe.a * 255.0 - 128.0);\n}\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec3 ACESToneMap (vec3 color) {\n  color = min(color, vec3(8.0));\n  const float A = 2.51;\n  const float B = 0.03;\n  const float C = 2.43;\n  const float D = 0.59;\n  const float E = 0.14;\n  return (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n  #if !CC_USE_HDR\n    color.rgb = sqrt(ACESToneMap(color.rgb));\n  #endif\n  return color;\n}\nin mediump vec4 viewDir;\nvec4 frag () {\n  #if USE_RGBE_CUBEMAP\n    vec3 c = unpackRGBE(texture(cc_environment, viewDir.xyz));\n  #else\n    vec3 c = SRGBToLinear(texture(cc_environment, viewDir.xyz).rgb);\n  #endif\n  return CCFragOutput(vec4(c * cc_ambientSky.w, 1.0));\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nin vec3 a_position;\nin vec4 a_color;\nout vec2 v_uv;\nlayout(std140) uniform Constants {\n  vec4 offset;\n};\nlayout(std140) uniform PerFrameInfo {\n  vec4 digits[8 * 10 / 4];\n};\nfloat getComponent(vec4 v, float i) {\n  if (i < 1.0) { return v.x; }\n  else if (i < 2.0) { return v.y; }\n  else if (i < 3.0) { return v.z; }\n  else { return v.w; }\n}\nvec4 vert () {\n  vec4 position = cc_matViewProj * vec4(a_position, 1.0);\n  position.xy += offset.xy;\n  v_uv = a_color.xy;\n  if (a_color.z >= 0.0) {\n    float n = getComponent(digits[int(a_color.z)], a_color.w);\n    v_uv += vec2(offset.z * n, 0.0);\n  }\n  return position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n  #if CC_USE_HDR\n    color.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n  #endif\n  return color;\n}\nin vec2 v_uv;\nuniform sampler2D mainTexture;\nvec4 frag () {\n  return CCFragOutput(texture(mainTexture, v_uv));\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nin vec2 a_position;\nin vec2 a_texCoord;\nout vec2 v_uv;\nvec4 vert () {\n  vec4 pos = vec4(a_position, 0, 1);\n  v_uv = a_texCoord;\n  return pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nin vec2 v_uv;\nuniform sampler2D mainTexture;\nlayout(std140) uniform splashFrag {\n  float u_precent;\n};\nvec4 frag () {\n  vec4 color = texture(mainTexture, v_uv);\n  float precent = clamp(u_precent, 0.0, 1.0);\n  color.xyz *= precent;\n  return color;\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}]]},od=function(){function e(){this._device=null,this._resources={}}var t=e.prototype;return t.initBuiltinRes=function(e){var t=this;this._device=e;var n=this._resources,i=document.createElement("canvas"),r=i.getContext("2d"),o=new J_(i),a=i.width=i.height=2;r.fillStyle="#000",r.fillRect(0,0,a,a);var s=new Rm;s._uuid="black-texture",s.image=o,n[s._uuid]=s,r.fillStyle="rgba(0,0,0,0)",r.fillRect(0,0,a,a);for(var l=new Uint8Array(16),u=0;u<l.length;++u)l[u]=0;var h=new Rm;h._uuid="empty-texture",h.image=o,h.uploadData(l),n[h._uuid]=h;var _=new Om;_._uuid="black-cube-texture",_.setMipFilter(Om.Filter.NEAREST),_.image={front:new J_(i),back:new J_(i),left:new J_(i),right:new J_(i),top:new J_(i),bottom:new J_(i)},n[_._uuid]=_,r.fillStyle="#777",r.fillRect(0,0,a,a);var f=new Rm;f._uuid="grey-texture",f.image=o,n[f._uuid]=f,r.fillStyle="#fff",r.fillRect(0,0,a,a);var m=new Rm;m._uuid="white-texture",m.image=o,n[m._uuid]=m;var d=new Om;d._uuid="white-cube-texture",d.setMipFilter(Om.Filter.NEAREST),d.image={front:new J_(i),back:new J_(i),left:new J_(i),right:new J_(i),top:new J_(i),bottom:new J_(i)},n[d._uuid]=d,r.fillStyle="#7f7fff",r.fillRect(0,0,a,a);var p=new Rm;p._uuid="normal-texture",p.image=o,n[p._uuid]=p,i.width=i.height=16,r.fillStyle="#ddd",r.fillRect(0,0,16,16),r.fillStyle="#555",r.fillRect(0,0,8,8),r.fillStyle="#555",r.fillRect(8,8,8,8);var v=new Rm;v._uuid="default-texture",v.image=o,n[v._uuid]=v;var g=new Om;if(g.setMipFilter(Om.Filter.NEAREST),g._uuid="default-cube-texture",g.image={front:new J_(i),back:new J_(i),left:new J_(i),right:new J_(i),top:new J_(i),bottom:new J_(i)},n[g._uuid]=g,c.SpriteFrame){var y=new c.SpriteFrame,x=o._texture;y.texture=x,y._uuid="default-spriteframe",n[y._uuid]=y}var E=$m(e);if(!E)return Promise.reject(Error("Failed to initialize builtin shaders: unknown device."));var S=rd[E];return S?Promise.resolve().then((function(){Lm.forEach((function(e,t){var n=Object.assign(new c.EffectAsset,e);n.shaders.forEach((function(e,n){var i=S[t][n];i&&(e[E]=i)})),n.hideInEditor=!0,n.onLoaded()})),t._initMaterials()})):Promise.reject(Error("Current device is requiring builtin shaders of version "+E+" but shaders of that version are not assembled in this build."))},t.get=function(e){return this._resources[e]},t._initMaterials=function(){var e=this._resources,t=[],n=new c.Material;n._uuid="standard-material",n.initialize({effectName:"standard"}),e[n._uuid]=n,t.push(n);var i=new c.Material;i._uuid="missing-effect-material",i.initialize({effectName:"unlit",defines:{USE_COLOR:!0}}),i.setProperty("mainColor",c.color("#ffff00")),e[i._uuid]=i,t.push(i);var r=new c.Material;r._uuid="missing-material",r.initialize({effectName:"unlit",defines:{USE_COLOR:!0}}),r.setProperty("mainColor",c.color("#ff00ff")),e[r._uuid]=r,t.push(r);var o=new c.Material;o._uuid="default-clear-stencil",o.initialize({defines:{USE_TEXTURE:!1},effectName:"clear-stencil"}),e[o._uuid]=o,t.push(o);var a=new c.Material;a._uuid="ui-base-material",a.initialize({defines:{USE_TEXTURE:!1},effectName:"sprite"}),e[a._uuid]=a,t.push(a);var s=new c.Material;s._uuid="ui-sprite-material",s.initialize({defines:{USE_TEXTURE:!0,CC_USE_EMBEDDED_ALPHA:!1,IS_GRAY:!1},effectName:"sprite"}),e[s._uuid]=s,t.push(s);var l=new c.Material;l._uuid="ui-alpha-test-material",l.initialize({defines:{USE_TEXTURE:!0,USE_ALPHA_TEST:!0,CC_USE_EMBEDDED_ALPHA:!1,IS_GRAY:!1},effectName:"sprite"}),e[l._uuid]=l,t.push(l);var u=new c.Material;u._uuid="ui-sprite-gray-material",u.initialize({defines:{USE_TEXTURE:!0,CC_USE_EMBEDDED_ALPHA:!1,IS_GRAY:!0},effectName:"sprite"}),e[u._uuid]=u,t.push(u);var h=new c.Material;h._uuid="ui-sprite-alpha-sep-material",h.initialize({defines:{USE_TEXTURE:!0,CC_USE_EMBEDDED_ALPHA:!0,IS_GRAY:!1},effectName:"sprite"}),e[h._uuid]=h,t.push(h);var _=new c.Material;_._uuid="ui-sprite-gray-alpha-sep-material",_.initialize({defines:{USE_TEXTURE:!0,CC_USE_EMBEDDED_ALPHA:!0,IS_GRAY:!0},effectName:"sprite"}),e[_._uuid]=_,t.push(_);var f=new c.Material;f._uuid="ui-graphics-material",f.initialize({effectName:"graphics"}),e[f._uuid]=f,t.push(f);var m=new c.Material;m._uuid="default-particle-material",m.initialize({effectName:"particle"}),e[m._uuid]=m,t.push(m);var d=new c.Material;d._uuid="default-particle-gpu-material",d.initialize({effectName:"particle-gpu"}),e[d._uuid]=d,t.push(d);var p=new c.Material;p._uuid="default-trail-material",p.initialize({effectName:"particle-trail"}),e[p._uuid]=p,t.push(p);var v=new c.Material;v._uuid="default-billboard-material",v.initialize({effectName:"billboard"}),e[v._uuid]=v,t.push(v);var g=new c.Material;g._uuid="default-spine-material",g.initialize({defines:{USE_TEXTURE:!0,CC_USE_EMBEDDED_ALPHA:!1,IS_GRAY:!1},effectName:"spine"}),e[g._uuid]=g,t.push(g),c.game.on(c.Game.EVENT_RENDERER_INITED,(function(){for(var e=0;e<t.length;++e)for(var n=t[e],i=0;i<n.passes.length;++i)n.passes[i].tryCompile()}))},e}(),ad=e("b3",c.builtinResMgr=new od),sd=e("fm",(td=new Map,nd=0,function(e){return"number"==typeof e?e:(td.has(e)||(td.set(e,1<<nd),nd++),td.get(e))})),cd=new Wa($o.UNIFORM|$o.TRANSFER_DST,ea.HOST|ea.DEVICE),ld=new qa(null),ud=new js(null);!function(e){e[e.INSTANCING=1]="INSTANCING",e[e.VB_MERGING=2]="VB_MERGING"}(id||(id={}));var hd=e("cq",function(){function e(e){this._rootBuffer=null,this._rootBufferDirty=!1,this._buffers=[],this._descriptorSet=null,this._passIndex=0,this._propertyIndex=0,this._programName="",this._dynamics={},this._propertyHandleMap={},this._rootBlock=null,this._blocks=[],this._shaderInfo=null,this._defines={},this._properties={},this._root=void 0,this._device=void 0,this._hShaderDefault=Qi,this._handle=Qi,this._bs=new gs,this._dss=new ps,this._rs=new ds,this._root=e,this._device=e.device}e.fillPipelineInfo=function(e,t){var n=e.handle;void 0!==t.priority&&fr.set(n,Ki.PRIORITY,t.priority),void 0!==t.primitive&&fr.set(n,Ki.PRIMITIVE,t.primitive),void 0!==t.stage&&fr.set(n,Ki.STAGE,t.stage),void 0!==t.dynamicStates&&fr.set(n,Ki.DYNAMIC_STATES,t.dynamicStates),void 0!==t.phase&&fr.set(n,Ki.PHASE,sd(t.phase));var i=e._bs;if(t.blendState){var r=t.blendState,o=r.targets;o&&o.forEach((function(e,t){i.setTarget(t,e)})),void 0!==r.isA2C&&(i.isA2C=r.isA2C),void 0!==r.isIndepend&&(i.isIndepend=r.isIndepend),void 0!==r.blendColor&&(i.blendColor=r.blendColor)}e._rs.assign(t.rasterizerState),e._dss.assign(t.depthStencilState)},e.getPassHash=function(e,t){var n,i=e.handle,r=t+","+fr.get(i,Ki.PRIMITIVE)+","+fr.get(i,Ki.DYNAMIC_STATES);return r+=function(e){for(var t,n=",bs,"+e.isA2C,i=oe(e.targets);!(t=i()).done;){var r=t.value;n+=",bt,"+r.blend+","+r.blendEq+","+r.blendAlphaEq+","+r.blendColorMask,n+=","+r.blendSrc+","+r.blendDst+","+r.blendSrcAlpha+","+r.blendDstAlpha}return n}(e._bs),r+=function(e){var t=",dss,"+e.depthTest+","+e.depthWrite+","+e.depthFunc;return t+=","+e.stencilTestFront+","+e.stencilFuncFront+","+e.stencilRefFront+","+e.stencilReadMaskFront,t+=","+e.stencilFailOpFront+","+e.stencilZFailOpFront+","+e.stencilPassOpFront+","+e.stencilWriteMaskFront,(t+=","+e.stencilTestBack+","+e.stencilFuncBack+","+e.stencilRefBack+","+e.stencilReadMaskBack)+","+e.stencilFailOpBack+","+e.stencilZFailOpBack+","+e.stencilPassOpBack+","+e.stencilWriteMaskBack}(e._dss),is(r+=",rs,"+(n=e._rs).cullMode+","+n.depthBias+","+n.isFrontFaceCCW,666)};var t=e.prototype;return t.initialize=function(e){this._doInit(e),this.resetUBOs(),this.resetTextures(),this.tryCompile()},t.getHandle=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=Zo.UNKNOWN);var i=this._propertyHandleMap[e];return i?(n?i=Hm(i,n):t&&(i=Hm(i,Bm(i)-t)),i+t):0},t.getBinding=function(t){var n=this.getHandle(t);return n?e.getBindingFromHandle(n):-1},t.setUniform=function(t,n){var i=e.getBindingFromHandle(t),r=e.getTypeFromHandle(t),o=e.getOffsetFromHandle(t),a=this._blocks[i];Vm[r](a,n,o),this._rootBufferDirty=!0},t.getUniform=function(t,n){var i=e.getBindingFromHandle(t),r=e.getTypeFromHandle(t),o=e.getOffsetFromHandle(t),a=this._blocks[i];return km[r](a,n,o)},t.setUniformArray=function(t,n){for(var i=e.getBindingFromHandle(t),r=e.getTypeFromHandle(t),o=Ga(r)>>2,a=this._blocks[i],s=e.getOffsetFromHandle(t),c=0;c<n.length;c++,s+=o)null!==n[c]&&Vm[r](a,n[c],s);this._rootBufferDirty=!0},t.bindTexture=function(e,t,n){this._descriptorSet.bindTexture(e,t,n||0)},t.bindSampler=function(e,t,n){this._descriptorSet.bindSampler(e,t,n||0)},t.setDynamicState=function(e,t){var n=this._dynamics[e];n&&n.value===t||(n.value=t,n.dirty=!0)},t.overridePipelineStates=function(){console.warn("base pass cannot override states, please use pass instance instead.")},t.update=function(){this._rootBufferDirty&&this._rootBuffer&&(this._rootBuffer.update(this._rootBlock),this._rootBufferDirty=!1),this._descriptorSet.update()},t.destroy=function(){for(var e=0;e<this._shaderInfo.blocks.length;e++){var t=this._shaderInfo.blocks[e];this._buffers[t.binding].destroy()}this._buffers=[],this._rootBuffer&&(this._rootBuffer.destroy(),this._rootBlock=null),this._descriptorSet=null,this._rs.destroy(),this._dss.destroy(),this._bs.destroy(),this._handle&&(Ji.free(fr.get(this._handle,Ki.DESCRIPTOR_SET)),fr.free(this._handle),this._handle=Qi)},t.resetUniform=function(t){var n=this.getHandle(t);if(n){var i=e.getTypeFromHandle(n),r=e.getBindingFromHandle(n),o=e.getOffsetFromHandle(n),a=this._blocks[r],s=this._properties[t],c=s&&s.value||Wm(i);Vm[i](a,c,o),this._rootBufferDirty=!0}},t.resetTexture=function(t,n){var i=this.getHandle(t);if(i){var r=e.getTypeFromHandle(i),o=e.getBindingFromHandle(i),a=this._properties[t],s=a&&a.value,c=s?s+"-texture":Wm(r),l=ad.get(c),u=l&&l.getGFXTexture(),h=a&&void 0!==a.samplerHash?a.samplerHash:l&&l.getSamplerHash(),_=gf.getSampler(this._device,h);this._descriptorSet.bindSampler(o,_,n),this._descriptorSet.bindTexture(o,u,n)}},t.resetUBOs=function(){for(var e=0;e<this._shaderInfo.blocks.length;e++)for(var t=this._shaderInfo.blocks[e],n=this._blocks[t.binding],i=0,r=0;r<t.members.length;r++){for(var o=t.members[r],a=this._properties[o.name],s=a&&a.value||Wm(o.type),c=(Ga(o.type)>>2)*o.count,l=0;l+s.length<=c;l+=s.length)n.set(s,i+l);i+=c}this._rootBufferDirty=!0},t.resetTextures=function(){for(var e=0;e<this._shaderInfo.samplers.length;e++)for(var t=this._shaderInfo.samplers[e],n=0;n<t.count;n++)this.resetTexture(t.name,n)},t.tryCompile=function(){var t=this._root.pipeline;return!!t&&(this._syncBatchingScheme(),this._hShaderDefault=ed.getGFXShader(this._device,this._programName,this._defines,t),this._hShaderDefault?(fr.set(this._handle,Ki.PIPELINE_LAYOUT,ed.getTemplateInfo(this._programName).hPipelineLayout),fr.set(this._handle,Ki.HASH,e.getPassHash(this,this._hShaderDefault)),!0):(console.warn("create shader "+this._programName+" failed"),!1))},t.getShaderVariant=function(e){if(void 0===e&&(e=null),!this._hShaderDefault&&!this.tryCompile())return console.warn("pass resources incomplete"),Qi;if(!e)return this._hShaderDefault;for(var t=this._root.pipeline,n=0;n<e.length;n++){var i=e[n];this._defines[i.name]=i.value}for(var r=ed.getGFXShader(this._device,this._programName,this._defines,t),o=0;o<e.length;o++){var a=e[o];delete this._defines[a.name]}return r},t.beginChangeStatesSilently=function(){},t.endChangeStatesSilently=function(){},t._doInit=function(t,n){void 0===n&&(n=!1);var i=this._handle=fr.alloc();fr.set(i,Ki.PRIORITY,Yl.DEFAULT),fr.set(i,Ki.STAGE,ql.DEFAULT),fr.set(i,Ki.PHASE,sd("default")),fr.set(i,Ki.PRIMITIVE,ia.TRIANGLE_LIST),fr.set(i,Ki.RASTERIZER_STATE,this._rs.handle),fr.set(i,Ki.DEPTH_STENCIL_STATE,this._dss.handle),fr.set(i,Ki.BLEND_STATE,this._bs.handle),this._passIndex=t.passIndex,this._propertyIndex=void 0!==t.propertyIndex?t.propertyIndex:t.passIndex,this._programName=t.program,this._defines=n?J({},t.defines):t.defines,this._shaderInfo=ed.getTemplate(t.program),this._properties=t.properties||this._properties;var r=this._device;e.fillPipelineInfo(this,t),t.stateOverrides&&e.fillPipelineInfo(this,t.stateOverrides),ud.layout=ed.getDescriptorSetLayout(this._device,t.program);var o=Ji.alloc(this._device,ud);fr.set(this._handle,Ki.DESCRIPTOR_SET,o),this._descriptorSet=Ji.get(o);for(var a=this._shaderInfo.blocks,s=ed.getTemplateInfo(t.program),c=s.blockSizes,l=s.handleMap,u=r.uboOffsetAlignment,h=[],_=0,f=0,m=0;m<a.length;m++){var d=c[m];h.push(f),f+=Math.ceil(d/u)*u,_=d}var p=h[h.length-1]+_;p&&(cd.size=16*Math.ceil(p/16),this._rootBuffer=r.createBuffer(cd),this._rootBlock=new ArrayBuffer(p));for(var v=0,g=0;v<a.length;v++){var y=a[v].binding,x=c[v];ld.buffer=this._rootBuffer,ld.offset=h[g++],ld.range=16*Math.ceil(x/16);var E=this._buffers[y]=r.createBuffer(ld);this._blocks[y]=new Float32Array(this._rootBlock,ld.offset,x/Float32Array.BYTES_PER_ELEMENT),this._descriptorSet.bindBuffer(y,E)}var S=this._propertyHandleMap=l,T={};for(var A in this._properties){var C=this._properties[A];C.handleInfo&&(T[A]=this.getHandle.apply(this,C.handleInfo))}Object.assign(S,T)},t._syncBatchingScheme=function(){this._defines.USE_INSTANCING?this._device.hasFeature(Pa.INSTANCED_ARRAYS)?fr.set(this._handle,Ki.BATCHING_SCHEME,id.INSTANCING):(this._defines.USE_INSTANCING=!1,fr.set(this._handle,Ki.BATCHING_SCHEME,0)):this._defines.USE_BATCHING?fr.set(this._handle,Ki.BATCHING_SCHEME,id.VB_MERGING):fr.set(this._handle,Ki.BATCHING_SCHEME,0)},t._destroyHandle=function(){this._handle&&(fr.free(this._handle),this._handle=Qi)},t._initPassFromTarget=function(e,t,n,i){fr.set(this.handle,Ki.PRIORITY,e.priority),fr.set(this.handle,Ki.STAGE,e.stage),fr.set(this.handle,Ki.PHASE,e.phase),fr.set(this.handle,Ki.BATCHING_SCHEME,e.batchingScheme),fr.set(this.handle,Ki.PRIMITIVE,e.primitive),fr.set(this.handle,Ki.DYNAMIC_STATES,e.dynamicStates),this._descriptorSet=e.descriptorSet,fr.set(this.handle,Ki.DESCRIPTOR_SET,fr.get(e.handle,Ki.DESCRIPTOR_SET)),this._bs=n,fr.set(this.handle,Ki.BLEND_STATE,n.handle),this._rs=e.rasterizerState,fr.set(this.handle,Ki.RASTERIZER_STATE,fr.get(e.handle,Ki.RASTERIZER_STATE)),this._dss=t,fr.set(this.handle,Ki.DEPTH_STENCIL_STATE,t.handle),this._passIndex=e.passIndex,this._propertyIndex=e.propertyIndex,this._programName=e.program,this._defines=e.defines,this._shaderInfo=e._shaderInfo,this._properties=e._properties,this._blocks=e._blocks,this._dynamics=e._dynamics,this._hShaderDefault=e._hShaderDefault,fr.set(this._handle,Ki.PIPELINE_LAYOUT,ed.getTemplateInfo(this._programName).hPipelineLayout);var r=fr.get(e.handle,Ki.HASH);fr.set(this._handle,Ki.HASH,r^i)},Z(e,[{key:"root",get:function(){return this._root}},{key:"device",get:function(){return this._device}},{key:"shaderInfo",get:function(){return this._shaderInfo}},{key:"localSetLayout",get:function(){return ed.getDescriptorSetLayout(this._device,this._programName,!0)}},{key:"program",get:function(){return this._programName}},{key:"properties",get:function(){return this._properties}},{key:"defines",get:function(){return this._defines}},{key:"passIndex",get:function(){return this._passIndex}},{key:"propertyIndex",get:function(){return this._propertyIndex}},{key:"dynamics",get:function(){return this._dynamics}},{key:"blocks",get:function(){return this._blocks}},{key:"handle",get:function(){return this._handle}},{key:"priority",get:function(){return fr.get(this._handle,Ki.PRIORITY)}},{key:"primitive",get:function(){return fr.get(this._handle,Ki.PRIMITIVE)}},{key:"stage",get:function(){return fr.get(this._handle,Ki.STAGE)}},{key:"phase",get:function(){return fr.get(this._handle,Ki.PHASE)}},{key:"rasterizerState",get:function(){return this._rs}},{key:"depthStencilState",get:function(){return this._dss}},{key:"blendState",get:function(){return this._bs}},{key:"dynamicStates",get:function(){return fr.get(this._handle,Ki.DYNAMIC_STATES)}},{key:"batchingScheme",get:function(){return fr.get(this._handle,Ki.BATCHING_SCHEME)}},{key:"descriptorSet",get:function(){return this._descriptorSet}},{key:"hash",get:function(){return fr.get(this._handle,Ki.HASH)}},{key:"rootBufferDirty",get:function(){return this._rootBufferDirty}}]),e}());hd.PropertyType=Dm,hd.getPropertyTypeFromHandle=zm,hd.getTypeFromHandle=Bm,hd.getBindingFromHandle=Um,hd.getOffsetFromHandle=Gm,ge(lh.prototype,"RenderScene.prototype",[{name:"raycastUI2DNode"},{name:"raycastUINode"}]),ge(lh.prototype,"RenderScene.prototype",[{name:"raycastAll",suggest:"using intersect.rayModel in geometry"},{name:"raycastAllModels",suggest:"using intersect.rayModel in geometry"},{name:"raycastSingleModel",suggest:"using intersect.rayModel in geometry"},{name:"raycastAllCanvas",suggest:"using intersect.rayAABB in geometry"},{name:"rayResultCanvas"},{name:"rayResultModels"},{name:"rayResultAll"},{name:"rayResultSingleModel"}]);var _d={};ge(_d,"CameraVisFlags",[{name:"GENERAL"}]),ve(_d,"CameraVisFlags",[{name:"PROFILER",newName:"PROFILER",target:Kl.BitMask,targetName:"PROFILER"},{name:"GIZMOS",newName:"GIZMOS",target:Kl.BitMask,targetName:"GIZMOS"},{name:"EDITOR",newName:"EDITOR",target:Kl.BitMask,targetName:"EDITOR"},{name:"UI",newName:"UI",target:Kl.BitMask,targetName:"UI_3D"},{name:"UI2D",newName:"UI2D",target:Kl.BitMask,targetName:"UI_2D"}]),c.CameraVisFlags=_d;var fd,md={};function dd(e,t){t<1e3?t=1e3:t>15e3&&(t=15e3);var n=t*t,i=(.860117757+.000154118254*t+1.28641212e-7*n)/(1+.000842420235*t+7.08145163e-7*n),r=(.317398726+422806245e-13*t+4.20481691e-8*n)/(1-289741816e-13*t+1.61456053e-7*n),o=2*i-8*r+4,a=3*i/o,s=2*r/o,c=1/s*a,l=1/s*(1-a-s);e.x=3.2404542*c-1.5371385+-.4985314*l,e.y=-.969266*c+1.8760108+.041556*l,e.z=.0556434*c-.2040259+1.0572252*l}ge(md,"VisibilityFlags",[{name:"GENERAL"}]),ve(md,"VisibilityFlags",[{name:"ALWALS",newName:"ALWALS",target:Kl.Enum,targetName:"ALWALS"},{name:"PROFILER",newName:"PROFILER",target:Kl.Enum,targetName:"PROFILER"},{name:"GIZMOS",newName:"GIZMOS",target:Kl.Enum,targetName:"GIZMOS"},{name:"EDITOR",newName:"EDITOR",target:Kl.Enum,targetName:"EDITOR"},{name:"UI",newName:"UI",target:Kl.Enum,targetName:"UI_3D"},{name:"UI2D",newName:"UI2D",target:Kl.Enum,targetName:"UI_2D"}]),c.VisibilityFlags=md,ve(hd.prototype,"Pass.prototype",[{name:"getBindingTypeFromHandle",newName:"getDescriptorTypeFromHandle"}]),ge(ch.prototype,"Camera.prototype",[{name:"getSplitFrustum"}]),function(e){e[e.DIRECTIONAL=0]="DIRECTIONAL",e[e.SPHERE=1]="SPHERE",e[e.SPOT=2]="SPOT",e[e.UNKNOWN=3]="UNKNOWN"}(fd||(fd=e("bh",{})));var pd=e("bq",(function(e){return 4*Math.PI*Math.PI*e*e})),vd=e("bi",function(){function e(){this._baked=!1,this._color=new Un(1,1,1),this._colorTemp=6550,this._colorTempRGB=new Un(1,1,1),this._scene=null,this._node=null,this._name=null,this._handle=Qi}var t=e.prototype;return t.initialize=function(){this._handle=ro.alloc(),ro.setVec3(this._handle,eo.COLOR,this._color),ro.setVec3(this._handle,eo.COLOR_TEMPERATURE_RGB,this._colorTempRGB),ro.set(this._handle,eo.TYPE,fd.UNKNOWN)},t.attachToScene=function(e){this._scene=e},t.detachFromScene=function(){this._scene=null},t.destroy=function(){this._name=null,this._node=null,this._handle&&(ro.free(this._handle),this._handle=Qi)},t.update=function(){},Z(e,[{key:"baked",get:function(){return this._baked},set:function(e){this._baked=e}},{key:"color",set:function(e){this._color.set(e),ro.setVec3(this._handle,eo.COLOR,e)},get:function(){return this._color}},{key:"useColorTemperature",set:function(e){ro.set(this._handle,eo.USE_COLOR_TEMPERATURE,e?1:0)},get:function(){return 1===ro.get(this._handle,eo.USE_COLOR_TEMPERATURE)}},{key:"colorTemperature",set:function(e){this._colorTemp=e,dd(this._colorTempRGB,this._colorTemp),ro.setVec3(this._handle,eo.COLOR_TEMPERATURE_RGB,this._colorTempRGB)},get:function(){return this._colorTemp}},{key:"colorTemperatureRGB",get:function(){return this._colorTempRGB}},{key:"node",set:function(e){this._node=e,this._node&&(this._node.hasChangedFlags|=$u.ROTATION,ro.set(this._handle,eo.NODE,this._node.handle))},get:function(){return this._node}},{key:"type",get:function(){return ro.get(this._handle,eo.TYPE)}},{key:"name",get:function(){return this._name},set:function(e){this._name=e}},{key:"scene",get:function(){return this._scene}},{key:"handle",get:function(){return this._handle}}]),e}()),gd=new Un(0,0,-1),yd=new Un,xd=e("bn",function(e){function t(){var t;return(t=e.call(this)||this)._dir=new Un(1,-1,-1),t._shadowRange=1e3,t._shadowIntensity=0,t._shadowFadeDistance=0,t._shadowDistance=0,t._fadeStart=.8,t._splits=new ci(1,0,0,0),t._biasAutoAdjust=1,t}$(t,e),Z(t,[{key:"shadowRange",set:function(e){this._shadowRange=e},get:function(){return this._shadowRange}},{key:"shadowIntensitywRange",set:function(e){this._shadowIntensity=e}},{key:"shadowIntensity",get:function(){return this._shadowIntensity}},{key:"shadowFadeDistance",set:function(e){this._shadowFadeDistance=e},get:function(){return this._shadowFadeDistance}},{key:"shadowDistance",set:function(e){this._shadowDistance=e},get:function(){return this._shadowDistance}},{key:"fadeStart",set:function(e){this._fadeStart=e},get:function(){return this._fadeStart}},{key:"splits",set:function(e){this._splits=e},get:function(){return this._splits}},{key:"biasAutoAdjust",set:function(e){this._biasAutoAdjust=e},get:function(){return this._biasAutoAdjust}},{key:"direction",set:function(e){Un.normalize(this._dir,e),ro.setVec3(this._handle,eo.DIRECTION,this._dir)},get:function(){return this._dir}},{key:"illuminance",set:function(e){ro.set(this._handle,eo.ILLUMINANCE,e)},get:function(){return ro.get(this._handle,eo.ILLUMINANCE)}}]);var n=t.prototype;return n.initialize=function(){e.prototype.initialize.call(this),ro.set(this._handle,eo.ILLUMINANCE,Co.SUN_ILLUM),ro.setVec3(this._handle,eo.DIRECTION,this._dir),ro.set(this._handle,eo.TYPE,fd.DIRECTIONAL)},n.update=function(){this._node&&this._node.hasChangedFlags&&(this.direction=Un.transformQuat(yd,gd,this._node.worldRotation))},t}(vd)),Ed=new js(null),Sd=function(){function e(){this._device=null,this._passes=null,this._subMesh=null,this._patches=null,this._handle=Qi,this._priority=Yl.DEFAULT,this._inputAssembler=null,this._descriptorSet=null}var t=e.prototype;return t.initialize=function(e,t,n){void 0===n&&(n=null),this._device=c.director.root.device,this._subMesh=e,this._patches=n,this._passes=t,this._handle=pr.alloc(),this._flushPassInfo(),t[0].batchingScheme===id.VB_MERGING&&this._subMesh.genFlatBuffers(),Ed.layout=t[0].localSetLayout;var i=Ji.alloc(this._device,Ed),r=$i.alloc(this._device,e.iaInfo);pr.set(this._handle,hr.PRIORITY,Yl.DEFAULT),pr.set(this._handle,hr.INPUT_ASSEMBLER,r),pr.set(this._handle,hr.DESCRIPTOR_SET,i),pr.set(this._handle,hr.SUB_MESH,e.handle),this._inputAssembler=$i.get(r),this._descriptorSet=Ji.get(i)},t.initPlanarShadowShader=function(){var e=c.director.root.pipeline.shadows.getPlanarShader(this._patches);pr.set(this._handle,hr.PLANAR_SHADER,e)},t.destroy=function(){Ji.free(pr.get(this._handle,hr.DESCRIPTOR_SET)),$i.free(pr.get(this._handle,hr.INPUT_ASSEMBLER)),pr.free(this._handle),this._descriptorSet=null,this._inputAssembler=null,this._priority=Yl.DEFAULT,this._handle=Qi,this._patches=null,this._subMesh=null,this._passes=null},t.update=function(){for(var e=0;e<this._passes.length;++e)this._passes[e].update();this._descriptorSet.update()},t.onPipelineStateChanged=function(){var e=this._passes;if(e){for(var t=0;t<e.length;t++){var n=e[t];n.beginChangeStatesSilently(),n.tryCompile(),n.endChangeStatesSilently()}this._flushPassInfo()}},t.onMacroPatchesStateChanged=function(e){this._patches=e;var t=this._passes;if(t){for(var n=0;n<t.length;n++){var i=t[n];i.beginChangeStatesSilently(),i.tryCompile(),i.endChangeStatesSilently()}this._flushPassInfo()}},t._flushPassInfo=function(){var e=this._passes;if(e){pr.set(this._handle,hr.PASS_COUNT,e.length);for(var t=hr.PASS_0,n=hr.SHADER_0,i=0;i<e.length;i++,t++,n++)pr.set(this._handle,t,e[i].handle),pr.set(this._handle,n,e[i].getShaderVariant(this._patches))}},Z(e,[{key:"passes",set:function(e){if(this._passes=e,this._flushPassInfo(),this._descriptorSet){Ji.free(pr.get(this._handle,hr.DESCRIPTOR_SET)),Ed.layout=e[0].localSetLayout;var t=Ji.alloc(this._device,Ed);pr.set(this._handle,hr.DESCRIPTOR_SET,t),this._descriptorSet=Ji.get(t)}},get:function(){return this._passes}},{key:"subMesh",set:function(e){this._subMesh=e,this._inputAssembler.destroy(),this._inputAssembler.initialize(e.iaInfo),this._passes[0].batchingScheme===id.VB_MERGING&&this._subMesh.genFlatBuffers(),pr.set(this._handle,hr.SUB_MESH,e.handle)},get:function(){return this._subMesh}},{key:"priority",set:function(e){this._priority=e,pr.set(this._handle,hr.PRIORITY,e)},get:function(){return this._priority}},{key:"handle",get:function(){return this._handle}},{key:"inputAssembler",get:function(){return this._inputAssembler}},{key:"descriptorSet",get:function(){return this._descriptorSet}},{key:"patches",get:function(){return this._patches}},{key:"planarShaderHandel",get:function(){return pr.get(this._handle,hr.PLANAR_SHADER)}}]),e}(),Td=e("fk",function(){function e(e){this.instances=[],this.pass=void 0,this.hasPendingModels=!1,this.dynamicOffsets=[],this._device=void 0,this._device=e.device,this.pass=e}e.get=function(t,n){void 0===n&&(n=0);var i=e._buffers;i.has(t)||i.set(t,{});var r=i.get(t);return r[n]||(r[n]=new e(t))};var t=e.prototype;return t.destroy=function(){for(var e=0;e<this.instances.length;++e){var t=this.instances[e];t.vb.destroy(),t.ia.destroy()}this.instances.length=0},t.merge=function(e,t,n){var i=t.buffer.length;if(i){for(var r=e.inputAssembler,o=e.descriptorSet.getTexture(Bu),a=pr.get(e.handle,hr.SHADER_0+n),s=pr.get(e.handle,hr.DESCRIPTOR_SET),c=0;c<this.instances.length;++c){var l=this.instances[c];if(!(l.ia.indexBuffer!==r.indexBuffer||l.count>=1024)&&l.lightingMap===o){if(l.stride!==i)return;if(l.count>=l.capacity){l.capacity<<=1;var u=l.stride*l.capacity,h=l.data;l.data=new Uint8Array(u),l.data.set(h),l.vb.resize(u)}return l.hShader!==a&&(l.hShader=a),l.hDescriptorSet!==s&&(l.hDescriptorSet=s),l.data.set(t.buffer,l.stride*l.count++),void(this.hasPendingModels=!0)}}for(var _=this._device.createBuffer(new Wa($o.VERTEX|$o.TRANSFER_DST,ea.HOST|ea.DEVICE,32*i,i)),f=new Uint8Array(32*i),m=r.vertexBuffers.slice(),d=r.attributes.slice(),p=r.indexBuffer,v=0;v<t.attributes.length;v++){var g=t.attributes[v],y=new rs(g.name,g.format,g.isNormalized,m.length,!0);d.push(y)}f.set(t.buffer),m.push(_);var x=new os(d,m,p),E=this._device.createInputAssembler(x);this.instances.push({count:1,capacity:32,vb:_,data:f,ia:E,stride:i,hShader:a,hDescriptorSet:s,lightingMap:o}),this.hasPendingModels=!0}},t.uploadBuffers=function(e){for(var t=0;t<this.instances.length;++t){var n=this.instances[t];n.count&&(n.ia.instanceCount=n.count,e.updateBuffer(n.vb,n.data))}},t.clear=function(){for(var e=0;e<this.instances.length;++e)this.instances[e].count=0;this.hasPendingModels=!1},e}());Td._buffers=new Map;var Ad,Cd=new Wi(Vi.ATTRIBUTE,(function(e,t){return t||new rs})),wd=new ei,Id=new x_((function(){return new Sd}),32),bd=[{name:"CC_RECEIVE_SHADOW",value:!0}];!function(e){e[e.DEFAULT=0]="DEFAULT",e[e.SKINNING=1]="SKINNING",e[e.BAKED_SKINNING=2]="BAKED_SKINNING",e[e.BATCH_2D=3]="BATCH_2D",e[e.PARTICLE_BATCH=4]="PARTICLE_BATCH",e[e.LINE=5]="LINE"}(Ad||(Ad=e("bF",{})));var Rd,Od,Nd,Pd,Md,Dd,Ld,Fd,zd,Bd,Ud,Gd,Hd,kd,Vd,jd,Wd,qd,Yd=rf([_a.LINEAR,_a.LINEAR,_a.NONE,fa.CLAMP,fa.CLAMP,fa.CLAMP]),Xd=rf([_a.LINEAR,_a.LINEAR,_a.LINEAR,fa.CLAMP,fa.CLAMP,fa.CLAMP]),Kd=e("aY",function(){function e(){this.type=Ad.DEFAULT,this.scene=null,this.isDynamicBatching=!1,this.instancedAttributes={buffer:null,views:[],attributes:[]},this._worldBounds=null,this._modelBounds=null,this._subModels=[],this._node=null,this._transform=null,this._device=void 0,this._inited=!1,this._descriptorSetCount=1,this._updateStamp=-1,this._transformUpdated=!0,this._handle=Qi,this._hWorldBounds=Qi,this._localData=new Float32Array(gu.COUNT),this._localBuffer=null,this._instMatWorldIdx=-1,this._lightmap=null,this._lightmapUVParam=new ci,this._device=c.director.root.device}Z(e,[{key:"subModels",get:function(){return this._subModels}},{key:"inited",get:function(){return this._inited}},{key:"worldBounds",get:function(){return this._worldBounds}},{key:"modelBounds",get:function(){return this._modelBounds}},{key:"localBuffer",get:function(){return this._localBuffer}},{key:"updateStamp",get:function(){return this._updateStamp}},{key:"isInstancingEnabled",get:function(){return this._instMatWorldIdx>=0}},{key:"receiveShadow",get:function(){return!!yr.get(this._handle,mr.RECEIVE_SHADOW)},set:function(e){yr.set(this._handle,mr.RECEIVE_SHADOW,e?1:0),this.onMacroPatchesStateChanged()}},{key:"castShadow",get:function(){return!!yr.get(this._handle,mr.CAST_SHADOW)},set:function(e){yr.set(this._handle,mr.CAST_SHADOW,e?1:0)}},{key:"handle",get:function(){return this._handle}},{key:"node",get:function(){return this._node},set:function(e){this._node=e,yr.set(this._handle,mr.NODE,e.handle)}},{key:"transform",get:function(){return this._transform},set:function(e){this._transform=e,yr.set(this._handle,mr.TRANSFORM,e.handle)}},{key:"visFlags",get:function(){return yr.get(this._handle,mr.VIS_FLAGS)},set:function(e){yr.set(this._handle,mr.VIS_FLAGS,e)}},{key:"enabled",get:function(){return!!yr.get(this._handle,mr.ENABLED)},set:function(e){yr.set(this._handle,mr.ENABLED,e?1:0)}}]);var t=e.prototype;return t.initialize=function(){if(!this._inited){this._handle=yr.alloc();var e=nr.alloc(),t=rr.alloc();yr.set(this._handle,mr.INSTANCED_ATTR_ARRAY,t),yr.set(this._handle,mr.SUB_MODEL_ARRAY,e),yr.set(this._handle,mr.VIS_FLAGS,Kl.Enum.NONE),yr.set(this._handle,mr.ENABLED,1),yr.set(this._handle,mr.RECEIVE_SHADOW,1),yr.set(this._handle,mr.CAST_SHADOW,0),this._inited=!0}},t.destroy=function(){for(var e=this._subModels,t=0;t<e.length;t++){var n=this._subModels[t];n.destroy(),Id.free(n)}if(this._localBuffer&&(this._localBuffer.destroy(),this._localBuffer=null),this._worldBounds=null,this._modelBounds=null,this._subModels.length=0,this._inited=!1,this._transformUpdated=!0,this._transform=null,this._node=null,this.isDynamicBatching=!1,this._handle){var i=yr.get(this._handle,mr.SUB_MODEL_ARRAY);i&&nr.free(i);var r=yr.get(this._handle,mr.INSTANCED_BUFFER);r&&lr.free(r);var o=yr.get(this._handle,mr.INSTANCED_ATTR_ARRAY);o&&Xi(o,rr,Cd),yr.free(this._handle),this._handle=Qi}this._hWorldBounds&&(Cr.free(this._hWorldBounds),this._hWorldBounds=Qi)},t.attachToScene=function(e){this.scene=e},t.detachFromScene=function(){this.scene=null},t.updateTransform=function(){var e=this.transform;if(e.hasChangedFlags||e._dirtyFlags){e.updateWorldTransform(),this._transformUpdated=!0;var t=this._worldBounds;this._modelBounds&&t&&(this._modelBounds.transform(e._mat,e._pos,e._rot,e._scale,t),Cr.setVec3(this._hWorldBounds,xr.CENTER,t.center),Cr.setVec3(this._hWorldBounds,xr.HALF_EXTENSION,t.halfExtents))}},t.updateWorldBound=function(){var e=this.transform;if(null!==e){e.updateWorldTransform(),this._transformUpdated=!0;var t=this._worldBounds;this._modelBounds&&t&&(this._modelBounds.transform(e._mat,e._pos,e._rot,e._scale,t),Cr.setVec3(this._hWorldBounds,xr.CENTER,t.center),Cr.setVec3(this._hWorldBounds,xr.HALF_EXTENSION,t.halfExtents))}},t.updateUBOs=function(e){for(var t=this._subModels,n=0;n<t.length;n++)t[n].update();if(this._updateStamp=e,this._transformUpdated){this._transformUpdated=!1;var i=this.transform._mat,r=this._instMatWorldIdx;if(r>=0){var o=this.instancedAttributes.views;!function(e,t,n,i){t[0]=e.m00,t[1]=e.m01,t[2]=e.m02,t[3]=e.m12,n[0]=e.m04,n[1]=e.m05,n[2]=e.m06,n[3]=e.m13,i[0]=e.m08,i[1]=e.m09,i[2]=e.m10,i[3]=e.m14}(i,o[r],o[r+1],o[r+2])}else this._localBuffer&&(ei.toArray(this._localData,i,gu.MAT_WORLD_OFFSET),ei.inverseTranspose(wd,i),ei.toArray(this._localData,wd,gu.MAT_WORLD_IT_OFFSET),this._localBuffer.update(this._localData))}},t.createBoundingShape=function(e,t){e&&t&&(this._modelBounds=gl.fromPoints(gl.create(),e,t),this._worldBounds=gl.clone(this._modelBounds),this._hWorldBounds===Qi&&(this._hWorldBounds=Cr.alloc(),yr.set(this._handle,mr.WORLD_BOUNDS,this._hWorldBounds)),Cr.setVec3(this._hWorldBounds,xr.CENTER,this._worldBounds.center),Cr.setVec3(this._hWorldBounds,xr.HALF_EXTENSION,this._worldBounds.halfExtents))},t.initSubModel=function(e,t,n){this.initialize();var i=!1;if(null==this._subModels[e]?(this._subModels[e]=Id.alloc(),i=!0):this._subModels[e].destroy(),this._subModels[e].initialize(t,n.passes,this.getMacroPatches(e)),this._subModels[e].initPlanarShadowShader(),this._updateAttributesAndBinding(e),i){var r=yr.get(this._handle,mr.SUB_MODEL_ARRAY);nr.assign(r,e,this._subModels[e].handle)}},t.setSubModelMesh=function(e,t){this._subModels[e]&&(this._subModels[e].subMesh=t)},t.setSubModelMaterial=function(e,t){this._subModels[e]&&(this._subModels[e].passes=t.passes,this._updateAttributesAndBinding(e))},t.onGlobalPipelineStateChanged=function(){for(var e=this._subModels,t=0;t<e.length;t++)e[t].onPipelineStateChanged()},t.onMacroPatchesStateChanged=function(){for(var e=this._subModels,t=0;t<e.length;t++)e[t].onMacroPatchesStateChanged(this.getMacroPatches(t))},t.updateLightingmap=function(e,t){ci.toArray(this._localData,t,gu.LIGHTINGMAP_UVPARAM),this._lightmap=e,this._lightmapUVParam=t,null===e&&(e=ad.get("empty-texture"));var n=e.getGFXTexture();if(n)for(var i=gf.getSampler(this._device,e.mipmaps.length>1?Xd:Yd),r=this._subModels,o=0;o<r.length;o++){var a=r[o].descriptorSet;a.bindTexture(Bu,n),a.bindSampler(Bu,i),a.update()}},t.getMacroPatches=function(){return this.receiveShadow?bd:null},t._updateAttributesAndBinding=function(e){var t=this._subModels[e];if(t){this._initLocalDescriptors(e),this._updateLocalDescriptors(e,t.descriptorSet);var n=Zi.get(pr.get(t.handle,hr.SHADER_0));this._updateInstancedAttributes(n.attributes,t.passes[0])}},t._getInstancedAttributeIndex=function(e){for(var t=this.instancedAttributes.attributes,n=0;n<t.length;n++)if(t[n].name===e)return n;return-1},t._updateInstancedAttributes=function(e,t){if(t.device.hasFeature(Pa.INSTANCED_ARRAYS)){var n=yr.get(this._handle,mr.INSTANCED_BUFFER);n&&lr.free(n);var i=yr.get(this._handle,mr.INSTANCED_ATTR_ARRAY);i&&Xi(i,rr,Cd,!1);for(var r=0,o=0;o<e.length;o++){var a=e[o];a.isInstanced&&(r+=Fa[a.format].size)}var s=lr.alloc(r),c=lr.getBuffer(s);yr.set(this._handle,mr.INSTANCED_BUFFER,s);var l=this.instancedAttributes;l.buffer=new Uint8Array(c),l.views.length=l.attributes.length=0;for(var u=0,h=0;h<e.length;h++){var _=e[h];if(_.isInstanced){var f=Cd.alloc(),m=Cd.get(f);m.format=_.format,m.name=_.name,m.isNormalized=_.isNormalized,m.location=_.location,l.attributes.push(m),rr.push(i,f);var d=Fa[_.format];l.views.push(new(Ha(d))(c,u,d.count)),u+=d.size}}t.batchingScheme===id.INSTANCING&&Td.get(t).destroy(),this._instMatWorldIdx=this._getInstancedAttributeIndex("a_matWorld0"),this._transformUpdated=!0}},t._initLocalDescriptors=function(){this._localBuffer||(this._localBuffer=this._device.createBuffer(new Wa($o.UNIFORM|$o.TRANSFER_DST,ea.HOST|ea.DEVICE,gu.SIZE,gu.SIZE)))},t._updateLocalDescriptors=function(e,t){this._localBuffer&&t.bindBuffer(gu.BINDING,this._localBuffer)},e}()),Qd=e("du",vh("cc.EffectAsset")((Fd=Ld=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ae(t=e.call.apply(e,[this].concat(i))||this,"techniques",Nd,ie(t)),ae(t,"shaders",Pd,ie(t)),ae(t,"combinations",Md,ie(t)),ae(t,"hideInEditor",Dd,ie(t)),t}$(t,e),t.register=function(e){t._effects[e.name]=e},t.remove=function(e){if(t._effects[e])delete t._effects[e];else for(var n in t._effects)if(t._effects[n]._uuid===e)return void delete t._effects[n]},t.get=function(e){if(t._effects[e])return t._effects[e];for(var n in t._effects)if(t._effects[n]._uuid===e)return t._effects[n];return null},t.getAll=function(){return t._effects};var n=t.prototype;return n.onLoaded=function(){ed.register(this),t.register(this),c.game.once(c.Game.EVENT_ENGINE_INITED,this._precompile,this)},n._precompile=function(){for(var e=this,t=c.director.root,n=function(n){var i=e.shaders[n],r=e.combinations[n];if(!r)return"continue";Object.keys(r).reduce((function(e,t){return e.reduce((function(e,n){var i=r[t],o=[n].concat([].concat(Array(i.length-1)).map((function(){return J({},n)})));return o.forEach((function(e,n){return e[t]=i[n]})),e.concat(o)}),[])}),[{}]).forEach((function(e){return ed.getGFXShader(t.device,i.name,e,t.pipeline)}))},i=0;i<this.shaders.length;i++)n(i)},n.destroy=function(){return t.remove(this.name),e.prototype.destroy.call(this)},t}(H_),Ld._effects={},Nd=se((Od=Fd).prototype,"techniques",[Sh,Nh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Pd=se(Od.prototype,"shaders",[Sh,Nh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Md=se(Od.prototype,"combinations",[Sh,Nh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Dd=se(Od.prototype,"hideInEditor",[Sh,Th],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Rd=Od))||Rd);c.EffectAsset=Qd;var Zd=new Ne("RenderTex"),Jd=new As;Jd.endLayout=Ta.SHADER_READONLY_OPTIMAL;var $d,ep,tp,np,ip,rp,op,ap,sp,cp,lp=new Cs,up=new Is([Jd],lp),hp={width:1,height:1,renderPassInfo:up},_p=e("ej",(zd=vh("cc.RenderTexture"),Bd=Fh(),Ud=zh(),Gd=Fh(),Hd=zh(),zd((qd=function(e){function t(){var t;return ae(t=e.call(this)||this,"_width",jd,ie(t)),ae(t,"_height",Wd,ie(t)),t._textureHash=0,t._id=void 0,t._window=null,t._id=Zd.getNewId(),t._textureHash=is(t._id,666),t}$(t,e);var n=t.prototype;return n.getHash=function(){return this._textureHash},n.initialize=function(e){this._name=e.name||"",this._width=e.width,this._height=e.height,this._initWindow(e)},n.reset=function(e){this.initialize(e)},n.destroy=function(){return this._window&&(c.director.root.destroyWindow(this._window),this._window=null),e.prototype.destroy.call(this)},n.resize=function(e,t){this._width=e,this._height=t,this._window&&this._window.resize(e,t),this.emit("resize",this._window)},n.getGFXTexture=function(){return this._window&&this._window.framebuffer.colorTextures[0]},n.getGFXSampler=function(){var e=c.director.root;return gf.getSampler(e.device,ef)},n.getSamplerHash=function(){return ef},n.onLoaded=function(){this._initWindow(),this.loaded=!0,this.emit("load")},n._initWindow=function(e){var t=c.director.root;hp.title=this._name,hp.width=this._width,hp.height=this._height,hp.renderPassInfo=e&&e.passInfo?e.passInfo:up,this._window?(this._window.destroy(),this._window.initialize(t.device,hp)):this._window=t.createWindow(hp)},Z(t,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"window",get:function(){return this._window}}]),t}(H_),jd=se((Vd=qd).prototype,"_width",[Sh,Bd,Ud],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Wd=se(Vd.prototype,"_height",[Sh,Gd,Hd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),kd=Vd))||kd));c.RenderTexture=_p;var fp=e("bK",($d=vh("cc.Material"),ep=qh(Qd),$d((cp=function(e){function t(){var t;return ae(t=e.call(this)||this,"_effectAsset",ip,ie(t)),ae(t,"_techIdx",rp,ie(t)),ae(t,"_defines",op,ie(t)),ae(t,"_states",ap,ie(t)),ae(t,"_props",sp,ie(t)),t._passes=[],t._hash=0,t.loaded=!1,t}$(t,e),t.getHash=function(e){for(var t,n=0,i=oe(e.passes);!(t=i()).done;)n^=t.value.hash;return n};var n=t.prototype;return n.initialize=function(e){this._defines||(this._defines=[]),this._states||(this._states=[]),this._props||(this._props=[]),void 0!==e.technique&&(this._techIdx=e.technique),e.effectAsset?this._effectAsset=e.effectAsset:e.effectName&&(this._effectAsset=Qd.get(e.effectName)),e.defines&&this._prepareInfo(e.defines,this._defines),e.states&&this._prepareInfo(e.states,this._states),this._update()},n.reset=function(e){this.initialize(e)},n.destroy=function(){return this._doDestroy(),e.prototype.destroy.call(this)},n.recompileShaders=function(){console.warn("Shaders in material asset '"+this.name+"' cannot be modified at runtime, please instantiate the material first.")},n.overridePipelineStates=function(){console.warn("Pipeline states in material asset '"+this.name+"' cannot be modified at runtime, please instantiate the material first.")},n.onLoaded=function(){this._update(),this.loaded=!0,this.emit("load")},n.resetUniforms=function(e){void 0===e&&(e=!0),this._props.length=this._passes.length;for(var t=0;t<this._props.length;t++)this._props[t]={};if(e)for(var n,i=oe(this._passes);!(n=i()).done;){var r=n.value;r.resetUBOs(),r.resetTextures()}},n.setProperty=function(e,t,n){var i=!1;if(void 0===n)for(var r=this._passes,o=r.length,a=0;a<o;a++){var s=r[a];this._uploadProperty(s,e,t)&&(this._props[s.propertyIndex][e]=t,i=!0)}else{if(n>=this._passes.length)return void console.warn("illegal pass index: "+n+".");var c=this._passes[n];this._uploadProperty(c,e,t)&&(this._props[c.propertyIndex][e]=t,i=!0)}i||console.warn("illegal property name: "+e+".")},n.getProperty=function(e,t){if(void 0===t)for(var n=this._props,i=n.length,r=0;r<i;r++){var o=n[r];if(e in o)return o[e]}else{if(t>=this._props.length)return console.warn("illegal pass index: "+t+"."),null;var a=this._props[this._passes[t].propertyIndex];if(e in a)return a[e]}return null},n.copy=function(e){this._techIdx=e._techIdx,this._props.length=e._props.length;for(var t=0;t<e._props.length;t++)this._props[t]=J({},e._props[t]);this._defines.length=e._defines.length;for(var n=0;n<e._defines.length;n++)this._defines[n]=J({},e._defines[n]);this._states.length=e._states.length;for(var i=0;i<e._states.length;i++)this._states[i]=J({},e._states[i]);this._effectAsset=e._effectAsset,this._update()},n._prepareInfo=function(e,t){var n=e;if(!Array.isArray(n)){var i=this._effectAsset?this._effectAsset.techniques[this._techIdx].passes.length:1;n=Array(i).fill(n)}for(var r=0;r<n.length;++r)Object.assign(t[r]||(t[r]={}),n[r])},n._createPasses=function(){var e=this._effectAsset.techniques[this._techIdx||0];if(!e)return[];for(var t=e.passes.length,n=[],i=0;i<t;++i){var r=e.passes[i],o=r.passIndex=i,a=r.defines=this._defines[o]||(this._defines[o]={}),s=r.stateOverrides=this._states[o]||(this._states[o]={});if(void 0!==r.propertyIndex&&(Object.assign(a,this._defines[r.propertyIndex]),Object.assign(s,this._states[r.propertyIndex])),void 0!==r.embeddedMacros&&Object.assign(a,r.embeddedMacros),!r.switch||a[r.switch]){var l=new hd(c.director.root);l.initialize(r),n.push(l)}}return n},n._update=function(e){var n=this;if(void 0===e&&(e=!0),this._effectAsset){if(this._passes&&this._passes.length)for(var i,r=oe(this._passes);!(i=r()).done;)i.value.destroy();this._passes=this._createPasses();var o=this._effectAsset.techniques[this._techIdx].passes.length;if(this._props.length=o,e)this._passes.forEach((function(e,t){var i=n._props[t];for(var r in i||(i=n._props[t]={}),void 0!==e.propertyIndex&&Object.assign(i,n._props[e.propertyIndex]),i)n._uploadProperty(e,r,i[r])}));else for(var a=0;a<this._props.length;a++)this._props[a]={}}else{var s=ad.get("missing-effect-material");s&&(this._passes=s._passes.slice())}this._hash=t.getHash(this)},n._uploadProperty=function(e,t,n){var i=e.getHandle(t);if(!i)return!1;var r=hd.getPropertyTypeFromHandle(i);if(r===Dm.UBO)Array.isArray(n)?e.setUniformArray(i,n):null!==n?e.setUniform(i,n):e.resetUniform(t);else if(r===Dm.SAMPLER)if(Array.isArray(n))for(var o=0;o<n.length;o++)this._bindTexture(e,i,n[o],o);else n?this._bindTexture(e,i,n):e.resetTexture(t);return!0},n._bindTexture=function(e,t,n,i){var r=hd.getBindingFromHandle(t);if(n instanceof Gs)e.bindTexture(r,n,i);else if(n instanceof xf||n instanceof _p){var o=n.getGFXTexture();if(!o||!o.width||!o.height)return;e.bindTexture(r,o,i),e.bindSampler(r,n.getGFXSampler(),i)}},n._doDestroy=function(){if(this._passes&&this._passes.length)for(var e,t=oe(this._passes);!(e=t()).done;)e.value.destroy();this._effectAsset=null,this._passes.length=0,this._props.length=0,this._defines.length=0,this._states.length=0},Z(t,[{key:"effectAsset",get:function(){return this._effectAsset}},{key:"effectName",get:function(){return this._effectAsset?this._effectAsset.name:""}},{key:"technique",get:function(){return this._techIdx}},{key:"passes",get:function(){return this._passes}},{key:"hash",get:function(){return this._hash}},{key:"parent",get:function(){return null}},{key:"owner",get:function(){return null}}]),t}(H_),ip=se((np=cp).prototype,"_effectAsset",[ep],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),rp=se(np.prototype,"_techIdx",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),op=se(np.prototype,"_defines",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ap=se(np.prototype,"_states",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),sp=se(np.prototype,"_props",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),tp=np))||tp));c.Material=fp;var mp=xt({Planar:0,ShadowMap:1}),dp=xt({HARD:0,FILTER_X5:1,FILTER_X9:2,FILTER_X25:3}),pp=mp.ShadowMap+1,vp=function(){function e(){this.sphere=new Yo(0,0,0,.01),this.maxReceived=4,this._normal=new Un(0,1,0),this._shadowColor=new zn(0,0,0,76),this._matLight=new ei,this._material=null,this._instancingMaterial=null,this._size=new ri(512,512),this._handle=Qi,this._handle=to.alloc()}Z(e,[{key:"enabled",get:function(){return!!to.get(this._handle,Zr.ENABLE)},set:function(e){to.set(this._handle,Zr.ENABLE,e?1:0),e||to.set(this._handle,Zr.TYPE,pp),this.activate()}},{key:"normal",get:function(){return this._normal},set:function(e){Un.copy(this._normal,e),to.setVec3(this._handle,Zr.NORMAL,this._normal)}},{key:"distance",get:function(){return to.get(this._handle,Zr.DISTANCE)},set:function(e){to.set(this._handle,Zr.DISTANCE,e)}},{key:"shadowColor",get:function(){return this._shadowColor},set:function(e){this._shadowColor=e,to.setVec4(this._handle,Zr.COLOR,e)}},{key:"type",get:function(){return to.get(this._handle,Zr.TYPE)},set:function(e){to.set(this._handle,Zr.TYPE,this.enabled?e:pp),this.activate()}},{key:"near",get:function(){return to.get(this._handle,Zr.NEAR)},set:function(e){to.set(this._handle,Zr.NEAR,e)}},{key:"far",get:function(){return to.get(this._handle,Zr.FAR)},set:function(e){to.set(this._handle,Zr.FAR,e)}},{key:"aspect",get:function(){return to.get(this._handle,Zr.ASPECT)},set:function(e){to.set(this._handle,Zr.ASPECT,e)}},{key:"orthoSize",get:function(){return to.get(this._handle,Zr.ORTHO_SIZE)},set:function(e){to.set(this._handle,Zr.ORTHO_SIZE,e)}},{key:"size",get:function(){return this._size},set:function(e){this._size=e,to.setVec2(this._handle,Zr.SIZE,this._size)}},{key:"pcf",get:function(){return to.get(this._handle,Zr.PCF_TYPE)},set:function(e){to.set(this._handle,Zr.PCF_TYPE,e)}},{key:"shadowMapDirty",get:function(){return!!to.get(this._handle,Zr.SHADOW_MAP_DIRTY)},set:function(e){to.set(this._handle,Zr.SHADOW_MAP_DIRTY,e?1:0)}},{key:"bias",get:function(){return to.get(this._handle,Zr.BIAS)},set:function(e){to.set(this._handle,Zr.BIAS,e)}},{key:"autoAdapt",get:function(){return!!to.get(this._handle,Zr.AUTO_ADAPT)},set:function(e){to.set(this._handle,Zr.AUTO_ADAPT,e?1:0)}},{key:"matLight",get:function(){return this._matLight}},{key:"material",get:function(){return this._material}},{key:"instancingMaterial",get:function(){return this._instancingMaterial}},{key:"handle",get:function(){return this._handle}}]);var t=e.prototype;return t.getPlanarShader=function(e){return this._material||(this._material=new fp,this._material.initialize({effectName:"planar-shadow"}),to.set(this._handle,Zr.PLANAR_PASS,this._material.passes[0].handle)),this._material.passes[0].getShaderVariant(e)},t.initialize=function(e){to.set(this._handle,Zr.TYPE,e.enabled?e.type:pp),to.set(this._handle,Zr.NEAR,e.near),to.set(this._handle,Zr.FAR,e.far),to.set(this._handle,Zr.ASPECT,e.aspect),to.set(this._handle,Zr.ORTHO_SIZE,e.orthoSize),this._size=e.shadowMapSize,to.setVec2(this._handle,Zr.SIZE,this._size),to.set(this._handle,Zr.PCF_TYPE,e.pcf),Un.copy(this._normal,e.normal),to.setVec3(this._handle,Zr.NORMAL,this._normal),to.set(this._handle,Zr.DISTANCE,e.distance),this._shadowColor.set(e.shadowColor),to.setVec4(this._handle,Zr.COLOR,this._shadowColor),to.set(this._handle,Zr.BIAS,e.bias),to.set(this._handle,Zr.ENABLE,e.enabled?1:0),this.maxReceived=e.maxReceived,to.set(this._handle,Zr.AUTO_ADAPT,e.autoAdapt?1:0)},t.activate=function(){if(this.enabled)this.type===mp.ShadowMap?this._updatePipeline():this._updatePlanarInfo();else{var e=c.director.root;e.pipeline.macros.CC_RECEIVE_SHADOW=0,e.onGlobalPipelineStateChanged()}},t._updatePlanarInfo=function(){this._material||(this._material=new fp,this._material.initialize({effectName:"planar-shadow"}),to.set(this._handle,Zr.PLANAR_PASS,this._material.passes[0].handle)),this._instancingMaterial||(this._instancingMaterial=new fp,this._instancingMaterial.initialize({effectName:"planar-shadow",defines:{USE_INSTANCING:!0}}),to.set(this._handle,Zr.INSTANCE_PASS,this._instancingMaterial.passes[0].handle));var e=c.director.root;e.pipeline.macros.CC_RECEIVE_SHADOW=0,e.onGlobalPipelineStateChanged()},t._updatePipeline=function(){var e=c.director.root;e.pipeline.macros.CC_RECEIVE_SHADOW=1,e.onGlobalPipelineStateChanged()},t.destroy=function(){this._material&&this._material.destroy(),this._instancingMaterial&&this._instancingMaterial.destroy(),this._handle&&(to.free(this._handle),this._handle=Qi),this.sphere.destroy()},e}();vp.MAX_FAR=2e3,vp.COEFFICIENT_OF_EXPANSION=2*Math.sqrt(3),c.Shadows=vp;var gp=function(e){function t(t,n){var i;(i=e.call(this,t.root)||this)._parent=void 0,i._owner=void 0,i._dontNotify=!1,i._parent=t,i._owner=n,i._doInit(i._parent,!0);for(var r=0;r<i._shaderInfo.blocks.length;r++){var o=i._shaderInfo.blocks[r],a=i._blocks[o.binding],s=i._parent.blocks[o.binding];a.set(s)}i._rootBufferDirty=!0;for(var c=i._parent,l=0;l<i._shaderInfo.samplers.length;l++)for(var u=i._shaderInfo.samplers[l],h=0;h<u.count;h++){var _=c._descriptorSet.getSampler(u.binding,h),f=c._descriptorSet.getTexture(u.binding,h);i._descriptorSet.bindSampler(u.binding,_,h),i._descriptorSet.bindTexture(u.binding,f,h)}return e.prototype.tryCompile.call(ie(i)),i}$(t,e),Z(t,[{key:"parent",get:function(){return this._parent}}]);var n=t.prototype;return n.overridePipelineStates=function(e,t){this._bs.reset(),this._rs.reset(),this._dss.reset(),hd.fillPipelineInfo(this,e),hd.fillPipelineInfo(this,t),this._onStateChange()},n.tryCompile=function(t){if(t&&!qm(this._defines,t))return!1;var n=e.prototype.tryCompile.call(this);return this._onStateChange(),n},n.beginChangeStatesSilently=function(){this._dontNotify=!0},n.endChangeStatesSilently=function(){this._dontNotify=!1},n._syncBatchingScheme=function(){this._defines.USE_BATCHING=this._defines.USE_INSTANCING=!1,fr.set(this._handle,Ki.BATCHING_SCHEME,0)},n._onStateChange=function(){fr.set(this._handle,Ki.HASH,hd.getPassHash(this,this._hShaderDefault)),this._owner.onPassStateChange(this._dontNotify)},t}(hd),yp=e("c9",function(e){function t(t){var n;return(n=e.call(this)||this)._passes=[],n._parent=void 0,n._owner=void 0,n._subModelIdx=0,n._parent=t.parent,n._owner=t.owner||null,n._subModelIdx=t.subModelIdx||0,n.copy(n._parent),n}$(t,e),Z(t,[{key:"parent",get:function(){return this._parent}},{key:"owner",get:function(){return this._owner}}]);var n=t.prototype;return n.recompileShaders=function(e,t){if(this._passes&&this.effectAsset)if(void 0===t)for(var n,i=oe(this._passes);!(n=i()).done;)n.value.tryCompile(e);else this._passes[t].tryCompile(e)},n.overridePipelineStates=function(e,t){if(this._passes&&this.effectAsset){var n=this.effectAsset.techniques[this.technique].passes;if(void 0===t)for(var i=0;i<this._passes.length;i++){var r=this._passes[i],o=this._states[i]||(this._states[i]={});for(var a in e)o[a]=e[a];r.overridePipelineStates(n[r.passIndex],o)}else{var s=this._states[t]||(this._states[t]={});for(var c in e)s[c]=e[c];this._passes[t].overridePipelineStates(n[t],s)}}},n.destroy=function(){return this._doDestroy(),!0},n.onPassStateChange=function(e){this._hash=fp.getHash(this),!e&&this._owner&&this._owner._onRebuildPSO(this._subModelIdx,this)},n._createPasses=function(){var e=[],t=this._parent.passes;if(!t)return e;for(var n=0;n<t.length;++n)e.push(new gp(t[n],this));return e},t}(fp)),xp=null,Ep=null,Sp=function(){function e(){this._envmap=null,this._globalDescriptorSet=null,this._model=null,this._default=null,this._handle=Qi,this._handle=Kr.alloc()}Z(e,[{key:"model",get:function(){return this._model}},{key:"enabled",get:function(){return Kr.get(this._handle,Wr.ENABLE)},set:function(e){e?this.activate():this._updatePipeline(),Kr.set(this._handle,Wr.ENABLE,e?1:0)}},{key:"useIBL",get:function(){return Kr.get(this._handle,Wr.USE_IBL)},set:function(e){Kr.set(this._handle,Wr.USE_IBL,e?1:0),this._updatePipeline()}},{key:"isRGBE",get:function(){return Kr.get(this._handle,Wr.IS_RGBE)},set:function(e){e&&(Ep&&Ep.recompileShaders({USE_RGBE_CUBEMAP:e}),this._model&&this._model.setSubModelMaterial(0,Ep)),Kr.set(this._handle,Wr.IS_RGBE,e?1:0),this._updatePipeline()}},{key:"envmap",get:function(){return this._envmap},set:function(e){this._envmap=e||this._default,this._envmap&&(c.director.root.pipeline.ambient.albedoArray[3]=this._envmap.mipmapLevel,this._updateGlobalBinding())}},{key:"handle",get:function(){return this._handle}}]);var t=e.prototype;return t.initialize=function(e){Kr.set(this._handle,Wr.ENABLE,e.enabled?1:0),Kr.set(this._handle,Wr.USE_IBL,e.useIBL?1:0),Kr.set(this._handle,Wr.IS_RGBE,e.isRGBE?1:0),this._envmap=e.envmap},t.activate=function(){var e=c.director.root.pipeline;if(this._globalDescriptorSet=e.descriptorSet,this._default=ad.get("default-cube-texture"),this._model||(this._model=c.director.root.createModel(c.renderer.scene.Model),this._model._initLocalDescriptors=function(){}),Kr.set(this._handle,Wr.MODEL,this._model.handle),this._envmap||(this._envmap=this._default),e.ambient.groundAlbedo[3]=this._envmap.mipmapLevel,Ep)Ep.recompileShaders({USE_RGBE_CUBEMAP:this.isRGBE});else{var t=new fp;t.initialize({effectName:"skybox",defines:{USE_RGBE_CUBEMAP:this.isRGBE}}),Ep=new yp({parent:t})}this.enabled&&(xp||(xp=c.utils.createMesh(c.primitives.box({width:2,height:2,length:2}))),this._model.initSubModel(0,xp.renderingSubMeshes[0],Ep)),this._updateGlobalBinding(),this._updatePipeline()},t._updatePipeline=function(){var e=this.useIBL?this.isRGBE?2:1:0,t=c.director.root,n=t.pipeline;n.macros.CC_USE_IBL!==e&&(n.macros.CC_USE_IBL=e,t.onGlobalPipelineStateChanged())},t._updateGlobalBinding=function(){var e=this.envmap.getGFXTexture(),t=gf.getSampler(c.director._device,this.envmap.getSamplerHash());this._globalDescriptorSet.bindSampler(_u,t),this._globalDescriptorSet.bindTexture(_u,e)},t.destroy=function(){this._handle&&(Kr.free(this._handle),this._handle=Qi)},e}();c.Skybox=Sp;var Tp,Ap,Cp=e("bp",function(e){function t(){var t;return(t=e.call(this)||this)._needUpdate=!1,t._pos=void 0,t._aabb=void 0,t._hAABB=Qi,t._aabb=gl.create(),t._pos=new Un,t}$(t,e),Z(t,[{key:"position",get:function(){return this._pos}},{key:"size",set:function(e){ro.set(this._handle,eo.SIZE,e)},get:function(){return ro.get(this._handle,eo.SIZE)}},{key:"range",set:function(e){ro.set(this._handle,eo.RANGE,e),this._needUpdate=!0},get:function(){return ro.get(this._handle,eo.RANGE)}},{key:"luminance",set:function(e){ro.set(this._handle,eo.ILLUMINANCE,e)},get:function(){return ro.get(this._handle,eo.ILLUMINANCE)}},{key:"aabb",get:function(){return this._aabb}}]);var n=t.prototype;return n.initialize=function(){e.prototype.initialize.call(this),this._hAABB=Cr.alloc(),ro.set(this._handle,eo.TYPE,fd.SPHERE),ro.set(this._handle,eo.SIZE,.15),ro.set(this._handle,eo.RANGE,1),ro.set(this._handle,eo.AABB,this._hAABB),ro.set(this._handle,eo.ILLUMINANCE,1700/pd(.15))},n.update=function(){if(this._node&&(this._node.hasChangedFlags||this._needUpdate)){this._node.getWorldPosition(this._pos);var e=ro.get(this._handle,eo.RANGE);gl.set(this._aabb,this._pos.x,this._pos.y,this._pos.z,e,e,e),this._needUpdate=!1,ro.setVec3(this._handle,eo.POSITION,this._pos),Cr.setVec3(this._hAABB,xr.CENTER,this._aabb.center),Cr.setVec3(this._hAABB,xr.HALF_EXTENSION,this._aabb.halfExtents)}},n.destroy=function(){return this._hAABB&&(Cr.free(this._hAABB),this._hAABB=Qi),e.prototype.destroy.call(this)},t}(vd)),wp=new Un(0,0,-1),Ip=new qn,bp=new ei,Rp=new ei,Op=new ei,Np=new ei,Pp=e("br",function(e){function t(){var t;return(t=e.call(this)||this)._dir=new Un(1,-1,-1),t._range=5,t._spotAngle=Math.cos(Math.PI/6),t._pos=void 0,t._aabb=void 0,t._frustum=void 0,t._angle=0,t._needUpdate=!1,t._hAABB=Qi,t._hFrustum=Qi,t._aabb=gl.create(),t._frustum=bl.create(),t._pos=new Un,t}$(t,e),Z(t,[{key:"position",get:function(){return this._pos}},{key:"size",set:function(e){ro.set(this._handle,eo.SIZE,e)},get:function(){return ro.get(this._handle,eo.SIZE)}},{key:"range",set:function(e){this._range=e,ro.set(this._handle,eo.RANGE,e),this._needUpdate=!0},get:function(){return ro.get(this._handle,eo.RANGE)}},{key:"luminance",set:function(e){ro.set(this._handle,eo.ILLUMINANCE,e)},get:function(){return ro.get(this._handle,eo.ILLUMINANCE)}},{key:"direction",get:function(){return this._dir}},{key:"spotAngle",get:function(){return ro.get(this._handle,eo.SPOT_ANGLE)},set:function(e){this._angle=e,ro.set(this._handle,eo.SPOT_ANGLE,Math.cos(.5*e)),this._needUpdate=!0}},{key:"aspect",set:function(e){ro.set(this._handle,eo.ASPECT,e),this._needUpdate=!0},get:function(){return ro.get(this._handle,eo.ASPECT)}},{key:"aabb",get:function(){return this._aabb}},{key:"frustum",get:function(){return this._frustum}}]);var n=t.prototype;return n.initialize=function(){e.prototype.initialize.call(this),this._hAABB=Cr.alloc(),this._hFrustum=Vr.alloc(),ro.set(this._handle,eo.TYPE,fd.SPOT),ro.set(this._handle,eo.SIZE,.15),ro.set(this._handle,eo.AABB,this._hAABB),ro.set(this._handle,eo.ILLUMINANCE,1700/pd(.15)),ro.set(this._handle,eo.RANGE,Math.cos(Math.PI/6)),ro.set(this._handle,eo.ASPECT,1),ro.setVec3(this._handle,eo.DIRECTION,this._dir)},n.update=function(){this._node&&(this._node.hasChangedFlags||this._needUpdate)&&(this._node.getWorldPosition(this._pos),Un.transformQuat(this._dir,wp,this._node.getWorldRotation(Ip)),Un.normalize(this._dir,this._dir),ro.setVec3(this._handle,eo.DIRECTION,this._dir),gl.set(this._aabb,this._pos.x,this._pos.y,this._pos.z,this._range,this._range,this._range),this._node.getWorldRT(bp),ei.invert(bp,bp),ei.perspective(Rp,this._angle,1,.001,this._range),ei.multiply(Op,Rp,bp),this._frustum.update(Op,Np),this._needUpdate=!1,ro.setVec3(this._handle,eo.POSITION,this._pos),Cr.setVec3(this._hAABB,xr.CENTER,this._aabb.center),Cr.setVec3(this._hAABB,xr.HALF_EXTENSION,this._aabb.halfExtents),Rl(this._hFrustum,this._frustum))},n.destroy=function(){return this._hAABB&&(Cr.free(this._hAABB),this._hAABB=Qi),this._hFrustum&&(Vr.free(this._hFrustum),this._hFrustum=Qi),e.prototype.destroy.call(this)},t}(vd)),Mp=Object.freeze({__proto__:null,Ambient:Co,get CameraFOVAxis(){return ju},get CameraProjection(){return Wu},get CameraAperture(){return qu},get CameraISO(){return Yu},get CameraShutter(){return Xu},SKYBOX_FLAG:ah,Camera:ch,CameraVisFlags:_d,VisibilityFlags:md,DirectionalLight:xd,ColorTemperatureToRGB:dd,get LightType(){return fd},nt2lm:pd,Light:vd,get ModelType(){return Ad},Model:Kd,ShadowType:mp,PCFType:dp,Shadows:vp,RenderScene:lh,Skybox:Sp,SphereLight:Cp,SpotLight:Pp,SubModel:Sd});function Dp(e){return--e,e|=e>>16,e|=e>>8,e|=e>>4,e|=e>>2,e|=e>>1,++e}function Lp(e,t){return Math.ceil(e/t)*t}!function(e){e[e.OPAQUE=0]="OPAQUE",e[e.TRANSPARENT=1]="TRANSPARENT",e[e.OVERLAY=2]="OVERLAY"}(Tp||(Tp={})),function(e){e[e.DEFAULT=1]="DEFAULT",e[e.FORWARD=2]="FORWARD",e[e.SHADOWCAST=4]="SHADOWCAST"}(Ap||(Ap={}));var Fp=e("bv",function(){function e(e){this._device=void 0,this._format=Jo.UNKNOWN,this._formatSize=0,this._chunks=[],this._chunkCount=0,this._handles=[],this._region0=new ms,this._region1=new ms,this._region2=new ms,this._roundUpFn=null,this._bufferViewCtor=Uint8Array,this._channels=4,this._alignment=1,this._device=e}var t=e.prototype;return t.initialize=function(e){var t=Fa[e.format];this._format=e.format,this._formatSize=t.size,this._channels=t.count,this._bufferViewCtor=Ha(t),this._roundUpFn=e.roundUpFn||null,this._alignment=e.alignment||1,e.inOrderFree&&(this.alloc=this._McDonaldAlloc)},t.destroy=function(){for(var e=0;e<this._chunkCount;++e)this._chunks[e].texture.destroy();this._chunks.length=0,this._handles.length=0},t.alloc=function(e,t){e=Lp(e,this._alignment);var n=-1,i=-1;if(void 0!==t&&(n=t,i=this._findAvailableSpace(e,n)),i<0)for(var r=0;r<this._chunkCount&&(n=r,!((i=this._findAvailableSpace(e,n))>=0));++r);if(i>=0){var o=this._chunks[n];o.start+=e;var a={chunkIdx:n,start:i,end:i+e,texture:o.texture};return this._handles.push(a),a}var s=Math.sqrt(e/this._formatSize),c=this._roundUpFn&&this._roundUpFn(s,this._formatSize)||Math.max(1024,Dp(s)),l=this._chunks[this.createChunk(c)];l.start+=e;var u={chunkIdx:this._chunkCount-1,start:0,end:e,texture:l.texture};return this._handles.push(u),u},t.free=function(e){for(var t=0;t<this._handles.length;++t)if(this._handles[t]===e)return this._chunks[e.chunkIdx].end=e.end,void this._handles.splice(t,1)},t.createChunk=function(e){var t=e*e*this._formatSize;console.info("TextureBufferPool: Allocate chunk "+this._chunkCount+", size: "+t+", format: "+this._format);var n={texture:this._device.createTexture(new zs(ma.TEX2D,da.SAMPLED|da.TRANSFER_DST,this._format,e,e,va.IMMUTABLE)),size:t,start:0,end:t};return this._chunks[this._chunkCount]=n,this._chunkCount++},t.update=function(e,t){var n=[],i=[],r=e.start/this._formatSize,o=t.byteLength/this._formatSize,a=r%e.texture.width,s=Math.floor(r/e.texture.width),c=Math.min(e.texture.width-a,o),l=0;a>0&&(this._region0.texOffset.x=a,this._region0.texOffset.y=s,this._region0.texExtent.width=c,this._region0.texExtent.height=1,n.push(new this._bufferViewCtor(t,l*this._formatSize,c*this._channels)),i.push(this._region0),a=0,s+=1,o-=c,l+=c),o>0&&(this._region1.texOffset.x=a,this._region1.texOffset.y=s,o>e.texture.width?(this._region1.texExtent.width=e.texture.width,this._region1.texExtent.height=Math.floor(o/e.texture.width),c=this._region1.texExtent.width*this._region1.texExtent.height):(c=o,this._region1.texExtent.width=c,this._region1.texExtent.height=1),n.push(new this._bufferViewCtor(t,l*this._formatSize,c*this._channels)),i.push(this._region1),a=0,s+=this._region1.texExtent.height,o-=c,l+=c),o>0&&(this._region2.texOffset.x=a,this._region2.texOffset.y=s,this._region2.texExtent.width=o,this._region2.texExtent.height=1,n.push(new this._bufferViewCtor(t,l*this._formatSize,o*this._channels)),i.push(this._region2)),this._device.copyBuffersToTexture(n,e.texture,i)},t._findAvailableSpace=function(e,t){var n=this._chunks[t],i=!1,r=n.start;if(r+e<=n.size)i=!0;else{r=0;for(var o=this._handles.filter((function(e){return e.chunkIdx===t})).sort((function(e,t){return e.start-t.start})),a=0;a<o.length;a++){var s=o[a];if(r+e<=s.start){i=!0;break}r=s.end}!i&&r+e<=n.size&&(i=!0)}return i?r:-1},t._McDonaldAlloc=function(e){e=Lp(e,this._alignment);for(var t=0;t<this._chunkCount;++t){var n=this._chunks[t],i=!1,r=n.start;if(r+e<=n.end?i=!0:r>n.end?r+e<=n.size?i=!0:e<=n.end&&(n.start=r=0,i=!0):r===n.end&&(n.start=r=0,n.end=n.size,e<=n.end&&(i=!0)),i){n.start+=e;var o={chunkIdx:t,start:r,end:r+e,texture:n.texture};return this._handles.push(o),o}}var a=Math.sqrt(e/this._formatSize),s=this._roundUpFn&&this._roundUpFn(a,this._formatSize)||Math.max(1024,Dp(a)),c=this._chunks[this.createChunk(s)];c.start+=e;var l={chunkIdx:this._chunkCount,start:0,end:e,texture:c.texture};return this._handles.push(l),l},e}()),zp=function(e){if(void 0===le[e]){var t=1<<ce;le[e]=t,ce+=1}},Bp=Object.freeze({__proto__:null,addStage:zp,scene:Mp,createIA:function(e,t){if(!t.positions)return console.error("The data must have positions field"),null;for(var n=[],i=t.positions.length/3,r=0;r<i;++r)n.push(t.positions[3*r],t.positions[3*r+1],t.positions[3*r+2]),t.normals&&n.push(t.normals[3*r],t.normals[3*r+1],t.normals[3*r+2]),t.uvs&&n.push(t.uvs[2*r],t.uvs[2*r+1]),t.colors&&n.push(t.colors[3*r],t.colors[3*r+1],t.colors[3*r+2]);var o=[];o.push(new rs(Qo.ATTR_POSITION,Jo.RGB32F)),t.normals&&o.push(new rs(Qo.ATTR_NORMAL,Jo.RGB32F)),t.uvs&&o.push(new rs(Qo.ATTR_TEX_COORD,Jo.RG32F)),t.colors&&o.push(new rs(Qo.ATTR_COLOR,Jo.RGB32F));var a=e.createBuffer(new Wa($o.VERTEX|$o.TRANSFER_DST,ea.HOST|ea.DEVICE,4*n.length,4*n.length/i));a.update(new Float32Array(n));var s=null;return t.indices&&(s=e.createBuffer(new Wa($o.INDEX|$o.TRANSFER_DST,ea.HOST|ea.DEVICE,2*t.indices.length,2))).update(new Uint16Array(t.indices)),e.createInputAssembler(new os(o,[a],s))},get RenderQueue(){return Tp},get PassStage(){return Ap},get PropertyType(){return Dm},genHandle:Fm,getPropertyTypeFromHandle:zm,getTypeFromHandle:Bm,getSetIndexFromHandle:function(e){return(3145728&e)>>>20},getBindingFromHandle:Um,getOffsetFromHandle:Gm,customizeType:Hm,type2reader:km,type2writer:Vm,getDefaultFromType:Wm,overrideMacros:qm,get BatchingSchemes(){return id},Pass:hd,getDeviceShaderVersion:$m,programLib:ed,get SamplerInfoIndex(){return Z_},defaultSamplerHash:ef,genSamplerHash:rf,samplerLib:gf,nearestPOT:Dp,TextureBufferPool:Fp,MaterialInstance:yp,PassInstance:gp,ObjectPool:Wi,freeHandleArray:Xi,get PoolType(){return Vi},NULL_HANDLE:Qi,ShaderPool:Zi,DSPool:Ji,IAPool:$i,PipelineLayoutPool:er,FramebufferPool:tr,SubModelArrayPool:nr,ModelArrayPool:ir,AttributeArrayPool:rr,FlatBufferArrayPool:or,LightArrayPool:ar,BlendTargetArrayPool:sr,UIBatchArrayPool:cr,RawBufferPool:lr,RawObjectPool:ur,get PassView(){return Ki},PassPool:fr,get SubModelView(){return hr},SubModelPool:pr,get ModelView(){return mr},ModelPool:yr,get BatchView2D(){return vr},BatchPool2D:Sr,get AABBView(){return xr},AABBPool:Cr,get SceneView(){return Tr},ScenePool:br,get CameraView(){return wr},CameraPool:Nr,get NodeView(){return Rr},NodePool:Dr,get RootView(){return Mr},RootPool:zr,get RenderWindowView(){return Lr},RenderWindowPool:Gr,get FrustumView(){return Br},FrustumPool:Vr,get AmbientView(){return Hr},AmbientPool:qr,get SkyboxView(){return Wr},SkyboxPool:Kr,get FogView(){return Yr},FogPool:Jr,get ShadowsView(){return Zr},ShadowsPool:to,get LightView(){return eo},LightPool:ro,get SphereView(){return no},SpherePool:so,get FlatBufferView(){return ao},FlatBufferPool:uo,get SubMeshView(){return co},SubMeshPool:fo,get RasterizerStateView(){return ho},RasterizerStatePool:vo,get DepthStencilStateView(){return mo},DepthStencilStatePool:xo,get BlendTargetView(){return go},BlendTargetPool:So,get BlendStateView(){return Eo},BlendStatePool:Ao});function Up(e){return e*e}function Gp(e){return e*(2-e)}function Hp(e){return e*e*e}function kp(e){return--e*e*e+1}function Vp(e){return e*e*e*e}function jp(e){return 1- --e*e*e*e}function Wp(e){return e*e*e*e*e}function qp(e){return--e*e*e*e*e+1}function Yp(e){return 1-Math.cos(e*Math.PI/2)}function Xp(e){return Math.sin(e*Math.PI/2)}function Kp(e){return 0===e?0:Math.pow(1024,e-1)}function Qp(e){return 1===e?1:1-Math.pow(2,-10*e)}function Zp(e){return 1-Math.sqrt(1-e*e)}function Jp(e){return Math.sqrt(1- --e*e)}function $p(e){var t,n=.1;return 0===e?0:1===e?1:(!n||n<1?(n=1,t=.1):t=.4*Math.asin(1/n)/(2*Math.PI),-n*Math.pow(2,10*(e-=1))*Math.sin(2*(e-t)*Math.PI/.4))}function ev(e){var t,n=.1;return 0===e?0:1===e?1:(!n||n<1?(n=1,t=.1):t=.4*Math.asin(1/n)/(2*Math.PI),n*Math.pow(2,-10*e)*Math.sin(2*(e-t)*Math.PI/.4)+1)}function tv(e){var t=1.70158;return e*e*((t+1)*e-t)}function nv(e){var t=1.70158;return--e*e*((t+1)*e+t)+1}function iv(e){return 1-rv(1-e)}function rv(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375}e("dF",Bp);var ov=dv(Up,Gp),av=dv(Hp,kp),sv=dv(Vp,jp),cv=dv(Wp,qp),lv=dv(Yp,Xp),uv=dv(Kp,Qp),hv=dv(Zp,Jp),_v=dv($p,ev),fv=dv(tv,nv),mv=dv(iv,rv);function dv(e,t){return function(n){return n<.5?t(2*n)/2:e(2*n-1)/2+.5}}var pv,vv=Object.freeze({__proto__:null,constant:function(){return 0},linear:function(e){return e},quadIn:Up,quadOut:Gp,quadInOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)},cubicIn:Hp,cubicOut:kp,cubicInOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)},quartIn:Vp,quartOut:jp,quartInOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)},quintIn:Wp,quintOut:qp,quintInOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)},sineIn:Yp,sineOut:Xp,sineInOut:function(e){return.5*(1-Math.cos(Math.PI*e))},expoIn:Kp,expoOut:Qp,expoInOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))},circIn:Zp,circOut:Jp,circInOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)},elasticIn:$p,elasticOut:ev,elasticInOut:function(e){var t,n=.1;return 0===e?0:1===e?1:(!n||n<1?(n=1,t=.1):t=.4*Math.asin(1/n)/(2*Math.PI),(e*=2)<1?n*Math.pow(2,10*(e-=1))*Math.sin(2*(e-t)*Math.PI/.4)*-.5:n*Math.pow(2,-10*(e-=1))*Math.sin(2*(e-t)*Math.PI/.4)*.5+1)},backIn:tv,backOut:nv,backInOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)},bounceIn:iv,bounceOut:rv,bounceInOut:function(e){return e<.5?.5*iv(2*e):.5*rv(2*e-1)+.5},smooth:function(e){return e<=0?0:e>=1?1:e*e*(3-2*e)},fade:function(e){return e<=0?0:e>=1?1:e*e*e*(e*(6*e-15)+10)},quadOutIn:ov,cubicOutIn:av,quartOutIn:sv,quintOutIn:cv,sineOutIn:lv,expoOutIn:uv,circOutIn:hv,elasticOutIn:_v,backOutIn:fv,bounceOutIn:mv});e("ds",vv),function(e){e[e.NONE=0]="NONE",e[e.LAN=1]="LAN",e[e.WWAN=2]="WWAN"}(pv||(pv={}));var gv,yv,xv,Ev,Sv,Tv,Av,Cv,wv,Iv,bv,Rv=e("ae",{NetworkType:pv,LANGUAGE_ENGLISH:"en",LANGUAGE_CHINESE:"zh",LANGUAGE_FRENCH:"fr",LANGUAGE_ITALIAN:"it",LANGUAGE_GERMAN:"de",LANGUAGE_SPANISH:"es",LANGUAGE_DUTCH:"du",LANGUAGE_RUSSIAN:"ru",LANGUAGE_KOREAN:"ko",LANGUAGE_JAPANESE:"ja",LANGUAGE_HUNGARIAN:"hu",LANGUAGE_PORTUGUESE:"pt",LANGUAGE_ARABIC:"ar",LANGUAGE_NORWEGIAN:"no",LANGUAGE_POLISH:"pl",LANGUAGE_TURKISH:"tr",LANGUAGE_UKRAINIAN:"uk",LANGUAGE_ROMANIAN:"ro",LANGUAGE_BULGARIAN:"bg",LANGUAGE_UNKNOWN:"unknown",OS_IOS:"iOS",OS_ANDROID:"Android",OS_WINDOWS:"Windows",OS_LINUX:"Linux",OS_OSX:"OS X",OS_UNKNOWN:"Unknown",UNKNOWN:-1,WIN32:0,LINUX:1,MACOS:2,ANDROID:3,IPHONE:4,IPAD:5,BLACKBERRY:6,NACL:7,EMSCRIPTEN:8,TIZEN:9,WINRT:10,WP8:11,MOBILE_BROWSER:100,DESKTOP_BROWSER:101,EDITOR_PAGE:102,EDITOR_CORE:103,WECHAT_GAME:104,QQ_PLAY:105,FB_PLAYABLE_ADS:106,BAIDU_MINI_GAME:107,VIVO_MINI_GAME:108,OPPO_MINI_GAME:109,HUAWEI_QUICK_GAME:110,XIAOMI_QUICK_GAME:111,COCOSPLAY:112,ALIPAY_MINI_GAME:113,QTT_MINI_GAME:116,BYTEDANCE_MINI_GAME:117,LINKSURE_MINI_GAME:119,BROWSER_TYPE_WECHAT:"wechat",BROWSER_TYPE_ANDROID:"androidbrowser",BROWSER_TYPE_IE:"ie",BROWSER_TYPE_EDGE:"edge",BROWSER_TYPE_QQ:"qqbrowser",BROWSER_TYPE_MOBILE_QQ:"mqqbrowser",BROWSER_TYPE_UC:"ucbrowser",BROWSER_TYPE_UCBS:"ucbs",BROWSER_TYPE_360:"360browser",BROWSER_TYPE_BAIDU_APP:"baiduboxapp",BROWSER_TYPE_BAIDU:"baidubrowser",BROWSER_TYPE_MAXTHON:"maxthon",BROWSER_TYPE_OPERA:"opera",BROWSER_TYPE_OUPENG:"oupeng",BROWSER_TYPE_MIUI:"miuibrowser",BROWSER_TYPE_FIREFOX:"firefox",BROWSER_TYPE_SAFARI:"safari",BROWSER_TYPE_CHROME:"chrome",BROWSER_TYPE_LIEBAO:"liebao",BROWSER_TYPE_QZONE:"qzone",BROWSER_TYPE_SOUGOU:"sogou",BROWSER_TYPE_HUAWEI:"huawei",BROWSER_TYPE_UNKNOWN:"unknown",isNative:!1,isBrowser:"object"==typeof window&&"object"==typeof document,isMobile:!1,isLittleEndian:(gv=new ArrayBuffer(2),new DataView(gv).setInt16(0,256,!0),256===new Int16Array(gv)[0]),platform:-1,language:"unknown",languageCode:"unknown",os:"Unknown",osVersion:"",osMainVersion:0,browserType:"unknown",browserVersion:"",windowPixelResolution:null,capabilities:null,localStorage:null,__audioSupport:null,__videoSupport:null,getNetworkType:function(){return pv.LAN},getBatteryLevel:function(){return 1},garbageCollect:function(){},isObjectValid:function(e){return null!=e},dump:function(){var e="";e+="isMobile : "+this.isMobile+"\r\n",e+="language : "+this.language+"\r\n",e+="browserType : "+this.browserType+"\r\n",e+="browserVersion : "+this.browserVersion+"\r\n",e+="capabilities : "+JSON.stringify(this.capabilities)+"\r\n",e+="os : "+this.os+"\r\n",e+="osVersion : "+this.osVersion+"\r\n",e+="platform : "+this.platform+"\r\n",v(e+="Using "+(c.game.renderType===c.game.RENDER_TYPE_WEBGL?"WEBGL":"CANVAS")+" renderer.\r\n")},openURL:function(e){window.open(e)},now:function(){return Date.now?Date.now():+new Date},restartVM:function(){},getSafeAreaRect:function(){var e=c.view.getVisibleSize();return c.rect(0,0,e.width,e.height)},__init:function(){var e=window,t=e.navigator,n=document,i=n.documentElement,r=t.userAgent.toLowerCase();Rv.isMobile=/mobile|android|iphone|ipad/.test(r),Rv.platform=Rv.isMobile?Rv.MOBILE_BROWSER:Rv.DESKTOP_BROWSER;var o=t.language;Rv.languageCode=o.toLowerCase(),o=(o=o||t.browserLanguage)?o.split("-")[0]:Rv.LANGUAGE_ENGLISH,Rv.language=o;var a=!1,s=!1,c="",l=0,u=/android\s*(\d+(?:\.\d+)*)/i.exec(r)||/android\s*(\d+(?:\.\d+)*)/i.exec(t.platform);u&&(a=!0,c=u[1]||"",l=parseInt(c)||0),(u=/(iPad|iPhone|iPod).*OS ((\d+_?){2,3})/i.exec(r))?(s=!0,c=u[2]||"",l=parseInt(c)||0):(/(iPhone|iPad|iPod)/.exec(t.platform)||"MacIntel"===t.platform&&t.maxTouchPoints&&t.maxTouchPoints>1)&&(s=!0,c="",l=0);var h=Rv.OS_UNKNOWN;-1!==t.appVersion.indexOf("Win")?h=Rv.OS_WINDOWS:s?h=Rv.OS_IOS:-1!==t.appVersion.indexOf("Mac")?h=Rv.OS_OSX:-1!==t.appVersion.indexOf("X11")&&-1===t.appVersion.indexOf("Linux")?h=Rv.OS_UNIX:a?h=Rv.OS_ANDROID:-1===t.appVersion.indexOf("Linux")&&-1===r.indexOf("ubuntu")||(h=Rv.OS_LINUX),Rv.os=h,Rv.osVersion=c,Rv.osMainVersion=l,Rv.browserType=Rv.BROWSER_TYPE_UNKNOWN,function(){var e=/mqqbrowser|micromessenger|qqbrowser|sogou|qzone|liebao|maxthon|ucbs|360 aphone|360browser|baiduboxapp|baidubrowser|maxthon|mxbrowser|miuibrowser/i.exec(r)||/qq|qqbrowser|ucbrowser|ubrowser|edge|HuaweiBrowser/i.exec(r)||/chrome|safari|firefox|trident|opera|opr\/|oupeng/i.exec(r),t=e?e[0].toLowerCase():Rv.BROWSER_TYPE_UNKNOWN;("safari"===t&&a||"qq"===t&&/android.*applewebkit/i.test(r))&&(t=Rv.BROWSER_TYPE_ANDROID);var n={micromessenger:Rv.BROWSER_TYPE_WECHAT,trident:Rv.BROWSER_TYPE_IE,edge:Rv.BROWSER_TYPE_EDGE,"360 aphone":Rv.BROWSER_TYPE_360,mxbrowser:Rv.BROWSER_TYPE_MAXTHON,"opr/":Rv.BROWSER_TYPE_OPERA,ubrowser:Rv.BROWSER_TYPE_UC,huaweibrowser:Rv.BROWSER_TYPE_HUAWEI};Rv.browserType=n[t]||t}(),Rv.browserVersion="",function(){var e=/(mqqbrowser|micromessenger|qqbrowser|sogou|qzone|liebao|maxthon|uc|ucbs|360 aphone|360|baiduboxapp|baidu|maxthon|mxbrowser|miui(?:.hybrid)?)(mobile)?(browser)?\/?([\d.]+)/i.exec(r);e||(e=/(qq|chrome|safari|firefox|trident|opera|opr\/|oupeng)(mobile)?(browser)?\/?([\d.]+)/i.exec(r)),Rv.browserVersion=e?e[4]:""}();var _=window.innerWidth||document.documentElement.clientWidth,f=window.innerHeight||document.documentElement.clientHeight,m=window.devicePixelRatio||1;Rv.windowPixelResolution={width:m*_,height:m*f};var d,p=document.createElement("canvas");try{var v=Rv.localStorage=e.localStorage;v.setItem("storage",""),v.removeItem("storage"),v=null}catch(e){var g=function(){I(5200)};Rv.localStorage={getItem:g,setItem:g,removeItem:g,clear:g}}try{d=p.toDataURL("image/webp").startsWith("data:image/webp")}catch(e){d=!1}var y=!!p.getContext("2d"),x=!1;e.WebGLRenderingContext&&(x=!0);var E,S=Rv.capabilities={canvas:y,opengl:x,webp:d,imageBitmap:!1,touches:!1,mouse:!1,keyboard:!1,accelerometer:!1};"undefined"!=typeof createImageBitmap&&"undefined"!=typeof Blob&&(p.width=p.height=2,createImageBitmap(p,{}).then((function(e){S.imageBitmap=!0,e.close&&e.close()})).catch((function(){}))),(void 0!==i.ontouchstart||void 0!==n.ontouchstart||t.msPointerEnabled)&&(S.touches=!0),void 0!==i.onmouseup&&(S.mouse=!0),void 0!==i.onkeyup&&(S.keyboard=!0),(e.DeviceMotionEvent||e.DeviceOrientationEvent)&&(S.accelerometer=!0),E={ONLY_ONE:!1,WEB_AUDIO:!!(window.AudioContext||window.webkitAudioContext||window.mozAudioContext),DELAY_CREATE_CTX:!1},Rv.os===Rv.OS_IOS&&(E.USE_LOADER_EVENT="loadedmetadata"),Rv.browserType===Rv.BROWSER_TYPE_FIREFOX&&(E.DELAY_CREATE_CTX=!0,E.USE_LOADER_EVENT="canplay"),Rv.os===Rv.OS_ANDROID&&Rv.browserType===Rv.BROWSER_TYPE_UC&&(E.ONE_SOURCE=!0);try{E.WEB_AUDIO&&(E._context=null,Object.defineProperty(E,"context",{get:function(){return this._context?this._context:this._context=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext)}}))}catch(e){E.WEB_AUDIO=!1,C(5201)}var T,A=[];(T=document.createElement("audio")).canPlayType&&(T.canPlayType('audio/ogg; codecs="vorbis"')&&A.push(".ogg"),T.canPlayType("audio/mpeg")&&A.push(".mp3"),T.canPlayType('audio/wav; codecs="1"')&&A.push(".wav"),T.canPlayType("audio/mp4")&&A.push(".mp4"),T.canPlayType("audio/x-m4a")&&A.push(".m4a")),E.format=A,Rv.__audioSupport=E,Rv.__videoSupport={format:[]},function(){var e=document.createElement("video");if(e.canPlayType){var t=Rv.__videoSupport.format;["mp4","webm"].forEach((function(n){e.canPlayType("video/"+n)&&t.push("."+n)})),Rv.__videoSupport.format=t}}(),Rv.__isWebIOS14OrIPadOS14Env=(Rv.os===Rv.OS_IOS||Rv.os===Rv.MACOS)&&Rv.isBrowser&&/(OS 1[4-9])|(Version\/1[4-9])/.test(window.navigator.userAgent)}});"object"!=typeof window||"object"!=typeof document||o||a||r||Rv.__init(),c.sys=Rv;var Ov,Nv,Pv,Mv,Dv,Lv,Fv,zv,Bv,Uv,Gv,Hv,kv,Vv=e("fe",(yv=vh("RenderStage"),xv=Gh(),Ev=Gh(),Sv=Gh(),yv((bv=function(){function e(){ae(this,"_name",Cv,this),ae(this,"_priority",wv,this),ae(this,"_tag",Iv,this)}var t=e.prototype;return t.initialize=function(e){return this._name=e.name,this._priority=e.priority,e.tag&&(this._tag=e.tag),!0},t.activate=function(e,t){this._pipeline=e,this._flow=t},Z(e,[{key:"name",get:function(){return this._name}},{key:"priority",get:function(){return this._priority}},{key:"tag",get:function(){return this._tag}}]),e}(),Cv=se((Av=bv).prototype,"_name",[xv,Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),wv=se(Av.prototype,"_priority",[Ev,Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Iv=se(Av.prototype,"_tag",[Sv,Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Tv=Av))||Tv));c.RenderStage=Vv;var jv,Wv,qv,Yv,Xv,Kv,Qv,Zv,Jv,$v=e("fd",(Ov=vh("RenderFlow"),Nv=Gh(),Pv=Gh(),Mv=Gh(),Dv=Gh(),Lv=qh([Vv]),Ov((kv=function(){function e(){ae(this,"_name",Bv,this),ae(this,"_priority",Uv,this),ae(this,"_tag",Gv,this),ae(this,"_stages",Hv,this)}var t=e.prototype;return t.initialize=function(e){return this._name=e.name,this._priority=e.priority,this._stages=e.stages,e.tag&&(this._tag=e.tag),!0},t.activate=function(e){this._pipeline=e,this._stages.sort((function(e,t){return e.priority-t.priority}));for(var t=0,n=this._stages.length;t<n;t++)this._stages[t].activate(e,this)},t.render=function(e){for(var t=0,n=this._stages.length;t<n;t++)this._stages[t].render(e)},t.destroy=function(){for(var e=0,t=this._stages.length;e<t;e++)this._stages[e].destroy();this._stages.length=0},Z(e,[{key:"name",get:function(){return this._name}},{key:"priority",get:function(){return this._priority}},{key:"tag",get:function(){return this._tag}},{key:"stages",get:function(){return this._stages}}]),e}(),Bv=se((zv=kv).prototype,"_name",[Nv,Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Uv=se(zv.prototype,"_priority",[Pv,Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Gv=se(zv.prototype,"_tag",[Mv,Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Hv=se(zv.prototype,"_stages",[Dv,Lv,Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Fv=zv))||Fv));c.RenderFlow=$v;var eg,tg,ng=e("fc",(jv=vh("cc.RenderPipeline"),Wv=Gh(),qv=Gh(),Yv=qh([$v]),jv((Jv=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ae(t=e.call.apply(e,[this].concat(i))||this,"_tag",Qv,ie(t)),ae(t,"_flows",Zv,ie(t)),t._macros={},t._commandBuffers=[],t}$(t,e);var n=t.prototype;return n.initialize=function(e){return this._flows=e.flows,e.tag&&(this._tag=e.tag),!0},n.activate=function(){this._device=c.director.root.device;var e=new Ys(Zl.bindings);this._descriptorSetLayout=this._device.createDescriptorSetLayout(e),this._descriptorSet=this._device.createDescriptorSet(new js(this._descriptorSetLayout));for(var t=0;t<this._flows.length;t++)this._flows[t].activate(this);return!0},n.render=function(e){for(var t=0;t<this.flows.length;t++)for(var n=0;n<e.length;n++){var i=e[n];this.flows[t].render(i)}},n.destroy=function(){for(var t=0;t<this._flows.length;t++)this._flows[t].destroy();this._flows.length=0,this._descriptorSet&&(this._descriptorSet.destroy(),this._descriptorSet=null);for(var n=0;n<this._commandBuffers.length;n++)this._commandBuffers[n].destroy();return this._commandBuffers.length=0,e.prototype.destroy.call(this)},Z(t,[{key:"macros",get:function(){return this._macros}},{key:"tag",get:function(){return this._tag}},{key:"flows",get:function(){return this._flows}},{key:"device",get:function(){return this._device}},{key:"descriptorSetLayout",get:function(){return this._descriptorSetLayout}},{key:"descriptorSet",get:function(){return this._descriptorSet}},{key:"commandBuffers",get:function(){return this._commandBuffers}}]),t}(H_),Qv=se((Kv=Jv).prototype,"_tag",[Wv,Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Zv=se(Kv.prototype,"_flows",[qv,Yv,Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Xv=Kv))||Xv));c.RenderPipeline=ng,function(e){e[e.FORWARD=10]="FORWARD",e[e.UI=20]="UI"}(eg||(eg={})),function(e){e[e.SHADOW=0]="SHADOW",e[e.FORWARD=1]="FORWARD",e[e.UI=10]="UI"}(tg||(tg={}));var ig=e("fl",function(){function e(){}return e.getOrCreatePipelineState=function(e,t,n,i,r){var o=t.handle,a=fr.get(o,Ki.HASH)^i.hash^r.attributesHash^n.id,s=this._PSOHashMap.get(a);if(!s){var c=er.get(fr.get(o,Ki.PIPELINE_LAYOUT)),l=new ys(r.attributes),u=new xs(n,c,i,l,t.rasterizerState,t.depthStencilState,t.blendState,fr.get(o,Ki.PRIMITIVE),fr.get(o,Ki.DYNAMIC_STATES));s=e.createPipelineState(u),this._PSOHashMap.set(a,s)}return s},e}());function rg(e,t){return e.hash-t.hash||e.depth-t.depth||e.shaderId-t.shaderId}function og(e,t){return e.hash-t.hash||t.depth-e.depth||e.shaderId-t.shaderId}ig._PSOHashMap=new Map;var ag=function(){function e(e){this.queue=void 0,this._passDesc=void 0,this._passPool=void 0,this._passDesc=e,this._passPool=new E_((function(){return{hash:0,depth:0,shaderId:0,subModel:null,passIdx:0}}),64),this.queue=new S_(64,this._passDesc.sortFunc)}var t=e.prototype;return t.clear=function(){this.queue.clear(),this._passPool.reset()},t.insertRenderPass=function(e,t,n){var i=e.model.subModels[t],r=pr.get(i.handle,hr.PASS_0+n);if(i.passes[n].blendState.targets[0].blend!==this._passDesc.isTransparent||!(fr.get(r,Ki.PHASE)&this._passDesc.phases))return!1;var o=0|fr.get(r,Ki.PRIORITY)<<16|i.priority<<8|n,a=this._passPool.add();return a.hash=o,a.depth=e.depth||0,a.shaderId=pr.get(i.handle,hr.SHADER_0+n),a.subModel=i,a.passIdx=n,this.queue.push(a),!0},t.sort=function(){this.queue.sort()},t.recordCommandBuffer=function(e,t,n){for(var i=0;i<this.queue.length;++i){var r=this.queue.array[i],o=r.subModel,a=r.passIdx,s=o.inputAssembler,c=o.handle,l=o.passes[a],u=Zi.get(pr.get(c,hr.SHADER_0+a)),h=ig.getOrCreatePipelineState(e,l,u,t,s);n.bindPipelineState(h),n.bindDescriptorSet(nu.MATERIAL,l.descriptorSet),n.bindDescriptorSet(nu.LOCAL,o.descriptorSet),n.bindInputAssembler(s),n.draw(s)}},e}(),sg=function(){function e(){this.queue=new Set}var t=e.prototype;return t.clear=function(){for(var e=this.queue.values(),t=e.next();!t.done;)t.value.clear(),t=e.next();this.queue.clear()},t.uploadBuffers=function(e){for(var t=this.queue.values(),n=t.next();!n.done;){for(var i=0;i<n.value.batches.length;++i){var r=n.value.batches[i];if(r.mergeCount){for(var o=0;o<r.vbs.length;++o)r.vbs[o].update(r.vbDatas[o]);e.updateBuffer(r.vbIdx,r.vbIdxData.buffer),e.updateBuffer(r.ubo,r.uboData)}}n=t.next()}},t.recordCommandBuffer=function(e,t,n){for(var i=this.queue.values(),r=i.next();!r.done;){for(var o=!1,a=0;a<r.value.batches.length;++a){var s=r.value.batches[a];if(s.mergeCount){if(!o){var c=Zi.get(s.hShader),l=ig.getOrCreatePipelineState(e,s.pass,c,t,s.ia);n.bindPipelineState(l),n.bindDescriptorSet(nu.MATERIAL,s.pass.descriptorSet),o=!0}n.bindDescriptorSet(nu.LOCAL,s.descriptorSet,r.value.dynamicOffsets),n.bindInputAssembler(s.ia),n.draw(s.ia)}}r=i.next()}},e}(),cg=function(){function e(){this.queue=new Set}var t=e.prototype;return t.clear=function(){for(var e=this.queue.values(),t=e.next();!t.done;)t.value.clear(),t=e.next();this.queue.clear()},t.uploadBuffers=function(e){for(var t=this.queue.values(),n=t.next();!n.done;)n.value.hasPendingModels&&n.value.uploadBuffers(e),n=t.next()},t.recordCommandBuffer=function(e,t,n){for(var i=this.queue.values(),r=i.next();!r.done;){var o=r.value,a=o.instances,s=o.pass;if(o.hasPendingModels){n.bindDescriptorSet(nu.MATERIAL,s.descriptorSet);for(var c=null,l=0;l<a.length;++l){var u=a[l];if(u.count){var h=Zi.get(u.hShader),_=ig.getOrCreatePipelineState(e,s,h,t,u.ia);c!==_&&(n.bindPipelineState(_),c=_),n.bindDescriptorSet(nu.LOCAL,Ji.get(u.hDescriptorSet),r.value.dynamicOffsets),n.bindInputAssembler(u.ia),n.draw(u.ia)}}}r=i.next()}},e}(),lg=function(){function e(e){this.batches=[],this.dynamicOffsets=[],this._device=void 0,this._device=e.device}e.get=function(t,n){void 0===n&&(n=0);var i=e._buffers;i.has(t)||i.set(t,{});var r=i.get(t);return r[n]||(r[n]=new e(t))};var t=e.prototype;return t.destroy=function(){for(var e=0;e<this.batches.length;++e){for(var t=this.batches[e],n=0;n<t.vbs.length;++n)t.vbs[n].destroy();t.vbIdx.destroy(),t.ia.destroy(),t.ubo.destroy()}this.batches.length=0},t.merge=function(e,t,n){var i=e.subMesh.flatBuffers;if(0!==i.length){for(var r=0,o=0,a=i[0].count,s=e.passes[t],c=pr.get(e.handle,hr.SHADER_0+t),l=e.descriptorSet,u=!1,h=0;h<this.batches.length;++h){var _=this.batches[h];if(_.vbs.length===i.length&&_.mergeCount<yu.BATCHING_COUNT){u=!0;for(var f=0;f<_.vbs.length;++f)if(_.vbs[f].stride!==i[f].stride){u=!1;break}if(u){for(var m=0;m<_.vbs.length;++m){var d=i[m],p=_.vbs[m],v=_.vbDatas[m];(r=(a+_.vbCount)*d.stride)>p.size&&(p.resize(r),_.vbDatas[m]=new Uint8Array(r),_.vbDatas[m].set(v)),_.vbDatas[m].set(d.buffer,_.vbCount*d.stride)}var g=_.vbIdxData;(o=4*(a+_.vbCount))>_.vbIdx.size&&(_.vbIdx.resize(o),_.vbIdxData=new Float32Array(o/Float32Array.BYTES_PER_ELEMENT),_.vbIdxData.set(g),g=_.vbIdxData);var y=_.vbCount,x=y+a,E=_.mergeCount;if(g[y]!==E||g[x-1]!==E)for(var S=y;S<x;S++)g[S]=E+.1;return ei.toArray(_.uboData,n.transform.worldMatrix,yu.MAT_WORLDS_OFFSET+16*_.mergeCount),_.mergeCount||(l.bindBuffer(yu.BINDING,_.ubo),l.update(),_.pass=s,_.hShader=c,_.descriptorSet=l),++_.mergeCount,_.vbCount+=a,void(_.ia.vertexCount+=a)}}}for(var T=[],A=[],C=[],w=0;w<i.length;++w){var I=i[w],b=this._device.createBuffer(new Wa($o.VERTEX|$o.TRANSFER_DST,ea.HOST|ea.DEVICE,I.count*I.stride,I.stride));b.update(I.buffer.buffer),T.push(b),A.push(new Uint8Array(b.size)),C.push(b)}var R=this._device.createBuffer(new Wa($o.VERTEX|$o.TRANSFER_DST,ea.HOST|ea.DEVICE,4*a,4)),O=new Float32Array(a);O.fill(0),R.update(O),C.push(R);for(var N=e.inputAssembler.attributes,P=new Array(N.length+1),M=0;M<N.length;++M)P[M]=N[M];P[N.length]=new rs("a_dyn_batch_id",Jo.R32F,!1,i.length);var D=new os(P,C),L=this._device.createInputAssembler(D),F=this._device.createBuffer(new Wa($o.UNIFORM|$o.TRANSFER_DST,ea.HOST|ea.DEVICE,yu.SIZE,yu.SIZE));l.bindBuffer(yu.BINDING,F),l.update();var z=new Float32Array(yu.COUNT);ei.toArray(z,n.transform.worldMatrix,yu.MAT_WORLDS_OFFSET),this.batches.push({mergeCount:1,vbs:T,vbDatas:A,vbIdx:R,vbIdxData:O,vbCount:a,ia:L,ubo:F,uboData:z,pass:s,hShader:c,descriptorSet:l})}},t.clear=function(){for(var e=0;e<this.batches.length;++e){var t=this.batches[e];t.vbCount=0,t.mergeCount=0,t.ia.vertexCount=0}},e}();lg._buffers=new Map;var ug=new Un,hg=new Un,_g=new Un,fg=new ei,mg=new gl,dg=!1,pg=[],vg=Yo.create(0,0,0,1),gg=new x_((function(){return{model:null,depth:0}}),128),yg=new x_((function(){return{model:null,depth:0}}),128);function xg(e,t){var n=0;e.node&&(Un.subtract(ug,e.node.worldPosition,t.position),n=Un.dot(ug,t.forward));var i=gg.alloc();return i.model=e,i.depth=n,i}function Eg(e,t){var n=0;e.node&&(Un.subtract(ug,e.node.worldPosition,t.position),n=Un.dot(ug,t.forward));var i=yg.alloc();return i.model=e,i.depth=n,i}function Sg(e,t,n,i){var r=e.shadows;Un.negate(hg,n);var o=r.sphere.radius*vp.COEFFICIENT_OF_EXPANSION;return Un.multiplyScalar(_g,hg,o),Un.add(_g,_g,r.sphere.center),i.set(_g),ei.fromRT(fg,t,_g),fg}function Tg(e,t,n){var i=t.direction,r=e.normal,o=e.distance+.001,a=1/Un.dot(r,i),s=i.x*a,c=i.y*a,l=i.z*a,u=r.x,h=r.y,_=r.z,f=e.matLight;f.m00=1-u*s,f.m01=-u*c,f.m02=-u*l,f.m03=0,f.m04=-h*s,f.m05=1-h*c,f.m06=-h*l,f.m07=0,f.m08=-_*s,f.m09=-_*c,f.m10=1-_*l,f.m11=0,f.m12=s*o,f.m13=c*o,f.m14=l*o,f.m15=1,ei.toArray(n,f,cu.MAT_LIGHT_PLANE_PROJ_OFFSET)}var Ag=[_a.LINEAR,_a.LINEAR,_a.NONE,fa.CLAMP,fa.CLAMP,fa.CLAMP],Cg=new x_((function(){return{subModel:null,passIdx:-1,dynamicOffsets:[],lights:[]}}),16),wg=new Float32Array(4),Ig=Yo.create(0,0,0,1),bg=[],Rg=[],Og=new ei,Ng=new ei;function Pg(e,t){return!(!t.worldBounds||al.aabbWithAABB(t.worldBounds,e.aabb))}function Mg(e,t){return!(!t.worldBounds||al.aabbWithAABB(t.worldBounds,e.aabb)&&al.aabbFrustum(t.worldBounds,e.frustum))}var Dg=sd("forward-add"),Lg=[];function Fg(e,t){t.length=0;for(var n=!1,i=0;i<e.length;i++){for(var r=e[i].passes,o=-1,a=0;a<r.length;a++)if(r[a].phase===Dg){o=a,n=!0;break}t.push(o)}return n}var zg,Bg,Ug,Gg,Hg,kg,Vg,jg,Wg,qg,Yg,Xg,Kg,Qg,Zg,Jg,$g,ey,ty,ny,iy,ry,oy,ay,sy,cy,ly,uy,hy,_y,fy,my,dy,py,vy,gy,yy,xy,Ey,Sy,Ty,Ay,Cy,wy,Iy,by,Ry,Oy,Ny,Py,My,Dy,Ly,Fy,zy,By,Uy,Gy,Hy,ky,Vy,jy,Wy,qy,Yy,Xy,Ky,Qy,Zy,Jy,$y,ex,tx,nx,ix,rx,ox,ax,sx,cx,lx=function(){function e(e){this._pipeline=void 0,this._device=void 0,this._validLights=[],this._lightPasses=[],this._descriptorSetMap=new Map,this._globalUBO=new Float32Array(au.COUNT),this._cameraUBO=new Float32Array(su.COUNT),this._shadowUBO=new Float32Array(cu.COUNT),this._lightBufferCount=16,this._lightBufferStride=void 0,this._lightBufferElementCount=void 0,this._lightBuffer=void 0,this._firstLightBufferView=void 0,this._lightBufferData=void 0,this._isHDR=void 0,this._fpScale=void 0,this._renderObjects=void 0,this._instancedQueue=void 0,this._batchedQueue=void 0,this._lightMeterScale=1e4,this._sampler=null,this._pipeline=e,this._device=e.device,this._isHDR=e.isHDR,this._fpScale=e.fpScale,this._renderObjects=e.renderObjects,this._instancedQueue=new cg,this._batchedQueue=new sg,this._lightBufferStride=Math.ceil(xu.SIZE/this._device.uboOffsetAlignment)*this._device.uboOffsetAlignment,this._lightBufferElementCount=this._lightBufferStride/Float32Array.BYTES_PER_ELEMENT,this._lightBuffer=this._device.createBuffer(new Wa($o.UNIFORM|$o.TRANSFER_DST,ea.HOST|ea.DEVICE,this._lightBufferStride*this._lightBufferCount,this._lightBufferStride)),this._firstLightBufferView=this._device.createBuffer(new qa(this._lightBuffer,0,xu.SIZE)),this._lightBufferData=new Float32Array(this._lightBufferElementCount*this._lightBufferCount);var t=rf(Ag);this._sampler=gf.getSampler(this._device,t)}var t=e.prototype;return t.clear=function(){this._instancedQueue.clear(),this._batchedQueue.clear(),this._validLights.length=0;for(var e=0;e<this._lightPasses.length;e++){var t=this._lightPasses[e];t.dynamicOffsets.length=0,t.lights.length=0}Cg.freeArray(this._lightPasses),this._lightPasses.length=0},t.destroy=function(){for(var e=Array.from(this._descriptorSetMap.values()),t=0;t<e.length;++t){var n=e[t];n&&(n.getBuffer(au.BINDING).destroy(),n.getBuffer(cu.BINDING).destroy(),n.getSampler(lu).destroy(),n.getSampler(du).destroy(),n.getTexture(lu).destroy(),n.getTexture(du).destroy(),n.destroy())}this._descriptorSetMap.clear()},t.gatherLightPasses=function(e,t){var n=this._validLights;if(this.clear(),this._gatherValidLights(e,n),n.length){this._updateUBOs(e,t),this._updateLightDescriptorSet(e,t);for(var i=0;i<this._renderObjects.length;i++){var r=this._renderObjects[i].model,o=r.subModels;if(Fg(o,Lg)&&(Rg.length=0,this._lightCulling(r,n),Rg.length))for(var a=0;a<o.length;a++){var s=Lg[a];if(!(s<0)){var c=o[a],l=c.passes[s];c.descriptorSet.bindBuffer(xu.BINDING,this._firstLightBufferView),c.descriptorSet.update(),this._addRenderQueue(l,c,r,s,n)}}}this._instancedQueue.uploadBuffers(t),this._batchedQueue.uploadBuffers(t)}},t.recordCommandBuffer=function(e,t,n){this._instancedQueue.recordCommandBuffer(e,t,n),this._batchedQueue.recordCommandBuffer(e,t,n);for(var i=0;i<this._lightPasses.length;i++){var r=this._lightPasses[i],o=r.subModel,a=r.passIdx,s=r.dynamicOffsets,c=r.lights,l=Zi.get(pr.get(o.handle,hr.SHADER_0+a)),u=o.passes[a],h=o.inputAssembler,_=ig.getOrCreatePipelineState(e,u,l,t,h),f=Ji.get(fr.get(u.handle,Ki.DESCRIPTOR_SET)),m=o.descriptorSet;n.bindPipelineState(_),n.bindDescriptorSet(nu.MATERIAL,f),n.bindInputAssembler(h);for(var d=0;d<s.length;++d){var p=c[d],v=this._getOrCreateDescriptorSet(p);bg[0]=s[d],n.bindDescriptorSet(nu.GLOBAL,v),n.bindDescriptorSet(nu.LOCAL,m,bg),n.draw(h)}}},t._gatherValidLights=function(e,t){for(var n=e.scene.sphereLights,i=0;i<n.length;i++){var r=n[i];r.baked||(Yo.set(Ig,r.position.x,r.position.y,r.position.z,r.range),al.sphereFrustum(Ig,e.frustum)&&(t.push(r),this._getOrCreateDescriptorSet(r)))}for(var o=e.scene.spotLights,a=0;a<o.length;a++){var s=o[a];s.baked||(Yo.set(Ig,s.position.x,s.position.y,s.position.z,s.range),al.sphereFrustum(Ig,e.frustum)&&(t.push(s),this._getOrCreateDescriptorSet(s)))}},t._lightCulling=function(e,t){for(var n=0;n<t.length;n++){var i=t[n],r=!1;switch(i.type){case fd.SPHERE:r=Pg(i,e);break;case fd.SPOT:r=Mg(i,e)}r||Rg.push(n)}},t._addRenderQueue=function(e,t,n,i,r){var o=e.batchingScheme;if(o===id.INSTANCING)for(var a=0;a<Rg.length;a++){var s=Rg[a],c=Td.get(e,s);c.merge(t,n.instancedAttributes,i),c.dynamicOffsets[0]=this._lightBufferStride*s,this._instancedQueue.queue.add(c)}else if(o===id.VB_MERGING)for(var l=0;l<Rg.length;l++){var u=Rg[l],h=lg.get(e,u);h.merge(t,i,n),h.dynamicOffsets[0]=this._lightBufferStride*u,this._batchedQueue.queue.add(h)}else{var _=Cg.alloc();_.subModel=t,_.passIdx=i;for(var f=0;f<Rg.length;f++){var m=Rg[f];_.lights.push(r[m]),_.dynamicOffsets.push(this._lightBufferStride*m)}this._lightPasses.push(_)}},t._updateLightDescriptorSet=function(e,t){for(var n=this._pipeline.shadows,i=e.scene.mainLight,r=0;r<this._validLights.length;r++){var o=this._validLights[r],a=this._getOrCreateDescriptorSet(o);if(a){switch(this._updateGlobalDescriptorSet(e,t),o.type){case fd.SPHERE:i&&Tg(n,i,this._shadowUBO),zn.toArray(this._shadowUBO,n.shadowColor,cu.SHADOW_COLOR_OFFSET),this._shadowUBO[cu.SHADOW_INFO_OFFSET+0]=n.size.x,this._shadowUBO[cu.SHADOW_INFO_OFFSET+1]=n.size.y,this._shadowUBO[cu.SHADOW_INFO_OFFSET+2]=n.pcf,this._shadowUBO[cu.SHADOW_INFO_OFFSET+3]=n.bias;break;case fd.SPOT:if(i&&Tg(n,i,this._shadowUBO),ei.invert(Og,o.node.getWorldMatrix()),ei.perspective(Ng,o.spotAngle,o.aspect,.001,o.range),ei.multiply(Ng,Ng,Og),ei.toArray(this._shadowUBO,Ng,cu.MAT_LIGHT_VIEW_PROJ_OFFSET),zn.toArray(this._shadowUBO,n.shadowColor,cu.SHADOW_COLOR_OFFSET),this._shadowUBO[cu.SHADOW_INFO_OFFSET+0]=n.size.x,this._shadowUBO[cu.SHADOW_INFO_OFFSET+1]=n.size.y,this._shadowUBO[cu.SHADOW_INFO_OFFSET+2]=n.pcf,this._shadowUBO[cu.SHADOW_INFO_OFFSET+3]=n.bias,this._pipeline.shadowFrameBufferMap.has(o)&&this._pipeline.shadowFrameBufferMap.has(o)){var s,c=null===(s=this._pipeline.shadowFrameBufferMap.get(o))||void 0===s?void 0:s.colorTextures[0];c&&a.bindTexture(du,c)}}a.update(),t.updateBuffer(a.getBuffer(au.BINDING),this._globalUBO),t.updateBuffer(a.getBuffer(su.BINDING),this._cameraUBO),t.updateBuffer(a.getBuffer(cu.BINDING),this._shadowUBO)}}},t._updateGlobalDescriptorSet=function(e){var t=c.director.root,n=this._pipeline.device,i=this._globalUBO,r=Math.floor(n.width),o=Math.floor(n.height);i[au.TIME_OFFSET]=t.cumulativeTime,i[au.TIME_OFFSET+1]=t.frameTime,i[au.TIME_OFFSET+2]=c.director.getTotalFrames(),i[au.SCREEN_SIZE_OFFSET]=n.width,i[au.SCREEN_SIZE_OFFSET+1]=n.height,i[au.SCREEN_SIZE_OFFSET+2]=1/n.width,i[au.SCREEN_SIZE_OFFSET+3]=1/n.height,i[au.NATIVE_SIZE_OFFSET]=r,i[au.NATIVE_SIZE_OFFSET+1]=o,i[au.NATIVE_SIZE_OFFSET+2]=1/i[au.NATIVE_SIZE_OFFSET],i[au.NATIVE_SIZE_OFFSET+3]=1/i[au.NATIVE_SIZE_OFFSET+1],this._updateCameraUBO(e)},t._updateCameraUBO=function(e){var t=this._pipeline,n=e.scene.mainLight,i=t.ambient,r=t.shadingScale,o=this._pipeline.device,a=Math.floor(o.width),s=Math.floor(o.height),c=t.fog,l=this._cameraUBO;l[su.SCREEN_SCALE_OFFSET]=e.width/a*r,l[su.SCREEN_SCALE_OFFSET+1]=e.height/s*r,l[su.SCREEN_SCALE_OFFSET+2]=1/l[su.SCREEN_SCALE_OFFSET],l[su.SCREEN_SCALE_OFFSET+3]=1/l[su.SCREEN_SCALE_OFFSET+1];var u=e.exposure;if(l[su.EXPOSURE_OFFSET]=u,l[su.EXPOSURE_OFFSET+1]=1/u,l[su.EXPOSURE_OFFSET+2]=this._isHDR?1:0,l[su.EXPOSURE_OFFSET+3]=this._fpScale/u,n){if(Un.toArray(l,n.direction,su.MAIN_LIT_DIR_OFFSET),Un.toArray(l,n.color,su.MAIN_LIT_COLOR_OFFSET),n.useColorTemperature){var h=n.colorTemperatureRGB;l[su.MAIN_LIT_COLOR_OFFSET]*=h.x,l[su.MAIN_LIT_COLOR_OFFSET+1]*=h.y,l[su.MAIN_LIT_COLOR_OFFSET+2]*=h.z}this._isHDR?l[su.MAIN_LIT_COLOR_OFFSET+3]=n.illuminance*this._fpScale:l[su.MAIN_LIT_COLOR_OFFSET+3]=n.illuminance*u}else Un.toArray(l,Un.UNIT_Z,su.MAIN_LIT_DIR_OFFSET),ci.toArray(l,ci.ZERO,su.MAIN_LIT_COLOR_OFFSET);ei.toArray(l,e.matView,su.MAT_VIEW_OFFSET),ei.toArray(l,e.node.worldMatrix,su.MAT_VIEW_INV_OFFSET),ei.toArray(l,e.matProj,su.MAT_PROJ_OFFSET),ei.toArray(l,e.matProjInv,su.MAT_PROJ_INV_OFFSET),ei.toArray(l,e.matViewProj,su.MAT_VIEW_PROJ_OFFSET),ei.toArray(l,e.matViewProjInv,su.MAT_VIEW_PROJ_INV_OFFSET),Un.toArray(l,e.position,su.CAMERA_POS_OFFSET);var _=o.screenSpaceSignY;e.window.hasOffScreenAttachments&&(_*=o.UVSpaceSignY),l[su.CAMERA_POS_OFFSET+3]=_;var f=i.colorArray;this._isHDR?f[3]=i.skyIllum*this._fpScale:f[3]=i.skyIllum*u,l.set(f,su.AMBIENT_SKY_OFFSET),l.set(i.albedoArray,su.AMBIENT_GROUND_OFFSET),c.enabled&&(l.set(c.colorArray,su.GLOBAL_FOG_COLOR_OFFSET),l[su.GLOBAL_FOG_BASE_OFFSET]=c.fogStart,l[su.GLOBAL_FOG_BASE_OFFSET+1]=c.fogEnd,l[su.GLOBAL_FOG_BASE_OFFSET+2]=c.fogDensity,l[su.GLOBAL_FOG_ADD_OFFSET]=c.fogTop,l[su.GLOBAL_FOG_ADD_OFFSET+1]=c.fogRange,l[su.GLOBAL_FOG_ADD_OFFSET+2]=c.fogAtten)},t._updateUBOs=function(e,t){var n=e.exposure;this._validLights.length>this._lightBufferCount&&(this._firstLightBufferView.destroy(),this._lightBufferCount=Nn(this._validLights.length),this._lightBuffer.resize(this._lightBufferStride*this._lightBufferCount),this._lightBufferData=new Float32Array(this._lightBufferElementCount*this._lightBufferCount),this._firstLightBufferView.initialize(new qa(this._lightBuffer,0,xu.SIZE)));for(var i=0,r=0;i<this._validLights.length;i++,r+=this._lightBufferElementCount){var o=this._validLights[i];switch(o.type){case fd.SPHERE:if(Un.toArray(wg,o.position),wg[3]=0,this._lightBufferData.set(wg,r+xu.LIGHT_POS_OFFSET),wg[0]=o.size,wg[1]=o.range,wg[2]=0,this._lightBufferData.set(wg,r+xu.LIGHT_SIZE_RANGE_ANGLE_OFFSET),Un.toArray(wg,o.color),o.useColorTemperature){var a=o.colorTemperatureRGB;wg[0]*=a.x,wg[1]*=a.y,wg[2]*=a.z}this._isHDR?wg[3]=o.luminance*this._fpScale*this._lightMeterScale:wg[3]=o.luminance*n*this._lightMeterScale,this._lightBufferData.set(wg,r+xu.LIGHT_COLOR_OFFSET);break;case fd.SPOT:if(Un.toArray(wg,o.position),wg[3]=1,this._lightBufferData.set(wg,r+xu.LIGHT_POS_OFFSET),wg[0]=o.size,wg[1]=o.range,wg[2]=o.spotAngle,this._lightBufferData.set(wg,r+xu.LIGHT_SIZE_RANGE_ANGLE_OFFSET),Un.toArray(wg,o.direction),this._lightBufferData.set(wg,r+xu.LIGHT_DIR_OFFSET),Un.toArray(wg,o.color),o.useColorTemperature){var s=o.colorTemperatureRGB;wg[0]*=s.x,wg[1]*=s.y,wg[2]*=s.z}this._isHDR?wg[3]=o.luminance*this._fpScale*this._lightMeterScale:wg[3]=o.luminance*n*this._lightMeterScale,this._lightBufferData.set(wg,r+xu.LIGHT_COLOR_OFFSET)}}t.updateBuffer(this._lightBuffer,this._lightBufferData)},t._getOrCreateDescriptorSet=function(e){if(!this._descriptorSetMap.has(e)){var t=this._device,n=t.createDescriptorSet(new js(this._pipeline.descriptorSetLayout)),i=t.createBuffer(new Wa($o.UNIFORM|$o.TRANSFER_DST,ea.HOST|ea.DEVICE,au.SIZE,au.SIZE));n.bindBuffer(au.BINDING,i);var r=t.createBuffer(new Wa($o.UNIFORM|$o.TRANSFER_DST,ea.HOST|ea.DEVICE,su.SIZE,su.SIZE));n.bindBuffer(su.BINDING,r);var o=t.createBuffer(new Wa($o.UNIFORM|$o.TRANSFER_DST,ea.HOST|ea.DEVICE,cu.SIZE,cu.SIZE));return n.bindBuffer(cu.BINDING,o),n.bindSampler(lu,this._sampler),n.bindTexture(lu,ad.get("default-texture").getGFXTexture()),n.bindSampler(du,this._sampler),n.bindTexture(du,ad.get("default-texture").getGFXTexture()),n.update(),this._descriptorSetMap.set(e,n),n}return this._descriptorSetMap.get(e)},e}();Tt(ma),Tt(da),Tt(Sa),Tt(Ea),Tt(Ta),function(e){e[e.SCENE=0]="SCENE",e[e.POSTPROCESS=1]="POSTPROCESS",e[e.UI=2]="UI"}(cx||(cx={})),Tt(cx),zg=vh("RenderTextureDesc"),Bg=qh(ma),Ug=qh(da),Gg=qh(Jo),zg((kg=se((Hg=function(){ae(this,"name",kg,this),ae(this,"type",Vg,this),ae(this,"usage",jg,this),ae(this,"format",Wg,this),ae(this,"width",qg,this),ae(this,"height",Yg,this)}).prototype,"name",[Sh,Nh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Vg=se(Hg.prototype,"type",[Bg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ma.TEX2D}}),jg=se(Hg.prototype,"usage",[Ug],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return da.COLOR_ATTACHMENT}}),Wg=se(Hg.prototype,"format",[Gg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Jo.UNKNOWN}}),qg=se(Hg.prototype,"width",[Sh,Nh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),Yg=se(Hg.prototype,"height",[Sh,Nh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),Hg));var ux,hx=(Xg=vh("RenderTextureConfig"),Kg=qh(_p),Xg((Jg=se((Zg=function(){ae(this,"name",Jg,this),ae(this,"texture",$g,this)}).prototype,"name",[Sh,Nh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),$g=se(Zg.prototype,"texture",[Kg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Qg=Zg))||Qg),_x=(ey=vh("MaterialConfig"),ty=qh(fp),ey((ry=se((iy=function(){ae(this,"name",ry,this),ae(this,"material",oy,this)}).prototype,"name",[Sh,Nh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),oy=se(iy.prototype,"material",[ty],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ny=iy))||ny),fx=(ay=vh("FrameBufferDesc"),sy=qh([Kt]),cy=qh(_p),ay((uy=se((ly=function(){ae(this,"name",uy,this),ae(this,"renderPass",hy,this),ae(this,"colorTextures",_y,this),ae(this,"depthStencilTexture",fy,this),ae(this,"texture",my,this)}).prototype,"name",[Sh,Nh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),hy=se(ly.prototype,"renderPass",[Sh,Nh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),_y=se(ly.prototype,"colorTextures",[sy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),fy=se(ly.prototype,"depthStencilTexture",[Sh,Nh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),my=se(ly.prototype,"texture",[cy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ly)),dy=vh("ColorDesc"),py=qh(Jo),vy=qh(Ea),gy=qh(Sa),yy=qh(Ta),xy=qh(Ta),dy((Ty=se((Sy=function(){ae(this,"format",Ty,this),ae(this,"loadOp",Ay,this),ae(this,"storeOp",Cy,this),ae(this,"sampleCount",wy,this),ae(this,"beginLayout",Iy,this),ae(this,"endLayout",by,this)}).prototype,"format",[py],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Jo.UNKNOWN}}),Ay=se(Sy.prototype,"loadOp",[vy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ea.CLEAR}}),Cy=se(Sy.prototype,"storeOp",[gy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Sa.STORE}}),wy=se(Sy.prototype,"sampleCount",[Sh,Nh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Iy=se(Sy.prototype,"beginLayout",[yy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ta.UNDEFINED}}),by=se(Sy.prototype,"endLayout",[xy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ta.PRESENT_SRC}}),Ey=Sy))||Ey),mx=(Ry=vh("DepthStencilDesc"),Oy=qh(Jo),Ny=qh(Ea),Py=qh(Sa),My=qh(Ea),Dy=qh(Sa),Ly=qh(Ta),Fy=qh(Ta),Ry((Uy=se((By=function(){ae(this,"format",Uy,this),ae(this,"depthLoadOp",Gy,this),ae(this,"depthStoreOp",Hy,this),ae(this,"stencilLoadOp",ky,this),ae(this,"stencilStoreOp",Vy,this),ae(this,"sampleCount",jy,this),ae(this,"beginLayout",Wy,this),ae(this,"endLayout",qy,this)}).prototype,"format",[Oy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Jo.UNKNOWN}}),Gy=se(By.prototype,"depthLoadOp",[Ny],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ea.CLEAR}}),Hy=se(By.prototype,"depthStoreOp",[Py],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Sa.STORE}}),ky=se(By.prototype,"stencilLoadOp",[My],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ea.CLEAR}}),Vy=se(By.prototype,"stencilStoreOp",[Dy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Sa.STORE}}),jy=se(By.prototype,"sampleCount",[Sh,Nh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Wy=se(By.prototype,"beginLayout",[Ly],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ta.UNDEFINED}}),qy=se(By.prototype,"endLayout",[Fy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ta.DEPTH_STENCIL_ATTACHMENT_OPTIMAL}}),zy=By))||zy);Yy=vh("RenderPassDesc"),Xy=qh([fx]),Ky=qh(mx),Yy((Zy=se((Qy=function(){ae(this,"index",Zy,this),ae(this,"colorAttachments",Jy,this),ae(this,"depthStencilAttachment",$y,this)}).prototype,"index",[Sh,Nh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),Jy=se(Qy.prototype,"colorAttachments",[Xy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),$y=se(Qy.prototype,"depthStencilAttachment",[Ky],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new mx}}),Qy)),function(e){e[e.FRONT_TO_BACK=0]="FRONT_TO_BACK",e[e.BACK_TO_FRONT=1]="BACK_TO_FRONT"}(ux||(ux={})),Tt(ux);var dx,px,vx,gx,yx,xx,Ex,Sx,Tx,Ax,Cx,wx=(ex=vh("RenderQueueDesc"),tx=qh(ux),nx=qh([Kt]),ex((ox=se((rx=function(){ae(this,"isTransparent",ox,this),ae(this,"sortMode",ax,this),ae(this,"stages",sx,this)}).prototype,"isTransparent",[Sh,Nh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ax=se(rx.prototype,"sortMode",[tx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ux.FRONT_TO_BACK}}),sx=se(rx.prototype,"stages",[nx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ix=rx))||ix),Ix=new gl,bx=function(){function e(e){this._pendingModels=[],this._instancedQueue=new cg,this._pipeline=void 0,this._pipeline=e}var t=e.prototype;return t.gatherShadowPasses=function(e,t){var n=this._pipeline.shadows;if(this._pendingModels.length=0,n.enabled&&n.type===mp.Planar){this._pipeline.updateShadowUBO(e);var i=e.scene,r=e.frustum,o=0!=(e.visibility&Kl.BitMask.DEFAULT);if(i.mainLight&&o){var a=this._pipeline.renderObjects,s=Td.get(n.instancingMaterial.passes[0]);this._instancedQueue.clear(),this._instancedQueue.queue.add(s);for(var c=0;c<a.length;c++){var l=a[c].model;if(l.enabled&&l.node&&l.castShadow&&(!l.worldBounds||(gl.transform(Ix,l.worldBounds,n.matLight),al.aabbFrustum(Ix,r))))if(l.isInstancingEnabled)for(var u=0;u<l.subModels.length;u++)s.merge(l.subModels[u],l.instancedAttributes,0);else this._pendingModels.push(l)}this._instancedQueue.uploadBuffers(t)}}},t.recordCommandBuffer=function(e,t,n){var i=this._pipeline.shadows;if(i.enabled&&i.type===mp.Planar&&this._pendingModels.length){this._instancedQueue.recordCommandBuffer(e,t,n);var r=i.material.passes[0],o=Ji.get(fr.get(r.handle,Ki.DESCRIPTOR_SET));n.bindDescriptorSet(nu.MATERIAL,o);for(var a=this._pendingModels.length,s=0;s<a;s++)for(var c=this._pendingModels[s],l=0;l<c.subModels.length;l++){var u=c.subModels[l],h=Zi.get(u.planarShaderHandel),_=u.inputAssembler,f=ig.getOrCreatePipelineState(e,r,h,t,_);n.bindPipelineState(f),n.bindDescriptorSet(nu.LOCAL,u.descriptorSet),n.bindInputAssembler(_),n.draw(_)}}},e}(),Rx=function(){function e(){this._phaseID=sd("default")}var t=e.prototype;return t.activate=function(e){this._pipeline=e},t.render=function(e,t){for(var n=this._pipeline,i=n.device,r=n.commandBuffers[0],o=e.scene.batches,a=0;a<o.length;a++){var s=o[a],c=!1;if(e.visibility&s.visFlags&&(c=!0),c)for(var l=s.handle,u=Sr.get(l,vr.PASS_COUNT),h=0;h<u;h++){var _=s.passes[h];if(_.phase===this._phaseID){var f=Sr.get(l,vr.SHADER_0+h),m=Zi.get(f),d=$i.get(s.hInputAssembler),p=Ji.get(s.hDescriptorSet),v=ig.getOrCreatePipelineState(i,_,m,t,d);r.bindPipelineState(v),r.bindDescriptorSet(nu.MATERIAL,_.descriptorSet),r.bindDescriptorSet(nu.LOCAL,p),r.bindInputAssembler(d),r.draw(d)}}}},e}(),Ox=[new ls(0,0,0,1)],Nx=e("fh",(dx=vh("ForwardStage"),px=qh([wx]),vx=Gh(),dx((Sx=Ex=function(e){function t(){var t;return ae(t=e.call(this)||this,"renderQueues",xx,ie(t)),t._renderQueues=[],t._renderArea=new ss,t._batchedQueue=void 0,t._instancedQueue=void 0,t._phaseID=sd("default"),t._clearFlag=4294967295,t._batchedQueue=new sg,t._instancedQueue=new cg,t._uiPhase=new Rx,t}$(t,e);var n=t.prototype;return n.initialize=function(t){return e.prototype.initialize.call(this,t),t.renderQueues&&(this.renderQueues=t.renderQueues),!0},n.activate=function(t,n){e.prototype.activate.call(this,t,n);for(var i=0;i<this.renderQueues.length;i++){for(var r=0,o=0;o<this.renderQueues[i].stages.length;o++)r|=sd(this.renderQueues[i].stages[o]);var a=rg;switch(this.renderQueues[i].sortMode){case ux.BACK_TO_FRONT:a=og;break;case ux.FRONT_TO_BACK:a=rg}this._renderQueues[i]=new ag({isTransparent:this.renderQueues[i].isTransparent,phases:r,sortFunc:a})}this._additiveLightQueue=new lx(this._pipeline),this._planarQueue=new bx(this._pipeline),this._uiPhase.activate(t)},n.destroy=function(){},n.render=function(e){this._instancedQueue.clear(),this._batchedQueue.clear();var t=this._pipeline,n=t.device;this._renderQueues.forEach(this.renderQueueClearFunc);for(var i=t.renderObjects,r=0,o=0,a=0,s=0;s<i.length;++s){var c=i[s],l=c.model.subModels;for(r=0;r<l.length;++r){var u=l[r],h=u.passes;for(o=0;o<h.length;++o){var _=h[o];if(_.phase===this._phaseID){var f=_.batchingScheme;if(f===id.INSTANCING){var m=Td.get(_);m.merge(u,c.model.instancedAttributes,o),this._instancedQueue.queue.add(m)}else if(f===id.VB_MERGING){var d=lg.get(_);d.merge(u,o,c.model),this._batchedQueue.queue.add(d)}else for(a=0;a<this._renderQueues.length;a++)this._renderQueues[a].insertRenderPass(c,r,o)}}}}this._renderQueues.forEach(this.renderQueueSortFunc);var p=t.commandBuffers[0];this._instancedQueue.uploadBuffers(p),this._batchedQueue.uploadBuffers(p),this._additiveLightQueue.gatherLightPasses(e,p),this._planarQueue.gatherShadowPasses(e,p);var v,g,y=e.viewport,x=e.window.hasOnScreenAttachments&&n.surfaceTransform%2?e.height:e.width,E=e.window.hasOnScreenAttachments&&n.surfaceTransform%2?e.width:e.height;if(this._renderArea.x=y.x*x,this._renderArea.y=y.y*E,this._renderArea.width=y.width*x*t.shadingScale,this._renderArea.height=y.height*E*t.shadingScale,e.clearFlag&ba.COLOR)if(t.isHDR){v=Ox[0],g=e.clearColor,v.x=g.x*g.x,v.y=g.y*g.y,v.z=g.z*g.z;var S=t.fpScale/e.exposure;Ox[0].x*=S,Ox[0].y*=S,Ox[0].z*=S}else Ox[0].x=e.clearColor.x,Ox[0].y=e.clearColor.y,Ox[0].z=e.clearColor.z;Ox[0].w=e.clearColor.w;var T=e.window.framebuffer,A=T.colorTextures[0]?T.renderPass:t.getRenderPass(e.clearFlag&this._clearFlag);p.beginRenderPass(A,T,this._renderArea,Ox,e.clearDepth,e.clearStencil),p.bindDescriptorSet(nu.GLOBAL,t.descriptorSet),this._renderQueues[0].recordCommandBuffer(n,A,p),this._instancedQueue.recordCommandBuffer(n,A,p),this._batchedQueue.recordCommandBuffer(n,A,p),this._additiveLightQueue.recordCommandBuffer(n,A,p),this._planarQueue.recordCommandBuffer(n,A,p),this._renderQueues[1].recordCommandBuffer(n,A,p),this._uiPhase.render(e,A),p.endRenderPass()},n.renderQueueClearFunc=function(e){e.clear()},n.renderQueueSortFunc=function(e){e.sort()},t}(Vv),Ex.initInfo={name:"ForwardStage",priority:eg.FORWARD,tag:0,renderQueues:[{isTransparent:!1,sortMode:ux.FRONT_TO_BACK,stages:["default"]},{isTransparent:!0,sortMode:ux.BACK_TO_FRONT,stages:["default","planarShadow"]}]},xx=se((yx=Sx).prototype,"renderQueues",[px,Sh,vx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),gx=yx))||gx)),Px=e("fg",vh("ForwardFlow")((Cx=Ax=function(e){function t(){return e.apply(this,arguments)||this}$(t,e);var n=t.prototype;return n.initialize=function(t){if(e.prototype.initialize.call(this,t),0===this._stages.length){var n=new Nx;n.initialize(Nx.initInfo),this._stages.push(n)}return!0},n.activate=function(t){e.prototype.activate.call(this,t)},n.render=function(t){(function(e,t){var n=t.scene,i=n.mainLight,r=e.shadows,o=e.renderObjects;gg.freeArray(o),o.length=0,r.enabled&&zn.toArray(e.shadowUBO,r.shadowColor,cu.SHADOW_COLOR_OFFSET),i&&r.type===mp.Planar&&function(e,t){var n=e.shadows,i=t.direction,r=n.normal,o=n.distance+.001,a=1/Un.dot(r,i),s=i.x*a,c=i.y*a,l=i.z*a,u=r.x,h=r.y,_=r.z,f=n.matLight;f.m00=1-u*s,f.m01=-u*c,f.m02=-u*l,f.m03=0,f.m04=-h*s,f.m05=1-h*c,f.m06=-h*l,f.m07=0,f.m08=-_*s,f.m09=-_*c,f.m10=1-_*l,f.m11=0,f.m12=s*o,f.m13=c*o,f.m14=l*o,f.m15=1,ei.toArray(e.shadowUBO,n.matLight,cu.MAT_LIGHT_PLANE_PROJ_OFFSET)}(e,i),e.skybox.enabled&&e.skybox.model&&t.clearFlag&ah&&o.push(xg(e.skybox.model,t));for(var a=n.models,s=0;s<a.length;s++){var c=a[s];if(c.enabled&&(c.node&&(t.visibility&c.node.layer)===c.node.layer||t.visibility&c.visFlags)){if(c.worldBounds&&!al.aabbFrustum(c.worldBounds,t.frustum))continue;o.push(xg(c,t))}}})(this._pipeline,t),e.prototype.render.call(this,t)},n.destroy=function(){e.prototype.destroy.call(this)},t}($v),Ax.initInfo={name:"ForwardFlow",priority:tg.FORWARD,stages:[]},Tx=Cx))||Tx),Mx=new ei,Dx=new ei,Lx=new ci,Fx=new Un,zx=new ei,Bx=sd("shadow-caster"),Ux=[];function Gx(e,t){t.length=0;for(var n=!1,i=0;i<e.length;i++){for(var r=e[i].passes,o=-1,a=0;a<r.length;a++)if(r[a].phase===Bx){o=a,n=!0;break}t.push(o)}return n}var Hx,kx,Vx,jx,Wx,qx,Yx,Xx,Kx,Qx,Zx,Jx,$x,eE,tE,nE,iE=function(){function e(e){this._pipeline=void 0,this._subModelsArray=[],this._passArray=[],this._shaderArray=[],this._shadowMapBuffer=void 0,this._device=void 0,this._shadowInfo=void 0,this._descriptorSet=void 0,this._shadowObjects=void 0,this._shadowUBO=void 0,this._instancedQueue=void 0,this._batchedQueue=void 0,this._pipeline=e,this._device=e.device,this._shadowInfo=e.shadows,this._descriptorSet=e.descriptorSet,this._shadowObjects=e.shadowObjects,this._shadowUBO=e.shadowUBO,this._shadowMapBuffer=e.descriptorSet.getBuffer(cu.BINDING),this._instancedQueue=new cg,this._batchedQueue=new sg}var t=e.prototype;return t.gatherLightPasses=function(e,t){if(this.clear(),e&&this._shadowInfo.enabled&&this._shadowInfo.type===mp.ShadowMap){this._updateUBOs(e);for(var n=0;n<this._shadowObjects.length;n++){var i=this._shadowObjects[n].model;if(Gx(i.subModels,Ux))switch(e.type){case fd.DIRECTIONAL:this.add(i,t,Ux);break;case fd.SPOT:if(i.worldBounds&&(!al.aabbWithAABB(i.worldBounds,e.aabb)||!al.aabbFrustum(i.worldBounds,e.frustum)))continue;this.add(i,t,Ux)}}}},t.clear=function(){this._subModelsArray.length=0,this._shaderArray.length=0,this._passArray.length=0,this._instancedQueue.clear(),this._batchedQueue.clear()},t.add=function(e,t,n){for(var i=e.subModels,r=0;r<i.length;r++){var o=i[r],a=n[r],s=o.passes[a],c=s.batchingScheme;if(o.descriptorSet.bindBuffer(cu.BINDING,this._shadowMapBuffer),o.descriptorSet.update(),c===id.INSTANCING){var l=Td.get(s);l.merge(o,e.instancedAttributes,a),this._instancedQueue.queue.add(l)}else if(s.batchingScheme===id.VB_MERGING){var u=lg.get(s);u.merge(o,a,e),this._batchedQueue.queue.add(u)}else{var h=Zi.get(pr.get(o.handle,hr.SHADER_0+a));this._subModelsArray.push(o),this._shaderArray.push(h),this._passArray.push(s)}}this._instancedQueue.uploadBuffers(t),this._batchedQueue.uploadBuffers(t)},t.recordCommandBuffer=function(e,t,n){this._instancedQueue.recordCommandBuffer(e,t,n),this._batchedQueue.recordCommandBuffer(e,t,n);for(var i=0;i<this._subModelsArray.length;++i){var r=this._subModelsArray[i],o=this._shaderArray[i],a=this._passArray[i],s=r.inputAssembler,c=ig.getOrCreatePipelineState(e,a,o,t,s),l=a.descriptorSet;n.bindPipelineState(c),n.bindDescriptorSet(nu.MATERIAL,l),n.bindDescriptorSet(nu.LOCAL,r.descriptorSet),n.bindInputAssembler(s),n.draw(s)}},t._updateUBOs=function(e){var t=0,n=0,i=0;switch(e.type){case fd.DIRECTIONAL:if(e.update(),this._shadowInfo.autoAdapt){var r=e.node;r&&(zx=Sg(this._pipeline,r.getWorldRotation(),e.direction,Fx));var o=this._shadowInfo.sphere.radius;t=o*this._shadowInfo.aspect,n=o;var a=Un.distance(this._shadowInfo.sphere.center,Fx);i=Math.min(a*vp.COEFFICIENT_OF_EXPANSION,vp.MAX_FAR)}else zx=e.node.getWorldMatrix(),t=this._shadowInfo.orthoSize*this._shadowInfo.aspect,n=this._shadowInfo.orthoSize,i=this._shadowInfo.far;ei.invert(Mx,zx),ei.ortho(Dx,-t,t,-n,n,this._shadowInfo.near,i,this._device.clipSpaceMinZ,this._device.screenSpaceSignY*this._device.UVSpaceSignY);break;case fd.SPOT:ei.invert(Mx,e.node.getWorldMatrix()),ei.perspective(Dx,e.spotAngle,e.aspect,.001,e.range)}ei.multiply(Dx,Dx,Mx),ei.toArray(this._shadowUBO,Dx,cu.MAT_LIGHT_VIEW_PROJ_OFFSET),zn.toArray(this._shadowUBO,this._shadowInfo.shadowColor,cu.SHADOW_COLOR_OFFSET),Lx.set(this._shadowInfo.size.x,this._shadowInfo.size.y,this._shadowInfo.pcf,this._shadowInfo.bias),ci.toArray(this._shadowUBO,Lx,cu.SHADOW_INFO_OFFSET),this._descriptorSet.getBuffer(cu.BINDING).update(this._shadowUBO)},e}(),rE=[new ls(1,1,1,1)],oE=e("fj",vh("ShadowStage")((Vx=kx=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this)._shadowFrameBuffer=null,t._renderArea=new ss,t._light=null,t}$(t,e);var n=t.prototype;return n.setUsage=function(e,t){this._light=e,this._shadowFrameBuffer=t},n.destroy=function(){this._additiveShadowQueue.clear()},n.clearFramebuffer=function(e){if(this._light&&this._shadowFrameBuffer){rE[0].w=e.clearColor.w;var t=this._pipeline.commandBuffers[0],n=this._shadowFrameBuffer.renderPass;t.beginRenderPass(n,this._shadowFrameBuffer,this._renderArea,rE,e.clearDepth,e.clearStencil),t.endRenderPass()}},n.render=function(e){var t=this._pipeline,n=t.shadows,i=t.commandBuffers[0];if(this._light&&this._shadowFrameBuffer){this._additiveShadowQueue.gatherLightPasses(this._light,i);var r=e.viewport,o=n.size;this._renderArea.x=r.x*o.x,this._renderArea.y=r.y*o.y,this._renderArea.width=r.width*o.x*t.shadingScale,this._renderArea.height=r.height*o.y*t.shadingScale;var a=t.device,s=this._shadowFrameBuffer.renderPass;i.beginRenderPass(s,this._shadowFrameBuffer,this._renderArea,rE,e.clearDepth,e.clearStencil),i.bindDescriptorSet(nu.GLOBAL,t.descriptorSet),this._additiveShadowQueue.recordCommandBuffer(a,s,i),i.endRenderPass()}},n.activate=function(t,n){e.prototype.activate.call(this,t,n),this._additiveShadowQueue=new iE(t)},t}(Vv),kx.initInfo={name:"ShadowStage",priority:eg.FORWARD,tag:0},Hx=Vx))||Hx),aE=e("fi",vh("ShadowFlow")((qx=Wx=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this)._shadowRenderPass=null,t}$(t,e);var n=t.prototype;return n.initialize=function(t){if(e.prototype.initialize.call(this,t),0===this._stages.length){var n=new oE;n.initialize(oE.initInfo),this._stages.push(n)}return!0},n.render=function(e){var t=this._pipeline,n=t.shadows;if(n.enabled&&n.type===mp.ShadowMap){var i=function(e,t){pg.length=0;var n=e.scene;pg.push(n.mainLight);for(var i=n.spotLights,r=0;r<i.length;r++){var o=i[r];Yo.set(vg,o.position.x,o.position.y,o.position.z,o.range),al.sphereFrustum(vg,e.frustum)&&t>pg.length&&pg.push(o)}return pg}(e,n.maxReceived);if(function(e,t){var n=t.scene,i=e.shadows,r=e.shadowObjects;yg.freeArray(r),r.length=0,dg=!1;for(var o=n.models,a=0;a<o.length;a++){var s=o[a];(s.node&&(t.visibility&s.node.layer)===s.node.layer||t.visibility&s.visFlags)&&s.castShadow&&s.worldBounds&&(dg||(mg.copy(s.worldBounds),dg=!0),gl.merge(mg,mg,s.worldBounds),r.push(Eg(s,t)))}mg&&gl.toBoundingSphere(i.sphere,mg)}(t,e),0!==t.shadowObjects.length){for(var r=0;r<i.length;r++){var o=i[r];t.shadowFrameBufferMap.has(o)||this._initShadowFrameBuffer(t,o);var a=t.shadowFrameBufferMap.get(o);n.shadowMapDirty&&this.resizeShadowMap(o,n.size);for(var s=0;s<this._stages.length;s++){var c=this._stages[s];c.setUsage(o,a),c.render(e)}}t.updateShadowUBO(e)}else this.clearShadowMap(i,e)}},n.destroy=function(){e.prototype.destroy.call(this);for(var t=Array.from(this._pipeline.shadowFrameBufferMap.values()),n=0;n<t.length;n++){var i=t[n];if(i){for(var r=i.colorTextures,o=0;o<r.length;o++){var a=r[n];a&&a.destroy()}r.length=0;var s=i.depthStencilTexture;s&&s.destroy(),i.destroy()}}this._pipeline.shadowFrameBufferMap.clear(),this._shadowRenderPass&&this._shadowRenderPass.destroy()},n._initShadowFrameBuffer=function(e,t){var n=e.device,i=e.shadows.size;if(!this._shadowRenderPass){var r=new As;r.format=Jo.RGBA8,r.loadOp=Ea.CLEAR,r.storeOp=Sa.STORE,r.sampleCount=1,r.beginLayout=Ta.UNDEFINED,r.endLayout=Ta.PRESENT_SRC;var o=new Cs;o.format=n.depthStencilFormat,o.depthLoadOp=Ea.CLEAR,o.depthStoreOp=Sa.DISCARD,o.stencilLoadOp=Ea.CLEAR,o.stencilStoreOp=Sa.DISCARD,o.sampleCount=1,o.beginLayout=Ta.UNDEFINED,o.endLayout=Ta.DEPTH_STENCIL_ATTACHMENT_OPTIMAL;var a=new Is([r],o);this._shadowRenderPass=n.createRenderPass(a)}var s=[];s.push(n.createTexture(new zs(ma.TEX2D,da.COLOR_ATTACHMENT|da.SAMPLED,Jo.RGBA8,i.x,i.y)));var c=n.createTexture(new zs(ma.TEX2D,da.DEPTH_STENCIL_ATTACHMENT,n.depthStencilFormat,i.x,i.y)),l=n.createFramebuffer(new $a(this._shadowRenderPass,s,c));e.shadowFrameBufferMap.set(t,l)},n.clearShadowMap=function(e,t){for(var n=this._pipeline,i=0;i<e.length;i++){var r=e[i],o=n.shadowFrameBufferMap.get(r);if(n.shadowFrameBufferMap.has(r))for(var a=0;a<this._stages.length;a++){var s=this._stages[a];s.setUsage(r,o),s.clearFramebuffer(t)}}},n.resizeShadowMap=function(e,t){var n=t.x,i=t.y,r=this._pipeline;if(r.shadowFrameBufferMap.has(e)){var o=r.shadowFrameBufferMap.get(e);if(!o)return;var a=o.colorTextures;if(a&&a.length>0)for(var s=0;s<a.length;s++){var c=a[s];c&&c.resize(n,i)}var l=o.depthStencilTexture;l&&l.resize(n,i);var u=o.renderPass;o.destroy(),o.initialize(new $a(u,a,l))}},t}($v),Wx.initInfo={name:"ShadowFlow",priority:tg.SHADOW,tag:cx.SCENE,stages:[]},jx=qx))||jx),sE=xt({LINEAR:0,EXP:1,EXP_SQUARED:2,LAYERED:3}),cE=sE.LAYERED+1,lE=function(){function e(){this._fogColor=new zn("#C8C8C8"),this._colorArray=new Float32Array([.2,.2,.2,1]),this._handle=Qi,this._handle=Jr.alloc()}Z(e,[{key:"enabled",set:function(e){Jr.set(this._handle,Yr.ENABLE,e?1:0),e||Jr.set(this._handle,Yr.TYPE,cE),e?this.activate():this._updatePipeline()},get:function(){return Jr.get(this._handle,Yr.ENABLE)}},{key:"fogColor",set:function(e){this._fogColor.set(e),zn.toArray(this._colorArray,this._fogColor),Jr.setVec4(this._handle,Yr.COLOR,this._fogColor)},get:function(){return this._fogColor}},{key:"type",get:function(){return Jr.get(this._handle,Yr.TYPE)},set:function(e){Jr.set(this._handle,Yr.TYPE,this.enabled?e:cE),this.enabled&&this._updatePipeline()}},{key:"fogDensity",get:function(){return Jr.get(this._handle,Yr.DENSITY)},set:function(e){Jr.set(this._handle,Yr.DENSITY,e)}},{key:"fogStart",get:function(){return Jr.get(this._handle,Yr.START)},set:function(e){Jr.set(this._handle,Yr.START,e)}},{key:"fogEnd",get:function(){return Jr.get(this._handle,Yr.END)},set:function(e){Jr.set(this._handle,Yr.END,e)}},{key:"fogAtten",get:function(){return Jr.get(this._handle,Yr.ATTEN)},set:function(e){Jr.set(this._handle,Yr.ATTEN,e)}},{key:"fogTop",get:function(){return Jr.get(this._handle,Yr.TOP)},set:function(e){Jr.set(this._handle,Yr.TOP,e)}},{key:"fogRange",get:function(){return Jr.get(this._handle,Yr.RANGE)},set:function(e){Jr.set(this._handle,Yr.RANGE,e)}},{key:"colorArray",get:function(){return this._colorArray}},{key:"handle",get:function(){return this._handle}}]);var t=e.prototype;return t.initialize=function(e){Jr.set(this._handle,Yr.ENABLE,e.enabled?1:0),Jr.set(this._handle,Yr.TYPE,e.enabled?e.type:cE),this._fogColor.set(e.fogColor),zn.toArray(this._colorArray,this._fogColor),Jr.setVec4(this._handle,Yr.COLOR,this._fogColor),Jr.set(this._handle,Yr.DENSITY,e.fogDensity),Jr.set(this._handle,Yr.START,e.fogStart),Jr.set(this._handle,Yr.END,e.fogEnd),Jr.set(this._handle,Yr.ATTEN,e.fogAtten),Jr.set(this._handle,Yr.TOP,e.fogTop),Jr.set(this._handle,Yr.RANGE,e.fogRange)},t.activate=function(){this._updatePipeline()},t._updatePipeline=function(){var e=c.director.root,t=this.enabled?this.type:cE,n=e.pipeline;n.macros.CC_USE_FOG!==t&&(n.macros.CC_USE_FOG=t,e.onGlobalPipelineStateChanged())},t.destroy=function(){this._handle&&(Jr.free(this._handle),this._handle=Qi)},e}();c.Fog=lE;var uE=new ei,hE=new ei,_E=new Un,fE=[_a.LINEAR,_a.LINEAR,_a.NONE,fa.CLAMP,fa.CLAMP,fa.CLAMP],mE=e("ff",(Yx=vh("ForwardPipeline"),Xx=qh([hx]),Kx=Gh(),Qx=qh([_x]),Zx=Gh(),Yx((nE=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ae(t=e.call.apply(e,[this].concat(i))||this,"renderTextures",eE,ie(t)),ae(t,"materials",tE,ie(t)),t.fog=new lE,t.ambient=new Co,t.skybox=new Sp,t.shadows=new vp,t.renderObjects=[],t.shadowObjects=[],t.shadowFrameBufferMap=new Map,t._isHDR=!1,t._shadingScale=1,t._fpScale=1/1024,t._renderPasses=new Map,t._globalUBO=new Float32Array(au.COUNT),t._cameraUBO=new Float32Array(su.COUNT),t._shadowUBO=new Float32Array(cu.COUNT),t}$(t,e);var n=t.prototype;return n.initialize=function(t){if(e.prototype.initialize.call(this,t),0===this._flows.length){var n=new aE;n.initialize(aE.initInfo),this._flows.push(n);var i=new Px;i.initialize(Px.initInfo),this._flows.push(i)}return!0},n.activate=function(){return this._macros={},!(!e.prototype.activate.call(this)||!this._activeRenderer()&&(R(2402),1))},n.render=function(e){this._commandBuffers[0].begin(),this.updateGlobalUBO();for(var t=0;t<e.length;t++){var n=e[t];if(n.scene){this.updateCameraUBO(n);for(var i=0;i<this._flows.length;i++)this._flows[i].render(n)}}this._commandBuffers[0].end(),this._device.queue.submit(this._commandBuffers)},n.getRenderPass=function(e){var t=this._renderPasses.get(e);if(t)return t;var n=this.device,i=new As,r=new Cs;i.format=n.colorFormat,r.format=n.depthStencilFormat,r.stencilStoreOp=Sa.DISCARD,r.depthStoreOp=Sa.DISCARD,e&ba.COLOR||(e&ah?i.loadOp=Ea.DISCARD:(i.loadOp=Ea.LOAD,i.beginLayout=Ta.PRESENT_SRC)),(e&ba.DEPTH_STENCIL)!==ba.DEPTH_STENCIL&&(e&ba.DEPTH||(r.depthLoadOp=Ea.LOAD),e&ba.STENCIL||(r.stencilLoadOp=Ea.LOAD),r.beginLayout=Ta.DEPTH_STENCIL_ATTACHMENT_OPTIMAL);var o=new Is([i],r);return t=n.createRenderPass(o),this._renderPasses.set(e,t),t},n.updateGlobalUBO=function(){this._descriptorSet.update();var e=c.director.root,t=this._globalUBO,n=this.device,i=Math.floor(n.width),r=Math.floor(n.height);t[au.TIME_OFFSET]=e.cumulativeTime,t[au.TIME_OFFSET+1]=e.frameTime,t[au.TIME_OFFSET+2]=c.director.getTotalFrames(),t[au.SCREEN_SIZE_OFFSET]=n.width,t[au.SCREEN_SIZE_OFFSET+1]=n.height,t[au.SCREEN_SIZE_OFFSET+2]=1/n.width,t[au.SCREEN_SIZE_OFFSET+3]=1/n.height,t[au.NATIVE_SIZE_OFFSET]=i,t[au.NATIVE_SIZE_OFFSET+1]=r,t[au.NATIVE_SIZE_OFFSET+2]=1/t[au.NATIVE_SIZE_OFFSET],t[au.NATIVE_SIZE_OFFSET+3]=1/t[au.NATIVE_SIZE_OFFSET+1],this._commandBuffers[0].updateBuffer(this._descriptorSet.getBuffer(au.BINDING),this._globalUBO)},n._activeRenderer=function(){var e=this.device;this._commandBuffers.push(e.commandBuffer);var t=e.createBuffer(new Wa($o.UNIFORM|$o.TRANSFER_DST,ea.HOST|ea.DEVICE,au.SIZE,au.SIZE));this._descriptorSet.bindBuffer(au.BINDING,t);var n=e.createBuffer(new Wa($o.UNIFORM|$o.TRANSFER_DST,ea.HOST|ea.DEVICE,su.SIZE,su.SIZE));this._descriptorSet.bindBuffer(su.BINDING,n);var i=e.createBuffer(new Wa($o.UNIFORM|$o.TRANSFER_DST,ea.HOST|ea.DEVICE,cu.SIZE,cu.SIZE));this._descriptorSet.bindBuffer(cu.BINDING,i);var r=rf(fE),o=gf.getSampler(e,r);return this._descriptorSet.bindSampler(lu,o),this._descriptorSet.bindTexture(lu,ad.get("default-texture").getGFXTexture()),this._descriptorSet.bindSampler(du,o),this._descriptorSet.bindTexture(du,ad.get("default-texture").getGFXTexture()),this._descriptorSet.update(),this.macros.CC_USE_HDR=this._isHDR,this.macros.CC_SUPPORT_FLOAT_TEXTURE=this.device.hasFeature(Pa.TEXTURE_FLOAT),!0},n.updateShadowUBO=function(e){this._descriptorSet.update();var t=e.scene.mainLight,n=this.device,i=this.shadows;if(i.enabled){if(t&&i.type===mp.ShadowMap){var r;this.shadowFrameBufferMap.has(t)&&this._descriptorSet.bindTexture(lu,this.shadowFrameBufferMap.get(t).colorTextures[0]);var o=0,a=0,s=0;if(i.autoAdapt){r=Sg(this,t.node.getWorldRotation(),t.direction,_E);var c=i.sphere.radius;o=c*i.aspect,a=c;var l=Un.distance(i.sphere.center,_E);s=Math.min(l*vp.COEFFICIENT_OF_EXPANSION,vp.MAX_FAR)}else r=t.node.getWorldMatrix(),o=i.orthoSize*i.aspect,a=i.orthoSize,s=i.far;ei.invert(uE,r);var u=n.screenSpaceSignY*n.UVSpaceSignY;ei.ortho(hE,-o,o,-a,a,i.near,s,n.clipSpaceMinZ,u),ei.multiply(hE,hE,uE),ei.toArray(this._shadowUBO,hE,cu.MAT_LIGHT_VIEW_PROJ_OFFSET),this._shadowUBO[cu.SHADOW_INFO_OFFSET]=i.size.x,this._shadowUBO[cu.SHADOW_INFO_OFFSET+1]=i.size.y,this._shadowUBO[cu.SHADOW_INFO_OFFSET+2]=i.pcf,this._shadowUBO[cu.SHADOW_INFO_OFFSET+3]=i.bias}else t&&i.type===mp.Planar&&Tg(i,t,this._shadowUBO);zn.toArray(this._shadowUBO,i.shadowColor,cu.SHADOW_COLOR_OFFSET),this._commandBuffers[0].updateBuffer(this._descriptorSet.getBuffer(cu.BINDING),this._shadowUBO)}},n.updateCameraUBO=function(e){var t=this.device,n=(e.scene?e.scene:c.director.getScene().renderScene).mainLight,i=this.ambient,r=this.fog,o=Math.floor(t.width),a=Math.floor(t.height),s=this._cameraUBO,l=e.exposure;if(s[su.SCREEN_SCALE_OFFSET]=e.width/o*this.shadingScale,s[su.SCREEN_SCALE_OFFSET+1]=e.height/a*this.shadingScale,s[su.SCREEN_SCALE_OFFSET+2]=1/s[su.SCREEN_SCALE_OFFSET],s[su.SCREEN_SCALE_OFFSET+3]=1/s[su.SCREEN_SCALE_OFFSET+1],s[su.EXPOSURE_OFFSET]=l,s[su.EXPOSURE_OFFSET+1]=1/l,s[su.EXPOSURE_OFFSET+2]=this._isHDR?1:0,s[su.EXPOSURE_OFFSET+3]=this._fpScale/l,n){if(Un.toArray(s,n.direction,su.MAIN_LIT_DIR_OFFSET),Un.toArray(s,n.color,su.MAIN_LIT_COLOR_OFFSET),n.useColorTemperature){var u=n.colorTemperatureRGB;s[su.MAIN_LIT_COLOR_OFFSET]*=u.x,s[su.MAIN_LIT_COLOR_OFFSET+1]*=u.y,s[su.MAIN_LIT_COLOR_OFFSET+2]*=u.z}this._isHDR?s[su.MAIN_LIT_COLOR_OFFSET+3]=n.illuminance*this._fpScale:s[su.MAIN_LIT_COLOR_OFFSET+3]=n.illuminance*l}else Un.toArray(s,Un.UNIT_Z,su.MAIN_LIT_DIR_OFFSET),ci.toArray(s,ci.ZERO,su.MAIN_LIT_COLOR_OFFSET);var h=i.colorArray;this._isHDR?h[3]=i.skyIllum*this._fpScale:h[3]=i.skyIllum*l,s.set(h,su.AMBIENT_SKY_OFFSET),s.set(i.albedoArray,su.AMBIENT_GROUND_OFFSET),ei.toArray(s,e.matView,su.MAT_VIEW_OFFSET),ei.toArray(s,e.node.worldMatrix,su.MAT_VIEW_INV_OFFSET),ei.toArray(s,e.matProj,su.MAT_PROJ_OFFSET),ei.toArray(s,e.matProjInv,su.MAT_PROJ_INV_OFFSET),ei.toArray(s,e.matViewProj,su.MAT_VIEW_PROJ_OFFSET),ei.toArray(s,e.matViewProjInv,su.MAT_VIEW_PROJ_INV_OFFSET),Un.toArray(s,e.position,su.CAMERA_POS_OFFSET);var _=t.screenSpaceSignY;e.window.hasOffScreenAttachments&&(_*=t.UVSpaceSignY),s[su.CAMERA_POS_OFFSET+3]=_,r.enabled&&(s.set(r.colorArray,su.GLOBAL_FOG_COLOR_OFFSET),s[su.GLOBAL_FOG_BASE_OFFSET]=r.fogStart,s[su.GLOBAL_FOG_BASE_OFFSET+1]=r.fogEnd,s[su.GLOBAL_FOG_BASE_OFFSET+2]=r.fogDensity,s[su.GLOBAL_FOG_ADD_OFFSET]=r.fogTop,s[su.GLOBAL_FOG_ADD_OFFSET+1]=r.fogRange,s[su.GLOBAL_FOG_ADD_OFFSET+2]=r.fogAtten),this._commandBuffers[0].updateBuffer(this._descriptorSet.getBuffer(su.BINDING),this._cameraUBO)},n.destroyUBOs=function(){this._descriptorSet&&(this._descriptorSet.getBuffer(au.BINDING).destroy(),this._descriptorSet.getBuffer(cu.BINDING).destroy(),this._descriptorSet.getBuffer(su.BINDING).destroy(),this._descriptorSet.getSampler(lu).destroy(),this._descriptorSet.getSampler(du).destroy(),this._descriptorSet.getTexture(lu).destroy(),this._descriptorSet.getTexture(du).destroy())},n.destroy=function(){this.destroyUBOs();for(var t=this._renderPasses.values(),n=t.next();!n.done;)n.value.destroy(),n=t.next();return this._commandBuffers.length=0,this.ambient.destroy(),this.skybox.destroy(),this.fog.destroy(),this.shadows.destroy(),e.prototype.destroy.call(this)},Z(t,[{key:"isHDR",get:function(){return this._isHDR},set:function(e){this._isHDR!==e&&(this._isHDR=e,this._cameraUBO[su.EXPOSURE_OFFSET+2]=this._isHDR?1:0)}},{key:"shadingScale",get:function(){return this._shadingScale}},{key:"fpScale",get:function(){return this._fpScale}},{key:"shadowUBO",get:function(){return this._shadowUBO}}]),t}(ng),eE=se(($x=nE).prototype,"renderTextures",[Xx,Sh,Kx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),tE=se($x.prototype,"materials",[Qx,Sh,Zx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Jx=$x))||Jx));var dE=A_.Flags.Destroyed,pE=A_.Flags.PersistentMask,vE=_n.IDENTIFIER_RE,gE={"cc.ClickEvent":!1,"cc.PrefabInfo":!1},yE=_n.escapeForJS,xE=function(){function e(e,t){this.varName=void 0,this.expression=void 0,this.varName=e,this.expression=t}return e.prototype.toString=function(){return"var "+this.varName+"="+this.expression+";"},e}();function EE(e,t){return t instanceof xE?new xE(t.varName,e+t.expression):e+t}function SE(e,t,n){Array.isArray(n)?(n[0]=EE(t,n[0]),e.push(n)):e.push(EE(t,n)+";")}var TE=function(){function e(e){this._exps=void 0,this._targetExp=void 0,this._exps=[],this._targetExp=e}var t=e.prototype;return t.append=function(e,t){this._exps.push([e,t])},t.writeCode=function(e){var t;if(this._exps.length>1)e.push("t="+this._targetExp+";"),t="t";else{if(1!==this._exps.length)return;t=this._targetExp}for(var n=0;n<this._exps.length;n++){var i=this._exps[n];SE(e,t+AE(i[0])+"=",i[1])}},e}();function AE(e){return vE.test(e)?"."+e:"["+yE(e)+"]"}TE.pool=void 0,TE.pool=new pt((function(e){e._exps.length=0,e._targetExp=null}),1),TE.pool.get=function(e){var t=this._get()||new TE;return t._targetExp=e,t};var CE=function(){function e(e,t){var n;this.parent=void 0,this.objsToClear_iN$t=void 0,this.codeArray=void 0,this.objs=void 0,this.funcs=void 0,this.funcModuleCache=void 0,this.globalVariables=void 0,this.globalVariableId=void 0,this.localVariableId=void 0,this.result=void 0,this.parent=t,this.objsToClear_iN$t=[],this.codeArray=[],this.objs=[],this.funcs=[],this.funcModuleCache=ke(),$e(this.funcModuleCache,gE),this.globalVariables=[],this.globalVariableId=0,this.localVariableId=0,this.codeArray.push("var o,t;","if(R){","o=R;","}else{","o=R=new "+this.getFuncModule(e.constructor,!0)+"();","}"),e._iN$t={globalVar:"R"},this.objsToClear_iN$t.push(e),this.enumerateObject(this.codeArray,e),this.globalVariables.length>0&&(n="var "+this.globalVariables.join(",")+";");var i=function(e){var t=[];return function e(t,n){for(var i,r=oe(n);!(i=r()).done;){var o=i.value;Array.isArray(o)?e(t,o):t.push(o)}}(t,e),t.join("")}(["return (function(R){",n||[],this.codeArray,"return o;","})"]);this.result=Function("O","F",i)(this.objs,this.funcs);for(var r=0,o=this.objsToClear_iN$t.length;r<o;++r)this.objsToClear_iN$t[r]._iN$t=null;this.objsToClear_iN$t.length=0}var t=e.prototype;return t.getFuncModule=function(e,t){var n=Ve(e);if(n){var i=this.funcModuleCache[n];if(i)return i;if(void 0===i){var r=-1!==n.indexOf(".");if(r)try{if(r=e===Function("return "+n)())return this.funcModuleCache[n]=n,n}catch(e){}}}var o=this.funcs.indexOf(e);o<0&&(o=this.funcs.length,this.funcs.push(e));var a="F["+o+"]";return t&&(a="("+a+")"),this.funcModuleCache[n]=a,a},t.getObjRef=function(e){var t=this.objs.indexOf(e);return t<0&&(t=this.objs.length,this.objs.push(e)),"O["+t+"]"},t.setValueType=function(e,t,n,i){var r=TE.pool.get(i),o=t.constructor.__props__;o||(o=Object.keys(t));for(var a=0;a<o.length;a++){var s=o[a],c=n[s];if(t[s]!==c){var l=this.enumerateField(n,s,c);r.append(s,l)}}r.writeCode(e),TE.pool.put(r)},t.enumerateCCClass=function(e,t,n){for(var i=n.__values__,r=Vt(n),o=0;o<i.length;o++){var a=i[o],s=t[a],l=r[a+"$_$default"];if(!wE(l,s))if("object"==typeof s&&s instanceof c.ValueType&&(l=_n.getDefault(l))&&l.constructor===s.constructor){var u="o"+AE(a);this.setValueType(e,l,s,u)}else this.setObjProp(e,t,a,s)}},t.instantiateArray=function(e){if(0===e.length)return"[]";var t="a"+ ++this.localVariableId,n=[new xE(t,"new Array("+e.length+")")];e._iN$t={globalVar:"",source:n},this.objsToClear_iN$t.push(e);for(var i=0;i<e.length;++i)SE(n,t+"["+i+"]=",this.enumerateField(e,i,e[i]));return n},t.instantiateTypedArray=function(e){var t=e.constructor.name;if(0===e.length)return"new "+t;var n="a"+ ++this.localVariableId,i=[new xE(n,"new "+t+"("+e.length+")")];e._iN$t={globalVar:"",source:i},this.objsToClear_iN$t.push(e);for(var r=0;r<e.length;++r)0!==e[r]&&SE(i,n+"["+r+"]=",e[r]);return i},t.enumerateField=function(e,t,n){if("object"==typeof n&&n){var i=n._iN$t;if(i){var r=i.globalVar;if(!r){r=i.globalVar="v"+ ++this.globalVariableId,this.globalVariables.push(r);var o=i.source[0];i.source[0]=EE(r+"=",o)}return r}return ArrayBuffer.isView(n)?this.instantiateTypedArray(n):Array.isArray(n)?this.instantiateArray(n):this.instantiateObj(n)}return"function"==typeof n?this.getFuncModule(n):"string"==typeof n?yE(n):("_objFlags"===t&&e instanceof A_&&(n&=pE),n)},t.setObjProp=function(e,t,n,i){SE(e,"o"+AE(n)+"=",this.enumerateField(t,n,i))},t.enumerateObject=function(e,t){var n=t.constructor;if(c.Class._isCCClass(n))this.enumerateCCClass(e,t,n);else for(var i in t)if(t.hasOwnProperty(i)&&(95!==i.charCodeAt(0)||95!==i.charCodeAt(1)||"__type__"===i)){var r=t[i];"object"==typeof r&&r&&r===t._iN$t||this.setObjProp(e,t,i,r)}},t.instantiateObj=function(e){if(e instanceof c.ValueType)return _n.getNewValueTypeCode(e);if(e instanceof c.Asset)return this.getObjRef(e);if(e._objFlags&dE)return null;var t,n=e.constructor;if(c.Class._isCCClass(n)){if(this.parent)if(this.parent instanceof c.Component){if(e instanceof c._BaseNode||e instanceof c.Component)return this.getObjRef(e)}else if(this.parent instanceof c._BaseNode)if(e instanceof c._BaseNode){if(!e.isChildOf(this.parent))return this.getObjRef(e)}else if(e instanceof c.Component&&!e.node.isChildOf(this.parent))return this.getObjRef(e);t=new xE("o","new "+this.getFuncModule(n,!0)+"()")}else if(n===Object)t=new xE("o","{}");else{if(n)return this.getObjRef(e);t=new xE("o","Object.create(null)")}var i=[t];return e._iN$t={globalVar:"",source:i},this.objsToClear_iN$t.push(e),this.enumerateObject(i,e),["(function(){",i,"return o;})();"]},e}();function wE(e,t){if("function"==typeof e)try{e=e()}catch(e){return!1}if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t&&e.constructor===t.constructor)if(e instanceof c.ValueType){if(e.equals(t))return!0}else{if(Array.isArray(e))return 0===e.length&&0===t.length;if(e.constructor===Object)return Fe(e)&&Fe(t)}return!1}var IE=Object.freeze({__proto__:null,ccclass:vh,property:Eh,requireComponent:gh,executionOrder:yh,disallowMultiple:xh,executeInEditMode:Ch,menu:wh,playOnFocus:Ih,inspector:bh,icon:Rh,help:Oh,type:qh,integer:kh,float:Vh,boolean:jh,string:Wh});e("e9",IE);var bE,RE,OE,NE,PE,ME,DE,LE,FE,zE,BE,UE=A_.Flags.Destroyed,GE=A_.Flags.PersistentMask,HE=[];function kE(e){var t;if(e instanceof A_){if(e._instantiate)return c.game._isCloning=!0,t=e._instantiate(null,!0),c.game._isCloning=!1,t;if(e instanceof c.Asset)throw new TypeError(M(6903))}return c.game._isCloning=!0,t=VE(e),c.game._isCloning=!1,t}function VE(e,t){var n;jE(e,n=e._iN$t?e._iN$t:e.constructor?new(0,e.constructor):Object.create(null),t);for(var i=0,r=HE.length;i<r;++i)HE[i]._iN$t=null;return HE.length=0,n}function jE(e,t,n){gt.value(e,"_iN$t",t,!0),HE.push(e);var i=e.constructor;if(c.Class._isCCClass(i))!function(e,t,n,i){for(var r=e.__values__,o=0;o<r.length;o++){var a=r[o],s=t[a];if("object"==typeof s&&s){var c=n[a];c instanceof At&&c.constructor===s.constructor?c.set(s):n[a]=s._iN$t||WE(s,i)}else n[a]=s}}(i,e,t,n);else for(var r in e)if(e.hasOwnProperty(r)&&(95!==r.charCodeAt(0)||95!==r.charCodeAt(1)||"__type__"===r)){var o=e[r];if("object"==typeof o&&o){if(o===t)continue;t[r]=o._iN$t||WE(o,n)}else t[r]=o}e instanceof A_&&(t._objFlags&=GE)}function WE(e,t){if(e instanceof At)return e.clone();if(e instanceof c.Asset)return e;var n;if(ArrayBuffer.isView(e)){var i=e.length;n=new e.constructor(i),e._iN$t=n,HE.push(e);for(var r=0;r<i;++r)n[r]=e[r];return n}if(Array.isArray(e)){var o=e.length;n=new Array(o),e._iN$t=n,HE.push(e);for(var a=0;a<o;++a){var s=e[a];n[a]="object"==typeof s&&s?s._iN$t||WE(s,t):s}return n}if(e._objFlags&UE)return null;var l=e.constructor;if(c.Class._isCCClass(l)){if(t)if(t instanceof c.Component){if(e instanceof c._BaseNode||e instanceof c.Component)return e}else if(t instanceof c._BaseNode)if(e instanceof c._BaseNode){if(!e.isChildOf(t))return e}else if(e instanceof c.Component&&!e.node.isChildOf(t))return e;n=new l}else if(l===Object)n={};else{if(l)return e;n=Object.create(null)}return jE(e,n,t),n}function qE(e,t){return(t<<3)+e}kE._clone=VE,c.instantiate=kE,function(e){e[e.Uint8=0]="Uint8",e[e.Uint16=1]="Uint16",e[e.Uint32=2]="Uint32",e[e.Int8=3]="Int8",e[e.Int16=4]="Int16",e[e.Int32=5]="Int32",e[e.Float32=6]="Float32",e[e.Float64=7]="Float64"}(zE||(zE={})),function(e){e[e.Scalar=0]="Scalar",e[e.Vec2=1]="Vec2",e[e.Vec3=2]="Vec3",e[e.Vec4=3]="Vec4",e[e.Quat=4]="Quat",e[e.Mat4=5]="Mat4"}(BE||(BE={}));var YE=e("ed",vh("cc.CompactValueTypeArray")((LE=DE=function(){function e(){ae(this,"_byteOffset",OE,this),ae(this,"_unitCount",NE,this),ae(this,"_unitElement",PE,this),ae(this,"_length",ME,this)}return e.lengthFor=function(e,t,n){return XE(t).requiredUnits*e.length*KE(n).BYTES_PER_ELEMENT},e.compress=function(t,n,i,r,o,a){for(var s=XE(n),c=KE(i),l=s.requiredUnits*t.length,u=new c(r,o,l),h=0;h<t.length;++h)s.compress(u,h,t[h]);var _=new e;return _._unitElement=qE(i,n),_._byteOffset=a,_._unitCount=l,_._length=t.length,_},e.prototype.decompress=function(e){for(var t,n={storageUnit:7&(t=this._unitElement),elementType:t>>3},i=n.storageUnit,r=XE(n.elementType),o=new(KE(i))(e,this._byteOffset,this._unitCount),a=new Array(this._length),s=0;s<this._length;++s)a[s]=r.decompress(o,s);return a},e}(),DE.StorageUnit=zE,DE.ElementType=BE,OE=se((RE=LE).prototype,"_byteOffset",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),NE=se(RE.prototype,"_unitCount",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),PE=se(RE.prototype,"_unitElement",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return qE(zE.Uint8,BE.Scalar)}}),ME=se(RE.prototype,"_length",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),bE=RE))||bE);function XE(e){return JS[e]}function KE(e){switch(e){case zE.Uint8:return Uint8Array;case zE.Uint16:return Uint16Array;case zE.Uint32:return Uint32Array;case zE.Int8:return Int8Array;case zE.Int16:return Int16Array;case zE.Int32:return Int32Array;case zE.Float32:return Float32Array;case zE.Float64:return Float64Array}}var QE,ZE,JE,$E,eS,tS,nS,iS,rS,oS,aS,sS,cS,lS,uS,hS,_S,fS,mS,dS,pS,vS,gS,yS,xS,ES,SS,TS,AS,CS,wS,IS,bS,RS,OS,NS,PS,MS,DS,LS,FS,zS,BS,US,GS,HS,kS,VS,jS,WS,qS,YS,XS,KS,QS,ZS,JS=((FE={})[BE.Scalar]={requiredUnits:1,compress:function(e,t,n){e[t]=n},decompress:function(e,t){return e[t]}},FE[BE.Vec2]={requiredUnits:2,compress:function(e,t,n){e[2*t]=n.x,e[2*t+1]=n.y},decompress:function(e,t){return new Un(e[2*t],e[2*t+1])}},FE[BE.Vec3]={requiredUnits:3,compress:function(e,t,n){e[3*t]=n.x,e[3*t+1]=n.y,e[3*t+2]=n.z},decompress:function(e,t){return new Un(e[3*t],e[3*t+1],e[3*t+2])}},FE[BE.Vec4]={requiredUnits:4,compress:function(e,t,n){e[4*t]=n.x,e[4*t+1]=n.y,e[4*t+2]=n.z,e[4*t+3]=n.w},decompress:function(e,t){return new ci(e[4*t],e[4*t+1],e[4*t+2],e[4*t+3])}},FE[BE.Quat]={requiredUnits:4,compress:function(e,t,n){e[4*t]=n.x,e[4*t+1]=n.y,e[4*t+2]=n.z,e[4*t+3]=n.w},decompress:function(e,t){return new qn(e[4*t],e[4*t+1],e[4*t+2],e[4*t+3])}},FE[BE.Mat4]={requiredUnits:16,compress:function(e,t,n){ei.toArray(e,n,16*t)},decompress:function(e,t){return ei.fromArray(new ei,e,16*t)}},FE);c._decorator=IE;var $S=vh("cc.TargetInfo")((JE=se((ZE=function(){ae(this,"localID",JE,this)}).prototype,"localID",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),QE=ZE))||QE,eT=($E=vh("cc.TargetOverrideInfo"),eS=qh(A_),tS=qh($S),nS=qh(c.Node),iS=qh($S),$E((aS=se((oS=function(){ae(this,"source",aS,this),ae(this,"sourceInfo",sS,this),ae(this,"propertyPath",cS,this),ae(this,"target",lS,this),ae(this,"targetInfo",uS,this)}).prototype,"source",[Sh,eS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),sS=se(oS.prototype,"sourceInfo",[Sh,tS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),cS=se(oS.prototype,"propertyPath",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),lS=se(oS.prototype,"target",[Sh,nS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),uS=se(oS.prototype,"targetInfo",[Sh,iS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),rS=oS))||rS),tT=(hS=vh("cc.PrefabInfo"),_S=qh([eT]),hS((dS=se((mS=function(){ae(this,"root",dS,this),ae(this,"asset",pS,this),ae(this,"fileId",vS,this),ae(this,"instance",gS,this),ae(this,"targetOverrides",yS,this)}).prototype,"root",[Sh,Nh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pS=se(mS.prototype,"asset",[Sh,Nh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vS=se(mS.prototype,"fileId",[Sh,Nh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),gS=se(mS.prototype,"instance",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yS=se(mS.prototype,"targetOverrides",[Sh,_S],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fS=mS))||fS);c._PrefabInfo=tT;var nT=vh("cc.CompPrefabInfo")((SS=se((ES=function(){ae(this,"fileId",SS,this)}).prototype,"fileId",[Sh,Nh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),xS=ES))||xS,iT=(TS=vh("CCPropertyOverrideInfo"),AS=qh($S),TS((OS=function(){function e(){ae(this,"targetInfo",IS,this),ae(this,"propertyPath",bS,this),ae(this,"value",RS,this)}return e.prototype.isTarget=function(){},e}(),IS=se((wS=OS).prototype,"targetInfo",[Sh,AS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),bS=se(wS.prototype,"propertyPath",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),RS=se(wS.prototype,"value",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CS=wS))||CS),rT=(NS=vh("cc.MountedChildrenInfo"),PS=qh($S),MS=qh([c.Node]),NS((BS=function(){function e(){ae(this,"targetInfo",FS,this),ae(this,"nodes",zS,this)}return e.prototype.isTarget=function(){},e}(),FS=se((LS=BS).prototype,"targetInfo",[Sh,PS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),zS=se(LS.prototype,"nodes",[Sh,MS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),DS=LS))||DS),oT=(US=vh("cc.PrefabInstance"),GS=qh(c.Node),HS=qh([rT]),kS=qh([iT]),VS=qh([$S]),US((ZS=function(){function e(){ae(this,"fileId",qS,this),ae(this,"prefabRootNode",YS,this),ae(this,"mountedChildren",XS,this),ae(this,"propertyOverrides",KS,this),ae(this,"removedComponents",QS,this),this.targetMap={}}var t=e.prototype;return t.findPropertyOverride=function(){},t.removePropertyOverride=function(){},e}(),qS=se((WS=ZS).prototype,"fileId",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),YS=se(WS.prototype,"prefabRootNode",[Sh,GS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XS=se(WS.prototype,"mountedChildren",[Sh,HS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),KS=se(WS.prototype,"propertyOverrides",[Sh,kS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),QS=se(WS.prototype,"removedComponents",[Sh,VS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),jS=WS))||jS);function aT(e){var t=e._prefab;if(t&&t.instance){if(!t.asset)return R(3701,e.name),void(t.instance=null);var n=e._objFlags,i=e._parent,r=e._id,o=e._prefab;c.game._isCloning=!0,t.asset._doInstantiate(e),c.game._isCloning=!1,e._objFlags=n,e._parent=i,e._id=r,e._prefab&&(e._prefab.instance=null==o?void 0:o.instance)}}function sT(e,t,n){var i,r=t,o=null===(i=e._prefab)||void 0===i?void 0:i.instance;!n&&o&&(t[o.fileId]={},r=t[o.fileId]);var a=e._prefab;a&&(r[a.fileId]=e);for(var s=e.components,c=0;c<s.length;c++){var l=s[c];l.__prefab&&(r[l.__prefab.fileId]=l)}for(var u=0;u<e.children.length;u++)sT(e.children[u],r,!1)}function cT(e,t){if(!e)return null;for(var n=t,i=0;i<e.length;i++){if(!n)return null;n=n[e[i]]}return n}function lT(e,t,n){if(t)for(var i=0;i<t.length;i++){var r=t[i];if(r&&r.targetInfo){var o=cT(r.targetInfo.localID,n);if(!o)continue;if(r.nodes)for(var a=0;a<r.nodes.length;a++){var s=r.nodes[a];o._children.push(s),s._parent=o,s._onBatchCreated(!1)}}}}function uT(e,t,n){if(!(t.length<=0))for(var i=null,r=0;r<t.length;r++){var o=t[r];if(o&&o.targetInfo){if(!(i=cT(o.targetInfo.localID,n)))continue;var a=i,s=o.propertyPath.slice();if(s.length>0){var c=s.pop();if(!c)continue;for(var l=0;l<s.length&&(a=a[s[l]]);l++);if(!a)continue;if(Array.isArray(a))if("length"===c)a[c]=o.value;else{var u=Number.parseInt(c);Number.isInteger(u)&&u<a.length&&(a[c]=o.value)}else a[c]=o.value}}}}function hT(e){var t,n=null===(t=e._prefab)||void 0===t?void 0:t.targetOverrides;if(n)for(var i=0;i<n.length;i++){var r,o,a=n[i],s=a.source,c=a.sourceInfo;if(c){var l,u,h=null===(l=a.source)||void 0===l||null===(u=l._prefab)||void 0===u?void 0:u.instance;if(h&&h.targetMap&&(s=cT(c.localID,h.targetMap)),!s)continue}var _,f=a.targetInfo;if(f){var m=null===(r=a.target)||void 0===r||null===(o=r._prefab)||void 0===o?void 0:o.instance;if(m&&m.targetMap&&(_=cT(f.localID,m.targetMap))){var d=a.propertyPath.slice(),p=s;if(d.length>0){var v=d.pop();if(!v)return;for(var g=0;g<d.length;g++)p=p[d[g]];p[v]=_}}}}}var _T,fT,mT,dT,pT,vT,gT,yT,xT,ET,ST,TT,AT,CT,wT=Object.freeze({__proto__:null,TargetInfo:$S,TargetOverrideInfo:eT,PrefabInfo:tT,CompPrefabInfo:nT,PropertyOverrideInfo:iT,MountedChildrenInfo:rT,PrefabInstance:oT,createNodeWithPrefab:aT,generateTargetMap:sT,getTarget:cT,applyMountedChildren:lT,applyPropertyOverrides:uT,applyTargetOverrides:hT}),IT=xt({AUTO:0,SINGLE_INSTANCE:1,MULTI_INSTANCE:2}),bT=e("ef",vh("cc.Prefab")((gT=vT=function(e){function t(){var t;return ae(t=e.call(this)||this,"data",mT,ie(t)),ae(t,"optimizationPolicy",dT,ie(t)),ae(t,"asyncLoadAssets",pT,ie(t)),t._createFunction=void 0,t._instantiatedTimes=void 0,t._createFunction=null,t._instantiatedTimes=0,t}$(t,e);var n=t.prototype;return n.createNode=function(e){var t=c.instantiate(this);t.name=this.name,e(null,t)},n.compileCreateFunction=function(){var e,t;this._createFunction=(t=(e=this.data)instanceof c._BaseNode&&e,new CE(e,t).result)},n._doInstantiate=function(e){return this.data._prefab||I(3700),this._createFunction||this.compileCreateFunction(),this._createFunction(e)},n._instantiate=function(){var e;return this.optimizationPolicy!==IT.SINGLE_INSTANCE&&(this.optimizationPolicy===IT.MULTI_INSTANCE||this._instantiatedTimes+1>=t.OptimizationPolicyThreshold)?(e=this._doInstantiate(),this.data._instantiate(e)):e=this.data._instantiate(),++this._instantiatedTimes,e},t}(H_),vT.OptimizationPolicy=IT,vT.OptimizationPolicyThreshold=3,mT=se((fT=gT).prototype,"data",[Sh,Nh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),dT=se(fT.prototype,"optimizationPolicy",[Sh,Nh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return IT.AUTO}}),pT=se(fT.prototype,"asyncLoadAssets",[Sh,Nh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),_T=fT))||_T);gt.value(bT,"_utils",wT),c.Prefab=bT,je(c,"cc._Prefab","Prefab"),e("e3",(yT=vh("cc.PrefabLink"),xT=qh(bT),ET=Ph(),yT((CT=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ae(t=e.call.apply(e,[this].concat(i))||this,"prefab",AT,ie(t)),t}return $(t,e),t}(cm),AT=se((TT=CT).prototype,"prefab",[xT,Sh,ET],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ST=TT))||ST));var RT=new Un;function OT(e,t,n,i){i||(i=new Un),e.convertToUINode(t,n,i);var r=n.position;return i.add(r),i}function NT(e,t,n){return n||(n=new Un),e.worldToScreen(t,n),n.x/=c.view.getScaleX(),n.y/=c.view.getScaleY(),n}var PT=e("e8",{WorldNode3DToLocalNodeUI:OT,WorldNode3DToWorldNodeUI:NT});c.pipelineUtils=PT,ve(c.pipelineUtils,"cc.pipelineUtils",[{name:"WorldNode3DToLocalNodeUI",newName:"convertToUINode",targetName:"cc.Camera.prototype",customFunction:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=t[0],r=t[3]||RT;return i.convertToUINode(t[1],t[2],r),r.add(t[2].position),t[3]||r.clone()}}]);var MT=new ri,DT=e("ex",function(e){function t(n,i,r){var o;return(o=e.call(this,y_.MOUSE,i)||this).movementX=0,o.movementY=0,o.eventType=void 0,o._button=t.BUTTON_MISSING,o._x=0,o._y=0,o._prevX=0,o._prevY=0,o._scrollX=0,o._scrollY=0,o.eventType=n,r&&(o._prevX=r.x,o._prevY=r.y),o}$(t,e);var n=t.prototype;return n.setScrollData=function(e,t){this._scrollX=e,this._scrollY=t},n.getScrollX=function(){return this._scrollX},n.getScrollY=function(){return this._scrollY},n.setLocation=function(e,t){this._x=e,this._y=t},n.getLocation=function(e){return e||(e=new ri),ri.set(e,this._x,this._y),e},n.getLocationInView=function(e){return e||(e=new ri),ri.set(e,this._x,c.view._designResolutionSize.height-this._y),e},n.getUILocation=function(e){return e||(e=new ri),ri.set(e,this._x,this._y),c.view._convertPointWithScale(e),e},n.getPreviousLocation=function(e){return e||(e=new ri),ri.set(e,this._prevX,this._prevY),e},n.getUIPreviousLocation=function(e){return e||(e=new ri),ri.set(e,this._prevX,this._prevY),c.view._convertPointWithScale(e),e},n.getDelta=function(e){return e||(e=new ri),ri.set(e,this._x-this._prevX,this._y-this._prevY),e},n.getDeltaX=function(){return this._x-this._prevX},n.getDeltaY=function(){return this._y-this._prevY},n.getUIDelta=function(e){return e||(e=new ri),ri.set(e,(this._x-this._prevX)/c.view.getScaleX(),(this._y-this._prevY)/c.view.getScaleY()),e},n.getUIDeltaX=function(){return(this._x-this._prevX)/c.view.getScaleX()},n.getUIDeltaY=function(){return(this._y-this._prevY)/c.view.getScaleY()},n.setButton=function(e){this._button=e},n.getButton=function(){return this._button},n.getLocationX=function(){return this._x},n.getLocationY=function(){return this._y},n.getUILocationX=function(){var e=c.view.getViewportRect();return(this._x-e.x)/c.view.getScaleX()},n.getUILocationY=function(){var e=c.view.getViewportRect();return(this._y-e.y)/c.view.getScaleY()},t}(y_));DT.NONE=0,DT.DOWN=1,DT.UP=2,DT.MOVE=3,DT.SCROLL=4,DT.BUTTON_MISSING=-1,DT.BUTTON_LEFT=0,DT.BUTTON_RIGHT=2,DT.BUTTON_MIDDLE=1,DT.BUTTON_4=3,DT.BUTTON_5=4,DT.BUTTON_6=5,DT.BUTTON_7=6,DT.BUTTON_8=7;var LT=e("cN",function(e){function t(t,n,i,r){var o;return(o=e.call(this,y_.TOUCH,n)||this).touch=null,o.simulate=!1,o._eventCode=void 0,o._touches=void 0,o._allTouches=void 0,o._eventCode=i||0,o._touches=t||[],o._allTouches=r||[],o}$(t,e);var n=t.prototype;return n.getEventCode=function(){return this._eventCode},n.getTouches=function(){return this._touches},n.getAllTouches=function(){return this._allTouches},n.setLocation=function(e,t){this.touch&&this.touch.setTouchInfo(this.touch.getID(),e,t)},n.getLocation=function(e){return this.touch?this.touch.getLocation(e):new ri},n.getUILocation=function(e){return this.touch?this.touch.getUILocation(e):new ri},n.getLocationInView=function(e){return this.touch?this.touch.getLocationInView(e):new ri},n.getPreviousLocation=function(e){return this.touch?this.touch.getPreviousLocation(e):new ri},n.getStartLocation=function(e){return this.touch?this.touch.getStartLocation(e):new ri},n.getUIStartLocation=function(e){return this.touch?this.touch.getUIStartLocation(e):new ri},n.getID=function(){return this.touch?this.touch.getID():null},n.getDelta=function(e){return this.touch?this.touch.getDelta(e):new ri},n.getUIDelta=function(e){return this.touch?this.touch.getUIDelta(e):new ri},n.getDeltaX=function(){return this.touch?this.touch.getDelta(MT).x:0},n.getDeltaY=function(){return this.touch?this.touch.getDelta(MT).y:0},n.getLocationX=function(){return this.touch?this.touch.getLocationX():0},n.getLocationY=function(){return this.touch?this.touch.getLocationY():0},t}(y_));LT.MAX_TOUCHES=5,LT.BEGAN=0,LT.MOVED=1,LT.ENDED=2,LT.CANCELLED=3;var FT=e("ey",function(e){function t(t,n){var i;return(i=e.call(this,y_.ACCELERATION,n)||this).acc=void 0,i.acc=t,i}return $(t,e),t}(y_)),zT=e("ez",function(e){function t(t,n,i){var r;return(r=e.call(this,y_.KEYBOARD,i)||this).keyCode=void 0,r.rawEvent=void 0,r.isPressed=void 0,"number"==typeof t?r.keyCode=t:(r.keyCode=t.keyCode,r.rawEvent=t),r.isPressed=n,r}return $(t,e),t}(y_));y_.EventMouse=DT,y_.EventTouch=LT,y_.EventAcceleration=FT,y_.EventKeyboard=zT;var BT=function(){function e(e,t,n){this._cameraPriority=0,this.owner=null,this.mask=null,this._previousIn=!1,this._target=null,this._onEvent=void 0,this._type=void 0,this._listenerID=void 0,this._registered=!1,this._fixedPriority=0,this._node=null,this._paused=!0,this._isEnabled=!0,this._onEvent=n,this._type=e||0,this._listenerID=t||""}e.create=function(e){P(e&&e.event,1900);var t=e.event;delete e.event;var n=null;if(t===c.EventListener.TOUCH_ONE_BY_ONE?n=new HT:t===c.EventListener.TOUCH_ALL_AT_ONCE?n=new kT:t===c.EventListener.MOUSE?n=new GT:t===c.EventListener.KEYBOARD?n=new jT:t===c.EventListener.ACCELERATION&&(n=new VT(e.callback),delete e.callback),n)for(var i=0,r=Object.keys(e);i<r.length;i++){var o=r[i];n[o]=e[o]}return n},Z(e,[{key:"onEvent",get:function(){return this._onEvent}}]);var t=e.prototype;return t._setPaused=function(e){this._paused=e},t._isPaused=function(){return this._paused},t._setRegistered=function(e){this._registered=e},t._isRegistered=function(){return this._registered},t._getType=function(){return this._type},t._getListenerID=function(){return this._listenerID},t._setFixedPriority=function(e){this._fixedPriority=e},t._getFixedPriority=function(){return this._fixedPriority},t._setSceneGraphPriority=function(e){this._target=e,this._node=e},t._getSceneGraphPriority=function(){return this._node},t.checkAvailable=function(){return null!==this._onEvent},t.clone=function(){return null},t.setEnabled=function(e){this._isEnabled=e},t.isEnabled=function(){return this._isEnabled},e}();BT.UNKNOWN=0,BT.TOUCH_ONE_BY_ONE=1,BT.TOUCH_ALL_AT_ONCE=2,BT.KEYBOARD=3,BT.MOUSE=4,BT.ACCELERATION=6,BT.CUSTOM=8,BT.ListenerID={MOUSE:"__cc_mouse",TOUCH_ONE_BY_ONE:"__cc_touch_one_by_one",TOUCH_ALL_AT_ONCE:"__cc_touch_all_at_once",KEYBOARD:"__cc_keyboard",ACCELERATION:"__cc_acceleration"};var UT=BT.ListenerID,GT=function(e){function t(){var t;return(t=e.call(this,BT.MOUSE,UT.MOUSE,null)||this).onMouseDown=null,t.onMouseUp=null,t.onMouseMove=null,t.onMouseScroll=null,t._onEvent=function(e){return t._callback(e)},t}$(t,e);var n=t.prototype;return n._callback=function(e){var t=c.Event.EventMouse;switch(e.eventType){case t.DOWN:this.onMouseDown&&this.onMouseDown(e);break;case t.UP:this.onMouseUp&&this.onMouseUp(e);break;case t.MOVE:this.onMouseMove&&this.onMouseMove(e);break;case t.SCROLL:this.onMouseScroll&&this.onMouseScroll(e)}},n.clone=function(){var e=new t;return e.onMouseDown=this.onMouseDown,e.onMouseUp=this.onMouseUp,e.onMouseMove=this.onMouseMove,e.onMouseScroll=this.onMouseScroll,e},n.checkAvailable=function(){return!0},t}(BT),HT=function(e){function t(){var t;return(t=e.call(this,BT.TOUCH_ONE_BY_ONE,UT.TOUCH_ONE_BY_ONE,null)||this).swallowTouches=!1,t.onTouchBegan=null,t.onTouchMoved=null,t.onTouchEnded=null,t.onTouchCancelled=null,t._claimedTouches=[],t}$(t,e);var n=t.prototype;return n.setSwallowTouches=function(e){this.swallowTouches=e},n.isSwallowTouches=function(){return this.swallowTouches},n.clone=function(){var e=new t;return e.onTouchBegan=this.onTouchBegan,e.onTouchMoved=this.onTouchMoved,e.onTouchEnded=this.onTouchEnded,e.onTouchCancelled=this.onTouchCancelled,e.swallowTouches=this.swallowTouches,e},n.checkAvailable=function(){return!!this.onTouchBegan||(C(1801),!1)},t}(BT),kT=function(e){function t(){var t;return(t=e.call(this,BT.TOUCH_ALL_AT_ONCE,UT.TOUCH_ALL_AT_ONCE,null)||this).onTouchesBegan=null,t.onTouchesMoved=null,t.onTouchesEnded=null,t.onTouchesCancelled=null,t}$(t,e);var n=t.prototype;return n.clone=function(){var e=new t;return e.onTouchesBegan=this.onTouchesBegan,e.onTouchesMoved=this.onTouchesMoved,e.onTouchesEnded=this.onTouchesEnded,e.onTouchesCancelled=this.onTouchesCancelled,e},n.checkAvailable=function(){return null!==this.onTouchesBegan||null!==this.onTouchesMoved||null!==this.onTouchesEnded||null!==this.onTouchesCancelled||(C(1802),!1)},t}(BT),VT=function(e){function t(t){var n;return(n=e.call(this,BT.ACCELERATION,UT.ACCELERATION,null)||this)._onAccelerationEvent=null,n._onEvent=function(e){return n._callback(e)},n._onAccelerationEvent=t,n}$(t,e);var n=t.prototype;return n._callback=function(e){this._onAccelerationEvent&&this._onAccelerationEvent(e.acc,e)},n.checkAvailable=function(){return P(this._onAccelerationEvent,1803),!0},n.clone=function(){return new t(this._onAccelerationEvent)},t}(BT),jT=function(e){function t(){var t;return(t=e.call(this,BT.KEYBOARD,UT.KEYBOARD,null)||this).onKeyPressed=null,t.onKeyReleased=null,t._onEvent=function(e){return t._callback(e)},t}$(t,e);var n=t.prototype;return n._callback=function(e){e.isPressed?this.onKeyPressed&&this.onKeyPressed(e.keyCode,e):this.onKeyReleased&&this.onKeyReleased(e.keyCode,e)},n.clone=function(){var e=new t;return e.onKeyPressed=this.onKeyPressed,e.onKeyReleased=this.onKeyReleased,e},n.checkAvailable=function(){return null!==this.onKeyPressed||null!==this.onKeyReleased||(C(1800),!1)},t}(BT);c.EventListener=BT;var WT=BT.ListenerID,qT=function(){function e(){this.gt0Index=0,this._fixedListeners=[],this._sceneGraphListeners=[]}var t=e.prototype;return t.size=function(){return this._fixedListeners.length+this._sceneGraphListeners.length},t.empty=function(){return 0===this._fixedListeners.length&&0===this._sceneGraphListeners.length},t.push=function(e){0===e._getFixedPriority()?this._sceneGraphListeners.push(e):this._fixedListeners.push(e)},t.clearSceneGraphListeners=function(){this._sceneGraphListeners.length=0},t.clearFixedListeners=function(){this._fixedListeners.length=0},t.clear=function(){this._sceneGraphListeners.length=0,this._fixedListeners.length=0},t.getFixedPriorityListeners=function(){return this._fixedListeners},t.getSceneGraphPriorityListeners=function(){return this._sceneGraphListeners},e}(),YT=function(){function e(){this._listenersMap={},this._priorityDirtyFlagMap={},this._nodeListenersMap={},this._toAddedListeners=[],this._toRemovedListeners=[],this._dirtyListeners={},this._inDispatch=0,this._isEnabled=!1,this._internalCustomListenerIDs=[],this._currentTouch=null,this._currentTouchListener=null}var t=e.prototype;return t.pauseTarget=function(e,t){if(void 0===t&&(t=!1),e instanceof c._BaseNode){var n=this._nodeListenersMap[e.uuid];if(n)for(var i=0;i<n.length;++i)n[i]._setPaused(!0);if(!0===t){var r=e.children;if(r)for(var o=0;o<r.length;++o){var a=r[o];this.pauseTarget(a,!0)}}}else I(3506)},t.resumeTarget=function(e,t){if(void 0===t&&(t=!1),e instanceof c._BaseNode){var n=this._nodeListenersMap[e.uuid];if(n)for(var i=0;i<n.length;++i)n[i]._setPaused(!1);if(this._setDirtyForNode(e),!0===t&&e.children.length>0){var r=e.children;if(r)for(var o=0;o<r.length;++o){var a=r[o];this.resumeTarget(a,!0)}}}else I(3506)},t.frameUpdateListeners=function(){var e=this._listenersMap,t=this._priorityDirtyFlagMap;for(var n in e)e[n].empty()&&(delete t[n],delete e[n]);var i=this._toAddedListeners;if(0!==i.length){for(var r=0,o=i.length;r<o;r++)this._forceAddEventListener(i[r]);i.length=0}0!==this._toRemovedListeners.length&&this._cleanToRemovedListeners()},t.hasEventListener=function(e){return!!this._getListeners(e)},t.addListener=function(e,t){if(P(e&&t,3503),!(c.js.isNumber(t)||t instanceof c._BaseNode))return I(3506),null;if(e instanceof c.EventListener){if(e._isRegistered())return C(3505),null}else P(!c.js.isNumber(t),3504),e=c.EventListener.create(e);if(!e.checkAvailable())return null;if(c.js.isNumber(t)){if(0===t)return C(3500),null;e._setSceneGraphPriority(null),e._setFixedPriority(t),e._setRegistered(!0),e._setPaused(!1),this._addListener(e)}else{if(!(n=t)||!n.getComponent("cc.UITransform"))return C(3512),null;e._setSceneGraphPriority(t),e._setFixedPriority(0),e._setRegistered(!0),this._addListener(e)}var n;return e},t.addCustomListener=function(e,t){var n=BT.create({event:c.EventListener.CUSTOM,eventName:e,callback:t});return this.addListener(n,1),n},t.removeListener=function(e){if(null!=e){var t=!1,n=this._listenersMap;for(var i in n){var r=n[i],o=r.getFixedPriorityListeners(),a=r.getSceneGraphPriorityListeners();if((t=this._removeListenerInVector(a,e))?this._setDirty(e._getListenerID(),2):(t=this._removeListenerInVector(o,e))&&this._setDirty(e._getListenerID(),1),r.empty()&&(delete this._priorityDirtyFlagMap[e._getListenerID()],delete n[i]),t)break}if(!t)for(var s=this._toAddedListeners,l=s.length-1;l>=0;l--){var u=s[l];if(u===e){c.js.array.removeAt(s,l),u._setRegistered(!1);break}}}},t.removeListeners=function(e,t){if(void 0===t&&(t=!1),c.js.isNumber(e)||e instanceof c._BaseNode)if(void 0!==e._id){var n=this._nodeListenersMap[e._id];if(n){for(var i=c.js.array.copy(n),r=0;r<i.length;++r){var o=i[r];this.removeListener(o)}delete this._nodeListenersMap[e._id]}for(var a=this._toAddedListeners,s=0;s<a.length;){var l=a[s];l._getSceneGraphPriority()===e?(l._setSceneGraphPriority(null),l._setRegistered(!1),a.splice(s,1)):++s}if(!0===t)for(var u=e.getChildren(),h=0;h<u.length;++h){var _=u[h];this.removeListeners(_,!0)}}else e===c.EventListener.TOUCH_ONE_BY_ONE?this._removeListenersForListenerID(WT.TOUCH_ONE_BY_ONE):e===c.EventListener.TOUCH_ALL_AT_ONCE?this._removeListenersForListenerID(WT.TOUCH_ALL_AT_ONCE):e===c.EventListener.MOUSE?this._removeListenersForListenerID(WT.MOUSE):e===c.EventListener.ACCELERATION?this._removeListenersForListenerID(WT.ACCELERATION):e===c.EventListener.KEYBOARD?this._removeListenersForListenerID(WT.KEYBOARD):C(3501);else I(3506)},t.removeCustomListeners=function(e){this._removeListenersForListenerID(e)},t.removeAllListeners=function(){var e=this._listenersMap,t=this._internalCustomListenerIDs;for(var n in e)-1===t.indexOf(n)&&this._removeListenersForListenerID(n)},t.setPriority=function(e,t){if(null!=e){var n=this._listenersMap;for(var i in n){var r=n[i].getFixedPriorityListeners();if(r&&-1!==r.indexOf(e))return null!=e._getSceneGraphPriority()&&C(3502),void(e._getFixedPriority()!==t&&(e._setFixedPriority(t),this._setDirty(e._getListenerID(),1)))}}},t.setEnabled=function(e){this._isEnabled=e},t.isEnabled=function(){return this._isEnabled},t.dispatchEvent=function(e){if(this._isEnabled)if(this._updateDirtyFlagForSceneGraph(),this._inDispatch++,e&&e.getType){if(e.getType().startsWith(c.Event.TOUCH))return this._dispatchTouchEvent(e),void this._inDispatch--;var t=function(e){var t=y_,n=e.type;return n===t.ACCELERATION?WT.ACCELERATION:n===t.KEYBOARD?WT.KEYBOARD:n.startsWith(t.MOUSE)?WT.MOUSE:(n.startsWith(t.TOUCH)&&C(2e3),"")}(e);this._sortEventListeners(t);var n=this._listenersMap[t];null!=n&&(this._dispatchEventToListeners(n,this._onListenerCallback,e),this._onUpdateListeners(n)),this._inDispatch--}else R(3511)},t._onListenerCallback=function(e,t){t.currentTarget=e._target;var n=e.onEvent;return n&&n(t),t.isStopped()},t.dispatchCustomEvent=function(e,t){var n=new c.Event.EventCustom(e);n.setUserData(t),this.dispatchEvent(n)},t._setDirtyForNode=function(e){var t=this._nodeListenersMap[e._id];if(void 0!==t)for(var n=0,i=t.length;n<i;n++){var r=t[n]._getListenerID();this._dirtyListeners[r]||(this._dirtyListeners[r]=!0)}if(e.children.length>0)for(var o=e.children,a=0,s=o?o.length:0;a<s;a++)this._setDirtyForNode(o[a])},t._addListener=function(e){0===this._inDispatch?this._forceAddEventListener(e):this._toAddedListeners.push(e)},t._forceAddEventListener=function(e){var t=e._getListenerID(),n=this._listenersMap[t];if(n||(n=new qT,this._listenersMap[t]=n),n.push(e),0===e._getFixedPriority()){this._setDirty(t,2);var i=e._getSceneGraphPriority();null===i&&C(3507),this._associateNodeAndEventListener(i,e),i.activeInHierarchy&&this.resumeTarget(i)}else this._setDirty(t,1)},t._getListeners=function(e){return this._listenersMap[e]},t._updateDirtyFlagForSceneGraph=function(){var e=this._dirtyListeners;for(var t in e)this._setDirty(t,2),e[t]=!1},t._removeAllListenersInVector=function(e){if(e)for(var t,n=e.length-1;n>=0;n--)(t=e[n])._setRegistered(!1),null!=t._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(t._getSceneGraphPriority(),t),t._setSceneGraphPriority(null)),0===this._inDispatch&&c.js.array.removeAt(e,n)},t._removeListenersForListenerID=function(e){var t=this._listenersMap[e];if(t){var n=t.getFixedPriorityListeners(),i=t.getSceneGraphPriorityListeners();this._removeAllListenersInVector(i),this._removeAllListenersInVector(n),delete this._priorityDirtyFlagMap[e],this._inDispatch||(t.clear(),delete this._listenersMap[e])}for(var r=this._toAddedListeners,o=r.length-1;o>=0;o--){var a=r[o];a&&a._getListenerID()===e&&c.js.array.removeAt(r,o)}},t._sortEventListeners=function(e){var t=0,n=this._priorityDirtyFlagMap;n[e]&&(t=n[e]),0!==t&&(n[e]=0,1&t&&this._sortListenersOfFixedPriority(e),2&t&&c.director.getScene()&&this._sortListenersOfSceneGraphPriority(e))},t._sortListenersOfSceneGraphPriority=function(e){var t=this._getListeners(e);if(t){var n=t.getSceneGraphPriorityListeners();if(n&&0!==n.length){var i=t.getSceneGraphPriorityListeners();i.forEach((function(e){var t=e._getSceneGraphPriority()._uiProps.uiTransformComp;e._cameraPriority=t.cameraPriority})),i.sort(this._sortEventListenersOfSceneGraphPriorityDes)}}},t._sortEventListenersOfSceneGraphPriorityDes=function(e,t){var n=e._getSceneGraphPriority(),i=t._getSceneGraphPriority();if(!(t&&i&&i._activeInHierarchy&&i._uiProps.uiTransformComp))return-1;if(!(e&&n&&n._activeInHierarchy&&n._uiProps.uiTransformComp))return 1;var r=n,o=i,a=!1;if(e._cameraPriority!==t._cameraPriority)return t._cameraPriority-e._cameraPriority;for(;r.parent._id!==o.parent._id;)r=null===r.parent.parent?(a=!0)&&i:r.parent,o=null===o.parent.parent?(a=!0)&&n:o.parent;if(r._id===o._id){if(r._id===i._id)return-1;if(r._id===n._id)return 1}var s=r.getSiblingIndex(),c=o.getSiblingIndex();return a?s-c:c-s},t._sortListenersOfFixedPriority=function(e){var t=this._listenersMap[e];if(t){var n=t.getFixedPriorityListeners();if(n&&0!==n.length){n.sort(this._sortListenersOfFixedPriorityAsc);for(var i=0,r=n.length;i<r&&!(n[i]._getFixedPriority()>=0);)++i;t.gt0Index=i}}},t._sortListenersOfFixedPriorityAsc=function(e,t){return e._getFixedPriority()-t._getFixedPriority()},t._onUpdateListeners=function(e){var t=e.getFixedPriorityListeners(),n=e.getSceneGraphPriorityListeners(),i=this._toRemovedListeners;if(n)for(var r=n.length-1;r>=0;r--){var o=n[r];if(!o._isRegistered()){c.js.array.removeAt(n,r);var a=i.indexOf(o);-1!==a&&i.splice(a,1)}}if(t)for(var s=t.length-1;s>=0;s--){var l=t[s];if(!l._isRegistered()){c.js.array.removeAt(t,s);var u=i.indexOf(l);-1!==u&&i.splice(u,1)}}n&&0===n.length&&e.clearSceneGraphListeners(),t&&0===t.length&&e.clearFixedListeners()},t._updateTouchListeners=function(){var e=this._inDispatch;if(P(e>0,3508),!(e>1)){var t;(t=this._listenersMap[WT.TOUCH_ONE_BY_ONE])&&this._onUpdateListeners(t),(t=this._listenersMap[WT.TOUCH_ALL_AT_ONCE])&&this._onUpdateListeners(t),P(1===e,3509);var n=this._toAddedListeners;if(0!==n.length){for(var i=0,r=n.length;i<r;i++)this._forceAddEventListener(n[i]);this._toAddedListeners.length=0}0!==this._toRemovedListeners.length&&this._cleanToRemovedListeners()}},t._cleanToRemovedListeners=function(){for(var e=this._toRemovedListeners,t=0;t<e.length;++t){var n=e[t],i=this._listenersMap[n._getListenerID()];if(i){var r=i.getFixedPriorityListeners(),o=i.getSceneGraphPriorityListeners();if(o){var a=o.indexOf(n);-1!==a&&o.splice(a,1)}if(r){var s=r.indexOf(n);-1!==s&&r.splice(s,1)}}}e.length=0},t._onTouchEventCallback=function(e,t){if(!e._isRegistered())return!1;var n=t.event,i=n.touch;n.currentTarget=e._getSceneGraphPriority();var r=!1,o=-1,a=n.getEventCode();if(a===LT.BEGAN){if(!Ct.ENABLE_MULTI_TOUCH&&XT._currentTouch){var s=XT._currentTouchListener._node;if(!s||s.activeInHierarchy)return!1}e.onTouchBegan&&(r=e.onTouchBegan(i,n))&&e._isRegistered()&&(e._claimedTouches.push(i),!Ct.ENABLE_MULTI_TOUCH&&XT._currentTouch||(XT._currentTouch=i),XT._currentTouchListener=e)}else if(e._claimedTouches.length>0&&-1!==(o=e._claimedTouches.indexOf(i))){if(r=!0,!Ct.ENABLE_MULTI_TOUCH&&XT._currentTouch&&XT._currentTouch!==i)return!1;a===LT.MOVED&&e.onTouchMoved?e.onTouchMoved(i,n):a===LT.ENDED?(e.onTouchEnded&&e.onTouchEnded(i,n),e._isRegistered()&&e._claimedTouches.splice(o,1),(Ct.ENABLE_MULTI_TOUCH||XT._currentTouch===i)&&(XT._currentTouch=null),XT._currentTouchListener=null):a===LT.CANCELLED&&(e.onTouchCancelled&&e.onTouchCancelled(i,n),e._isRegistered()&&e._claimedTouches.splice(o,1),(Ct.ENABLE_MULTI_TOUCH||XT._currentTouch===i)&&(XT._currentTouch=null),XT._currentTouchListener=null)}return n.isStopped()?(XT._updateTouchListeners(n),!0):!!(r&&e._isRegistered()&&e.swallowTouches)&&(t.needsMutableSet&&t.touches.splice(i,1),!0)},t._dispatchTouchEvent=function(e){this._sortEventListeners(WT.TOUCH_ONE_BY_ONE),this._sortEventListeners(WT.TOUCH_ALL_AT_ONCE);var t=this._getListeners(WT.TOUCH_ONE_BY_ONE),n=this._getListeners(WT.TOUCH_ALL_AT_ONCE);if(null!==t||null!==n){var i=e.getTouches(),r=c.js.array.copy(i),o={event:e,needsMutableSet:t&&n,touches:r,selTouch:null};if(t)for(var a=0;a<i.length;++a){var s=i[a];e.touch=s,e.propagationStopped=e.propagationImmediateStopped=!1,this._dispatchEventToListeners(t,this._onTouchEventCallback,o)}n&&r.length>0&&(this._dispatchEventToListeners(n,this._onTouchesEventCallback,{event:e,touches:r}),e.isStopped())||this._updateTouchListeners(e)}},t._onTouchesEventCallback=function(e,t){if(!e._isRegistered())return!1;var n=t.event,i=t.touches,r=n.getEventCode();return n.currentTarget=e._getSceneGraphPriority(),r===LT.BEGAN&&e.onTouchesBegan?e.onTouchesBegan(i,n):r===LT.MOVED&&e.onTouchesMoved?e.onTouchesMoved(i,n):r===LT.ENDED&&e.onTouchesEnded?e.onTouchesEnded(i,n):r===LT.CANCELLED&&e.onTouchesCancelled&&e.onTouchesCancelled(i,n),!!n.isStopped()&&(XT._updateTouchListeners(n),!0)},t._associateNodeAndEventListener=function(e,t){var n=this._nodeListenersMap[e.uuid];n||(n=[],this._nodeListenersMap[e.uuid]=n),n.push(t)},t._dissociateNodeAndEventListener=function(e,t){var n=this._nodeListenersMap[e.uuid];n&&(c.js.array.remove(n,t),0===n.length&&delete this._nodeListenersMap[e.uuid])},t._dispatchEventToListeners=function(e,t,n){var i=!1,r=e.getFixedPriorityListeners(),o=e.getSceneGraphPriorityListeners(),a=0;if(r&&0!==r.length)for(;a<e.gt0Index;++a){var s=r[a];if(s.isEnabled()&&!s._isPaused()&&s._isRegistered()&&t(s,n)){i=!0;break}}if(o&&!i)for(var c=0;c<o.length;++c){var l=o[c];if(l.isEnabled()&&!l._isPaused()&&l._isRegistered()&&t(l,n)){i=!0;break}}if(r&&!i)for(;a<r.length;++a){var u=r[a];if(u.isEnabled()&&!u._isPaused()&&u._isRegistered()&&t(u,n)){i=!0;break}}},t._setDirty=function(e,t){var n=this._priorityDirtyFlagMap;null==n[e]?n[e]=t:n[e]|=t},t._sortNumberAsc=function(e,t){return e-t},t._removeListenerInCallback=function(e,t){if(null==e)return!1;for(var n=e.length-1;n>=0;n--){var i=e[n];if(i._onCustomEvent===t||i.onEvent===t)return i._setRegistered(!1),null!=i._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(i._getSceneGraphPriority(),i),i._setSceneGraphPriority(null)),0===this._inDispatch?c.js.array.removeAt(e,n):this._toRemovedListeners.push(i),!0}return!1},t._removeListenerInVector=function(e,t){if(null==e)return!1;for(var n=e.length-1;n>=0;n--){var i=e[n];if(i===t)return i._setRegistered(!1),null!=i._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(i._getSceneGraphPriority(),i),i._setSceneGraphPriority(null)),0===this._inDispatch?c.js.array.removeAt(e,n):this._toRemovedListeners.push(i),!0}return!1},e}(),XT=e("et",new YT);c.eventManager=XT;var KT=new ri,QT=e("eA",function(){function e(e,t,n){void 0===n&&(n=0),this._point=new ri,this._prevPoint=new ri,this._lastModified=0,this._id=0,this._startPoint=new ri,this._startPointCaptured=!1,this.setTouchInfo(n,e,t)}Z(e,[{key:"lastModified",get:function(){return this._lastModified}}]);var t=e.prototype;return t.getLocation=function(e){return e||(e=new ri),e.set(this._point.x,this._point.y),e},t.getLocationX=function(){return this._point.x},t.getLocationY=function(){return this._point.y},t.getUILocation=function(e){return e||(e=new ri),e.set(this._point.x,this._point.y),c.view._convertPointWithScale(e),e},t.getUILocationX=function(){var e=c.view.getViewportRect();return(this._point.x-e.x)/c.view.getScaleX()},t.getUILocationY=function(){var e=c.view.getViewportRect();return(this._point.y-e.y)/c.view.getScaleY()},t.getPreviousLocation=function(e){return e||(e=new ri),e.set(this._prevPoint.x,this._prevPoint.y),e},t.getUIPreviousLocation=function(e){return e||(e=new ri),e.set(this._prevPoint.x,this._prevPoint.y),c.view._convertPointWithScale(e),e},t.getStartLocation=function(e){return e||(e=new ri),e.set(this._startPoint.x,this._startPoint.y),e},t.getUIStartLocation=function(e){return e||(e=new ri),e.set(this._startPoint.x,this._startPoint.y),c.view._convertPointWithScale(e),e},t.getDelta=function(e){return e||(e=new ri),e.set(this._point),e.subtract(this._prevPoint),e},t.getUIDelta=function(e){return e||(e=new ri),KT.set(this._point),KT.subtract(this._prevPoint),e.set(c.view.getScaleX(),c.view.getScaleY()),ri.divide(e,KT,e),e},t.getLocationInView=function(e){return e||(e=new ri),e.set(this._point.x,c.view._designResolutionSize.height-this._point.y),e},t.getPreviousLocationInView=function(e){return e||(e=new ri),e.set(this._prevPoint.x,c.view._designResolutionSize.height-this._prevPoint.y),e},t.getStartLocationInView=function(e){return e||(e=new ri),e.set(this._startPoint.x,c.view._designResolutionSize.height-this._startPoint.y),e},t.getID=function(){return this._id},t.setTouchInfo=function(e,t,n){void 0===e&&(e=0),this._prevPoint=this._point,this._point=new ri(t||0,n||0),this._id=e,this._startPointCaptured||(this._startPoint=new ri(this._point),this._startPointCaptured=!0)},t.setPoint=function(e,t){"object"==typeof e?(this._point.x=e.x,this._point.y=e.y):(this._point.x=e||0,this._point.y=t||0),this._lastModified=c.director.getCurrentTime()},t.setPrevPoint=function(e,t){this._prevPoint="object"==typeof e?new ri(e.x,e.y):new ri(e||0,t||0),this._lastModified=c.director.getCurrentTime()},e}());c.Touch=QT;var ZT,JT=Ct.TOUCH_TIMEOUT,$T=new ri,eA=new ri,tA=e("eu",(function(e,t,n,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),this.x=void 0,this.y=void 0,this.z=void 0,this.timestamp=void 0,this.x=e,this.y=t,this.z=n,this.timestamp=i}));c.internal.Acceleration=tA;var nA=new(function(){function e(){this._mousePressed=!1,this._isRegisterEvent=!1,this._preTouchPoint=new ri,this._prevMousePoint=new ri,this._preTouchPool=[],this._preTouchPoolPointer=0,this._touches=[],this._touchesIntegerDict={},this._indexBitsUsed=0,this._maxTouches=8,this._accelEnabled=!1,this._accelInterval=.2,this._accelMinus=1,this._accelCurTime=0,this._acceleration=null,this._accelDeviceEvent=null,this._glView=null,this._pointLocked=!1}var t=e.prototype;return t.handleTouchesBegin=function(e){for(var t=[],n=this._touchesIntegerDict,i=0;i<e.length;++i){var r=e[i],o=r.getID();if(null!==o&&void 0===n[o]){var a=this._getUnUsedIndex();if(-1===a){C(2300,a);continue}r.getLocation($T);var s=new QT($T.x,$T.y,o);this._touches[a]=s,r.getPreviousLocation($T),s.setPrevPoint($T),n[o]=a,t.push(s)}}if(t.length>0){var c=new LT(t,!1,LT.BEGAN,Ct.ENABLE_MULTI_TOUCH?this._getUsefulTouches():t);XT.dispatchEvent(c)}},t.handleTouchesMove=function(e){for(var t=[],n=this._touches,i=0;i<e.length;++i){var r=e[i],o=r.getID();if(null!==o){var a=this._touchesIntegerDict[o];void 0!==a&&n[a]&&(r.getLocation($T),n[a].setPoint($T),r.getPreviousLocation($T),n[a].setPrevPoint($T),t.push(n[a]))}}if(t.length>0){var s=new LT(t,!1,LT.MOVED,Ct.ENABLE_MULTI_TOUCH?this._getUsefulTouches():t);XT.dispatchEvent(s)}},t.handleTouchesEnd=function(e){var t=this.getSetOfTouchesEndOrCancel(e);if(t.length>0){var n=new LT(t,!1,LT.ENDED,Ct.ENABLE_MULTI_TOUCH?this._getUsefulTouches():t);XT.dispatchEvent(n)}this._preTouchPool.length=0},t.handleTouchesCancel=function(e){var t=this.getSetOfTouchesEndOrCancel(e);if(t.length>0){var n=new LT(t,!1,LT.CANCELLED,Ct.ENABLE_MULTI_TOUCH?this._getUsefulTouches():t);XT.dispatchEvent(n)}this._preTouchPool.length=0},t.getSetOfTouchesEndOrCancel=function(e){for(var t=[],n=this._touches,i=this._touchesIntegerDict,r=0;r<e.length;++r){var o=e[r],a=o.getID();if(null!==a){var s=i[a];void 0!==s&&n[s]&&(o.getLocation($T),n[s].setPoint($T),o.getPreviousLocation($T),n[s].setPrevPoint($T),t.push(n[s]),this._removeUsedIndexBit(s),delete i[a])}}return t},t.getHTMLElementPosition=function(e){var t=document.documentElement,n=Rv.os===Rv.OS_IOS&&Rv.isBrowser?window.screenLeft:window.pageXOffset;n-=t.clientLeft;var i=Rv.os===Rv.OS_IOS&&Rv.isBrowser?window.screenTop:window.pageYOffset;if(i-=t.clientTop,e.getBoundingClientRect){var r=e.getBoundingClientRect();return{left:r.left+n,top:r.top+i,width:r.width,height:r.height}}return e instanceof HTMLCanvasElement?{left:n,top:i,width:e.width,height:e.height}:{left:n,top:i,width:parseInt(e.style.width||"0",void 0),height:parseInt(e.style.height||"0",void 0)}},t.getPreTouch=function(e){for(var t=null,n=this._preTouchPool,i=e.getID(),r=n.length-1;r>=0;r--)if(n[r].getID()===i){t=n[r];break}return t||(t=e),t},t.setPreTouch=function(e){for(var t=!1,n=this._preTouchPool,i=e.getID(),r=n.length-1;r>=0;r--)if(n[r].getID()===i){n[r]=e,t=!0;break}t||(n.length<=50?n.push(e):(n[this._preTouchPoolPointer]=e,this._preTouchPoolPointer=(this._preTouchPoolPointer+1)%50))},t.getTouchByXY=function(e,t,n,i){var r=this._preTouchPoint,o=this._glView.convertToLocationInView(t,n,i);this._pointLocked&&(o.x=r.x+e.movementX,o.y=r.y-e.movementY);var a=new QT(o.x,o.y,0);return a.setPrevPoint(r.x,r.y),r.x=o.x,r.y=o.y,a},t.getMouseEvent=function(e,t,n){var i=this._prevMousePoint,r=new DT(n,!1,i);return i.x=e.x,i.y=e.y,this._glView._convertMouseToLocation(i,t),r.setLocation(i.x,i.y),r},t.getPointByEvent=function(e,t){return null!=e.pageX?{x:e.pageX,y:e.pageY}:(t.left-=document.body.scrollLeft,t.top-=document.body.scrollTop,{x:e.clientX,y:e.clientY})},t.getTouchesByEvent=function(e,t){for(var n=[],i=this._glView,r=this._preTouchPoint,o=e.changedTouches.length,a=0;a<o;a++){var s=e.changedTouches[a];if(s){var c;c=Rv.BROWSER_TYPE_FIREFOX===Rv.browserType?i.convertToLocationInView(s.pageX,s.pageY,t,$T):i.convertToLocationInView(s.clientX,s.clientY,t,$T);var l=void 0;if(null!=s.identifier?(l=new QT(c.x,c.y,s.identifier),this.getPreTouch(l).getLocation(eA),l.setPrevPoint(eA.x,eA.y),this.setPreTouch(l)):(l=new QT(c.x,c.y)).setPrevPoint(r.x,r.y),r.x=c.x,r.y=c.y,n.push(l),!Ct.ENABLE_MULTI_TOUCH)break}}return n},t.registerSystemEvent=function(e){if(!this._isRegisterEvent&&e){this._glView=c.view;var t=Rv.isMobile,n=Rv.capabilities.mouse,i=Rv.capabilities.touches;n&&this._registerMouseEvents(e,t),window.navigator.msPointerEnabled&&this._registerMousePointerEvents(e),i&&this._registerTouchEvents(e),this._registerKeyboardEvent(),this._isRegisterEvent=!0}},t.setAccelerometerEnabled=function(e){if(this._accelEnabled!==e){this._accelEnabled=e;var t=c.director.getScheduler();t.enableForTarget(this),this._accelEnabled?(this._registerAccelerometerEvent(),this._accelCurTime=0,t.scheduleUpdate(this)):(this._unregisterAccelerometerEvent(),this._accelCurTime=0,t.unscheduleUpdate(this))}},t.didAccelerate=function(e){if(this._accelEnabled){var t=this._acceleration,n=0,i=0,r=0;if(this._accelDeviceEvent===window.DeviceMotionEvent){var o=e.accelerationIncludingGravity;o&&(n=this._accelMinus*(o.x||0)*.1,i=this._accelMinus*(o.y||0)*.1,r=.1*(o.z||0))}else{var a=e;n=(a.gamma||0)/90*.981,i=-(a.beta||0)/90*.981,r=(a.alpha||0)/90*.981}if(c.view._isRotated){var s=n;n=-i,i=s}t.x=n,t.y=i,t.z=r,t.timestamp=e.timeStamp||Date.now();var l=t.x;90===window.orientation?(t.x=-t.y,t.y=l):-90===window.orientation?(t.x=t.y,t.y=-l):180===window.orientation&&(t.x=-t.x,t.y=-t.y),c.sys.os===c.sys.OS_ANDROID&&c.sys.browserType!==c.sys.BROWSER_TYPE_MOBILE_QQ&&(t.x=-t.x,t.y=-t.y)}},t.update=function(e){this._accelCurTime>this._accelInterval&&(this._accelCurTime-=this._accelInterval,XT.dispatchEvent(new FT(this._acceleration))),this._accelCurTime+=e},t.setAccelerometerInterval=function(e){this._accelInterval!==e&&(this._accelInterval=e)},t._getUnUsedIndex=function(){for(var e=this._indexBitsUsed,t=c.director.getCurrentTime(),n=0;n<this._maxTouches;n++){if(!(1&e))return this._indexBitsUsed|=1<<n,n;var i=this._touches[n];if(t-i.lastModified>JT){this._removeUsedIndexBit(n);var r=i.getID();return null!==r&&delete this._touchesIntegerDict[r],n}e>>=1}return-1},t._removeUsedIndexBit=function(e){if(!(e<0||e>=this._maxTouches)){var t=1<<e;t=~t,this._indexBitsUsed&=t}},t._registerMouseEvents=function(e,t){this._registerPointerLockEvent(),t||this._registerWindowMouseEvents(e),this._registerElementMouseEvents(e,t)},t._registerPointerLockEvent=function(){var e=this,t=function(){var t=c.game.canvas;document.pointerLockElement===t||document.mozPointerLockElement===t?e._pointLocked=!0:e._pointLocked=!1};"onpointerlockchange"in document?document.addEventListener("pointerlockchange",t,!1):"onmozpointerlockchange"in document&&document.addEventListener("mozpointerlockchange",t,!1)},t._registerWindowMouseEvents=function(e){var t=this;window.addEventListener("mousedown",(function(){t._mousePressed=!0}),!1),window.addEventListener("mouseup",(function(n){if(t._mousePressed){t._mousePressed=!1;var i=t.getHTMLElementPosition(e),r=t.getPointByEvent(n,i);if(!mi(i.left,i.top,i.width,i.height).contains(new ri(r.x,r.y))){t.handleTouchesEnd([t.getTouchByXY(n,r.x,r.y,i)]);var o=t.getMouseEvent(r,i,DT.UP);o.setButton(n.button),XT.dispatchEvent(o)}}}),!1)},t._registerElementMouseEvents=function(e,t){var n=this,i=function(t,i,r){e.addEventListener(t,(function(t){var o=n.getHTMLElementPosition(e),a=n.getPointByEvent(t,o),s=n.getMouseEvent(a,o,i);s.setButton(t.button),r(t,s,a,o),XT.dispatchEvent(s),t.stopPropagation(),t.preventDefault()}))};t||(i("mousedown",DT.DOWN,(function(t,i,r,o){n._mousePressed=!0,n.handleTouchesBegin([n.getTouchByXY(t,r.x,r.y,o)]),e.focus()})),i("mouseup",DT.UP,(function(e,t,i,r){n._mousePressed=!1,n.handleTouchesEnd([n.getTouchByXY(e,i.x,i.y,r)])})),i("mousemove",DT.MOVE,(function(e,t,i,r){n.handleTouchesMove([n.getTouchByXY(e,i.x,i.y,r)]),n._mousePressed||t.setButton(DT.BUTTON_MISSING),void 0!==e.movementX&&void 0!==e.movementY&&(t.movementX=e.movementX,t.movementY=e.movementY)}))),i("mousewheel",DT.SCROLL,(function(e,t){t.setScrollData(0,e.wheelDelta)})),i("DOMMouseScroll",DT.SCROLL,(function(e,t){t.setScrollData(0,-120*e.detail)}))},t._registerMousePointerEvents=function(e){var t=this,n={MSPointerDown:this.handleTouchesBegin,MSPointerMove:this.handleTouchesMove,MSPointerUp:this.handleTouchesEnd,MSPointerCancel:this.handleTouchesCancel},i=function(i){var r=n[i];e.addEventListener(i,(function(n){var i=t.getHTMLElementPosition(e);i.left-=document.documentElement.scrollLeft,i.top-=document.documentElement.scrollTop,r.call(t,[t.getTouchByXY(n,n.clientX,n.clientY,i)]),n.stopPropagation()}),!1)};for(var r in n)i(r)},t._registerTouchEvents=function(e){var t=this,n=function(n){return function(i){if(i.changedTouches){var r=t.getHTMLElementPosition(e),o=document.body;r.left-=o.scrollLeft||0,r.top-=o.scrollTop||0,n(t.getTouchesByEvent(i,r)),i.stopPropagation(),i.preventDefault()}}};e.addEventListener("touchstart",n((function(n){t.handleTouchesBegin(n),e.focus()})),!1),e.addEventListener("touchmove",n((function(e){t.handleTouchesMove(e)})),!1),e.addEventListener("touchend",n((function(e){t.handleTouchesEnd(e)})),!1),e.addEventListener("touchcancel",n((function(e){t.handleTouchesCancel(e)})),!1)},t._registerKeyboardEvent=function(){var e=c.game.canvas;e.addEventListener("keydown",(function(e){XT.dispatchEvent(new zT(e,!0)),e.stopPropagation(),e.preventDefault()}),!1),e.addEventListener("keyup",(function(e){XT.dispatchEvent(new zT(e,!1)),e.stopPropagation(),e.preventDefault()}),!1)},t._registerAccelerometerEvent=function(){var e=this;this._acceleration=new tA,this._accelDeviceEvent=window.DeviceMotionEvent||window.DeviceOrientationEvent,c.sys.browserType===c.sys.BROWSER_TYPE_MOBILE_QQ&&(this._accelDeviceEvent=window.DeviceOrientationEvent);var t=this._accelDeviceEvent===window.DeviceMotionEvent?"devicemotion":"deviceorientation";ZT=function(){return e.didAccelerate.apply(e,arguments)},window.addEventListener(t,ZT,!1)},t._unregisterAccelerometerEvent=function(){var e=this._accelDeviceEvent===window.DeviceMotionEvent?"devicemotion":"deviceorientation";ZT&&window.removeEventListener(e,ZT,!1)},t._getUsefulTouches=function(){var e=[],t=this._touchesIntegerDict;for(var n in t){var i=t[parseInt(n)];if(null!=i){var r=this._touches[i];e.push(r)}}return e},e}());c.internal.inputManager=nA;var iA=e("ca",function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this).frame=null,t.container=null,t.canvas=null,t.renderType=-1,t.eventTargetOn=e.prototype.on,t.eventTargetOnce=e.prototype.once,t.config={},t.onStart=null,t.collisionMatrix=[],t.groupList=[],t._persistRootNodes={},t._paused=!0,t._configLoaded=!1,t._isCloning=!1,t._inited=!1,t._engineInited=!1,t._rendererInitialized=!1,t._gfxDevice=null,t._intervalId=null,t}$(t,e);var n=t.prototype;return n.setFrameRate=function(e){var t=this.config;"number"!=typeof e&&(e=parseInt(e,10),Number.isNaN(e)&&(e=60)),t.frameRate=e,this._paused=!0,this._setAnimFrame(),this._runMainLoop()},n.getFrameRate=function(){return this.config.frameRate||0},n.step=function(){c.director.mainLoop()},n.pause=function(){this._paused||(this._paused=!0,this._intervalId&&(window.cAF(this._intervalId),this._intervalId=0))},n.resume=function(){this._paused&&this._runMainLoop()},n.isPaused=function(){return this._paused},n.restart=function(){var e=this;return new Promise((function(e){return c.director.once(c.Director.EVENT_AFTER_DRAW,(function(){return e()}))})).then((function(){for(var n in e._persistRootNodes)e.removePersistRootNode(e._persistRootNodes[n]);return c.director.getScene().destroy(),c.Object._deferredDestroy(),c.director.reset(),e.pause(),e._setRenderPipelineNShowSplash().then((function(){e.resume(),e._safeEmit(t.EVENT_RESTART)}))}))},n.end=function(){this._gfxDevice&&(this._gfxDevice.destroy(),this._gfxDevice=null),window.close()},n.on=function(e,n,i,r){return this._engineInited&&e===t.EVENT_ENGINE_INITED?n.call(i):this.eventTargetOn(e,n,i,r)},n.once=function(e,n,i){return this._engineInited&&e===t.EVENT_ENGINE_INITED?n.call(i):this.eventTargetOnce(e,n,i)},n.init=function(e){var t=this;return this._initConfig(e),this.config.assetOptions&&c.assetManager.init(this.config.assetOptions),this._initEngine().then((function(){return t._initEvents(),c.director.root.dataPoolManager&&c.director.root.dataPoolManager.jointTexturePool.registerCustomTextureLayouts(e.customJointTextureLayouts),t._engineInited}))},n.run=function(e,t){var n,i=this;return"function"!=typeof e&&e?(n=this.init(e),this.onStart=null!=t?t:null):this.onStart=null!=e?e:null,Promise.resolve(n).then((function(){return rA.config.registerSystemEvent&&nA.registerSystemEvent(rA.canvas),i._setRenderPipelineNShowSplash()}))},n.addPersistRootNode=function(e){if(c.Node.isNode(e)&&e.uuid){var t=e.uuid;if(!this._persistRootNodes[t]){var n=c.director._scene;if(c.isValid(n))if(e.parent){if(!(e.parent instanceof c.Scene))return void I(3801);if(e.parent!==n)return void I(3802)}else e.parent=n;this._persistRootNodes[t]=e,e._persistNode=!0,c.assetManager._releaseManager._addPersistNodeRef(e)}}else I(3800)},n.removePersistRootNode=function(e){var t=e.uuid||"";e===this._persistRootNodes[t]&&(delete this._persistRootNodes[t],e._persistNode=!1,c.assetManager._releaseManager._removePersistNodeRef(e))},n.isPersistRootNode=function(e){return!!e._persistNode},n._initEngine=function(){var e=this;return this._initDevice(),Promise.resolve(c.director._init()).then((function(){v("Cocos Creator v"+l),e.emit(t.EVENT_ENGINE_INITED),e._engineInited=!0,c.internal.dynamicAtlasManager.enabled=!Ct.CLEANUP_IMAGE_CACHE}))},n._setAnimFrame=function(){this._lastTime=performance.now();var e=this.config.frameRate;this._frameTime=1e3/e,this._intervalId&&(window.cAF(this._intervalId),this._intervalId=0);var t=window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;60!==e&&30!==e?(window.rAF=t?this._stTimeWithRAF:this._stTime,window.cAF=this._ctTime):(window.rAF=t||this._stTime,window.cAF=window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.ocancelAnimationFrame||this._ctTime)},n._stTimeWithRAF=function(e){var t=performance.now(),n=Math.max(0,t-rA._lastTime),i=Math.max(0,rA._frameTime-n),r=window.setTimeout((function(){window.requestAnimationFrame(e)}),i);return rA._lastTime=t+i,r},n._stTime=function(e){var t=performance.now(),n=Math.max(0,t-rA._lastTime),i=Math.max(0,rA._frameTime-n),r=window.setTimeout(e,i);return rA._lastTime=t+i,r},n._ctTime=function(e){window.clearTimeout(e)},n._runMainLoop=function(){var e=this;if(this._inited&&!i){var t,n=this.config,r=c.director,o=n.frameRate;if(L(!!n.showFPS),r.startAnimation(),30===o){var a=!0;t=function(n){e._intervalId=window.rAF(t),(a=!a)||r.mainLoop(n)}}else t=function(n){e._intervalId=window.rAF(t),r.mainLoop(n)};this._intervalId&&(window.cAF(this._intervalId),this._intervalId=0),this._intervalId=window.rAF(t),this._paused=!1}},n._initConfig=function(e){"number"!=typeof e.debugMode&&(e.debugMode=O.NONE),e.exposeClassName=!!e.exposeClassName,"number"!=typeof e.frameRate&&(e.frameRate=60);var t=e.renderMode;("number"!=typeof t||t>2||t<0)&&(e.renderMode=0),"boolean"!=typeof e.registerSystemEvent&&(e.registerSystemEvent=!0),e.showFPS=!!e.showFPS,this.collisionMatrix=e.collisionMatrix||[],this.groupList=e.groupList||[],E(e.debugMode),this.config=e,this._configLoaded=!0,this._setAnimFrame()},n._determineRenderType=function(){var e=this.config,n=parseInt(e.renderMode,10);this.renderType=t.RENDER_TYPE_CANVAS;var i=!1;if(0===n?c.sys.capabilities.opengl?(this.renderType=t.RENDER_TYPE_WEBGL,i=!0):c.sys.capabilities.canvas&&(this.renderType=t.RENDER_TYPE_CANVAS,i=!0):1===n&&c.sys.capabilities.canvas?(this.renderType=t.RENDER_TYPE_CANVAS,i=!0):2===n&&c.sys.capabilities.opengl&&(this.renderType=t.RENDER_TYPE_WEBGL,i=!0),!i)throw new Error(M(3820,n))},n._initDevice=function(){if(!this._rendererInitialized){if(this.canvas=this.config.adapter.canvas,this.frame=this.config.adapter.frame,this.container=this.config.adapter.container,this._determineRenderType(),this.renderType===t.RENDER_TYPE_WEBGL){var e=[],n=!!window.WebGL2RenderingContext,i=window.navigator.userAgent.toLowerCase();(-1!==i.indexOf("safari")&&-1===i.indexOf("chrome")||Rv.browserType===Rv.BROWSER_TYPE_UC)&&(n=!1),n&&c.WebGL2Device&&e.push(c.WebGL2Device),c.WebGLDevice&&e.push(c.WebGLDevice);for(var r=new Za(this.canvas,Ct.ENABLE_WEBGL_ANTIALIAS,!1,window.devicePixelRatio,Rv.windowPixelResolution.width,Rv.windowPixelResolution.height,ou),o=0;o<e.length&&(this._gfxDevice=new e[o],!this._gfxDevice.initialize(r));o++);}if(!this._gfxDevice)return y("can not support canvas rendering in 3D"),void(this.renderType=t.RENDER_TYPE_CANVAS);this.canvas.oncontextmenu=function(){return!1}}},n._initEvents=function(){var e,n=this,i=window;void 0!==document.hidden?e="hidden":void 0!==document.mozHidden?e="mozHidden":void 0!==document.msHidden?e="msHidden":void 0!==document.webkitHidden&&(e="webkitHidden");var r=!1,o=this;function a(){r||(r=!0,o.emit(t.EVENT_HIDE))}function s(e,n,i,a,s){r&&(r=!1,o.emit(t.EVENT_SHOW,e,n,i,a,s))}if(e)for(var c=["visibilitychange","mozvisibilitychange","msvisibilitychange","webkitvisibilitychange","qbrowserVisibilityChange"],l=0;l<c.length;l++)document.addEventListener(c[l],(function(t){var n=document[e];(n=n||t.hidden)?a():s()}));else i.addEventListener("blur",a),i.addEventListener("focus",s);window.navigator.userAgent.indexOf("MicroMessenger")>-1&&(i.onfocus=s),"onpageshow"in window&&"onpagehide"in window&&(i.addEventListener("pagehide",a),i.addEventListener("pageshow",s),document.addEventListener("pagehide",a),document.addEventListener("pageshow",s)),this.on(t.EVENT_HIDE,(function(){n.pause()})),this.on(t.EVENT_SHOW,(function(){n.resume()}))},n._setRenderPipelineNShowSplash=function(){var e=this;return Promise.resolve(this._setupRenderPipeline()).then((function(){return Promise.resolve(e._showSplashScreen()).then((function(){e._inited=!0,e._setAnimFrame(),e._runMainLoop(),e._safeEmit(t.EVENT_GAME_INITED),e.onStart&&e.onStart()}))}))},n._setupRenderPipeline=function(){var e=this,t=this.config.renderPipeline;return t?new Promise((function(e,n){c.assetManager.loadAny(t,(function(t,i){return!t&&i instanceof ng?e(i):n(t)}))})).then((function(t){e._setRenderPipeline(t)})).catch((function(n){g(n),g("Failed load render pipeline: "+t+", engine failed to initialize, will fallback to default pipeline"),e._setRenderPipeline()})):this._setRenderPipeline()},n._showSplashScreen=function(){if(c.internal.SplashScreen){var e=c.internal.SplashScreen.instance;return e.main(c.director.root),new Promise((function(t){e.setOnFinish((function(){return t()})),e.loadFinish=!0}))}return null},n._setRenderPipeline=function(e){c.director.root.setRenderPipeline(e)||this._setRenderPipeline(),this._rendererInitialized=!0,this._safeEmit(t.EVENT_RENDERER_INITED)},n._safeEmit=function(e){this.emit(e)},Z(t,[{key:"inited",get:function(){return this._inited}},{key:"frameTime",get:function(){return this._frameTime}}]),t}(G_));iA.EVENT_HIDE="game_on_hide",iA.EVENT_SHOW="game_on_show",iA.EVENT_LOW_MEMORY="game_on_low_memory",iA.EVENT_GAME_INITED="game_inited",iA.EVENT_ENGINE_INITED="engine_inited",iA.EVENT_RENDERER_INITED="renderer_inited",iA.EVENT_RESTART="game_on_restart",iA.RENDER_TYPE_CANVAS=0,iA.RENDER_TYPE_WEBGL=1,iA.RENDER_TYPE_OPENGL=2,c.Game=iA;var rA=e("cf",c.game=new iA),oA=e("ce",{topLeft:c.v2(0,0),topRight:c.v2(0,0),top:c.v2(0,0),bottomLeft:c.v2(0,0),bottomRight:c.v2(0,0),bottom:c.v2(0,0),center:c.v2(0,0),left:c.v2(0,0),right:c.v2(0,0),width:0,height:0,init:function(e){var t=this.width=e.width,n=this.height=e.height,i=e.x,r=e.y,o=r+n,a=i+t;this.topLeft.x=i,this.topLeft.y=o,this.topRight.x=a,this.topRight.y=o,this.top.x=i+t/2,this.top.y=o,this.bottomLeft.x=i,this.bottomLeft.y=r,this.bottomRight.x=a,this.bottomRight.y=r,this.bottom.x=i+t/2,this.bottom.y=r,this.center.x=i+t/2,this.center.y=r+n/2,this.left.x=i,this.left.y=r+n/2,this.right.x=a,this.right.y=r+n/2}});c.visibleRect=oA;var aA=new(function(){function e(){this.html=void 0,this.meta={width:"device-width"},this.adaptationType=c.sys.browserType}var t=e.prototype;return t.init=function(){this.html=document.getElementsByTagName("html")[0]},t.availWidth=function(e){return c.sys.isMobile||!e||e===this.html?window.innerWidth:e.clientWidth},t.availHeight=function(e){return c.sys.isMobile||!e||e===this.html?window.innerHeight:e.clientHeight},e}());switch(c.sys.os===c.sys.OS_IOS&&(aA.adaptationType=c.sys.BROWSER_TYPE_SAFARI),aA.adaptationType){case c.sys.BROWSER_TYPE_SAFARI:aA.meta["minimal-ui"]="true",aA.availWidth=function(e){return e.clientWidth},aA.availHeight=function(e){return e.clientHeight};break;case c.sys.BROWSER_TYPE_SOUGOU:case c.sys.BROWSER_TYPE_UC:aA.availWidth=function(e){return e.clientWidth},aA.availHeight=function(e){return e.clientHeight}}var sA=e("cS",function(e){function t(){var t;(t=e.call(this)||this)._resizeWithBrowserSize=void 0,t._designResolutionSize=void 0,t._originalDesignResolutionSize=void 0,t._frameSize=void 0,t._scaleX=void 0,t._scaleY=void 0,t._viewportRect=void 0,t._visibleRect=void 0,t._autoFullScreen=void 0,t._devicePixelRatio=void 0,t._maxPixelRatio=void 0,t._retinaEnabled=void 0,t._resizeCallback=void 0,t._resizing=void 0,t._orientationChanging=void 0,t._isRotated=void 0,t._orientation=void 0,t._isAdjustViewport=void 0,t._resolutionPolicy=void 0,t._rpExactFit=void 0,t._rpShowAll=void 0,t._rpNoBorder=void 0,t._rpFixedHeight=void 0,t._rpFixedWidth=void 0;var n=cA,i=lA;return t._frameSize=new hi(0,0),t._designResolutionSize=new hi(0,0),t._originalDesignResolutionSize=new hi(0,0),t._scaleX=1,t._scaleY=1,t._viewportRect=new fi(0,0,0,0),t._visibleRect=new fi(0,0,0,0),t._autoFullScreen=!1,t._devicePixelRatio=1,t._maxPixelRatio=2,t._retinaEnabled=!1,t._resizeCallback=null,t._resizing=!1,t._resizeWithBrowserSize=!1,t._orientationChanging=!0,t._isRotated=!1,t._orientation=c.macro.ORIENTATION_AUTO,t._isAdjustViewport=!0,t._rpExactFit=new uA(n.EQUAL_TO_FRAME,i.EXACT_FIT),t._rpShowAll=new uA(n.EQUAL_TO_FRAME,i.SHOW_ALL),t._rpNoBorder=new uA(n.EQUAL_TO_FRAME,i.NO_BORDER),t._rpFixedHeight=new uA(n.EQUAL_TO_FRAME,i.FIXED_HEIGHT),t._rpFixedWidth=new uA(n.EQUAL_TO_FRAME,i.FIXED_WIDTH),t._resolutionPolicy=t._rpShowAll,c.game.once(c.Game.EVENT_ENGINE_INITED,t.init,ie(t)),t}$(t,e);var n=t.prototype;return n.init=function(){aA.init(),this._initFrameSize();var e=c.game.canvas.width,t=c.game.canvas.height;this._designResolutionSize.width=e,this._designResolutionSize.height=t,this._originalDesignResolutionSize.width=e,this._originalDesignResolutionSize.height=t,this._viewportRect.width=e,this._viewportRect.height=t,this._visibleRect.width=e,this._visibleRect.height=t,c.winSize.width=this._visibleRect.width,c.winSize.height=this._visibleRect.height,c.visibleRect&&c.visibleRect.init(this._visibleRect)},n.resizeWithBrowserSize=function(e){e?this._resizeWithBrowserSize||(this._resizeWithBrowserSize=!0,window.addEventListener("resize",this._resizeEvent),window.addEventListener("orientationchange",this._orientationChange)):this._resizeWithBrowserSize&&(this._resizeWithBrowserSize=!1,window.removeEventListener("resize",this._resizeEvent),window.removeEventListener("orientationchange",this._orientationChange))},n.setResizeCallback=function(e){"function"!=typeof e&&null!=e||(this._resizeCallback=e)},n.setOrientation=function(e){(e&=c.macro.ORIENTATION_AUTO)&&this._orientation!==e&&(this._orientation=e)},n.adjustViewportMeta=function(e){this._isAdjustViewport=e},n.enableRetina=function(e){this._retinaEnabled=!!e},n.isRetinaEnabled=function(){return this._retinaEnabled},n.enableAutoFullScreen=function(e){e&&e!==this._autoFullScreen&&c.sys.isMobile&&c.sys.browserType!==c.sys.BROWSER_TYPE_WECHAT?(this._autoFullScreen=!0,c.screen.autoFullScreen(c.game.frame)):this._autoFullScreen=!1},n.isAutoFullScreenEnabled=function(){return this._autoFullScreen},n.setCanvasSize=function(e,t){var n=c.game.canvas,i=c.game.container;this._devicePixelRatio=window.devicePixelRatio,n.width=Rv.windowPixelResolution.width,n.height=Rv.windowPixelResolution.height,n.style.width=e+"px",n.style.height=t+"px",i.style.width=e+"px",i.style.height=t+"px",this._resizeEvent()},n.getCanvasSize=function(){return new hi(c.game.canvas.width,c.game.canvas.height)},n.getFrameSize=function(){return new hi(this._frameSize.width,this._frameSize.height)},n.setFrameSize=function(e,t){this._frameSize.width=e,this._frameSize.height=t,c.game.frame.style.width=e+"px",c.game.frame.style.height=t+"px",this._resizeEvent()},n.getVisibleSize=function(){return new hi(this._visibleRect.width,this._visibleRect.height)},n.getVisibleSizeInPixel=function(){return new hi(this._visibleRect.width*this._scaleX,this._visibleRect.height*this._scaleY)},n.getVisibleOrigin=function(){return new ri(this._visibleRect.x,this._visibleRect.y)},n.getVisibleOriginInPixel=function(){return new ri(this._visibleRect.x*this._scaleX,this._visibleRect.y*this._scaleY)},n.getResolutionPolicy=function(){return this._resolutionPolicy},n.setResolutionPolicy=function(e){if(e instanceof uA)this._resolutionPolicy=e;else{var t=uA;e===t.EXACT_FIT&&(this._resolutionPolicy=this._rpExactFit),e===t.SHOW_ALL&&(this._resolutionPolicy=this._rpShowAll),e===t.NO_BORDER&&(this._resolutionPolicy=this._rpNoBorder),e===t.FIXED_HEIGHT&&(this._resolutionPolicy=this._rpFixedHeight),e===t.FIXED_WIDTH&&(this._resolutionPolicy=this._rpFixedWidth)}},n.setDesignResolutionSize=function(e,t,n){if(e>0&&t>0){this.setResolutionPolicy(n);var i=this._resolutionPolicy;if(i&&i.preApply(this),c.sys.isMobile&&this._adjustViewportMeta(),this._orientationChanging=!0,this._resizing||this._initFrameSize(),i){this._originalDesignResolutionSize.width=this._designResolutionSize.width=e,this._originalDesignResolutionSize.height=this._designResolutionSize.height=t;var r=i.apply(this,this._designResolutionSize);if(r.scale&&2===r.scale.length&&(this._scaleX=r.scale[0],this._scaleY=r.scale[1]),r.viewport){var o=this._viewportRect,a=this._visibleRect,s=r.viewport;o.x=s.x,o.y=s.y,o.width=s.width,o.height=s.height,a.x=0,a.y=0,a.width=s.width/this._scaleX,a.height=s.height/this._scaleY}i.postApply(this),c.winSize.width=this._visibleRect.width,c.winSize.height=this._visibleRect.height,oA&&oA.init(this._visibleRect),this.emit("design-resolution-changed")}else C(2201)}else R(2200)},n.getDesignResolutionSize=function(){return new hi(this._designResolutionSize.width,this._designResolutionSize.height)},n.setRealPixelResolution=function(e,t,n){this._setViewportMeta({width:e},!0),document.documentElement.style.width=e+"px",document.body.style.width=e+"px",document.body.style.left="0px",document.body.style.top="0px",this.setDesignResolutionSize(e,t,n)},n.getViewportRect=function(){return this._viewportRect},n.getScaleX=function(){return this._scaleX},n.getScaleY=function(){return this._scaleY},n.getDevicePixelRatio=function(){return this._devicePixelRatio},n.convertToLocationInView=function(e,t,n,i){var r=i||new ri,o=this._devicePixelRatio*(e-n.left),a=this._devicePixelRatio*(n.top+n.height-t);return this._isRotated?(r.x=c.game.canvas.width-a,r.y=o):(r.x=o,r.y=a),c.GAME_VIEW&&(r.x/=c.gameView.canvas.width/c.game.canvas.width,r.y/=c.gameView.canvas.height/c.game.canvas.height),r},n._convertPointWithScale=function(e){var t=this._viewportRect;e.x=(e.x-t.x)/this._scaleX,e.y=(e.y-t.y)/this._scaleY},n._resizeEvent=function(){var e=c.view,t=e._frameSize.width,n=e._frameSize.height,i=e._isRotated;if(c.sys.isMobile){var r=c.game.container.style,o=r.margin;r.margin="0",r.display="none",e._initFrameSize(),r.margin=o,r.display="block"}else e._initFrameSize();if(e._orientationChanging||e._isRotated!==i||e._frameSize.width!==t||e._frameSize.height!==n){var a=e._originalDesignResolutionSize.width,s=e._originalDesignResolutionSize.height;e._resizing=!0,a>0&&e.setDesignResolutionSize(a,s,e._resolutionPolicy),e._resizing=!1,e.emit("canvas-resize"),e._resizeCallback&&e._resizeCallback.call()}},n._orientationChange=function(){c.view._orientationChanging=!0,c.view._resizeEvent()},n._initFrameSize=function(){var e=this._frameSize,t=aA.availWidth(c.game.frame),n=aA.availHeight(c.game.frame),i=t>=n;!c.sys.isMobile||i&&this._orientation&c.macro.ORIENTATION_LANDSCAPE||!i&&this._orientation&c.macro.ORIENTATION_PORTRAIT?(e.width=t,e.height=n,c.game.container.style["-webkit-transform"]="rotate(0deg)",c.game.container.style.transform="rotate(0deg)",this._isRotated=!1):(e.width=n,e.height=t,c.game.container.style["-webkit-transform"]="rotate(90deg)",c.game.container.style.transform="rotate(90deg)",c.game.container.style["-webkit-transform-origin"]="0px 0px 0px",c.game.container.style.transformOrigin="0px 0px 0px",this._isRotated=!0,c.game.canvas.style["-webkit-transform"]="translateZ(0px)",c.game.canvas.style.transform="translateZ(0px)"),this._orientationChanging&&setTimeout((function(){c.view._orientationChanging=!1}),1e3)},n._adjustSizeKeepCanvasSize=function(){var e=this._originalDesignResolutionSize.width,t=this._originalDesignResolutionSize.height;e>0&&this.setDesignResolutionSize(e,t,this._resolutionPolicy)},n._setViewportMeta=function(e,t){var n=document.getElementById("cocosMetaElement");n&&t&&document.head.removeChild(n);var i,r,o,a=document.getElementsByName("viewport"),s=a?a[0]:null;for(r in i=s?s.content:"",(n=n||document.createElement("meta")).id="cocosMetaElement",n.name="viewport",n.content="",e)-1===i.indexOf(r)?i+=","+r+"="+e[r]:t&&(o=new RegExp(r+"s*=s*[^,]+"),i=i.replace(o,r+"="+e[r]));/^,/.test(i)&&(i=i.substr(1)),n.content=i,s&&(s.content=i),document.head.appendChild(n)},n._adjustViewportMeta=function(){!this._isAdjustViewport||a||r||o||(this._setViewportMeta(aA.meta,!1),this._isAdjustViewport=!1)},n._convertMouseToLocation=function(e,t){e.x=this._devicePixelRatio*(e.x-t.left),e.y=this._devicePixelRatio*(t.top+t.height-e.y),c.GAME_VIEW&&(e.x/=c.gameView.canvas.width/c.game.canvas.width,e.y/=c.gameView.canvas.height/c.game.canvas.height)},n._convertTouchWidthScale=function(e){var t=this._viewportRect,n=this._scaleX,i=this._scaleY;e._point.x=(e._point.x-t.x)/n,e._point.y=(e._point.y-t.y)/i,e._prevPoint.x=(e._prevPoint.x-t.x)/n,e._prevPoint.y=(e._prevPoint.y-t.y)/i},n._convertTouchesWithScale=function(e){for(var t,n,i=this._viewportRect,r=this._scaleX,o=this._scaleY,a=0;a<e.length;a++){var s=e[a];t=s._point,n=s._prevPoint,t.x=(t.x-i.x)/r,t.y=(t.y-i.y)/o,n.x=(n.x-i.x)/r,n.y=(n.y-i.y)/o}},t}(G_));sA.instance=void 0;var cA=function(){function e(){this.name="ContainerStrategy"}var t=e.prototype;return t.preApply=function(){},t.apply=function(){},t.postApply=function(){},t._setupContainer=function(e,t,n){var i=c.game.canvas,r=c.game.container;c.sys.os===c.sys.OS_ANDROID&&(document.body.style.width=(e._isRotated?n:t)+"px",document.body.style.height=(e._isRotated?t:n)+"px"),r.style.width=i.style.width=t+"px",r.style.height=i.style.height=n+"px",e._devicePixelRatio=1,e.isRetinaEnabled()&&(e._devicePixelRatio=Math.min(e._maxPixelRatio,window.devicePixelRatio||1)),i.width=t*e._devicePixelRatio,i.height=n*e._devicePixelRatio},t._fixContainer=function(){document.body.insertBefore(c.game.container,document.body.firstChild);var e=document.body.style;e.width=window.innerWidth+"px",e.height=window.innerHeight+"px",e.overflow="hidden";var t=c.game.container.style;t.position="fixed",t.left=t.top="0px",document.body.scrollTop=0},e}();cA.EQUAL_TO_FRAME=void 0,cA.PROPORTION_TO_FRAME=void 0;var lA=function(){function e(){this.name="ContentStrategy",this._result=void 0,this._result={scale:[1,1],viewport:null}}var t=e.prototype;return t.preApply=function(){},t.apply=function(){return{scale:[1,1]}},t.postApply=function(){},t._buildResult=function(e,t,n,i,r,o){Math.abs(e-n)<2&&(n=e),Math.abs(t-i)<2&&(i=t);var a=new fi(Math.round((e-n)/2),Math.round((t-i)/2),n,i);return this._result.scale=[r,o],this._result.viewport=a,this._result},e}();lA.EXACT_FIT=void 0,lA.SHOW_ALL=void 0,lA.NO_BORDER=void 0,lA.FIXED_HEIGHT=void 0,lA.FIXED_WIDTH=void 0,function(){var e=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this).name="EqualToFrame",t}return $(t,e),t.prototype.apply=function(e){var t=e._frameSize.height,n=c.game.container.style;this._setupContainer(e,e._frameSize.width,e._frameSize.height),e._isRotated?n.margin="0 0 0 "+t+"px":n.margin="0px",n.padding="0px"},t}(cA),t=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this).name="ProportionalToFrame",t}return $(t,e),t.prototype.apply=function(e,t){var n,i,r=e._frameSize.width,o=e._frameSize.height,a=c.game.container.style,s=t.width,l=t.height,u=r/s,h=o/l;u<h?(n=r,i=l*u):(n=s*h,i=o);var _=Math.round((r-n)/2),f=Math.round((o-i)/2);n=r-2*_,i=o-2*f,this._setupContainer(e,n,i),e._isRotated?a.margin="0 0 0 "+o+"px":a.margin="0px",a.paddingLeft=_+"px",a.paddingRight=_+"px",a.paddingTop=f+"px",a.paddingBottom=f+"px"},t}(cA),n=("undefined"==typeof window?global:window).__globalAdapter;n&&(n.adaptContainerStrategy&&n.adaptContainerStrategy(cA.prototype),n.adaptView&&n.adaptView(sA.prototype)),cA.EQUAL_TO_FRAME=new e,cA.PROPORTION_TO_FRAME=new t;var i=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this).name="ExactFit",t}return $(t,e),t.prototype.apply=function(e,t){var n=c.game.canvas.width,i=c.game.canvas.height,r=n/t.width,o=i/t.height;return this._buildResult(n,i,n,i,r,o)},t}(lA),r=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this).name="ShowAll",t}return $(t,e),t.prototype.apply=function(e,t){var n,i,r=c.game.canvas.width,o=c.game.canvas.height,a=t.width,s=t.height,l=r/a,u=o/s,h=0;return l<u?(n=r,i=s*(h=l)):(n=a*(h=u),i=o),this._buildResult(r,o,n,i,h,h)},t}(lA),o=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this).name="NoBorder",t}return $(t,e),t.prototype.apply=function(e,t){var n,i,r,o=c.game.canvas.width,a=c.game.canvas.height,s=t.width,l=t.height,u=o/s,h=a/l;return u<h?(i=s*(n=h),r=a):(i=o,r=l*(n=u)),this._buildResult(o,a,i,r,n,n)},t}(lA),a=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this).name="FixedHeight",t}return $(t,e),t.prototype.apply=function(e,t){var n=c.game.canvas.width,i=c.game.canvas.height,r=i/t.height,o=n,a=i;return this._buildResult(n,i,o,a,r,r)},t}(lA),s=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this).name="FixedWidth",t}return $(t,e),t.prototype.apply=function(e,t){var n=c.game.canvas.width,i=c.game.canvas.height,r=n/t.width,o=n,a=i;return this._buildResult(n,i,o,a,r,r)},t}(lA);lA.EXACT_FIT=new i,lA.SHOW_ALL=new r,lA.NO_BORDER=new o,lA.FIXED_HEIGHT=new a,lA.FIXED_WIDTH=new s}();var uA=e("es",function(){function e(e,t){this.name="ResolutionPolicy",this._containerStrategy=void 0,this._contentStrategy=void 0,this._containerStrategy=null,this._contentStrategy=null,this.setContainerStrategy(e),this.setContentStrategy(t)}var t=e.prototype;return t.preApply=function(e){this._containerStrategy.preApply(e),this._contentStrategy.preApply(e)},t.apply=function(e,t){return this._containerStrategy.apply(e,t),this._contentStrategy.apply(e,t)},t.postApply=function(e){this._containerStrategy.postApply(e),this._contentStrategy.postApply(e)},t.setContainerStrategy=function(e){e instanceof cA&&(this._containerStrategy=e)},t.setContentStrategy=function(e){e instanceof lA&&(this._contentStrategy=e)},Z(e,[{key:"canvasSize",get:function(){return new ri(c.game.canvas.width,c.game.canvas.height)}}]),e}());uA.EXACT_FIT=0,uA.NO_BORDER=1,uA.SHOW_ALL=2,uA.FIXED_HEIGHT=3,uA.FIXED_WIDTH=4,uA.UNKNOWN=5,uA.ContainerStrategy=cA,uA.ContentStrategy=lA,c.ResolutionPolicy=uA;var hA,_A=e("cg",sA.instance=c.view=new sA);c.winSize=new hi,ge(sA.prototype,"View.prototype",[{name:"isAntiAliasEnabled",suggest:"The API of Texture2d have been largely modified, no alternative"},{name:"enableAntiAlias",suggest:"The API of Texture2d have been largely modified, no alternative"}]),function(e){e.TOUCH_START="touch-start",e.TOUCH_MOVE="touch-move",e.TOUCH_END="touch-end",e.TOUCH_CANCEL="touch-cancel",e.MOUSE_DOWN="mouse-down",e.MOUSE_MOVE="mouse-move",e.MOUSE_UP="mouse-up",e.MOUSE_WHEEL="mouse-wheel",e.MOUSE_ENTER="mouse-enter",e.MOUSE_LEAVE="mouse-leave",e.KEY_DOWN="keydown",e.KEY_UP="keyup",e.DEVICEMOTION="devicemotion",e.TRANSFORM_CHANGED="transform-changed",e.SCENE_CHANGED_FOR_PERSISTS="scene-changed-for-persists",e.SIZE_CHANGED="size-changed",e.ANCHOR_CHANGED="anchor-changed",e.COLOR_CHANGED="color-changed",e.CHILD_ADDED="child-added",e.CHILD_REMOVED="child-removed",e.PARENT_CHANGED="parent-changed",e.NODE_DESTROYED="node-destroyed",e.LAYER_CHANGED="layer-changed",e.SIBLING_ORDER_CHANGED="sibling-order-changed"}(hA||(hA=e("b$",{}))),Tt(hA),c.SystemEventType=hA,ve(hA,"Node.EventType",[{name:"POSITION_PART",newName:"TRANSFORM_CHANGED"},{name:"ROTATION_PART",newName:"TRANSFORM_CHANGED"},{name:"SCALE_PART",newName:"TRANSFORM_CHANGED"}]);var fA=null,mA=null,dA=null,pA=null,vA=e("ev",function(e){function t(){return e.call(this)||this}$(t,e);var n=t.prototype;return n.setAccelerometerEnabled=function(e){e&&window.DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceMotionEvent.requestPermission().then((function(e){C(3520,e),nA.setAccelerometerEnabled("granted"===e)})).catch((function(e){I(3521,e.message),nA.setAccelerometerEnabled(!1)})):nA.setAccelerometerEnabled(e)},n.setAccelerometerInterval=function(e){nA.setAccelerometerInterval(e)},n.on=function(t,n,i,r){return e.prototype.on.call(this,t,n,i,r),t!==hA.KEY_DOWN&&t!==hA.KEY_UP||fA||(fA=BT.create({event:BT.KEYBOARD,onKeyPressed:function(e,t){t.type=hA.KEY_DOWN,gA.emit(t.type,t)},onKeyReleased:function(e,t){t.type=hA.KEY_UP,gA.emit(t.type,t)}}),XT.addListener(fA,256)),t===hA.DEVICEMOTION&&(mA||(mA=BT.create({event:BT.ACCELERATION,callback:function(e,t){t.type=hA.DEVICEMOTION,c.systemEvent.emit(t.type,t)}}),XT.addListener(mA,256))),t!==hA.TOUCH_START&&t!==hA.TOUCH_MOVE&&t!==hA.TOUCH_END&&t!==hA.TOUCH_CANCEL||dA||(dA=BT.create({event:BT.TOUCH_ONE_BY_ONE,onTouchBegan:function(e,t){return t.type=hA.TOUCH_START,c.systemEvent.emit(t.type,e,t),!0},onTouchMoved:function(e,t){t.type=hA.TOUCH_MOVE,c.systemEvent.emit(t.type,e,t)},onTouchEnded:function(e,t){t.type=hA.TOUCH_END,c.systemEvent.emit(t.type,e,t)},onTouchCancelled:function(e,t){t.type=hA.TOUCH_CANCEL,c.systemEvent.emit(t.type,e,t)}}),XT.addListener(dA,256)),t!==hA.MOUSE_DOWN&&t!==hA.MOUSE_MOVE&&t!==hA.MOUSE_UP&&t!==hA.MOUSE_WHEEL||pA||(pA=BT.create({event:BT.MOUSE,onMouseDown:function(e){e.type=hA.MOUSE_DOWN,c.systemEvent.emit(e.type,e)},onMouseMove:function(e){e.type=hA.MOUSE_MOVE,c.systemEvent.emit(e.type,e)},onMouseUp:function(e){e.type=hA.MOUSE_UP,c.systemEvent.emit(e.type,e)},onMouseScroll:function(e){e.type=hA.MOUSE_WHEEL,c.systemEvent.emit(e.type,e)}}),XT.addListener(pA,256)),n},n.off=function(t,n,i){if(e.prototype.off.call(this,t,n,i),fA&&(t===hA.KEY_DOWN||t===hA.KEY_UP)){var r=this.hasEventListener(hA.KEY_DOWN),o=this.hasEventListener(hA.KEY_UP);r||o||(XT.removeListener(fA),fA=null)}if(mA&&t===hA.DEVICEMOTION&&(XT.removeListener(mA),mA=null),dA&&(t===hA.TOUCH_START||t===hA.TOUCH_MOVE||t===hA.TOUCH_END||t===hA.TOUCH_CANCEL)){var a=this.hasEventListener(hA.TOUCH_START),s=this.hasEventListener(hA.TOUCH_MOVE),c=this.hasEventListener(hA.TOUCH_END),l=this.hasEventListener(hA.TOUCH_CANCEL);a||s||c||l||(XT.removeListener(dA),dA=null)}if(pA&&(t===hA.MOUSE_DOWN||t===hA.MOUSE_MOVE||t===hA.MOUSE_UP||t===hA.MOUSE_WHEEL)){var u=this.hasEventListener(hA.MOUSE_DOWN),h=this.hasEventListener(hA.MOUSE_MOVE),_=this.hasEventListener(hA.MOUSE_UP),f=this.hasEventListener(hA.MOUSE_WHEEL);u||h||_||f||(XT.removeListener(pA),pA=null)}},t}(G_));vA.EventType=hA,c.SystemEvent=vA;var gA=e("ew",new vA);c.systemEvent=gA;var yA=e("cI",{_supportsFullScreen:!1,_onfullscreenchange:null,_onfullscreenerror:null,_preOnFullScreenError:null,_preOnTouch:null,_touchEvent:"",_fn:null,_fnMap:[["requestFullscreen","exitFullscreen","fullscreenchange","fullscreenEnabled","fullscreenElement"],["requestFullScreen","exitFullScreen","fullScreenchange","fullScreenEnabled","fullScreenElement"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitfullscreenchange","webkitIsFullScreen","webkitCurrentFullScreenElement"],["mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozFullScreen","mozFullScreenElement"],["msRequestFullscreen","msExitFullscreen","MSFullscreenChange","msFullscreenEnabled","msFullscreenElement"]],init:function(){var e,t,n;this._fn={};var i,r=this._fnMap;for(e=0,t=r.length;e<t;e++)if((n=r[e])&&void 0!==document[n[1]]){for(e=0,i=n.length;e<i;e++)this._fn[r[0][e]]=n[e];break}this._supportsFullScreen=void 0!==this._fn.requestFullscreen,this._touchEvent="ontouchstart"in window?"touchstart":"mousedown"},get supportsFullScreen(){return this._supportsFullScreen},fullScreen:function(){return!!this._supportsFullScreen&&void 0!==document[this._fn.fullscreenElement]&&null!==document[this._fn.fullscreenElement]},requestFullScreen:function(e,t,n){if(this._supportsFullScreen){if(e=e||document.documentElement,t){var i=this._fn.fullscreenchange;this._onfullscreenchange&&document.removeEventListener(i,this._onfullscreenchange),this._onfullscreenchange=t,document.addEventListener(i,t,!1)}if(n){var r=this._fn.fullscreenerror;this._onfullscreenerror&&document.removeEventListener(r,this._onfullscreenerror),this._onfullscreenerror=n,document.addEventListener(r,n,{once:!0})}var o=e[this._fn.requestFullscreen]();return window.Promise&&o instanceof Promise&&o.catch((function(){})),o}},exitFullScreen:function(){var e;return this.fullScreen()&&(e=document[this._fn.exitFullscreen]()).catch((function(){})),e},autoFullScreen:function(e,t){e=e||document.body,this._ensureFullScreen(e,t),this.requestFullScreen(e,t)},disableAutoFullScreen:function(e){if(this._preOnTouch){var t=c.game.canvas||e,n=this._touchEvent;t.removeEventListener(n,this._preOnTouch),this._preOnTouch=null}},_ensureFullScreen:function(e,t){var n=this,i=c.game.canvas||e,r=this._fn.fullscreenerror,o=this._touchEvent,a=function(){n._preOnFullScreenError=null,n._preOnTouch&&i.removeEventListener(o,n._preOnTouch),n._preOnTouch=function(){n._preOnTouch=null,n.requestFullScreen(e,t)},i.addEventListener(o,n._preOnTouch,{once:!0})};this._preOnFullScreenError&&e.removeEventListener(r,this._preOnFullScreenError),this._preOnFullScreenError=a,e.addEventListener(r,a,{once:!0})}});yA.init(),c.screen=yA;var xA=function(){var e=t.prototype;function t(){this.handle=0,this.callBack=null,this.cancelAnimate=!1,this.startTime=-1,this._splashFinish=!1,this._loadFinish=!1,this._directCall=!1}return e.main=function(e){if(null!=e){if(window._CCSettings&&window._CCSettings.splashScreen){var t=this.setting=window._CCSettings.splashScreen;t.totalTime=null!=this.setting.totalTime?this.setting.totalTime:3e3,t.base64src=this.setting.base64src||"",t.effect=this.setting.effect||"FADE-INOUT",t.clearColor=this.setting.clearColor||new ls(.88,.88,.88,1),t.displayRatio=null!=this.setting.displayRatio?this.setting.displayRatio:.4,t.displayWatermark=null==this.setting.displayWatermark||this.setting.displayWatermark}else this.setting={totalTime:3e3,base64src:"",effect:"FADE-INOUT",clearColor:new ls(.88,.88,.88,1),displayRatio:.4,displayWatermark:!0};if(""===this.setting.base64src||this.setting.totalTime<=0)this.callBack&&this.callBack(),this.callBack=null,this.setting=null,this._directCall=!0;else{c.view.enableRetina(!0);var n=window._CCSettings.designResolution;n?c.view.setDesignResolutionSize(n.width,n.height,n.policy):c.view.setDesignResolutionSize(960,640,4),this.root=e,this.device=e.device,c.game.once(c.Game.EVENT_GAME_INITED,(function(){c.director._lateUpdate=performance.now()}),c.director),this.callBack=null,this.cancelAnimate=!1,this.startTime=-1;var i=this.setting.clearColor;this.clearColors=[new ls(i.x,i.y,i.z,i.w)];var r=this.device,o=r.width,a=r.height,s=r.surfaceTransform;this.screenWidth=s%2?a:o,this.screenHeight=s%2?o:a,this.image=new Image,this.image.onload=this.init.bind(this),this.image.src=this.setting.base64src}}else y("RENDER ROOT IS NULL.")},e.setOnFinish=function(e){if(this._directCall&&e)return t._ins=void 0,void e();this.callBack=e},e._tryToStart=function(){this._splashFinish&&this._loadFinish&&this.callBack&&(this.callBack(),this.hide(),c.game.resume())},e.init=function(){var e=this;this.initCMD(),this.initIA(),this.initPSO(),this.setting.displayWatermark&&this.initText(),c.game.pause(),this.handle=requestAnimationFrame((function t(n){if(!e.cancelAnimate){e.startTime<0&&(e.startTime=n);var i=n-e.startTime,r=kp(En(i/e.setting.totalTime));"NONE"===e.setting.effect&&(r=1),e.material.setProperty("u_precent",r),e.material.passes[0].update(),e.setting.displayWatermark&&e.textMaterial&&(e.textMaterial.setProperty("u_precent",r),e.textMaterial.passes[0].update()),e.frame(n),i>e.setting.totalTime&&(e.splashFinish=!0),requestAnimationFrame(t)}}))},e.hide=function(){cancelAnimationFrame(this.handle),this.cancelAnimate=!0,setTimeout(this.destroy.bind(this))},e.frame=function(){if(!this.cancelAnimate){var e=this.device;e.acquire();var t=this.cmdBuff,n=this.framebuffer,i=this.renderArea;i.height=e.height,i.width=e.width,t.begin(),t.beginRenderPass(n.renderPass,n,i,this.clearColors,1,0);var r=this.material.passes[0],o=ig.getOrCreatePipelineState(e,r,this.shader,n.renderPass,this.assmebler);if(t.bindPipelineState(o),t.bindDescriptorSet(nu.MATERIAL,r.descriptorSet),t.bindInputAssembler(this.assmebler),t.draw(this.assmebler),this.setting.displayWatermark&&this.textShader&&this.textAssmebler){var a=this.textMaterial.passes[0],s=ig.getOrCreatePipelineState(e,a,this.textShader,n.renderPass,this.textAssmebler);t.bindPipelineState(s),t.bindDescriptorSet(nu.MATERIAL,a.descriptorSet),t.bindInputAssembler(this.textAssmebler),t.draw(this.textAssmebler)}t.endRenderPass(),t.end(),e.queue.submit([t]),e.present()}},e.initText=function(){this.textImg=document.createElement("canvas"),this.textImg.width=330,this.textImg.height=30,this.textImg.style.width=""+this.textImg.width,this.textImg.style.height=""+this.textImg.height;var e=this.textImg.getContext("2d");e.font="18px Arial",e.textBaseline="top",e.textAlign="left",e.fillStyle="`#424242`";var t="Powered by Cocos Creator",n=e.measureText(t);e.fillText(t,(330-n.width)/2,6),this.textRegion=new ms,this.textRegion.texExtent.width=this.textImg.width,this.textRegion.texExtent.height=this.textImg.height,this.textRegion.texExtent.depth=1,this.textTexture=this.device.createTexture(new zs(ma.TEX2D,da.SAMPLED|da.TRANSFER_DST,Jo.RGBA8,this.textImg.width,this.textImg.height)),this.device.copyTexImagesToTexture([this.textImg],this.textTexture,[this.textRegion]),this.textMaterial=new fp,this.textMaterial.initialize({effectName:"splash-screen"});var i=this.textMaterial.passes[0],r=i.getBinding("mainTexture");i.bindTexture(r,this.textTexture),this.textShader=Zi.get(i.getShaderVariant()),Ji.get(fr.get(i.handle,Ki.DESCRIPTOR_SET)).update();var o=4*Float32Array.BYTES_PER_ELEMENT,a=4*o;this.textVB=this.device.createBuffer(new Wa($o.VERTEX|$o.TRANSFER_DST,ea.HOST|ea.DEVICE,a,o));var s=new Float32Array(16),c=-this.textImg.width/2,l=this.textImg.height;l=this.screenWidth<this.screenHeight?(c=-this.screenWidth/2*.5)/(this.textImg.width/this.textImg.height):(c=-this.screenHeight/2*.5)/(this.textImg.width/this.textImg.height);var u=0;s[u++]=c,s[u++]=l,s[u++]=0,s[u++]=1,s[u++]=-c,s[u++]=l,s[u++]=1,s[u++]=1,s[u++]=c,s[u++]=-l,s[u++]=0,s[u++]=0,s[u++]=-c,s[u++]=-l,s[u++]=1,s[u++]=0;for(var h=0;h<s.length;h+=4)s[h]+=this.screenWidth/2,s[h+1]+=.1*this.screenHeight;for(var _=this.device.screenSpaceSignY,f=$n[this.device.surfaceTransform],m=0;m<s.length;m+=4){var d=s[m]/this.screenWidth*2-1,p=(s[m+1]/this.screenHeight*2-1)*_;s[m]=f[0]*d+f[2]*p,s[m+1]=f[1]*d+f[3]*p}this.textVB.update(s);var v=Uint16Array.BYTES_PER_ELEMENT,g=6*v;this.textIB=this.device.createBuffer(new Wa($o.INDEX|$o.TRANSFER_DST,ea.HOST|ea.DEVICE,g,v));var y=new Uint16Array(6);y[0]=0,y[1]=1,y[2]=2,y[3]=1,y[4]=3,y[5]=2,this.textIB.update(y);var x=[new rs("a_position",Jo.RG32F),new rs("a_texCoord",Jo.RG32F)],E=new os(x,[this.textVB],this.textIB);this.textAssmebler=this.device.createInputAssembler(E)},e.initCMD=function(){var e=this.device;this.renderArea=new ss(0,0,e.width,e.height),this.framebuffer=this.root.mainWindow.framebuffer,this.cmdBuff=e.commandBuffer},e.initIA=function(){var e=this.device,t=4*Float32Array.BYTES_PER_ELEMENT,n=4*t;this.vertexBuffers=e.createBuffer(new Wa($o.VERTEX|$o.TRANSFER_DST,ea.HOST|ea.DEVICE,n,t));var i=new Float32Array(16),r=-this.image.width/2,o=this.image.height;o=this.screenWidth<this.screenHeight?(r=-this.screenWidth/2*this.setting.displayRatio)/(this.image.width/this.image.height):(r=-this.screenHeight/2*this.setting.displayRatio)/(this.image.width/this.image.height);var a=0;i[a++]=r,i[a++]=o,i[a++]=0,i[a++]=1,i[a++]=-r,i[a++]=o,i[a++]=1,i[a++]=1,i[a++]=r,i[a++]=-o,i[a++]=0,i[a++]=0,i[a++]=-r,i[a++]=-o,i[a++]=1,i[a++]=0;for(var s=0;s<i.length;s+=4)i[s]+=this.screenWidth/2,i[s+1]+=this.screenHeight/2;for(var c=this.device.screenSpaceSignY,l=$n[this.device.surfaceTransform],u=0;u<i.length;u+=4){var h=i[u]/this.screenWidth*2-1,_=(i[u+1]/this.screenHeight*2-1)*c;i[u]=l[0]*h+l[2]*_,i[u+1]=l[1]*h+l[3]*_}this.vertexBuffers.update(i);var f=Uint16Array.BYTES_PER_ELEMENT,m=6*f;this.indicesBuffers=e.createBuffer(new Wa($o.INDEX|$o.TRANSFER_DST,ea.HOST|ea.DEVICE,m,f));var d=new Uint16Array(6);d[0]=0,d[1]=1,d[2]=2,d[3]=1,d[4]=3,d[5]=2,this.indicesBuffers.update(d);var p=[new rs("a_position",Jo.RG32F),new rs("a_texCoord",Jo.RG32F)],v=new os(p,[this.vertexBuffers],this.indicesBuffers);this.assmebler=e.createInputAssembler(v)},e.initPSO=function(){var e=this.device;this.material=new fp,this.material.initialize({effectName:"splash-screen"});var t=new Rs;t.addressU=fa.CLAMP,t.addressV=fa.CLAMP,this.sampler=e.createSampler(t),this.texture=e.createTexture(new zs(ma.TEX2D,da.SAMPLED|da.TRANSFER_DST,Jo.RGBA8,this.image.width,this.image.height));var n=this.material.passes[0],i=n.getBinding("mainTexture");n.bindTexture(i,this.texture),this.shader=Zi.get(n.getShaderVariant());var r=Ji.get(fr.get(n.handle,Ki.DESCRIPTOR_SET));r.bindSampler(i,this.sampler),r.update(),this.region=new ms,this.region.texExtent.width=this.image.width,this.region.texExtent.height=this.image.height,this.region.texExtent.depth=1,e.copyTexImagesToTexture([this.image],this.texture,[this.region])},e.destroy=function(){this.callBack=null,this.clearColors=null,this.device=null,this.image=null,this.framebuffer=null,this.renderArea=null,this.region=null,this.cmdBuff=null,this.shader=null,this.material.destroy(),this.material=null,this.texture.destroy(),this.texture=null,this.assmebler.destroy(),this.assmebler=null,this.vertexBuffers.destroy(),this.vertexBuffers=null,this.indicesBuffers.destroy(),this.indicesBuffers=null,this.sampler.destroy(),this.sampler=null,this.textImg&&(this.textImg=null,this.textRegion=null,this.textShader=null,this.textMaterial.destroy(),this.textMaterial=null,this.textTexture.destroy(),this.textTexture=null,this.textAssmebler.destroy(),this.textAssmebler=null,this.textVB.destroy(),this.textVB=null,this.textIB.destroy(),this.textIB=null),this.setting=null,t._ins=void 0},Z(t,[{key:"splashFinish",set:function(e){this._splashFinish=e,this._tryToStart()}},{key:"loadFinish",set:function(e){this._loadFinish=e,this._tryToStart()}}],[{key:"instance",get:function(){return t._ins||(t._ins=new t),t._ins}}]),t}();xA._ins=void 0,c.internal.SplashScreen=xA;var EA=e("d8",function(){function e(){this._id="",this._priority=0,this._executeInEditMode=!1}e.sortByPriority=function(e,t){return e._priority<t._priority?1:e._priority>t.priority?-1:0};var t=e.prototype;return t.init=function(){},t.update=function(){},t.postUpdate=function(){},Z(e,[{key:"priority",set:function(e){this._priority=e},get:function(){return this._priority}},{key:"id",set:function(e){this._id=e},get:function(){return this._id}}]),e}()),SA=new Ne("Scheduler"),TA=function(e,t,n,i){this.target=void 0,this.priority=void 0,this.paused=void 0,this.markedForDeletion=void 0,this.target=e,this.priority=t,this.paused=n,this.markedForDeletion=i};TA.get=function(e,t,n,i){var r=TA._listEntries.pop();return r?(r.target=e,r.priority=t,r.paused=n,r.markedForDeletion=i):r=new TA(e,t,n,i),r},TA.put=function(e){TA._listEntries.length<20&&(e.target=null,TA._listEntries.push(e))},TA._listEntries=[];var AA=function(e,t,n,i){this.list=void 0,this.entry=void 0,this.target=void 0,this.callback=void 0,this.list=e,this.entry=t,this.target=n,this.callback=i};AA.get=function(e,t,n,i){var r=AA._hashUpdateEntries.pop();return r?(r.list=e,r.entry=t,r.target=n,r.callback=i):r=new AA(e,t,n,i),r},AA.put=function(e){AA._hashUpdateEntries.length<20&&(e.list=e.entry=e.target=e.callback=null,AA._hashUpdateEntries.push(e))},AA._hashUpdateEntries=[];var CA=function(e,t,n,i,r,o){this.timers=void 0,this.target=void 0,this.timerIndex=void 0,this.currentTimer=void 0,this.currentTimerSalvaged=void 0,this.paused=void 0,this.timers=e,this.target=t,this.timerIndex=n,this.currentTimer=i,this.currentTimerSalvaged=r,this.paused=o};CA.get=function(e,t,n,i,r,o){var a=CA._hashTimerEntries.pop();return a?(a.timers=e,a.target=t,a.timerIndex=n,a.currentTimer=i,a.currentTimerSalvaged=r,a.paused=o):a=new CA(e,t,n,i,r,o),a},CA.put=function(e){CA._hashTimerEntries.length<20&&(e.timers=e.target=e.currentTimer=null,CA._hashTimerEntries.push(e))},CA._hashTimerEntries=[];var wA=function(){function e(){this._lock=void 0,this._scheduler=void 0,this._elapsed=void 0,this._runForever=void 0,this._useDelay=void 0,this._timesExecuted=void 0,this._repeat=void 0,this._delay=void 0,this._interval=void 0,this._target=void 0,this._callback=void 0,this._lock=!1,this._scheduler=null,this._elapsed=-1,this._runForever=!1,this._useDelay=!1,this._timesExecuted=0,this._repeat=0,this._delay=0,this._interval=0,this._target=null,this._callback=null}var t=e.prototype;return t.initWithCallback=function(e,t,n,i,r,o){return this._lock=!1,this._scheduler=e,this._target=n,this._callback=t,this._elapsed=-1,this._interval=i,this._delay=o,this._useDelay=this._delay>0,this._repeat=r,this._runForever=this._repeat===c.macro.REPEAT_FOREVER,!0},t.getInterval=function(){return this._interval},t.setInterval=function(e){this._interval=e},t.update=function(e){-1===this._elapsed?(this._elapsed=0,this._timesExecuted=0):(this._elapsed+=e,this._runForever&&!this._useDelay?this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0):(this._useDelay?this._elapsed>=this._delay&&(this.trigger(),this._elapsed-=this._delay,this._timesExecuted+=1,this._useDelay=!1):this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0,this._timesExecuted+=1),this._callback&&!this._runForever&&this._timesExecuted>this._repeat&&this.cancel()))},t.getCallback=function(){return this._callback},t.trigger=function(){this._target&&this._callback&&(this._lock=!0,this._callback.call(this._target,this._elapsed),this._lock=!1)},t.cancel=function(){this._scheduler.unschedule(this._callback,this._target)},e}();wA._timers=[],wA.get=function(){return wA._timers.pop()||new wA},wA.put=function(e){wA._timers.length<20&&!e._lock&&(e._scheduler=e._target=e._callback=null,wA._timers.push(e))};var IA=e("dD",function(e){function t(){var t;return(t=e.call(this)||this)._timeScale=void 0,t._updatesNegList=void 0,t._updates0List=void 0,t._updatesPosList=void 0,t._hashForUpdates=void 0,t._hashForTimers=void 0,t._currentTarget=void 0,t._currentTargetSalvaged=void 0,t._updateHashLocked=void 0,t._arrayForTimers=void 0,t._timeScale=1,t._updatesNegList=[],t._updates0List=[],t._updatesPosList=[],t._hashForUpdates=ke(!0),t._hashForTimers=ke(!0),t._currentTarget=null,t._currentTargetSalvaged=!1,t._updateHashLocked=!1,t._arrayForTimers=[],t}$(t,e),t.enableForTarget=function(e){var t=!1;(e.uuid||e.id)&&(t=!0),t||(e.__instanceId?I(1513):e.id=SA.getNewId())};var n=t.prototype;return n.setTimeScale=function(e){this._timeScale=e},n.getTimeScale=function(){return this._timeScale},n.update=function(e){var t,n,i,r,o;for(this._updateHashLocked=!0,1!==this._timeScale&&(e*=this._timeScale),t=0,i=(n=this._updatesNegList).length;t<i;t++)(r=n[t]).paused||r.markedForDeletion||r.target.update(e);for(t=0,i=(n=this._updates0List).length;t<i;t++)(r=n[t]).paused||r.markedForDeletion||r.target.update(e);for(t=0,i=(n=this._updatesPosList).length;t<i;t++)(r=n[t]).paused||r.markedForDeletion||r.target.update(e);var a=this._arrayForTimers;for(t=0;t<a.length;t++){if(o=a[t],this._currentTarget=o,this._currentTargetSalvaged=!1,!o.paused)for(o.timerIndex=0;o.timerIndex<o.timers.length;++o.timerIndex)o.currentTimer=o.timers[o.timerIndex],o.currentTimerSalvaged=!1,o.currentTimer.update(e),o.currentTimer=null;this._currentTargetSalvaged&&0===this._currentTarget.timers.length&&(this._removeHashElement(this._currentTarget),--t)}for(t=0,n=this._updatesNegList;t<n.length;)(r=n[t]).markedForDeletion?this._removeUpdateFromHash(r):t++;for(t=0,n=this._updates0List;t<n.length;)(r=n[t]).markedForDeletion?this._removeUpdateFromHash(r):t++;for(t=0,n=this._updatesPosList;t<n.length;)(r=n[t]).markedForDeletion?this._removeUpdateFromHash(r):t++;this._updateHashLocked=!1,this._currentTarget=null},n.schedule=function(e,t,n,i,r,o){if("function"!=typeof e){var a=e;e=t,t=a}3!==arguments.length&&4!==arguments.length&&5!==arguments.length||(o=!!i,i=c.macro.REPEAT_FOREVER,r=0),P(t,1502);var s=t.uuid||t.id;if(s){var l,u,h=this._hashForTimers[s];if(h?h.paused!==o&&I(1511):(h=CA.get(null,t,0,null,null,o),this._arrayForTimers.push(h),this._hashForTimers[s]=h),null==h.timers)h.timers=[];else for(u=0;u<h.timers.length;++u)if((l=h.timers[u])&&e===l._callback)return C(1507,l.getInterval(),n),void(l._interval=n);(l=wA.get()).initWithCallback(this,e,t,n,i,r),h.timers.push(l),this._currentTarget===h&&this._currentTargetSalvaged&&(this._currentTargetSalvaged=!1)}else R(1510)},n.scheduleUpdate=function(e,t,n){var i=e.uuid||e.id;if(i){var r=this._hashForUpdates[i];if(r&&r.entry){if(r.entry.priority===t)return r.entry.markedForDeletion=!1,void(r.entry.paused=n);if(this._updateHashLocked)return C(1506),r.entry.markedForDeletion=!1,void(r.entry.paused=n);this.unscheduleUpdate(e)}var o,a=TA.get(e,t,n,!1);0===t?(o=this._updates0List,this._appendIn(o,a)):(o=t<0?this._updatesNegList:this._updatesPosList,this._priorityIn(o,a,t)),this._hashForUpdates[i]=AA.get(o,a,e,null)}else R(1510)},n.unschedule=function(e,t){if(t&&e){var n=t.uuid||t.id;if(n){var i=this._hashForTimers[n];if(i)for(var r=i.timers,o=0,a=r.length;o<a;o++){var s=r[o];if(e===s._callback)return s!==i.currentTimer||i.currentTimerSalvaged||(i.currentTimerSalvaged=!0),r.splice(o,1),wA.put(s),i.timerIndex>=o&&i.timerIndex--,void(0===r.length&&(this._currentTarget===i?this._currentTargetSalvaged=!0:this._removeHashElement(i)))}}else R(1510)}},n.unscheduleUpdate=function(e){if(e){var t=e.uuid||e.id;if(t){var n=this._hashForUpdates[t];n&&(this._updateHashLocked?n.entry.markedForDeletion=!0:this._removeUpdateFromHash(n.entry))}else R(1510)}},n.unscheduleAllForTarget=function(e){if(e){var t=e.uuid||e.id;if(t){var n=this._hashForTimers[t];if(n){var i=n.timers;i.indexOf(n.currentTimer)>-1&&!n.currentTimerSalvaged&&(n.currentTimerSalvaged=!0);for(var r=0,o=i.length;r<o;r++)wA.put(i[r]);i.length=0,this._currentTarget===n?this._currentTargetSalvaged=!0:this._removeHashElement(n)}this.unscheduleUpdate(e)}else R(1510)}},n.unscheduleAll=function(){this.unscheduleAllWithMinPriority(c.Scheduler.PRIORITY_SYSTEM)},n.unscheduleAllWithMinPriority=function(e){var t,n,i,r=this._arrayForTimers;for(t=r.length-1;t>=0;t--)n=r[t],this.unscheduleAllForTarget(n.target);var o=0;if(e<0)for(t=0;t<this._updatesNegList.length;)o=this._updatesNegList.length,(i=this._updatesNegList[t])&&i.priority>=e&&this.unscheduleUpdate(i.target),o===this._updatesNegList.length&&t++;if(e<=0)for(t=0;t<this._updates0List.length;)o=this._updates0List.length,(i=this._updates0List[t])&&this.unscheduleUpdate(i.target),o===this._updates0List.length&&t++;for(t=0;t<this._updatesPosList.length;)o=this._updatesPosList.length,(i=this._updatesPosList[t])&&i.priority>=e&&this.unscheduleUpdate(i.target),o===this._updatesPosList.length&&t++},n.isScheduled=function(e,t){P(e,1508),P(t,1509);var n=t.uuid||t.id;if(n){var i=this._hashForTimers[n];if(!i)return!1;if(null==i.timers)return!1;for(var r=i.timers,o=0;o<r.length;++o)if(e===r[o]._callback)return!0;return!1}R(1510)},n.pauseAllTargets=function(){return this.pauseAllTargetsWithMinPriority(c.Scheduler.PRIORITY_SYSTEM)},n.pauseAllTargetsWithMinPriority=function(e){var t,n,i,r,o=[],a=this._arrayForTimers;for(n=0,i=a.length;n<i;n++)(t=a[n])&&(t.paused=!0,o.push(t.target));if(e<0)for(n=0;n<this._updatesNegList.length;n++)(r=this._updatesNegList[n])&&r.priority>=e&&(r.paused=!0,o.push(r.target));if(e<=0)for(n=0;n<this._updates0List.length;n++)(r=this._updates0List[n])&&(r.paused=!0,o.push(r.target));for(n=0;n<this._updatesPosList.length;n++)(r=this._updatesPosList[n])&&r.priority>=e&&(r.paused=!0,o.push(r.target));return o},n.resumeTargets=function(e){if(e)for(var t=0;t<e.length;t++)this.resumeTarget(e[t])},n.pauseTarget=function(e){P(e,1503);var t=e.uuid||e.id;if(t){var n=this._hashForTimers[t];n&&(n.paused=!0);var i=this._hashForUpdates[t];i&&(i.entry.paused=!0)}else R(1510)},n.resumeTarget=function(e){P(e,1504);var t=e.uuid||e.id;if(t){var n=this._hashForTimers[t];n&&(n.paused=!1);var i=this._hashForUpdates[t];i&&(i.entry.paused=!1)}else R(1510)},n.isTargetPaused=function(e){P(e,1505);var t=e.uuid||e.id;if(!t)return R(1510),!1;var n=this._hashForTimers[t];if(n)return n.paused;var i=this._hashForUpdates[t];return!!i&&i.entry.paused},n._removeHashElement=function(e){var t=e.target.uuid||e.target.id;delete this._hashForTimers[t];for(var n=this._arrayForTimers,i=0,r=n.length;i<r;i++)if(n[i]===e){n.splice(i,1);break}CA.put(e)},n._removeUpdateFromHash=function(e){var t=e.target.uuid||e.target.id,n=this._hashForUpdates[t];if(n){for(var i=n.list,r=n.entry,o=0,a=i.length;o<a;o++)if(i[o]===r){i.splice(o,1);break}delete this._hashForUpdates[t],TA.put(r),AA.put(n)}},n._priorityIn=function(e,t,n){for(var i=0;i<e.length;i++)if(n<e[i].priority)return void e.splice(i,0,t);e.push(t)},n._appendIn=function(e,t){e.push(t)},t}(EA));IA.PRIORITY_SYSTEM=1<<31,IA.PRIORITY_NON_SYSTEM=IA.PRIORITY_SYSTEM+1,IA.ID="scheduler",c.Scheduler=IA;var bA=function(){function e(){this._title="",this._width=1,this._height=1,this._nativeWidth=1,this._nativeHeight=1,this._renderPass=null,this._colorTextures=[],this._depthStencilTexture=null,this._swapchainBufferIndices=0,this._shouldSyncSizeWithSwapchain=!1,this._poolHandle=Qi,this._cameras=[]}e.registerCreateFunc=function(t){t._createWindowFun=function(t){return new e(t)}},Z(e,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"framebuffer",get:function(){return tr.get(Gr.get(this._poolHandle,Lr.FRAMEBUFFER))}},{key:"shouldSyncSizeWithSwapchain",get:function(){return this._shouldSyncSizeWithSwapchain}},{key:"hasOnScreenAttachments",get:function(){return 1===Gr.get(this._poolHandle,Lr.HAS_ON_SCREEN_ATTACHMENTS)}},{key:"hasOffScreenAttachments",get:function(){return 1===Gr.get(this._poolHandle,Lr.HAS_OFF_SCREEN_ATTACHMENTS)}},{key:"handle",get:function(){return this._poolHandle}},{key:"cameras",get:function(){return this._cameras}}]);var t=e.prototype;return t.initialize=function(e,t){this._poolHandle=Gr.alloc(),void 0!==t.title&&(this._title=t.title),void 0!==t.swapchainBufferIndices&&(this._swapchainBufferIndices=t.swapchainBufferIndices),void 0!==t.shouldSyncSizeWithSwapchain&&(this._shouldSyncSizeWithSwapchain=t.shouldSyncSizeWithSwapchain),this._width=t.width,this._height=t.height,this._nativeWidth=this._width,this._nativeHeight=this._height;for(var n=t.renderPassInfo,i=n.colorAttachments,r=n.depthStencilAttachment,o=0;o<i.length;o++)i[o].format===Jo.UNKNOWN&&(i[o].format=e.colorFormat);r&&r.format===Jo.UNKNOWN&&(r.format=e.depthStencilFormat),this._renderPass=e.createRenderPass(t.renderPassInfo);for(var a=0;a<i.length;a++){var s=null;this._swapchainBufferIndices&1<<a?Gr.set(this._poolHandle,Lr.HAS_ON_SCREEN_ATTACHMENTS,1):(s=e.createTexture(new zs(ma.TEX2D,da.COLOR_ATTACHMENT|da.SAMPLED,i[a].format,this._width,this._height)),Gr.set(this._poolHandle,Lr.HAS_OFF_SCREEN_ATTACHMENTS,1)),this._colorTextures.push(s)}r&&(this._swapchainBufferIndices>=0?(this._depthStencilTexture=e.createTexture(new zs(ma.TEX2D,da.DEPTH_STENCIL_ATTACHMENT|da.SAMPLED,r.format,this._width,this._height)),Gr.set(this._poolHandle,Lr.HAS_OFF_SCREEN_ATTACHMENTS,1)):Gr.set(this._poolHandle,Lr.HAS_ON_SCREEN_ATTACHMENTS,1));var c=tr.alloc(e,new $a(this._renderPass,this._colorTextures,this._depthStencilTexture));return Gr.set(this._poolHandle,Lr.FRAMEBUFFER,c),!0},t.destroy=function(){this.clearCameras(),this._depthStencilTexture&&(this._depthStencilTexture.destroy(),this._depthStencilTexture=null);for(var e=0;e<this._colorTextures.length;e++){var t=this._colorTextures[e];t&&t.destroy()}this._colorTextures.length=0,this._poolHandle&&(tr.get(Gr.get(this._poolHandle,Lr.FRAMEBUFFER)).destroy(),this._poolHandle=Qi)},t.resize=function(e,t){if(this._width=e,this._height=t,e>this._nativeWidth||t>this._nativeHeight){this._nativeWidth=e,this._nativeHeight=t;var n=!1;this._depthStencilTexture&&(this._depthStencilTexture.resize(e,t),n=!0);for(var i=0;i<this._colorTextures.length;i++){var r=this._colorTextures[i];r&&(r.resize(e,t),n=!0)}var o=tr.get(Gr.get(this._poolHandle,Lr.FRAMEBUFFER));n&&o&&(o.destroy(),o.initialize(new $a(this._renderPass,this._colorTextures,this._depthStencilTexture)))}for(var a,s=oe(this._cameras);!(a=s()).done;){var c=a.value;c.isWindowSize&&c.resize(e,t)}},t.extractRenderCameras=function(){for(var e=[],t=0;t<this._cameras.length;t++){var n=this._cameras[t];n.enabled&&(n.update(),e.push(n))}return e},t.attachCamera=function(e){for(var t=0;t<this._cameras.length;t++)if(this._cameras[t]===e)return;this._cameras.push(e),this.sortCameras()},t.detachCamera=function(e){for(var t=0;t<this._cameras.length;++t)if(this._cameras[t]===e)return void this._cameras.splice(t,1)},t.clearCameras=function(){this._cameras.length=0},t.sortCameras=function(){this._cameras.sort((function(e,t){return e.priority-t.priority}))},e}(),RA=function(){function e(e){var t=this;this._createSceneFun=null,this._createWindowFun=null,this._device=void 0,this._windows=[],this._mainWindow=null,this._curWindow=null,this._tempWindow=null,this._pipeline=null,this._batcher=null,this._dataPoolMgr=void 0,this._scenes=[],this._modelPools=new Map,this._cameraPool=null,this._lightPools=new Map,this._fpsTime=0,this._frameCount=0,this._fps=0,this._fixedFPS=0,this._fixedFPSFrameTime=0,this._poolHandle=Qi,this._device=e,this._dataPoolMgr=c.internal.DataPoolManager&&new c.internal.DataPoolManager(e),lh.registerCreateFunc(this),bA.registerCreateFunc(this),this._cameraPool=new x_((function(){return new ch(t._device)}),4)}Z(e,[{key:"device",get:function(){return this._device}},{key:"mainWindow",get:function(){return this._mainWindow}},{key:"curWindow",set:function(e){this._curWindow=e},get:function(){return this._curWindow}},{key:"tempWindow",set:function(e){this._tempWindow=e},get:function(){return this._tempWindow}},{key:"windows",get:function(){return this._windows}},{key:"pipeline",get:function(){return this._pipeline}},{key:"batcher2D",get:function(){return this._batcher}},{key:"scenes",get:function(){return this._scenes}},{key:"cumulativeTime",get:function(){return zr.get(this._poolHandle,Mr.CUMULATIVE_TIME)}},{key:"frameTime",get:function(){return zr.get(this._poolHandle,Mr.FRAME_TIME)}},{key:"frameCount",get:function(){return this._frameCount}},{key:"fps",get:function(){return this._fps}},{key:"fixedFPS",set:function(e){e>0?(this._fixedFPS=e,this._fixedFPSFrameTime=1e3/e):this._fixedFPSFrameTime=0},get:function(){return this._fixedFPS}},{key:"dataPoolManager",get:function(){return this._dataPoolMgr}},{key:"handle",get:function(){return this._poolHandle}}]);var t=e.prototype;return t.initialize=function(){var e=this;this._poolHandle=zr.alloc();var t=new As,n=new Cs;n.depthStoreOp=Sa.DISCARD,n.stencilStoreOp=Sa.DISCARD;var i=new Is([t],n);return this._mainWindow=this.createWindow({title:"rootMainWindow",width:this._device.width,height:this._device.height,renderPassInfo:i,swapchainBufferIndices:-1}),this._curWindow=this._mainWindow,Promise.resolve(ad.initBuiltinRes(this._device)).then((function(){c.view.on("design-resolution-changed",(function(){var t=c.game.canvas.width,n=c.game.canvas.height;e.resize(t,n)}),e)}))},t.destroy=function(){this.destroyScenes(),this._pipeline&&(this._pipeline.destroy(),this._pipeline=null),this._batcher&&(this._batcher.destroy(),this._batcher=null),this._curWindow=null,this._mainWindow=null,this.dataPoolManager.clear(),this._poolHandle&&(zr.free(this._poolHandle),this._poolHandle=Qi)},t.resize=function(e,t){this._device.resize(e,t),this._mainWindow.resize(e,t);for(var n,i=oe(this._windows);!(n=i()).done;){var r=n.value;r.shouldSyncSizeWithSwapchain&&r.resize(e,t)}},t.setRenderPipeline=function(e){if(e||(e=this.createDefaultPipeline()),this._pipeline=e,!this._pipeline.activate())return!1;var t=c.director.getScene();return t&&t.globals.activate(),this.onGlobalPipelineStateChanged(),!(!this._batcher&&c.internal.Batcher2D&&(this._batcher=new c.internal.Batcher2D(this),!this._batcher.initialize())&&(this.destroy(),1))},t.createDefaultPipeline=function(){var e=new mE;return e.initialize({flows:[]}),e},t.onGlobalPipelineStateChanged=function(){for(var e=0;e<this._scenes.length;e++)this._scenes[e].onGlobalPipelineStateChanged()},t.activeWindow=function(e){this._curWindow=e},t.resetCumulativeTime=function(){zr.set(this._poolHandle,Mr.CUMULATIVE_TIME,0)},t.frameMove=function(e){var t=this;zr.set(this._poolHandle,Mr.FRAME_TIME,e),++this._frameCount,zr.set(this._poolHandle,Mr.CUMULATIVE_TIME,zr.get(this._poolHandle,Mr.CUMULATIVE_TIME)+e),this._fpsTime+=e,this._fpsTime>1&&(this._fps=this._frameCount,this._frameCount=0,this._fpsTime=0);for(var n=0;n<this._scenes.length;++n)this._scenes[n].removeBatches();this._batcher&&this._batcher.update(),this._pipeline&&function(){t._device.acquire();var e=t._windows,n=t._scenes,i=c.director.getTotalFrames();t._batcher&&t._batcher.uploadBuffers();for(var r=0;r<n.length;r++)n[r].update(i);c.director.emit(c.Director.EVENT_BEFORE_COMMIT);for(var o=[],a=0;a<e.length;a++)e[a].extractRenderCameras().forEach((function(e){o.push(e)}));o.sort((function(e,t){return e.priority-t.priority})),t._pipeline.render(o),t._device.present()}(),this._batcher&&this._batcher.reset()},t.createWindow=function(e){var t=this._createWindowFun(this);return t.initialize(this.device,e),this._windows.push(t),t},t.destroyWindow=function(e){for(var t=0;t<this._windows.length;++t)if(this._windows[t]===e)return e.destroy(),void this._windows.splice(t,1)},t.destroyWindows=function(){for(var e,t=oe(this._windows);!(e=t()).done;)e.value.destroy();this._windows=[]},t.createScene=function(e){var t=this._createSceneFun(this);return t.initialize(e),this._scenes.push(t),t},t.destroyScene=function(e){for(var t=0;t<this._scenes.length;++t)if(this._scenes[t]===e)return e.destroy(),void this._scenes.splice(t,1)},t.destroyScenes=function(){for(var e,t=oe(this._scenes);!(e=t()).done;)e.value.destroy();this._scenes=[]},t.createModel=function(e){var t=this._modelPools.get(e);t||(this._modelPools.set(e,new x_((function(){return new e}),10)),t=this._modelPools.get(e));var n=t.alloc();return n.initialize(),n},t.destroyModel=function(e){var t=this._modelPools.get(e.constructor);t?(t.free(e),e.destroy(),e.scene&&e.scene.removeModel(e)):I(1300,e.constructor.name)},t.createCamera=function(){return this._cameraPool.alloc()},t.createLight=function(e){var t=this._lightPools.get(e);t||(this._lightPools.set(e,new x_((function(){return new e}),4)),t=this._lightPools.get(e));var n=t.alloc();return n.initialize(),n},t.destroyLight=function(e){var t=this._lightPools.get(e.constructor);if(e.destroy(),t&&(t.free(e),e.scene))switch(e.type){case fd.SPHERE:e.scene.removeSphereLight(e);break;case fd.SPOT:e.scene.removeSpotLight(e)}},e}();c.Root=RA;var OA,NA,PA={};ve(PA,"vmath",[{name:"vec2",newName:"Vec2",target:di,targetName:"math"},{name:"vec3",newName:"Vec3",target:di,targetName:"math"},{name:"vec4",newName:"Vec4",target:di,targetName:"math"},{name:"quat",newName:"Quat",target:di,targetName:"math"},{name:"mat3",newName:"Mat3",target:di,targetName:"math"},{name:"mat4",newName:"Mat4",target:di,targetName:"math"},{name:"color4",newName:"Color",target:di,targetName:"math"},{name:"rect",newName:"Rect",target:di,targetName:"math"},{name:"approx",newName:"approx",target:di,targetName:"math"},{name:"EPSILON",newName:"EPSILON",target:di,targetName:"math"},{name:"equals",newName:"equals",target:di,targetName:"math"},{name:"clamp",newName:"clamp",target:di,targetName:"math"},{name:"clamp01",newName:"clamp01",target:di,targetName:"math"},{name:"lerp",newName:"lerp",target:di,targetName:"math"},{name:"toRadian",newName:"toRadian",target:di,targetName:"math"},{name:"toDegree",newName:"toDegree",target:di,targetName:"math"},{name:"random",newName:"random",target:di,targetName:"math"},{name:"randomRange",newName:"randomRange",target:di,targetName:"math"},{name:"randomRangeInt",newName:"randomRangeInt",target:di,targetName:"math"},{name:"pseudoRandom",newName:"pseudoRandom",target:di,targetName:"math"},{name:"pseudoRandomRangeInt",newName:"pseudoRandomRangeInt",target:di,targetName:"math"},{name:"nextPow2",newName:"nextPow2",target:di,targetName:"math"},{name:"repeat",newName:"repeat",target:di,targetName:"math"},{name:"pingPong",newName:"pingPong",target:di,targetName:"math"},{name:"inverseLerp",newName:"inverseLerp",target:di,targetName:"math"}]),c.vmath=PA,ve(IA.prototype,"Scheduler.prototype",[{name:"enableForTarget",newName:"enableForTarget",target:IA,targetName:"Scheduler"}]),ve(LT.prototype,"EventTouch.prototype",[{name:"getUILocationInView",newName:"getLocationInView",target:LT,targetName:"EventTouch"}]),ve(Sd.prototype,"SubModel.prototype",[{name:"subMeshData",newName:"subMesh"}]),ge(Sd.prototype,"SubModel.prototype",[{name:"getSubModel",suggest:"Use `subModels[i]` instead"},{name:"subModelNum",suggest:"Use `subModels.length` instead"}]),ve(RA.prototype,"Root.prototype",[{name:"ui",newName:"batcher2D"}]),ge(xf.prototype,"TextureBase.prototype",[{name:"hasPremultipliedAlpha"},{name:"setPremultiplyAlpha"},{name:"setFlipY"}]),ve(_p.prototype,"RenderTexture.prototype",[{name:"getGFXWindow",customFunction:function(){return this._window}}]);var MA,DA=e("ee",vh("cc.BufferAsset")((se((NA=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this)._buffer=null,t}return $(t,e),t.prototype.buffer=function(){return this._buffer},Z(t,[{key:"_nativeAsset",get:function(){return this._buffer},set:function(e){e instanceof ArrayBuffer?this._buffer=e:this._buffer=e.buffer}}]),t}(H_)).prototype,"_nativeAsset",[Yh],Object.getOwnPropertyDescriptor(NA.prototype,"_nativeAsset"),NA.prototype),OA=NA))||OA);c.BufferAsset=DA;var LA=((MA={})[Ra.UNORM]="Uint",MA[Ra.SNORM]="Int",MA[Ra.UINT]="Uint",MA[Ra.INT]="Int",MA[Ra.UFLOAT]="Float",MA[Ra.FLOAT]="Float",MA.default="Uint",MA);function FA(e){return(LA[e.type]||LA.default)+e.size/e.count*8}function zA(e,t,n,i,r,o,a){void 0===n&&(n=Jo.R32F),void 0===i&&(i=0),void 0===r&&(r=e.byteLength-i),void 0===o&&(o=0),a||(a=new DataView(e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)));var s=Fa[n];o||(o=s.size);for(var c="set"+FA(s),l="get"+FA(s),u=s.size/s.count,h=Math.floor(r/o),_=Rv.isLittleEndian,f=0;f<h;++f)for(var m=i+o*f,d=0;d<s.count;++d){var p=m+u*d,v=e[l](p,_);a[c](p,t(v,d,e),_)}return a}e("aS",function(){function e(e,t,n,i,r){void 0===i&&(i=null),void 0===r&&(r=null),this.mesh=void 0,this.subMeshIdx=void 0,this._flatBuffers=[],this._jointMappedBuffers=void 0,this._jointMappedBufferIndices=void 0,this._vertexIdChannel=void 0,this._geometricInfo=void 0,this._vertexBuffers=void 0,this._attributes=void 0,this._indexBuffer=null,this._indirectBuffer=null,this._primitiveMode=void 0,this._iaInfo=void 0,this._handle=Qi,this._attributes=t,this._vertexBuffers=e,this._indexBuffer=i,this._indirectBuffer=r,this._primitiveMode=n,this._iaInfo=new os(t,e,i,r),this._handle=fo.alloc();var o=or.alloc();fo.set(this._handle,co.FLAT_BUFFER_ARRAY,o)}var t=e.prototype;return t.genFlatBuffers=function(){if(!this._flatBuffers.length&&this.mesh&&void 0!==this.subMeshIdx){var e=this.mesh,t=0,n=e.struct.primitives[this.subMeshIdx],i=fo.get(this._handle,co.FLAT_BUFFER_ARRAY);n.indexView&&(t=n.indexView.count);for(var r=0;r<n.vertexBundelIndices.length;r++){var o=n.vertexBundelIndices[r],a=e.struct.vertexBundles[o],s=n.indexView?n.indexView.count:a.view.count,c=a.view.stride,l=c*s,u=new Uint8Array(e.data.buffer,a.view.offset,a.view.length),h=lr.alloc(n.indexView?l:a.view.length),_=uo.alloc();uo.set(_,ao.STRIDE,c),uo.set(_,ao.AMOUNT,s),uo.set(_,ao.BUFFER,h),or.push(i,_);var f=lr.getBuffer(h),m=new Uint8Array(f);if(n.indexView){for(var d=e.readIndices(this.subMeshIdx),p=0;p<t;++p)for(var v=p*c,g=d[p]*c,y=0;y<c;++y)m[v+y]=u[g+y];this._flatBuffers.push({stride:c,count:s,buffer:m})}else m.set(e.data.subarray(a.view.offset,a.view.offset+a.view.length)),this._flatBuffers.push({stride:c,count:s,buffer:m})}}},t.destroy=function(){for(var e=0;e<this.vertexBuffers.length;e++)this.vertexBuffers[e].destroy();if(this.vertexBuffers.length=0,this._indexBuffer&&(this._indexBuffer.destroy(),this._indexBuffer=null),this._jointMappedBuffers&&this._jointMappedBufferIndices){for(var t=0;t<this._jointMappedBufferIndices.length;t++)this._jointMappedBuffers[this._jointMappedBufferIndices[t]].destroy();this._jointMappedBuffers=void 0,this._jointMappedBufferIndices=void 0}this._indirectBuffer&&(this._indirectBuffer.destroy(),this._indirectBuffer=null),this._handle&&(Xi(fo.get(this._handle,co.FLAT_BUFFER_ARRAY),or,uo),fo.free(this._handle),this._handle=Qi)},t.enableVertexIdChannel=function(e){if(!this._vertexIdChannel){var t=this.vertexBuffers.length,n=this.attributes.length,i=this._allocVertexIdBuffer(e);this._vertexBuffers.push(i),this._attributes.push(new rs("a_vertexId",Jo.R32F,!1,t)),this._iaInfo.attributes=this._attributes,this._iaInfo.vertexBuffers=this._vertexBuffers,this._vertexIdChannel={stream:t,index:n}}},t._allocVertexIdBuffer=function(e){for(var t=0===this.vertexBuffers.length||0===this.vertexBuffers[0].stride?0:this.vertexBuffers[0].size/this.vertexBuffers[0].stride,n=new Float32Array(t),i=0;i<t;++i)n[i]=i+.5;var r=e.createBuffer(new Wa($o.VERTEX|$o.TRANSFER_DST,ea.DEVICE,n.byteLength,n.BYTES_PER_ELEMENT));return r.update(n),r},Z(e,[{key:"attributes",get:function(){return this._attributes}},{key:"vertexBuffers",get:function(){return this._vertexBuffers}},{key:"indexBuffer",get:function(){return this._indexBuffer}},{key:"indirectBuffer",get:function(){return this._indirectBuffer}},{key:"primitiveMode",get:function(){return this._primitiveMode}},{key:"geometricInfo",get:function(){if(this._geometricInfo)return this._geometricInfo;if(void 0===this.mesh)return{positions:new Float32Array,indices:new Uint8Array,boundingBox:{min:Un.ZERO,max:Un.ZERO}};if(void 0===this.subMeshIdx)return{positions:new Float32Array,indices:new Uint8Array,boundingBox:{min:Un.ZERO,max:Un.ZERO}};var e=this.mesh,t=this.subMeshIdx,n=e.readAttribute(t,Qo.ATTR_POSITION),i=e.readIndices(t),r=new Un,o=new Un,a=this.attributes.find((function(e){return e.name===Qo.ATTR_POSITION}));if(a){var s=Fa[a.format].count;2===s?(r.set(n[0],n[1],0),o.set(n[0],n[1],0)):(r.set(n[0],n[1],n[2]),o.set(n[0],n[1],n[2]));for(var c=0;c<n.length;c+=s)2===s?(r.x=n[c]>r.x?n[c]:r.x,r.y=n[c+1]>r.y?n[c+1]:r.y,o.x=n[c]<o.x?n[c]:o.x,o.y=n[c+1]<o.y?n[c+1]:o.y):(r.x=n[c]>r.x?n[c]:r.x,r.y=n[c+1]>r.y?n[c+1]:r.y,r.z=n[c+2]>r.z?n[c+2]:r.z,o.x=n[c]<o.x?n[c]:o.x,o.y=n[c+1]<o.y?n[c+1]:o.y,o.z=n[c+2]<o.z?n[c+2]:o.z)}return this._geometricInfo={positions:n,indices:i,boundingBox:{max:r,min:o}},this._geometricInfo}},{key:"flatBuffers",get:function(){return this._flatBuffers}},{key:"jointMappedBuffers",get:function(){var e=this;if(this._jointMappedBuffers)return this._jointMappedBuffers;var t=this._jointMappedBuffers=[],n=this._jointMappedBufferIndices=[];if(!this.mesh||void 0===this.subMeshIdx)return this._jointMappedBuffers=this.vertexBuffers;var i,r,o=this.mesh.struct,a=o.primitives[this.subMeshIdx];if(!o.jointMaps||void 0===a.jointMapIndex||!o.jointMaps[a.jointMapIndex])return this._jointMappedBuffers=this.vertexBuffers;for(var s=c.director.root.device,l=0;l<a.vertexBundelIndices.length;l++){var u=o.vertexBundles[a.vertexBundelIndices[l]];r=0,i=Jo.UNKNOWN;for(var h=0;h<u.attributes.length;h++){var _=u.attributes[h];if(_.name===Qo.ATTR_JOINTS){i=_.format;break}r+=Fa[_.format].size}i?function(){var c=new Uint8Array(e.mesh.data.buffer,u.view.offset,u.view.length),h=new DataView(c.slice().buffer),_=o.jointMaps[a.jointMapIndex];zA(h,(function(e){return _.indexOf(e)}),i,r,u.view.length,u.view.stride,h);var f=s.createBuffer(new Wa($o.VERTEX|$o.TRANSFER_DST,ea.DEVICE,u.view.length,u.view.stride));f.update(h.buffer),t.push(f),n.push(l)}():t.push(this.vertexBuffers[a.vertexBundelIndices[l]])}return this._vertexIdChannel&&t.push(this._allocVertexIdBuffer(s)),t}},{key:"iaInfo",get:function(){return this._iaInfo}},{key:"handle",get:function(){return this._handle}}]),e}());var BA,UA,GA,HA,kA,VA,jA,WA,qA,YA=e("eg",vh("cc.SceneAsset")((kA=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ae(t=e.call.apply(e,[this].concat(i))||this,"scene",GA,ie(t)),ae(t,"asyncLoadAssets",HA,ie(t)),t}return $(t,e),t}(H_),GA=se((UA=kA).prototype,"scene",[Nh,Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),HA=se(UA.prototype,"asyncLoadAssets",[Nh,Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),BA=UA))||BA);c.SceneAsset=YA;var XA,KA,QA,ZA,JA=e("dz",vh("cc.TextAsset")((qA=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ae(t=e.call.apply(e,[this].concat(i))||this,"text",WA,ie(t)),t}return $(t,e),t.prototype.toString=function(){return this.text},t}(H_),WA=se((jA=qA).prototype,"text",[Sh,Nh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),VA=jA))||VA);c.TextAsset=JA;var $A=e("eh",vh("cc.JsonAsset")((ZA=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ae(t=e.call.apply(e,[this].concat(i))||this,"json",QA,ie(t)),t}return $(t,e),t}(H_),QA=se((KA=ZA).prototype,"json",[Sh,Nh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),XA=KA))||XA);c.JsonAsset=$A;var eC,tC,nC,iC,rC,oC,aC,sC,cC,lC=function(){function e(e){this._uiComp=null,this.opacity=1,this._uiTransformComp=null,this._node=void 0,this._node=e}return Z(e,[{key:"uiTransformComp",get:function(){return this._uiTransformComp||(this._uiTransformComp=this._node.getComponent("cc.UITransform")),this._uiTransformComp},set:function(e){this._uiTransformComp=e}},{key:"uiComp",get:function(){return this._uiComp},set:function(e){this._uiComp&&e?I(12002):this._uiComp=e}}]),e}(),uC=(A_.Flags.Destroying,A_.Flags.Destroying),hC=A_.Flags.DontDestroy,_C=A_.Flags.Deactivating,fC=new Ne("Node");function mC(e){return e?"string"==typeof e?mt(e):e:(R(3804),null)}var dC,pC,vC,gC,yC,xC,EC,SC,TC,AC,CC,wC=e("ft",vh("cc.BaseNode")((cC=sC=function(e){$(n,e),n._setScene=function(e){e._updateScene()},n._findComponent=function(e,t){var n=t,i=e._components;if(n._sealed)for(var r=0;r<i.length;++r){var o=i[r];if(o.constructor===t)return o}else for(var a=0;a<i.length;++a){var s=i[a];if(s instanceof t)return s}return null},n._findComponents=function(e,t,n){var i=t,r=e._components;if(i._sealed)for(var o=0;o<r.length;++o){var a=r[o];a.constructor===t&&n.push(a)}else for(var s=0;s<r.length;++s){var c=r[s];c instanceof t&&n.push(c)}},n._findChildComponent=function(e,t){for(var i=0;i<e.length;++i){var r=e[i],o=n._findComponent(r,t);if(o)return o;if(r._children.length>0&&(o=n._findChildComponent(r._children,t)))return o}return null},n._findChildComponents=function(e,t,i){for(var r=0;r<e.length;++r){var o=e[r];n._findComponents(o,t,i),o._children.length>0&&n._findChildComponents(o._children,t,i)}};var t=n.prototype;function n(t){var n;return ae(n=e.call(this,t)||this,"_parent",nC,ie(n)),ae(n,"_children",iC,ie(n)),ae(n,"_active",rC,ie(n)),ae(n,"_components",oC,ie(n)),ae(n,"_prefab",aC,ie(n)),n._scene=null,n._activeInHierarchy=!1,n._id=fC.getNewId(),n._name=void 0,n._eventProcessor=new c.NodeEventProcessor(ie(n)),n._eventMask=0,n._siblingIndex=0,n._registerIfAttached=void 0,n._name=void 0!==t?t:"New Node",n}return t._updateScene=function(){null==this._parent?y("Node %s(%s) has not attached to a scene.",this.name,this.uuid):this._scene=this._parent._scene},Z(n,[{key:"components",get:function(){return this._components}},{key:"_persistNode",get:function(){return(this._objFlags&hC)>0},set:function(e){e?this._objFlags|=hC:this._objFlags&=~hC}},{key:"name",get:function(){return this._name},set:function(e){this._name=e}},{key:"uuid",get:function(){return this._id}},{key:"children",get:function(){return this._children}},{key:"active",get:function(){return this._active},set:function(e){if(this._active!==e){this._active=e;var t=this._parent;t&&t._activeInHierarchy&&c.director._nodeActivator.activateNode(this,e)}}},{key:"activeInHierarchy",get:function(){return this._activeInHierarchy}},{key:"parent",get:function(){return this._parent},set:function(e){this.setParent(e)}},{key:"scene",get:function(){return this._scene}},{key:"eventProcessor",get:function(){return this._eventProcessor}}]),t.attr=function(e){$e(this,e)},t.getParent=function(){return this._parent},t.setParent=function(e,t){if(void 0===t&&(t=!1),this._parent!==e){var n=this._parent,i=e;if(this._parent=i,this._siblingIndex=0,this._onSetParent(n,t),this.emit&&this.emit(hA.PARENT_CHANGED,n),n&&!(n._objFlags&uC)){var r=n._children.indexOf(this);n._children.splice(r,1),n._updateSiblingIndex(),n.emit&&n.emit(hA.CHILD_REMOVED,this)}i&&(i._children.push(this),this._siblingIndex=i._children.length-1,i.emit&&i.emit(hA.CHILD_ADDED,this)),this._onHierarchyChanged(n)}},t.getChildByUuid=function(e){if(!e)return v("Invalid uuid"),null;for(var t=this._children,n=0,i=t.length;n<i;n++)if(t[n]._id===e)return t[n];return null},t.getChildByName=function(e){if(!e)return v("Invalid name"),null;for(var t=this._children,n=0,i=t.length;n<i;n++)if(t[n]._name===e)return t[n];return null},t.getChildByPath=function(e){for(var t=e.split("/"),n=this,i=function(e){var i=t[e];if(0===i.length)return"continue";var r=n.children.find((function(e){return e.name===i}));if(!r)return{v:null};n=r},r=0;r<t.length;++r){var o=i(r);switch(o){case"continue":continue;default:if("object"==typeof o)return o.v}}return n},t.addChild=function(e){e.setParent(this)},t.insertChild=function(e,t){e.parent=this,e.setSiblingIndex(t)},t.getSiblingIndex=function(){return this._siblingIndex},t.setSiblingIndex=function(e){if(this._parent)if(this._parent._objFlags&_C)R(3821);else{var t=this._parent._children;e=-1!==e?e:t.length-1;var n=t.indexOf(this);e!==n&&(t.splice(n,1),e<t.length?t.splice(e,0,this):t.push(this),this._parent._updateSiblingIndex(),this._onSiblingIndexChanged&&this._onSiblingIndexChanged(e))}},t.walk=function(e,t){var i=1,r=null,o=null,a=0,s=n._stacks[n._stackId];s||(s=[],n._stacks.push(s)),n._stackId++,s.length=0,s[0]=this;for(var c=null,l=!1;i;)if(o=s[--i])if(!l&&e?e(o):l&&t&&t(o),s[i]=null,l){if(c===this._parent)break;if(l=!1,r)if(r[++a])s[i]=r[a],i++;else if(c&&(s[i]=c,i++,l=!0,c._parent?(a=(r=c._parent._children).indexOf(c),c=c._parent):(c=null,r=null),a<0))break}else o._children.length>0?(c=o,r=o._children,a=0,s[i]=r[a],i++):(s[i]=o,i++,l=!0);s.length=0,n._stackId--},t.removeFromParent=function(){this._parent&&this._parent.removeChild(this)},t.removeChild=function(e){this._children.indexOf(e)>-1&&(e.parent=null)},t.removeAllChildren=function(){for(var e=this._children,t=e.length-1;t>=0;t--){var n=e[t];n&&(n.parent=null)}this._children.length=0},t.isChildOf=function(e){var t=this;do{if(t===e)return!0;t=t._parent}while(t);return!1},t.getComponent=function(e){var t=mC(e);return t?n._findComponent(this,t):null},t.getComponents=function(e){var t=mC(e),i=[];return t&&n._findComponents(this,t,i),i},t.getComponentInChildren=function(e){var t=mC(e);return t?n._findChildComponent(this._children,t):null},t.getComponentsInChildren=function(e){var t=mC(e),i=[];return t&&(n._findComponents(this,t,i),n._findChildComponents(this._children,t,i)),i},t.addComponent=function(e){var t;if("string"==typeof e){if(!(t=mt(e)))throw c._RF.peek()&&R(3808,e),TypeError(M(3807,e))}else{if(!e)throw TypeError(M(3804));t=e}if("function"!=typeof t)throw TypeError(M(3809));if(!nt(t,c.Component))throw TypeError(M(3810));var n=t._requireComponent;n&&!this.getComponent(n)&&this.addComponent(n);var i=new t;return i.node=this,this._components.push(i),this._activeInHierarchy&&c.director._nodeActivator.activateComp(i),i},t.removeComponent=function(e){if(e){var t=null;(t=e instanceof cm?e:this.getComponent(e))&&t.destroy()}else R(3813)},t.on=function(e,t,n,i){switch(void 0===i&&(i=!1),e){case hA.TRANSFORM_CHANGED:this._eventMask|=1}this._eventProcessor.on(e,t,n,i)},t.off=function(e,t,n,i){if(void 0===i&&(i=!1),this._eventProcessor.off(e,t,n,i),!this._eventProcessor.hasEventListener(e))switch(e){case hA.TRANSFORM_CHANGED:this._eventMask&=-2}},t.once=function(e,t,n,i){this._eventProcessor.once(e,t,n,i)},t.emit=function(e,t,n,i,r,o){this._eventProcessor.emit(e,t,n,i,r,o)},t.dispatchEvent=function(e){this._eventProcessor.dispatchEvent(e)},t.hasEventListener=function(e,t,n){return this._eventProcessor.hasEventListener(e,t,n)},t.targetOff=function(e){this._eventProcessor.targetOff(e),1&this._eventMask&&!this._eventProcessor.hasEventListener(hA.TRANSFORM_CHANGED)&&(this._eventMask&=-2)},t.destroy=function(){return!!e.prototype.destroy.call(this)&&(this.active=!1,!0)},t.destroyAllChildren=function(){for(var e=this._children,t=0;t<e.length;++t)e[t].destroy()},t._removeComponent=function(e){if(e){if(!(this._objFlags&uC)){var t=this._components.indexOf(e);-1!==t?this._components.splice(t,1):e.node!==this&&R(3815)}}else R(3814)},t._updateSiblingIndex=function(){for(var e=0;e<this._children.length;++e)this._children[e]._siblingIndex=e;this.emit(hA.SIBLING_ORDER_CHANGED)},t._onSetParent=function(e){this._parent&&(null!=e&&e._scene===this._parent._scene||null==this._parent._scene||this.walk(n._setScene))},t._onPostActivated=function(){},t._onBatchCreated=function(){this._parent&&(this._siblingIndex=this._parent.children.indexOf(this))},t._onPreDestroy=function(){this._onPreDestroyBase()},t._onHierarchyChanged=function(e){return this._onHierarchyChangedBase(e)},t._instantiate=function(e,t){return e||(e=c.instantiate._clone(this,this)),e._prefab,e._parent=null,e._onBatchCreated(t),e},t._onHierarchyChangedBase=function(){var e=this._parent;!this._persistNode||e instanceof c.Scene||c.game.removePersistRootNode(this);var t=this._active&&!(!e||!e._activeInHierarchy);this._activeInHierarchy!==t&&c.director._nodeActivator.activateNode(this,t)},t._onPreDestroyBase=function(){this._objFlags|=uC;var e=this._parent,t=!!e&&0!=(e._objFlags&uC);if(!t&&i&&this._registerIfAttached(!1),this._persistNode&&c.game.removePersistRootNode(this),!t&&e){this.emit(hA.PARENT_CHANGED,this);var n=e._children.indexOf(this);e._children.splice(n,1),this._siblingIndex=0,e._updateSiblingIndex(),e.emit&&e.emit(hA.CHILD_REMOVED,this)}this.emit(hA.NODE_DESTROYED,this),this._eventProcessor.destroy();for(var r=this._children,o=0;o<r.length;++o)r[o]._destroyImmediate();for(var a=this._components,s=0;s<a.length;++s)a[s]._destroyImmediate();return t},n}(A_),sC.idGenerator=fC,sC._stacks=[[]],sC._stackId=0,se((tC=cC).prototype,"_persistNode",[Eh],Object.getOwnPropertyDescriptor(tC.prototype,"_persistNode"),tC.prototype),se(tC.prototype,"name",[Nh],Object.getOwnPropertyDescriptor(tC.prototype,"name"),tC.prototype),se(tC.prototype,"children",[Nh],Object.getOwnPropertyDescriptor(tC.prototype,"children"),tC.prototype),se(tC.prototype,"active",[Nh],Object.getOwnPropertyDescriptor(tC.prototype,"active"),tC.prototype),se(tC.prototype,"activeInHierarchy",[Nh],Object.getOwnPropertyDescriptor(tC.prototype,"activeInHierarchy"),tC.prototype),se(tC.prototype,"parent",[Nh],Object.getOwnPropertyDescriptor(tC.prototype,"parent"),tC.prototype),nC=se(tC.prototype,"_parent",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),iC=se(tC.prototype,"_children",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),rC=se(tC.prototype,"_active",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),oC=se(tC.prototype,"_components",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),aC=se(tC.prototype,"_prefab",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),eC=tC))||eC);c._BaseNode=wC;var IC=new Un,bC=new qn,RC=new qn,OC=new Array(10),NC=new qn,PC=new Vn,MC=new Vn,DC=new ei,LC=new Map,FC=e("bJ",(dC=vh("cc.Node"),pC=qh(Un),dC((CC=AC=function(e){function t(t){var n;return(n=e.call(this,t)||this)._uiProps=new lC(ie(n)),n._static=!1,n._pos=new Un,n._rot=new qn,n._scale=new Un(1,1,1),n._mat=new ei,ae(n,"_lpos",yC,ie(n)),ae(n,"_lrot",xC,ie(n)),ae(n,"_lscale",EC,ie(n)),ae(n,"_layer",SC,ie(n)),ae(n,"_euler",TC,ie(n)),n._dirtyFlags=$u.NONE,n._eulerDirty=!1,n._poolHandle=Qi,n._poolHandle=Dr.alloc(),Dr.set(n._poolHandle,Rr.LAYER,n._layer),n}$(t,e),t.isNode=function(e){return e instanceof t&&(e.constructor===t||!(e instanceof c.Scene))};var n=t.prototype;return n.destroy=function(){return this._poolHandle&&(Dr.free(this._poolHandle),this._poolHandle=Qi),e.prototype.destroy.call(this)},n.setParent=function(t,n){void 0===n&&(n=!1),n&&this.updateWorldTransform(),e.prototype.setParent.call(this,t,n)},n._onSetParent=function(t,n){if(e.prototype._onSetParent.call(this,t,n),n){var i=this._parent;i?(i.updateWorldTransform(),ei.multiply(DC,ei.invert(DC,i._mat),this._mat),ei.toRTS(DC,this._lrot,this._lpos,this._lscale)):(Un.copy(this._lpos,this._pos),qn.copy(this._lrot,this._rot),Un.copy(this._lscale,this._scale)),this._eulerDirty=!0}this.invalidateChildren($u.TRS)},n._onBatchCreated=function(t){var n;e.prototype._onBatchCreated.call(this,t),Dr.set(this._poolHandle,Rr.LAYER,this._layer),Dr.setVec3(this._poolHandle,Rr.WORLD_SCALE,this._scale);var i=null===(n=this._prefab)||void 0===n?void 0:n.instance;!t&&i&&aT(this),this.hasChangedFlags=$u.TRS,this._dirtyFlags=$u.TRS;for(var r=this._children.length,o=0;o<r;++o)this._children[o]._onBatchCreated(t);if(!t&&i){var a={};i.targetMap=a,sT(this,a,!0),lT(0,i.mountedChildren,a),uT(0,i.propertyOverrides,a)}hT(this)},n._onBeforeSerialize=function(){this.eulerAngles},n._onPostActivated=function(e){e?(XT.resumeTarget(this),this.eventProcessor.reattach(),this.invalidateChildren($u.TRS)):XT.pauseTarget(this)},n.translate=function(e,t){var n=t||Ju.LOCAL;if(n===Ju.LOCAL)Un.transformQuat(IC,e,this._lrot),this._lpos.x+=IC.x,this._lpos.y+=IC.y,this._lpos.z+=IC.z;else if(n===Ju.WORLD)if(this._parent){qn.invert(bC,this._parent.worldRotation),Un.transformQuat(IC,e,bC);var i=this.worldScale;this._lpos.x+=IC.x/i.x,this._lpos.y+=IC.y/i.y,this._lpos.z+=IC.z/i.z}else this._lpos.x+=e.x,this._lpos.y+=e.y,this._lpos.z+=e.z;this.invalidateChildren($u.POSITION),1&this._eventMask&&this.emit(hA.TRANSFORM_CHANGED,$u.POSITION)},n.rotate=function(e,t){var n=t||Ju.LOCAL;if(qn.normalize(bC,e),n===Ju.LOCAL)qn.multiply(this._lrot,this._lrot,bC);else if(n===Ju.WORLD){var i=this.worldRotation;qn.multiply(RC,bC,i),qn.invert(bC,i),qn.multiply(RC,bC,RC),qn.multiply(this._lrot,this._lrot,RC)}this._eulerDirty=!0,this.invalidateChildren($u.ROTATION),1&this._eventMask&&this.emit(hA.TRANSFORM_CHANGED,$u.ROTATION)},n.lookAt=function(e,t){this.getWorldPosition(IC),Un.subtract(IC,IC,e),Un.normalize(IC,IC),qn.fromViewUp(bC,IC,t),this.setWorldRotation(bC)},n.invalidateChildren=function(e){var t=this.hasChangedFlags;if((this._dirtyFlags&t&e)!==e){this._dirtyFlags|=e,this.hasChangedFlags=t|e;for(var n=e|$u.POSITION,i=this._children.length,r=0;r<i;++r){var o=this._children[r];o.isValid&&o.invalidateChildren(n)}}},n.updateWorldTransform=function(){if(this._dirtyFlags){for(var e,t=this,n=0;t&&t._dirtyFlags;)OC[n++]=t,t=t._parent;for(var i=0;n;)i|=(e=OC[--n])._dirtyFlags,t?(i&$u.POSITION&&(Un.transformMat4(e._pos,e._lpos,t._mat),e._mat.m12=e._pos.x,e._mat.m13=e._pos.y,e._mat.m14=e._pos.z,Dr.setVec3(e._poolHandle,Rr.WORLD_POSITION,e._pos)),i&$u.RS&&(ei.fromRTS(e._mat,e._lrot,e._lpos,e._lscale),ei.multiply(e._mat,t._mat,e._mat),i&$u.ROTATION&&(qn.multiply(e._rot,t._rot,e._lrot),Dr.setVec4(e._poolHandle,Rr.WORLD_ROTATION,e._rot)),Vn.fromQuat(PC,qn.conjugate(NC,e._rot)),Vn.multiplyMat4(PC,PC,e._mat),e._scale.x=PC.m00,e._scale.y=PC.m04,e._scale.z=PC.m08,Dr.setVec3(e._poolHandle,Rr.WORLD_SCALE,e._scale))):(i&$u.POSITION&&(Un.copy(e._pos,e._lpos),e._mat.m12=e._pos.x,e._mat.m13=e._pos.y,e._mat.m14=e._pos.z,Dr.setVec3(e._poolHandle,Rr.WORLD_POSITION,e._pos)),i&$u.RS&&(i&$u.ROTATION&&(qn.copy(e._rot,e._lrot),Dr.setVec4(e._poolHandle,Rr.WORLD_ROTATION,e._rot)),i&$u.SCALE&&(Un.copy(e._scale,e._lscale),Dr.setVec3(e._poolHandle,Rr.WORLD_SCALE,e._scale),ei.fromRTS(e._mat,e._rot,e._pos,e._scale)))),i!==$u.NONE&&Dr.setMat4(e._poolHandle,Rr.WORLD_MATRIX,e._mat),e._dirtyFlags=$u.NONE,t=e}},n.setPosition=function(e,t,n){void 0===t&&void 0===n?Un.copy(this._lpos,e):void 0===n?Un.set(this._lpos,e,t,this._lpos.z):Un.set(this._lpos,e,t,n),this.invalidateChildren($u.POSITION),1&this._eventMask&&this.emit(hA.TRANSFORM_CHANGED,$u.POSITION)},n.getPosition=function(e){return e?Un.set(e,this._lpos.x,this._lpos.y,this._lpos.z):Un.copy(new Un,this._lpos)},n.setRotation=function(e,t,n,i){void 0===t||void 0===n||void 0===i?qn.copy(this._lrot,e):qn.set(this._lrot,e,t,n,i),this._eulerDirty=!0,this.invalidateChildren($u.ROTATION),1&this._eventMask&&this.emit(hA.TRANSFORM_CHANGED,$u.ROTATION)},n.setRotationFromEuler=function(e,t,n){var i=void 0===n?this._euler.z:n;void 0===t?(Un.copy(this._euler,e),qn.fromEuler(this._lrot,e.x,e.y,e.z)):(Un.set(this._euler,e,t,i),qn.fromEuler(this._lrot,e,t,i)),this._eulerDirty=!1,this.invalidateChildren($u.ROTATION),1&this._eventMask&&this.emit(hA.TRANSFORM_CHANGED,$u.ROTATION)},n.getRotation=function(e){return e?qn.set(e,this._lrot.x,this._lrot.y,this._lrot.z,this._lrot.w):qn.copy(new qn,this._lrot)},n.setScale=function(e,t,n){void 0===t&&void 0===n?Un.copy(this._lscale,e):void 0===n?Un.set(this._lscale,e,t,this._lscale.z):Un.set(this._lscale,e,t,n),this.invalidateChildren($u.SCALE),1&this._eventMask&&this.emit(hA.TRANSFORM_CHANGED,$u.SCALE)},n.getScale=function(e){return e?Un.set(e,this._lscale.x,this._lscale.y,this._lscale.z):Un.copy(new Un,this._lscale)},n.inverseTransformPoint=function(e,t){Un.copy(e,t);for(var n=this,i=0;n._parent;)OC[i++]=n,n=n._parent;for(;i>=0;)Un.transformInverseRTS(e,e,n._lrot,n._lpos,n._lscale),n=OC[--i];return e},n.setWorldPosition=function(e,t,n){void 0===t||void 0===n?Un.copy(this._pos,e):Un.set(this._pos,e,t,n),Dr.setVec3(this._poolHandle,Rr.WORLD_POSITION,this._pos);var i=this._parent,r=this._lpos;i?(i.updateWorldTransform(),Un.transformMat4(r,this._pos,ei.invert(DC,i._mat))):Un.copy(r,this._pos),this.invalidateChildren($u.POSITION),1&this._eventMask&&this.emit(hA.TRANSFORM_CHANGED,$u.POSITION)},n.getWorldPosition=function(e){return this.updateWorldTransform(),e?Un.copy(e,this._pos):Un.copy(new Un,this._pos)},n.setWorldRotation=function(e,t,n,i){void 0===t||void 0===n||void 0===i?qn.copy(this._rot,e):qn.set(this._rot,e,t,n,i),Dr.setVec4(this._poolHandle,Rr.WORLD_ROTATION,this._rot),this._parent?(this._parent.updateWorldTransform(),qn.multiply(this._lrot,qn.conjugate(this._lrot,this._parent._rot),this._rot)):qn.copy(this._lrot,this._rot),this._eulerDirty=!0,this.invalidateChildren($u.ROTATION),1&this._eventMask&&this.emit(hA.TRANSFORM_CHANGED,$u.ROTATION)},n.setWorldRotationFromEuler=function(e,t,n){qn.fromEuler(this._rot,e,t,n),this._parent?(this._parent.updateWorldTransform(),qn.multiply(this._lrot,qn.conjugate(this._lrot,this._parent._rot),this._rot)):qn.copy(this._lrot,this._rot),this._eulerDirty=!0,this.invalidateChildren($u.ROTATION),1&this._eventMask&&this.emit(hA.TRANSFORM_CHANGED,$u.ROTATION)},n.getWorldRotation=function(e){return this.updateWorldTransform(),e?qn.copy(e,this._rot):qn.copy(new qn,this._rot)},n.setWorldScale=function(e,t,n){void 0===t||void 0===n?Un.copy(this._scale,e):Un.set(this._scale,e,t,n),Dr.setVec3(this._poolHandle,Rr.WORLD_SCALE,this._scale);var i=this._parent;i?(i.updateWorldTransform(),Vn.fromQuat(PC,qn.conjugate(NC,i._rot)),Vn.multiplyMat4(PC,PC,i._mat),MC.m00=this._scale.x,MC.m04=this._scale.y,MC.m08=this._scale.z,Vn.multiply(PC,MC,Vn.invert(PC,PC)),this._lscale.x=Un.set(IC,PC.m00,PC.m01,PC.m02).length(),this._lscale.y=Un.set(IC,PC.m03,PC.m04,PC.m05).length(),this._lscale.z=Un.set(IC,PC.m06,PC.m07,PC.m08).length()):Un.copy(this._lscale,this._scale),this.invalidateChildren($u.SCALE),1&this._eventMask&&this.emit(hA.TRANSFORM_CHANGED,$u.SCALE)},n.getWorldScale=function(e){return this.updateWorldTransform(),e?Un.copy(e,this._scale):Un.copy(new Un,this._scale)},n.getWorldMatrix=function(e){this.updateWorldTransform();var t=e||new ei;return ei.copy(t,this._mat)},n.getWorldRS=function(e){this.updateWorldTransform();var t=e||new ei;return ei.copy(t,this._mat),t.m12=0,t.m13=0,t.m14=0,t},n.getWorldRT=function(e){this.updateWorldTransform();var t=e||new ei;return ei.fromRT(t,this._rot,this._pos)},n.setRTS=function(e,t,n){var i=0;e&&(i|=$u.ROTATION,void 0!==e.w?(qn.copy(this._lrot,e),this._eulerDirty=!0):(Un.copy(this._euler,e),qn.fromEuler(this._lrot,e.x,e.y,e.z),this._eulerDirty=!1)),t&&(Un.copy(this._lpos,t),i|=$u.POSITION),n&&(Un.copy(this._lscale,n),i|=$u.SCALE),i&&(this.invalidateChildren(i),1&this._eventMask&&this.emit(hA.TRANSFORM_CHANGED,i))},n.pauseSystemEvents=function(e){XT.pauseTarget(this,e)},n.resumeSystemEvents=function(e){XT.resumeTarget(this,e)},Z(t,[{key:"handle",get:function(){return this._poolHandle}},{key:"position",get:function(){return this._lpos},set:function(e){this.setPosition(e)}},{key:"worldPosition",get:function(){return this.updateWorldTransform(),this._pos},set:function(e){this.setWorldPosition(e)}},{key:"rotation",get:function(){return this._lrot},set:function(e){this.setRotation(e)}},{key:"eulerAngles",set:function(e){this.setRotationFromEuler(e.x,e.y,e.z)},get:function(){return this._eulerDirty&&(qn.toEuler(this._euler,this._lrot),this._eulerDirty=!1),this._euler}},{key:"angle",get:function(){return this._euler.z},set:function(e){Un.set(this._euler,0,0,e),qn.fromAngleZ(this._lrot,e),this._eulerDirty=!1,this.invalidateChildren($u.ROTATION),1&this._eventMask&&this.emit(hA.TRANSFORM_CHANGED,$u.ROTATION)}},{key:"worldRotation",get:function(){return this.updateWorldTransform(),this._rot},set:function(e){this.setWorldRotation(e)}},{key:"scale",get:function(){return this._lscale},set:function(e){this.setScale(e)}},{key:"worldScale",get:function(){return this.updateWorldTransform(),this._scale},set:function(e){this.setWorldScale(e)}},{key:"matrix",set:function(e){ei.toRTS(e,this._lrot,this._lpos,this._lscale),this.invalidateChildren($u.TRS),this._eulerDirty=!0,1&this._eventMask&&this.emit(hA.TRANSFORM_CHANGED,$u.TRS)}},{key:"worldMatrix",get:function(){return this.updateWorldTransform(),this._mat}},{key:"forward",get:function(){return Un.transformQuat(new Un,Un.FORWARD,this.worldRotation)},set:function(e){var t=e.length();Un.multiplyScalar(IC,e,-1/t),qn.fromViewUp(bC,IC),this.setWorldRotation(bC)}},{key:"layer",set:function(e){this._layer=e,Dr.set(this._poolHandle,Rr.LAYER,this._layer),this.emit(hA.LAYER_CHANGED,this._layer)},get:function(){return this._layer}},{key:"hasChangedFlags",get:function(){return LC.get(this)||0},set:function(e){LC.set(this,e),Dr.set(this._poolHandle,Rr.FLAGS_CHANGED,e)}}]),t}(wC),AC.bookOfChange=LC,AC.EventType=hA,AC.NodeSpace=Ju,AC.TransformDirtyBit=$u,AC.TransformBit=$u,yC=se((gC=CC).prototype,"_lpos",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Un}}),xC=se(gC.prototype,"_lrot",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new qn}}),EC=se(gC.prototype,"_lscale",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Un(1,1,1)}}),SC=se(gC.prototype,"_layer",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Kl.Enum.DEFAULT}}),TC=se(gC.prototype,"_euler",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Un}}),se(gC.prototype,"eulerAngles",[pC],Object.getOwnPropertyDescriptor(gC.prototype,"eulerAngles"),gC.prototype),se(gC.prototype,"angle",[Nh],Object.getOwnPropertyDescriptor(gC.prototype,"angle"),gC.prototype),se(gC.prototype,"layer",[Nh],Object.getOwnPropertyDescriptor(gC.prototype,"layer"),gC.prototype),vC=gC))||vC));c.Node=FC;var zC=new Array(16),BC=null,UC=new ri,GC=[hA.TOUCH_START.toString(),hA.TOUCH_MOVE.toString(),hA.TOUCH_END.toString(),hA.TOUCH_CANCEL.toString()],HC=[hA.MOUSE_DOWN.toString(),hA.MOUSE_ENTER.toString(),hA.MOUSE_MOVE.toString(),hA.MOUSE_LEAVE.toString(),hA.MOUSE_UP.toString(),hA.MOUSE_WHEEL.toString()];function kC(e,t){var n=this.owner;return!(!n||!n._uiProps.uiTransformComp||(e.getUILocation(UC),!n._uiProps.uiTransformComp.isHit(UC,this)||(t.type=hA.TOUCH_START.toString(),t.touch=e,t.bubbles=!0,n.dispatchEvent(t),0)))}function VC(e,t){var n=this.owner;return!(!n||!n._uiProps.uiTransformComp||(t.type=hA.TOUCH_MOVE.toString(),t.touch=e,t.bubbles=!0,n.dispatchEvent(t),0))}function jC(e,t){var n=this.owner;n&&n._uiProps.uiTransformComp&&(e.getUILocation(UC),n._uiProps.uiTransformComp.isHit(UC,this)?t.type=hA.TOUCH_END.toString():t.type=hA.TOUCH_CANCEL.toString(),t.touch=e,t.bubbles=!0,n.dispatchEvent(t))}function WC(e,t){var n=this.owner;n&&n._uiProps.uiTransformComp&&(t.type=hA.TOUCH_CANCEL.toString(),t.touch=e,t.bubbles=!0,n.dispatchEvent(t))}function qC(e){var t=this.owner;t&&t._uiProps.uiTransformComp&&(UC=e.getUILocation(),t._uiProps.uiTransformComp.isHit(UC,this)&&(e.type=hA.MOUSE_DOWN.toString(),e.bubbles=!0,t.dispatchEvent(e)))}function YC(e){var t=this.owner;if(t&&t._uiProps.uiTransformComp){if(UC=e.getUILocation(),t._uiProps.uiTransformComp.isHit(UC,this))this._previousIn||(BC&&BC.eventProcessor.mouseListener&&(e.type=hA.MOUSE_LEAVE,BC.dispatchEvent(e),BC.eventProcessor.mouseListener&&(BC.eventProcessor.mouseListener._previousIn=!1)),BC=t,e.type=hA.MOUSE_ENTER.toString(),t.dispatchEvent(e),this._previousIn=!0),e.type=hA.MOUSE_MOVE.toString(),e.bubbles=!0,t.dispatchEvent(e);else{if(!this._previousIn)return;e.type=hA.MOUSE_LEAVE.toString(),t.dispatchEvent(e),this._previousIn=!1,BC=null}e.propagationStopped=!0}}function XC(e){var t=this.owner;t&&t._uiProps.uiTransformComp&&(UC=e.getUILocation(),t._uiProps.uiTransformComp.isHit(UC,this)&&(e.type=hA.MOUSE_UP.toString(),e.bubbles=!0,t.dispatchEvent(e),e.propagationStopped=!0))}function KC(e){var t=this.owner;t&&t._uiProps.uiTransformComp&&(UC=e.getUILocation(),t._uiProps.uiTransformComp.isHit(UC,this)&&(e.type=hA.MOUSE_WHEEL.toString(),e.bubbles=!0,t.dispatchEvent(e),e.propagationStopped=!0))}function QC(e,t){if(t){for(var n=0,i=[],r=e;r&&FC.isNode(r);r=r.parent,++n){var o=r.getComponent(t);if(o){var a={index:n,comp:o};i?i.push(a):i=[a]}}return i.length>0?i:null}return null}function ZC(e,t){if(!e._persistNode){if(e.eventProcessor.bubblingTargets)for(var n=0;n<t.length;++n)if(e.eventProcessor.bubblingTargets.hasEventListener(t[n]))return!0;if(e.eventProcessor.capturingTargets)for(var i=0;i<t.length;++i)if(e.eventProcessor.capturingTargets.hasEventListener(t[i]))return!0;return!1}return!0}var JC,$C,ew,tw,nw,iw,rw,ow,aw,sw,cw,lw,uw,hw,_w,fw,mw,dw,pw,vw,gw,yw,xw,Ew,Sw,Tw,Aw,Cw,ww,Iw,bw,Rw,Ow,Nw,Pw,Mw,Dw,Lw,Fw,zw,Bw,Uw,Gw,Hw,kw,Vw,jw,Ww,qw,Yw,Xw,Kw,Qw,Zw,Jw,$w,eI,tI,nI,iI,rI,oI,aI,sI,cI,lI,uI,hI,_I,fI,mI,dI,pI,vI,gI,yI,xI,EI,SI,TI,AI,CI,wI,II,bI,RI,OI,NI,PI,MI,DI,LI,FI,zI,BI,UI,GI,HI,kI,VI,jI,WI,qI,YI,XI,KI,QI,ZI=function(){function e(e){this.bubblingTargets=null,this.capturingTargets=null,this.touchListener=null,this.mouseListener=null,this._node=void 0,this._comp=null,this._node=e}Z(e,[{key:"node",get:function(){return this._node}}]);var t=e.prototype;return t.reattach=function(){if(this._comp)if(this.touchListener){var e=this.touchListener.mask=QC(this._node,this._comp);this.mouseListener&&(this.mouseListener.mask=e)}else this.mouseListener&&(this.mouseListener.mask=QC(this._node,this._comp))},t.registerComponentHitList=function(e){this._comp=e},t.destroy=function(){BC===this._node&&(BC=null),(this.touchListener||this.mouseListener)&&(XT.removeListeners(this._node),this.touchListener&&(this.touchListener.owner=null,this.touchListener.mask=null,this.touchListener=null),this.mouseListener&&(this.mouseListener.owner=null,this.mouseListener.mask=null,this.mouseListener=null)),this.capturingTargets&&this.capturingTargets.clear(),this.bubblingTargets&&this.bubblingTargets.clear()},t.on=function(e,t,n,i){return this._checknSetupSysEvent(e)?this._onDispatch(e,t,n,i):(this.bubblingTargets||(this.bubblingTargets=new M_),this.bubblingTargets.on(e,t,n))},t.once=function(e,t,n,i){var r,o=this;(r=this._checknSetupSysEvent(e)&&i?this.capturingTargets=this.capturingTargets||new M_:this.bubblingTargets=this.bubblingTargets||new M_).on(e,t,n,!0),r.on(e,(function(){o.off(e,t,n)}),void 0,!0)},t.off=function(e,t,n,i){var r=-1!==GC.indexOf(e),o=!r&&-1!==HC.indexOf(e);r||o?(this._offDispatch(e,t,n,i),r?this.touchListener&&!ZC(this._node,GC)&&(XT.removeListener(this.touchListener),this.touchListener=null):o&&this.mouseListener&&!ZC(this._node,HC)&&(XT.removeListener(this.mouseListener),this.mouseListener=null)):this.bubblingTargets&&this.bubblingTargets.off(e,t,n)},t.emit=function(e,t,n,i,r,o){this.bubblingTargets&&this.bubblingTargets.emit(e,t,n,i,r,o)},t.dispatchEvent=function(e){!function(e,t){var n,i=0;for(t.target=e,zC.length=0,e.eventProcessor.getCapturingTargets(t.type,zC),t.eventPhase=1,i=zC.length-1;i>=0;--i)if((n=zC[i]).eventProcessor.capturingTargets&&(t.currentTarget=n,n.eventProcessor.capturingTargets.emit(t.type,t,zC),t.propagationStopped))return void(zC.length=0);if(zC.length=0,t.eventPhase=2,t.currentTarget=e,e.eventProcessor.capturingTargets&&e.eventProcessor.capturingTargets.emit(t.type,t),!t.propagationImmediateStopped&&e.eventProcessor.bubblingTargets&&e.eventProcessor.bubblingTargets.emit(t.type,t),!t.propagationStopped&&t.bubbles)for(e.eventProcessor.getBubblingTargets(t.type,zC),t.eventPhase=3,i=0;i<zC.length;++i)if((n=zC[i]).eventProcessor.bubblingTargets&&(t.currentTarget=n,n.eventProcessor.bubblingTargets.emit(t.type,t),t.propagationStopped))return void(zC.length=0);zC.length=0}(this._node,e),zC.length=0},t.hasEventListener=function(e,t,n){var i=!1;return this.bubblingTargets&&(i=this.bubblingTargets.hasEventListener(e,t,n)),!i&&this.capturingTargets&&(i=this.capturingTargets.hasEventListener(e,t,n)),i},t.targetOff=function(e){this.capturingTargets&&this.capturingTargets.removeAll(e),this.bubblingTargets&&this.bubblingTargets.removeAll(e),this.touchListener&&!ZC(this.node,GC)&&(XT.removeListener(this.touchListener),this.touchListener=null),this.mouseListener&&!ZC(this.node,HC)&&(XT.removeListener(this.mouseListener),this.mouseListener=null)},t.getCapturingTargets=function(e,t){for(var n=this._node.parent;n;)n.eventProcessor.capturingTargets&&n.eventProcessor.capturingTargets.hasEventListener(e)&&t.push(n),n=n.parent},t.getBubblingTargets=function(e,t){for(var n=this._node.parent;n;)n.eventProcessor.bubblingTargets&&n.eventProcessor.bubblingTargets.hasEventListener(e)&&t.push(n),n=n.parent},t._checknSetupSysEvent=function(e){var t=this,n=!1,i=!1;return-1!==GC.indexOf(e)?(this.touchListener||(this.touchListener=c.EventListener.create({event:c.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,owner:this._node,mask:QC(this._node,this._comp),onTouchBegan:kC,onTouchMoved:VC,onTouchEnded:jC,onTouchCancelled:WC}),XT.addListener(this.touchListener,this._node),n=!0),i=!0):-1!==HC.indexOf(e)&&(this.mouseListener||(this.mouseListener=c.EventListener.create({event:c.EventListener.MOUSE,_previousIn:!1,owner:this._node,mask:QC(this._node,this._comp),onMouseDown:qC,onMouseMove:YC,onMouseUp:XC,onMouseScroll:KC}),XT.addListener(this.mouseListener,this._node),n=!0),i=!0),n&&!this._node.activeInHierarchy&&c.director.getScheduler().schedule((function(){t._node.activeInHierarchy||XT.pauseTarget(t._node)}),this._node,0,0,0,!1),i},t._onDispatch=function(e,t,n,i){if("boolean"==typeof n?(i=n,n=void 0):i=!!i,t){var r=null;return(r=i?this.capturingTargets=this.capturingTargets||new M_:this.bubblingTargets=this.bubblingTargets||new M_).hasEventListener(e,t,n)||r.on(e,t,n),t}R(6800)},t._offDispatch=function(e,t,n,i){if("boolean"==typeof n?(i=n,n=void 0):i=!!i,t){var r=i?this.capturingTargets:this.bubblingTargets;r&&r.off(e,t,n)}else this.capturingTargets&&this.capturingTargets.removeAll(e),this.bubblingTargets&&this.bubblingTargets.removeAll(e)},e}();c.NodeEventProcessor=ZI,ve(wC.prototype,"BaseNode",[{name:"childrenCount",newName:"children.length",customGetter:function(){return this.children.length}}]),ve(FC.prototype,"Node",[{name:"width",targetName:"node.getComponent(UITransform)",customGetter:function(){return this._uiProps.uiTransformComp.width},customSetter:function(e){this._uiProps.uiTransformComp.width=e}},{name:"height",targetName:"node.getComponent(UITransform)",customGetter:function(){return this._uiProps.uiTransformComp.height},customSetter:function(e){this._uiProps.uiTransformComp.height=e}},{name:"anchorX",targetName:"node.getComponent(UITransform)",customGetter:function(){return this._uiProps.uiTransformComp.anchorX},customSetter:function(e){this._uiProps.uiTransformComp.anchorX=e}},{name:"anchorY",targetName:"node.getComponent(UITransform)",customGetter:function(){return this._uiProps.uiTransformComp.anchorY},customSetter:function(e){this._uiProps.uiTransformComp.anchorY=e}},{name:"getAnchorPoint",targetName:"node.getComponent(UITransform)",customFunction:function(e){return e||(e=new ri),e.set(this._uiProps.uiTransformComp.anchorPoint),e}},{name:"setAnchorPoint",targetName:"node.getComponent(UITransform)",customFunction:function(e,t){this._uiProps.uiTransformComp.setAnchorPoint(e,t)}},{name:"getContentSize",targetName:"node.getComponent(UITransform)",customFunction:function(e){return e||(e=new hi),e.set(this._uiProps.uiTransformComp.contentSize),e}},{name:"setContentSize",targetName:"node.getComponent(UITransform)",customFunction:function(e,t){"number"==typeof e?this._uiProps.uiTransformComp.setContentSize(e,t):this._uiProps.uiTransformComp.setContentSize(e)}}]),ge(FC.prototype,"Node.prototype",[{name:"addLayer"},{name:"removeLayer"}]),ge(Kl,"Layers",[{name:"All"},{name:"RaycastMask"},{name:"check"}]),ve(Kl,"Layers",[{name:"Default",newName:"DEFAULT",target:Kl.Enum,targetName:"Layers.Enum"},{name:"Always",newName:"ALWAYS",target:Kl.Enum,targetName:"Layers.Enum"},{name:"IgnoreRaycast",newName:"IGNORE_RAYCAST",target:Kl.Enum,targetName:"Layers.Enum"},{name:"Gizmos",newName:"GIZMOS",target:Kl.Enum,targetName:"Layers.Enum"},{name:"Editor",newName:"EDITOR",target:Kl.Enum,targetName:"Layers.Enum"},{name:"UI",newName:"UI_3D",target:Kl.Enum,targetName:"Layers.Enum"},{name:"UI2D",newName:"UI_2D",target:Kl.Enum,targetName:"Layers.Enum"},{name:"SceneGizmo",newName:"SCENE_GIZMO",target:Kl.Enum,targetName:"Layers.Enum"},{name:"makeInclusiveMask",newName:"makeMaskInclude",target:Kl,targetName:"Layers"},{name:"makeExclusiveMask",newName:"makeMaskExclude",target:Kl,targetName:"Layers"}]),ge(Kl.Enum,"Layers.Enum",[{name:"ALWAYS"}]),ge(Kl.BitMask,"Layers.BitMask",[{name:"ALWAYS"}]);var JI=new Un(0,1,0),$I=new Un,eb=new qn,tb=(JC=vh("cc.AmbientInfo"),$C=qh(Yt),JC((ow=function(){function e(){ae(this,"_skyColor",nw,this),ae(this,"_skyIllum",iw,this),ae(this,"_groundAlbedo",rw,this),this._resource=null}return e.prototype.activate=function(e){this._resource=e,this._resource.initialize(this)},Z(e,[{key:"skyColor",set:function(e){this._skyColor.set(e),this._resource&&(this._resource.skyColor=this._skyColor)},get:function(){return this._skyColor}},{key:"skyIllum",set:function(e){this._skyIllum=e,this._resource&&(this._resource.skyIllum=this.skyIllum)},get:function(){return this._skyIllum}},{key:"groundAlbedo",set:function(e){this._groundAlbedo.set(e),this._resource&&(this._resource.groundAlbedo=this._groundAlbedo)},get:function(){return this._groundAlbedo}}]),e}(),nw=se((tw=ow).prototype,"_skyColor",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new zn(51,128,204,1)}}),iw=se(tw.prototype,"_skyIllum",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Co.SKY_ILLUM}}),rw=se(tw.prototype,"_groundAlbedo",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new zn(51,51,51,255)}}),se(tw.prototype,"skyColor",[Nh],Object.getOwnPropertyDescriptor(tw.prototype,"skyColor"),tw.prototype),se(tw.prototype,"skyIllum",[Nh,$C],Object.getOwnPropertyDescriptor(tw.prototype,"skyIllum"),tw.prototype),se(tw.prototype,"groundAlbedo",[Nh],Object.getOwnPropertyDescriptor(tw.prototype,"groundAlbedo"),tw.prototype),ew=tw))||ew);c.AmbientInfo=tb;var nb=(aw=vh("cc.SkyboxInfo"),sw=qh(Om),cw=qh(Om),aw((dw=function(){function e(){ae(this,"_envmap",hw,this),ae(this,"_isRGBE",_w,this),ae(this,"_enabled",fw,this),ae(this,"_useIBL",mw,this),this._resource=null}return e.prototype.activate=function(e){this._resource=e,this._resource.initialize(this),this._resource.activate()},Z(e,[{key:"enabled",set:function(e){this._enabled!==e&&(this._enabled=e,this._resource&&(this._resource.enabled=this._enabled))},get:function(){return this._enabled}},{key:"useIBL",set:function(e){this._useIBL=e,this._resource&&(this._resource.useIBL=this._useIBL)},get:function(){return this._useIBL}},{key:"envmap",set:function(e){this._envmap=e,this._resource&&(this._resource.envmap=this._envmap)},get:function(){return this._envmap}},{key:"isRGBE",set:function(e){this._isRGBE=e,this._resource&&(this._resource.isRGBE=this._isRGBE)},get:function(){return this._isRGBE}}]),e}(),hw=se((uw=dw).prototype,"_envmap",[sw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_w=se(uw.prototype,"_isRGBE",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),fw=se(uw.prototype,"_enabled",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),mw=se(uw.prototype,"_useIBL",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),se(uw.prototype,"enabled",[Nh],Object.getOwnPropertyDescriptor(uw.prototype,"enabled"),uw.prototype),se(uw.prototype,"useIBL",[Nh],Object.getOwnPropertyDescriptor(uw.prototype,"useIBL"),uw.prototype),se(uw.prototype,"envmap",[Nh,cw],Object.getOwnPropertyDescriptor(uw.prototype,"envmap"),uw.prototype),se(uw.prototype,"isRGBE",[Nh],Object.getOwnPropertyDescriptor(uw.prototype,"isRGBE"),uw.prototype),lw=uw))||lw);c.SkyboxInfo=nb;var ib=(pw=vh("cc.FogInfo"),vw=qh(sE),gw=Ph(),yw=qh(Yt),xw=Lh(),Ew=Bh(),Sw=Gh(),Tw=Ph(),Aw=qh(Yt),Cw=Bh(),ww=Gh(),Iw=Ph(),bw=qh(Yt),Rw=Bh(),Ow=Gh(),Nw=Ph(),Pw=qh(Yt),Mw=Fh(),Dw=Bh(),Lw=Gh(),Fw=Ph(),zw=qh(Yt),Bw=Bh(),Uw=Gh(),Gw=Ph(),Hw=qh(Yt),kw=Bh(),Vw=Gh(),pw((nI=tI=function(){function e(){ae(this,"_type",qw,this),ae(this,"_fogColor",Yw,this),ae(this,"_enabled",Xw,this),ae(this,"_fogDensity",Kw,this),ae(this,"_fogStart",Qw,this),ae(this,"_fogEnd",Zw,this),ae(this,"_fogAtten",Jw,this),ae(this,"_fogTop",$w,this),ae(this,"_fogRange",eI,this),this._resource=null}return e.prototype.activate=function(e){this._resource=e,this._resource.initialize(this),this._resource.activate()},Z(e,[{key:"enabled",set:function(e){this._enabled!==e&&(this._enabled=e,this._resource&&(this._resource.enabled=e,e&&(this._resource.type=this._type)))},get:function(){return this._enabled}},{key:"fogColor",set:function(e){this._fogColor.set(e),this._resource&&(this._resource.fogColor=this._fogColor)},get:function(){return this._fogColor}},{key:"type",get:function(){return this._type},set:function(e){this._type=e,this._resource&&(this._resource.type=e)}},{key:"fogDensity",get:function(){return this._fogDensity},set:function(e){this._fogDensity=e,this._resource&&(this._resource.fogDensity=e)}},{key:"fogStart",get:function(){return this._fogStart},set:function(e){this._fogStart=e,this._resource&&(this._resource.fogStart=e)}},{key:"fogEnd",get:function(){return this._fogEnd},set:function(e){this._fogEnd=e,this._resource&&(this._resource.fogEnd=e)}},{key:"fogAtten",get:function(){return this._fogAtten},set:function(e){this._fogAtten=e,this._resource&&(this._resource.fogAtten=e)}},{key:"fogTop",get:function(){return this._fogTop},set:function(e){this._fogTop=e,this._resource&&(this._resource.fogTop=e)}},{key:"fogRange",get:function(){return this._fogRange},set:function(e){this._fogRange=e,this._resource&&(this._resource.fogRange=e)}}]),e}(),tI.FogType=sE,qw=se((Ww=nI).prototype,"_type",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return sE.LINEAR}}),Yw=se(Ww.prototype,"_fogColor",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new zn("#C8C8C8")}}),Xw=se(Ww.prototype,"_enabled",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Kw=se(Ww.prototype,"_fogDensity",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),Qw=se(Ww.prototype,"_fogStart",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),Zw=se(Ww.prototype,"_fogEnd",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 300}}),Jw=se(Ww.prototype,"_fogAtten",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),$w=se(Ww.prototype,"_fogTop",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.5}}),eI=se(Ww.prototype,"_fogRange",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.2}}),se(Ww.prototype,"enabled",[Nh],Object.getOwnPropertyDescriptor(Ww.prototype,"enabled"),Ww.prototype),se(Ww.prototype,"fogColor",[Nh],Object.getOwnPropertyDescriptor(Ww.prototype,"fogColor"),Ww.prototype),se(Ww.prototype,"type",[Nh,vw],Object.getOwnPropertyDescriptor(Ww.prototype,"type"),Ww.prototype),se(Ww.prototype,"fogDensity",[gw,yw,xw,Ew,Uh,Sw],Object.getOwnPropertyDescriptor(Ww.prototype,"fogDensity"),Ww.prototype),se(Ww.prototype,"fogStart",[Tw,Aw,Cw,ww],Object.getOwnPropertyDescriptor(Ww.prototype,"fogStart"),Ww.prototype),se(Ww.prototype,"fogEnd",[Iw,bw,Rw,Ow],Object.getOwnPropertyDescriptor(Ww.prototype,"fogEnd"),Ww.prototype),se(Ww.prototype,"fogAtten",[Nw,Pw,Mw,Dw,Lw],Object.getOwnPropertyDescriptor(Ww.prototype,"fogAtten"),Ww.prototype),se(Ww.prototype,"fogTop",[Fw,zw,Bw,Uw],Object.getOwnPropertyDescriptor(Ww.prototype,"fogTop"),Ww.prototype),se(Ww.prototype,"fogRange",[Gw,Hw,kw,Vw],Object.getOwnPropertyDescriptor(Ww.prototype,"fogRange"),Ww.prototype),jw=Ww))||jw),rb=(iI=vh("cc.ShadowsInfo"),rI=qh(mp),oI=Ph(),aI=qh(Yt),sI=Ph(),cI=qh(dp),lI=Ph(),uI=qh(Xt),hI=Ph(),_I=qh(Yt),fI=Ph(),mI=qh(Yt),dI=Ph(),pI=qh(Yt),vI=Ph(),gI=qh(qt),yI=Ph(),xI=Ph(),EI=qh(Yt),SI=Ph(),TI=qh(Yt),AI=Ph(),iI((HI=function(){function e(){ae(this,"_type",II,this),ae(this,"_enabled",bI,this),ae(this,"_normal",RI,this),ae(this,"_distance",OI,this),ae(this,"_shadowColor",NI,this),ae(this,"_autoAdapt",PI,this),ae(this,"_pcf",MI,this),ae(this,"_bias",DI,this),ae(this,"_near",LI,this),ae(this,"_far",FI,this),ae(this,"_aspect",zI,this),ae(this,"_orthoSize",BI,this),ae(this,"_maxReceived",UI,this),ae(this,"_size",GI,this),this._resource=null}var t=e.prototype;return t.setPlaneFromNode=function(e){e.getWorldRotation(eb),this.normal=Un.transformQuat($I,JI,eb),e.getWorldPosition($I),this.distance=Un.dot(this._normal,$I)},t.activate=function(e){this._resource=e,this._resource.initialize(this),this._resource.activate()},Z(e,[{key:"enabled",set:function(e){this._enabled!==e&&(this._enabled=e,this._resource&&(this._resource.enabled=e,e&&(this._resource.type=this._type)))},get:function(){return this._enabled}},{key:"type",set:function(e){this._type=e,this._resource&&(this._resource.type=e)},get:function(){return this._type}},{key:"shadowColor",set:function(e){this._shadowColor.set(e),this._resource&&(this._resource.shadowColor=e)},get:function(){return this._shadowColor}},{key:"normal",set:function(e){Un.copy(this._normal,e),this._resource&&(this._resource.normal=e)},get:function(){return this._normal}},{key:"distance",set:function(e){this._distance=e,this._resource&&(this._resource.distance=e)},get:function(){return this._distance}},{key:"pcf",set:function(e){this._pcf=e,this._resource&&(this._resource.pcf=e)},get:function(){return this._pcf}},{key:"autoAdapt",set:function(e){this._autoAdapt=e,this._resource&&(this._resource.autoAdapt=e)},get:function(){return this._autoAdapt}},{key:"near",set:function(e){this._near=e,this._resource&&(this._resource.near=e)},get:function(){return this._near}},{key:"far",set:function(e){this._far=e,this._resource&&(this._resource.far=e)},get:function(){return this._far}},{key:"orthoSize",set:function(e){this._orthoSize=e,this._resource&&(this._resource.orthoSize=e)},get:function(){return this._orthoSize}},{key:"maxReceived",set:function(e){this._maxReceived=e,this._resource&&(this._resource.maxReceived=e)},get:function(){return this._maxReceived}},{key:"shadowMapSize",set:function(e){this._size.set(e),this._resource&&(this._resource.size=e,this._resource.shadowMapDirty=!0)},get:function(){return this._size}},{key:"aspect",set:function(e){this._aspect=e,this._resource&&(this._resource.aspect=e)},get:function(){return this._aspect}},{key:"bias",set:function(e){this._bias=e,this._resource&&(this._resource.bias=e)},get:function(){return this._bias}}]),e}(),II=se((wI=HI).prototype,"_type",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return mp.Planar}}),bI=se(wI.prototype,"_enabled",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),RI=se(wI.prototype,"_normal",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Un(0,1,0)}}),OI=se(wI.prototype,"_distance",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),NI=se(wI.prototype,"_shadowColor",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new zn(0,0,0,76)}}),PI=se(wI.prototype,"_autoAdapt",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),MI=se(wI.prototype,"_pcf",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return dp.HARD}}),DI=se(wI.prototype,"_bias",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e-5}}),LI=se(wI.prototype,"_near",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),FI=se(wI.prototype,"_far",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 30}}),zI=se(wI.prototype,"_aspect",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),BI=se(wI.prototype,"_orthoSize",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),UI=se(wI.prototype,"_maxReceived",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 4}}),GI=se(wI.prototype,"_size",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ri(512,512)}}),se(wI.prototype,"enabled",[Nh],Object.getOwnPropertyDescriptor(wI.prototype,"enabled"),wI.prototype),se(wI.prototype,"type",[Nh,rI],Object.getOwnPropertyDescriptor(wI.prototype,"type"),wI.prototype),se(wI.prototype,"shadowColor",[Nh],Object.getOwnPropertyDescriptor(wI.prototype,"shadowColor"),wI.prototype),se(wI.prototype,"normal",[oI],Object.getOwnPropertyDescriptor(wI.prototype,"normal"),wI.prototype),se(wI.prototype,"distance",[aI,sI],Object.getOwnPropertyDescriptor(wI.prototype,"distance"),wI.prototype),se(wI.prototype,"pcf",[cI,lI],Object.getOwnPropertyDescriptor(wI.prototype,"pcf"),wI.prototype),se(wI.prototype,"autoAdapt",[uI,hI],Object.getOwnPropertyDescriptor(wI.prototype,"autoAdapt"),wI.prototype),se(wI.prototype,"near",[_I,fI],Object.getOwnPropertyDescriptor(wI.prototype,"near"),wI.prototype),se(wI.prototype,"far",[mI,dI],Object.getOwnPropertyDescriptor(wI.prototype,"far"),wI.prototype),se(wI.prototype,"orthoSize",[pI,vI],Object.getOwnPropertyDescriptor(wI.prototype,"orthoSize"),wI.prototype),se(wI.prototype,"maxReceived",[gI,yI],Object.getOwnPropertyDescriptor(wI.prototype,"maxReceived"),wI.prototype),se(wI.prototype,"shadowMapSize",[xI],Object.getOwnPropertyDescriptor(wI.prototype,"shadowMapSize"),wI.prototype),se(wI.prototype,"aspect",[EI,SI],Object.getOwnPropertyDescriptor(wI.prototype,"aspect"),wI.prototype),se(wI.prototype,"bias",[TI,AI],Object.getOwnPropertyDescriptor(wI.prototype,"bias"),wI.prototype),CI=wI))||CI);c.ShadowsInfo=rb;var ob,ab,sb,cb,lb=(kI=vh("cc.SceneGlobals"),VI=qh(nb),kI((QI=function(){function e(){ae(this,"ambient",qI,this),ae(this,"shadows",YI,this),ae(this,"_skybox",XI,this),ae(this,"fog",KI,this)}return e.prototype.activate=function(){var e=c.director.root.pipeline;this.ambient.activate(e.ambient),this.skybox.activate(e.skybox),this.shadows.activate(e.shadows),this.fog.activate(e.fog)},Z(e,[{key:"skybox",get:function(){return this._skybox},set:function(e){this._skybox=e}}]),e}(),qI=se((WI=QI).prototype,"ambient",[Sh,Nh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new tb}}),YI=se(WI.prototype,"shadows",[Sh,Nh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new rb}}),XI=se(WI.prototype,"_skybox",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new nb}}),KI=se(WI.prototype,"fog",[Nh,Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ib}}),se(WI.prototype,"skybox",[Nh,VI],Object.getOwnPropertyDescriptor(WI.prototype,"skybox"),WI.prototype),jI=WI))||jI);c.SceneGlobals=lb;var ub,hb=e("cP",vh("cc.Scene")((se((ab=function(e){$(n,e);var t=n.prototype;function n(t){var n;return ae(n=e.call(this,t)||this,"autoReleaseAssets",sb,ie(n)),ae(n,"_globals",cb,ie(n)),n._renderScene=null,n.dependAssets=null,n._inited=void 0,n._prefabSyncedInLiveReload=!1,n._pos=Un.ZERO,n._rot=qn.IDENTITY,n._scale=Un.ONE,n._mat=ei.IDENTITY,n._dirtyFlags=0,n._activeInHierarchy=!1,c.director&&c.director.root&&(n._renderScene=c.director.root.createScene({})),n._inited=!c.game||!c.game._isCloning,n}return t._updateScene=function(){this._scene=this},Z(n,[{key:"renderScene",get:function(){return this._renderScene}},{key:"globals",get:function(){return this._globals}}]),t.destroy=function(){var e=A_.prototype.destroy.call(this);if(e)for(var t=this._children,n=0;n<t.length;++n)t[n].active=!1;return c.director.root.destroyScene(this._renderScene),this._active=!1,this._activeInHierarchy=!1,e},t.addComponent=function(){throw new Error(M(3822))},t._onHierarchyChanged=function(){},t._onBatchCreated=function(t){e.prototype._onBatchCreated.call(this,t);for(var n=this._children.length,i=0;i<n;++i)this._children[i]._onBatchCreated(t);hT(this)},t.getPosition=function(e){return Un.copy(e||new Un,Un.ZERO)},t.getRotation=function(e){return qn.copy(e||new qn,qn.IDENTITY)},t.getScale=function(e){return Un.copy(e||new Un,Un.ONE)},t.getWorldPosition=function(e){return Un.copy(e||new Un,Un.ZERO)},t.getWorldRotation=function(e){return qn.copy(e||new qn,qn.IDENTITY)},t.getWorldScale=function(e){return Un.copy(e||new Un,Un.ONE)},t.getWorldMatrix=function(e){return ei.copy(e||new ei,ei.IDENTITY)},t.getWorldRS=function(e){return ei.copy(e||new ei,ei.IDENTITY)},t.getWorldRT=function(e){return ei.copy(e||new ei,ei.IDENTITY)},t.updateWorldTransform=function(){},t._instantiate=function(){},t._load=function(){this._inited||(this._onBatchCreated(i),this._inited=!0),this.walk(wC._setScene)},t._activate=function(e){e=!1!==e,c.director._nodeActivator.activateNode(this,e),this._globals.activate()},Z(n,[{key:"position",get:function(){return Un.ZERO}},{key:"worldPosition",get:function(){return Un.ZERO}},{key:"rotation",get:function(){return qn.IDENTITY}},{key:"worldRotation",get:function(){return qn.IDENTITY}},{key:"scale",get:function(){return Un.ONE}},{key:"worldScale",get:function(){return Un.ONE}},{key:"eulerAngles",get:function(){return Un.ZERO}},{key:"worldMatrix",get:function(){return ei.IDENTITY}}]),n}(wC)).prototype,"globals",[Nh],Object.getOwnPropertyDescriptor(ab.prototype,"globals"),ab.prototype),sb=se(ab.prototype,"autoReleaseAssets",[Sh,Nh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),cb=se(ab.prototype,"_globals",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new lb}}),ob=ab))||ob);function _b(e,t){if(!t){var n=c.director.getScene();if(!n)return null;t=n}return t.getChildByPath(e)}c.Scene=hb,c.find=_b,A_.Flags.HideInHierarchy;var fb=e("ci",vh("cc.PrivateNode")(ub=function(e){function t(t){return e.call(this,t)||this}return $(t,e),t}(FC))||ub);c.PrivateNode=fb;var mb=vt.fastRemoveAt,db=A_.Flags.IsStartCalled,pb=A_.Flags.IsOnEnableCalled;function vb(e,t){for(var n=t.constructor._executionOrder,i=t._id,r=0,o=e.length-1,a=o>>>1;r<=o;a=r+o>>>1){var s=e[a],c=s.constructor._executionOrder;if(c>n)o=a-1;else if(c<n)r=a+1;else{var l=s._id;if(l>i)o=a-1;else{if(!(l<i))return a;r=a+1}}}return~r}function gb(e,t){for(var n=e.array,i=e.i+1;i<n.length;){var r=n[i];r._enabled&&r.node._activeInHierarchy?++i:(e.removeAt(i),t&&(r._objFlags&=~t))}}A_.Flags.IsEditorOnEnableCalled;var yb=function(e){this._zero=void 0,this._neg=void 0,this._pos=void 0,this._invoke=void 0;var t=Ce;this._zero=new t([]),this._neg=new t([]),this._pos=new t([]),this._invoke=e};function xb(e,t){return e.constructor._executionOrder-t.constructor._executionOrder}yb.stableRemoveInactive=gb;var Eb=function(e){function t(){return e.apply(this,arguments)||this}$(t,e);var n=t.prototype;return n.add=function(e){var t=e.constructor._executionOrder;(0===t?this._zero:t<0?this._neg:this._pos).array.push(e)},n.remove=function(e){var t=e.constructor._executionOrder;(0===t?this._zero:t<0?this._neg:this._pos).fastRemove(e)},n.cancelInactive=function(e){gb(this._zero,e),gb(this._neg,e),gb(this._pos,e)},n.invoke=function(){var e=this._neg;e.array.length>0&&(e.array.sort(xb),this._invoke(e),e.array.length=0),this._invoke(this._zero),this._zero.array.length=0;var t=this._pos;t.array.length>0&&(t.array.sort(xb),this._invoke(t),t.array.length=0)},t}(yb),Sb=function(e){function t(){return e.apply(this,arguments)||this}$(t,e);var n=t.prototype;return n.add=function(e){var t=e.constructor._executionOrder;if(0===t)this._zero.array.push(e);else{var n=t<0?this._neg.array:this._pos.array,i=vb(n,e);i<0&&n.splice(~i,0,e)}},n.remove=function(e){var t=e.constructor._executionOrder;if(0===t)this._zero.fastRemove(e);else{var n=t<0?this._neg:this._pos,i=vb(n.array,e);i>=0&&n.removeAt(i)}},n.invoke=function(e){this._neg.array.length>0&&this._invoke(this._neg,e),this._invoke(this._zero,e),this._pos.array.length>0&&this._invoke(this._pos,e)},t}(yb);function Tb(e,t,n){var i="var a=it.array;for(it.i=0;it.i<a.length;++it.i){var c=a[it.i];"+e+"}",r=t?Function("it","dt",i):Function("it",i);return function(e,t,n){return function(i,r){try{t(i,r)}catch(t){c._throw(t);var o=i.array;for(n&&(o[i.i]._objFlags|=n),++i.i;i.i<o.length;++i.i)try{e(o[i.i],r)}catch(e){c._throw(e),n&&(o[i.i]._objFlags|=n)}}}}(Function("c","dt",e),r,n)}var Ab=Tb("c.start();c._objFlags|="+db,!1,db),Cb=Tb("c.update(dt)",!0),wb=Tb("c.lateUpdate(dt)",!0),Ib=function(e){var t=c.director._compScheduler,n=e.array;for(e.i=0;e.i<n.length;++e.i){var i=n[e.i];i._enabled&&(i.onEnable(),!i.node._activeInHierarchy||t._onEnabled(i))}},bb=function(){function e(){this._deferredComps=[],this.unscheduleAll()}var t=e.prototype;return t.unscheduleAll=function(){this.startInvoker=new Eb(Ab),this.updateInvoker=new Sb(Cb),this.lateUpdateInvoker=new Sb(wb),this._updating=!1},t._onEnabled=function(e){c.director.getScheduler().resumeTarget(e),e._objFlags|=pb,this._updating?this._deferredComps.push(e):this._scheduleImmediate(e)},t._onDisabled=function(e){c.director.getScheduler().pauseTarget(e),e._objFlags&=~pb;var t=this._deferredComps.indexOf(e);t>=0?mb(this._deferredComps,t):(!e.start||e._objFlags&db||this.startInvoker.remove(e),e.update&&this.updateInvoker.remove(e),e.lateUpdate&&this.lateUpdateInvoker.remove(e))},t.enableComp=function(e,t){if(!(e._objFlags&pb)){if(e.onEnable){if(t)return void t.add(e);if(e.onEnable(),!e.node._activeInHierarchy)return}this._onEnabled(e)}},t.disableComp=function(e){e._objFlags&pb&&(e.onDisable&&e.onDisable(),this._onDisabled(e))},t.startPhase=function(){this._updating=!0,this.startInvoker.invoke(),this._startForNewComps()},t.updatePhase=function(e){this.updateInvoker.invoke(e)},t.lateUpdatePhase=function(e){this.lateUpdateInvoker.invoke(e),this._updating=!1,this._startForNewComps()},t._startForNewComps=function(){this._deferredComps.length>0&&(this._deferredSchedule(),this.startInvoker.invoke())},t._scheduleImmediate=function(e){"function"!=typeof e.start||e._objFlags&db||this.startInvoker.add(e),"function"==typeof e.update&&this.updateInvoker.add(e),"function"==typeof e.lateUpdate&&this.lateUpdateInvoker.add(e)},t._deferredSchedule=function(){for(var e=this._deferredComps,t=0,n=e.length;t<n;t++)this._scheduleImmediate(e[t]);e.length=0},e}(),Rb=A_.Flags.IsPreloadStarted,Ob=A_.Flags.IsOnLoadStarted,Nb=A_.Flags.IsOnLoadCalled,Pb=A_.Flags.Deactivating,Mb=function(e){function t(){return e.apply(this,arguments)||this}$(t,e);var n=t.prototype;return n.add=function(e){this._zero.array.push(e)},n.remove=function(e){this._zero.fastRemove(e)},n.cancelInactive=function(e){yb.stableRemoveInactive(this._zero,e)},n.invoke=function(){this._invoke(this._zero),this._zero.array.length=0},t}(yb),Db=Tb("c.__preload();"),Lb=Tb("c.onLoad();c._objFlags|="+Nb,!1,Nb),Fb=new pt(4);function zb(e,t,n){t?e._removeComponent(t):vt.removeAt(e._components,n)}Fb.get=function(){var e=this._get()||{preload:new Mb(Db),onLoad:new Eb(Lb),onEnable:new Eb(Ib)};e.preload._zero.i=-1;var t=e.onLoad;return t._zero.i=-1,t._neg.i=-1,t._pos.i=-1,(t=e.onEnable)._zero.i=-1,t._neg.i=-1,t._pos.i=-1,e};var Bb=e("fu",function(){function e(){this.resetComp=void 0,this.reset()}var t=e.prototype;return t.reset=function(){this._activatingStack=[]},t.activateNode=function(e,t){if(t){var n=Fb.get();this._activatingStack.push(n),this._activateNodeRecursively(e,n.preload,n.onLoad,n.onEnable),n.preload.invoke(),n.onLoad.invoke(),n.onEnable.invoke(),this._activatingStack.pop(),Fb.put(n)}else{this._deactivateNodeRecursively(e);for(var i,r=oe(this._activatingStack);!(i=r()).done;){var o=i.value;o.preload.cancelInactive(Rb),o.onLoad.cancelInactive(Ob),o.onEnable.cancelInactive()}}e.emit("active-in-hierarchy-changed",e)},t.activateComp=function(e,t,n,i){if(w_(e,!0)&&(e._objFlags&Rb||(e._objFlags|=Rb,e.__preload&&(t?t.add(e):e.__preload())),e._objFlags&Ob||(e._objFlags|=Ob,e.onLoad?n?n.add(e):(e.onLoad(),e._objFlags|=Nb):e._objFlags|=Nb),e._enabled)){if(!e.node._activeInHierarchy)return;c.director._compScheduler.enableComp(e,i)}},t.destroyComp=function(e){c.director._compScheduler.disableComp(e),e.onDestroy&&e._objFlags&Nb&&e.onDestroy()},t._activateNodeRecursively=function(e,t,n,i){if(e._objFlags&Pb)R(3816,e.name);else{e._activeInHierarchy=!0;for(var r=e._components.length,o=0;o<r;++o){var a=e._components[o];a instanceof c.Component?this.activateComp(a,t,n,i):(zb(e,a,o),--o,--r)}e._childArrivalOrder=e._children.length;for(var s=0,l=e._children.length;s<l;++s){var u=e._children[s];u._active&&this._activateNodeRecursively(u,t,n,i)}e._onPostActivated(!0)}},t._deactivateNodeRecursively=function(e){e._objFlags|=Pb,e._activeInHierarchy=!1;for(var t=e._components.length,n=0;n<t;++n){var i=e._components[n];if(i._enabled&&(c.director._compScheduler.disableComp(i),e._activeInHierarchy))return void(e._objFlags&=~Pb)}for(var r=0,o=e._children.length;r<o;++r){var a=e._children[r];if(a._activeInHierarchy&&(this._deactivateNodeRecursively(a),e._activeInHierarchy))return void(e._objFlags&=~Pb)}e._onPostActivated(!1),e._objFlags&=~Pb},e}()),Ub=e("bZ",function(e){function t(){var t;return(t=e.call(this)||this)._compScheduler=void 0,t._nodeActivator=void 0,t._invalid=void 0,t._paused=void 0,t._purgeDirectorInNextLoop=void 0,t._root=void 0,t._loadingScene=void 0,t._scene=void 0,t._totalFrames=void 0,t._lastUpdate=void 0,t._deltaTime=void 0,t._startTime=void 0,t._scheduler=void 0,t._systems=void 0,t._invalid=!1,t._paused=!1,t._purgeDirectorInNextLoop=!1,t._root=null,t._loadingScene="",t._scene=null,t._totalFrames=0,t._lastUpdate=0,t._deltaTime=0,t._startTime=0,t._scheduler=new IA,t._compScheduler=new bb,t._nodeActivator=new Bb,t._systems=[],c.game.once(iA.EVENT_RENDERER_INITED,t._initOnRendererInitialized,ie(t)),t}$(t,e);var n=t.prototype;return n.calculateDeltaTime=function(e){e||(e=performance.now()),this._deltaTime=e>this._lastUpdate?(e-this._lastUpdate)/1e3:0,this._lastUpdate=e},n.convertToGL=function(e){var t=c.game.container,n=c.view,i=t.getBoundingClientRect(),r=i.left+window.pageXOffset-t.clientLeft,o=i.top+window.pageYOffset-t.clientTop,a=n._devicePixelRatio*(e.x-r),s=n._devicePixelRatio*(o+i.height-e.y);return n._isRotated?si(n._viewportRect.width-s,a):si(a,s)},n.convertToUI=function(e){var t=c.game.container,n=c.view,i=t.getBoundingClientRect(),r=i.left+window.pageXOffset-t.clientLeft,o=i.top+window.pageYOffset-t.clientTop,a=si(0,0);return n._isRotated?(a.x=r+e.y/n._devicePixelRatio,a.y=o+i.height-(n._viewportRect.width-e.x)/n._devicePixelRatio):(a.x=r+e.x*n._devicePixelRatio,a.y=o+i.height-e.y*n._devicePixelRatio),a},n.end=function(){this._purgeDirectorInNextLoop=!0},n.getWinSize=function(){return _i(c.winSize)},n.getWinSizeInPixels=function(){return _i(c.winSize)},n.pause=function(){this._paused||(this._paused=!0)},n.purgeCachedData=function(){c.assetManager.releaseAll()},n.purgeDirector=function(){this._scheduler.unscheduleAll(),this._compScheduler.unscheduleAll(),this._nodeActivator.reset(),XT&&XT.setEnabled(!1),c.isValid(this._scene)&&this._scene.destroy(),this._scene=null,this.stopAnimation(),c.assetManager.releaseAll()},n.reset=function(){this.purgeDirector(),this.emit(t.EVENT_RESET),XT&&XT.setEnabled(!0),this.startAnimation()},n.runSceneImmediate=function(e,t,n){e instanceof YA&&(e=e.scene),P(e instanceof hb,1216),e._load();for(var i=Object.keys(c.game._persistRootNodes).map((function(e){return c.game._persistRootNodes[e]})),r=0;r<i.length;r++){var o=i[r];o.emit(c.Node.SCENE_CHANGED_FOR_PERSISTS,e.renderScene);var a=e.getChildByUuid(o.uuid);if(a){var s=a.getSiblingIndex();a._destroyImmediate(),e.insertChild(o,s)}else o.parent=e}var l=this._scene;c.isValid(l)&&l.destroy(),c.assetManager._releaseManager._autoRelease(l,e,i),this._scene=null,A_._deferredDestroy(),t&&t(),this.emit(c.Director.EVENT_BEFORE_SCENE_LAUNCH,e),this._scene=e,e._activate(),this._root&&this._root.resetCumulativeTime(),this.startAnimation(),n&&n(null,e),this.emit(c.Director.EVENT_AFTER_SCENE_LAUNCH,e)},n.runScene=function(e,t,n){var i=this;e instanceof YA&&(e=e.scene),P(e,1205),P(e instanceof hb,1216),e._load(),this.once(c.Director.EVENT_AFTER_DRAW,(function(){i.runSceneImmediate(e,t,n)}))},n.loadScene=function(e,t,n){var i=this;if(this._loadingScene)return I(1208,e,this._loadingScene),!1;var r=c.assetManager.bundles.find((function(t){return t.getSceneInfo(e)}));return r?(this.emit(c.Director.EVENT_BEFORE_SCENE_LOADING,e),this._loadingScene=e,console.time("LoadScene "+e),r.loadScene(e,(function(r,o){console.timeEnd("LoadScene "+e),i._loadingScene="",r?(y(r),t&&t(r)):i.runSceneImmediate(o,n,t)})),!0):(R(1209,e),!1)},n.preloadScene=function(e,t,n){var i=c.assetManager.bundles.find((function(t){return t.getSceneInfo(e)}));if(i)i.preloadScene(e,null,t,n);else{var r='Can not preload the scene "'+e+'" because it is not in the build settings.';n&&n(new Error(r)),y("preloadScene: "+r)}},n.resume=function(){this._paused&&(this._lastUpdate=performance.now(),this._lastUpdate||C(1200),this._paused=!1,this._deltaTime=0)},n.setDepthTest=function(e){c.Camera.main&&(c.Camera.main.depth=!!e)},n.setClearColor=function(e){c.Camera.main&&(c.Camera.main.backgroundColor=e)},n.getRunningScene=function(){return this._scene},n.getScene=function(){return this._scene},n.getAnimationInterval=function(){return 1e3/c.game.getFrameRate()},n.setAnimationInterval=function(e){c.game.setFrameRate(Math.round(1e3/e))},n.getDeltaTime=function(){return this._deltaTime},n.getTotalTime=function(){return performance.now()-this._startTime},n.getCurrentTime=function(){return this._lastUpdate},n.getTotalFrames=function(){return this._totalFrames},n.isPaused=function(){return this._paused},n.getScheduler=function(){return this._scheduler},n.setScheduler=function(e){this._scheduler!==e&&(this.unregisterSystem(this._scheduler),this._scheduler=e,this.registerSystem(IA.ID,e,200))},n.registerSystem=function(e,t,n){t.id=e,t.priority=n,t.init(),this._systems.push(t),this._systems.sort(EA.sortByPriority)},n.unregisterSystem=function(e){vt.fastRemove(this._systems,e),this._systems.sort(EA.sortByPriority)},n.getSystem=function(e){return this._systems.find((function(t){return t.id===e}))},n.getAnimationManager=function(){return this.getSystem(c.AnimationManager.ID)},n.startAnimation=function(){this._invalid=!1,this._lastUpdate=performance.now()},n.stopAnimation=function(){this._invalid=!0},n.mainLoop=function(e){if(this._purgeDirectorInNextLoop)this._purgeDirectorInNextLoop=!1,this.purgeDirector();else if(!this._invalid){this.calculateDeltaTime(e);var n=this._deltaTime;if(!this._paused){this.emit(t.EVENT_BEFORE_UPDATE),this._compScheduler.startPhase(),this._compScheduler.updatePhase(n);for(var i=0;i<this._systems.length;++i)this._systems[i].update(n);this._compScheduler.lateUpdatePhase(n),this.emit(t.EVENT_AFTER_UPDATE),A_._deferredDestroy();for(var r=0;r<this._systems.length;++r)this._systems[r].postUpdate(n)}this.emit(t.EVENT_BEFORE_DRAW),this._root.frameMove(this._deltaTime),this.emit(t.EVENT_AFTER_DRAW),XT.frameUpdateListeners(),FC.bookOfChange.clear(),this._totalFrames++}},n._initOnRendererInitialized=function(){this._totalFrames=0,this._lastUpdate=performance.now(),this._startTime=this._lastUpdate,this._paused=!1,this._purgeDirectorInNextLoop=!1,XT&&XT.setEnabled(!0),this.registerSystem(IA.ID,this._scheduler,200),this.emit(t.EVENT_INIT)},n._init=function(){return this._root=new RA(c.game._gfxDevice),this._root.initialize({}).catch((function(e){return R(1217),Promise.reject(e)}))},Z(t,[{key:"root",get:function(){return this._root}}]),t}(G_));Ub.EVENT_INIT="director_init",Ub.EVENT_RESET="director_reset",Ub.EVENT_BEFORE_SCENE_LOADING="director_before_scene_loading",Ub.EVENT_BEFORE_SCENE_LAUNCH="director_before_scene_launch",Ub.EVENT_AFTER_SCENE_LAUNCH="director_after_scene_launch",Ub.EVENT_BEFORE_UPDATE="director_before_update",Ub.EVENT_AFTER_UPDATE="director_after_update",Ub.EVENT_BEFORE_DRAW="director_before_draw",Ub.EVENT_AFTER_DRAW="director_after_draw",Ub.EVENT_BEFORE_COMMIT="director_before_commit",Ub.EVENT_BEFORE_PHYSICS="director_before_physics",Ub.EVENT_AFTER_PHYSICS="director_after_physics",Ub.instance=void 0,c.Director=Ub;var Gb=e("bY",Ub.instance=c.director=new Ub),Hb=function(){function e(){this.name="",this.base="",this.importBase="",this.nativeBase="",this.deps=null,this.assetInfos=new Xh,this.scenes=new Xh,this.paths=new Xh}var t=e.prototype;return t.init=function(e){!function(e){var t=e.uuids,n=e.paths,i=e.types,r=e.deps,o=e.paths=Object.create(null);if(!1===e.debug){for(var a=0,s=t.length;a<s;a++)t[a]=h_(t[a]);for(var c in n){var l=n[c],u=l[1];l[1]=i[u]}}else{for(var h=Object.create(null),_=0,f=t.length;_<f;_++){var m=t[_];t[_]=h[m]=h_(m)}t=h}for(var d in n){var p=n[d];o[t[d]]=p}var v=e.scenes;for(var g in v){var y=v[g];v[g]=t[y]}var x=e.packs;for(var E in x)for(var S=x[E],T=0;T<S.length;++T)S[T]=t[S[T]];var A=e.versions;if(A)for(var C in A)for(var w=A[C],I=0;I<w.length;I+=2){var b=w[I];w[I]=t[b]||b}var R=e.redirect;if(R)for(var O=0;O<R.length;O+=2)R[O]=t[R[O]],R[O+1]=r[R[O+1]]}(e),this.importBase=e.importBase||"",this.nativeBase=e.nativeBase||"",this.base=e.base||"",this.name=e.name||"",this.deps=e.deps||[],this._initUuid(e.uuids),this._initPath(e.paths),this._initScene(e.scenes),this._initPackage(e.packs),this._initVersion(e.versions),this._initRedirect(e.redirect)},t.getInfoWithPath=function(e,t){if(!e)return null;e=p_(e);var n=this.paths.get(e);if(n){if(!t)return n[0];for(var i=0,r=n.length;i<r;i++){var o=n[i];if(gt.isChildClassOf(o.ctor,t))return o}}return null},t.getDirWithPath=function(e,t,n){"/"===(e=p_(e))[e.length-1]&&(e=e.slice(0,-1));var i=n||[];return this.paths.forEach((function(n,r){if(r.startsWith(e)&&function(e,t){return!(e.length>t.length)||47===e.charCodeAt(t.length)}(r,e)||!e)for(var o=0,a=n.length;o<a;o++){var s=n[o];t&&!gt.isChildClassOf(s.ctor,t)||i.push(s)}})),i},t.getAssetInfo=function(e){return this.assetInfos.get(e)||null},t.getSceneInfo=function(e){return e.endsWith(".scene")||(e+=".scene"),"/"===e[0]||e.startsWith("db://")||(e="/"+e),this.scenes.find((function(t,n){return n.endsWith(e)}))},t.destroy=function(){this.paths.destroy(),this.scenes.destroy(),this.assetInfos.destroy()},t._initUuid=function(e){if(e){this.assetInfos.clear();for(var t=0,n=e.length;t<n;t++){var i=e[t];this.assetInfos.add(i,{uuid:i})}}},t._initPath=function(e){if(e){var t=this.paths;for(var n in t.clear(),e){var i=e[n],r=i[0],o=i[1],a=3===i.length,s=this.assetInfos.get(n);s.path=r,s.ctor=gt._getClassById(o),t.has(r)?a?t.get(r).push(s):t.get(r).splice(0,0,s):t.add(r,[s])}}},t._initScene=function(e){if(e){var t=this.scenes;t.clear();var n=this.assetInfos;for(var i in e){var r=e[i],o=n.get(r);o.url=i,t.add(i,o)}}},t._initPackage=function(e){if(e){var t=this.assetInfos;for(var n in e){var i=e[n],r={uuid:n,packedUuids:i,ext:".json"};t.add(n,r);for(var o=0,a=i.length;o<a;o++){var s=i[o],c=t.get(s),l=c.packs;l?1===a?l.splice(0,0,r):l.push(r):c.packs=[r]}}}},t._initVersion=function(e){if(e){var t=this.assetInfos,n=e.import;if(n)for(var i=0,r=n.length;i<r;i+=2){var o=n[i];t.get(o).ver=n[i+1]}if(n=e.native)for(var a=0,s=n.length;a<s;a+=2){var c=n[a];t.get(c).nativeVer=n[a+1]}}},t._initRedirect=function(e){if(e)for(var t=this.assetInfos,n=0,i=e.length;n<i;n+=2){var r=e[n];t.get(r).redirect=e[n+1]}},e}();function kb(e,t){e._uuid&&t.push(e._uuid)}function Vb(e,t){for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++){var r=n[i];if("node"!==r&&"__eventTargets"!==r){var o=e[r];if("object"==typeof o&&o)if(Array.isArray(o))for(var a=0;a<o.length;a++){var s=o[a];s instanceof H_&&kb(s,t)}else if(o.constructor&&o.constructor!==Object)o instanceof H_&&kb(o,t);else for(var c=Object.getOwnPropertyNames(o),l=0;l<c.length;l++){var u=o[c[l]];u instanceof H_&&kb(u,t)}}}}function jb(e,t,n,i){n.push(e._uuid);for(var r=fm.getDeps(e._uuid),o=0,a=r.length;o<a;o++){var s=Zh.get(r[o]);if(s){var c=s._uuid;c in t?t[c]+=i:t[c]=s.refCount+i,n.includes(c)||jb(s,t,n,i)}}}var Wb=[],qb=new(function(){function e(){this._persistNodeDeps=new Xh,this._toDelete=new Xh,this._eventListener=!1}var t=e.prototype;return t.init=function(){this._persistNodeDeps.clear(),this._toDelete.clear()},t._addPersistNodeRef=function(e){var t=[];!function e(t,n){for(var i=0;i<t._components.length;i++)Vb(t._components[i],n);for(var r=0;r<t._children.length;r++)e(t._children[r],n)}(e,t);for(var n=0,i=t.length;n<i;n++){var r=Zh.get(t[n]);r&&r.addRef()}this._persistNodeDeps.add(e.uuid,t)},t._removePersistNodeRef=function(e){if(this._persistNodeDeps.has(e.uuid)){for(var t=this._persistNodeDeps.get(e.uuid),n=0,i=t.length;n<i;n++){var r=Zh.get(t[n]);r&&r.decRef()}this._persistNodeDeps.remove(e.uuid)}},t._autoRelease=function(e,t,n){if(e){for(var i=fm.getDeps(e.uuid),r=0,o=i.length;r<o;r++){var a=Zh.get(i[r]);a&&a.decRef(e.autoReleaseAssets)}var s=fm._depends.get(e.uuid);if(s&&s.persistDeps)for(var c=s.persistDeps,l=0,u=c.length;l<u;l++){var h=Zh.get(c[l]);h&&h.decRef(e.autoReleaseAssets)}e.uuid!==t.uuid&&fm.remove(e.uuid)}var _=fm._depends.get(t.uuid);_&&(_.persistDeps=[]);for(var f=0,m=n.length;f<m;f++){for(var d,p,v=n[f],g=this._persistNodeDeps.get(v.uuid),y=oe(g);!(p=y()).done;){var x=p.value,E=Zh.get(x);E&&E.addRef()}_&&(d=_.persistDeps).push.apply(d,g)}},t.tryRelease=function(e,t){void 0===t&&(t=!1),e instanceof H_&&(t?this._free(e,t):(this._toDelete.add(e._uuid,e),this._eventListener||(this._eventListener=!0,Lt(this._freeAssets.bind(this)))))},t._freeAssets=function(){var e=this;this._eventListener=!1,this._toDelete.forEach((function(t){e._free(t)})),this._toDelete.clear()},t._free=function(e,t){void 0===t&&(t=!1);var n=e._uuid;if(this._toDelete.remove(n),w_(e,!0)&&!(!t&&e.refCount>0&&function(e){var t=Object.create(null);if(t[e._uuid]=e.refCount,jb(e,t,Wb,-1),Wb.length=0,0!==t[e._uuid])return t[e._uuid];for(var n in t)0!==t[n]&&jb(Zh.get(n),t,Wb,1);return Wb.length=0,t[e._uuid]}(e)>0)){Zh.remove(n);for(var i=fm.getDeps(n),r=0,o=i.length;r<o;r++){var a=Zh.get(i[r]);a&&(a.decRef(!1),this._free(a,!1))}e.destroy(),fm.remove(n)}},e}()),Yb=null;function Xb(e,t){for(var n=0,i=e.input.length;n<i;n++){var r=e.input[n];t&&!r.isNative&&r.content instanceof H_&&r.content.decRef(!1),r.recycle()}e.input=null}function Kb(e,t){return t?/\?/.test(e)?e+"&_t="+Date.now():e+"?_t="+Date.now():e}function Qb(e,t,n,r,o,a,s){try{var c=fm.parse(e,t),l=!0;if(t instanceof H_&&!t.__nativeDepend__&&(l=!1),o){for(var u=0,h=c.deps.length;u<h;u++){var _=c.deps[u];_ in n||(n[_]=!0,r.push({uuid:_,bundle:s&&s.name}))}l&&c.nativeDep&&(s&&(c.nativeDep.bundle=s.name),r.push(J({},c.nativeDep)))}else{a=!i&&(!!t.asyncLoadAssets||a&&!c.preventDeferredLoadDependents);for(var f=0,m=c.deps.length;f<m;f++){var d=c.deps[f];d in n||(n[d]=!0,r.push({uuid:d,__asyncLoadAssets__:a,bundle:s&&s.name}))}l&&!a&&!c.preventPreloadNativeObject&&c.nativeDep&&(s&&(c.nativeDep.bundle=s.name),r.push(J({},c.nativeDep)))}}catch(e){y(e.message,e.stack)}}function Zb(e,t,n){t&&(n=void 0!==n?n:c.assetManager.cacheAsset,!d_(t)&&n&&Zh.add(e,t))}function Jb(e,t,n){var i=!1,r=t.__depends__;if(r){for(var o=0,a=r.length;o<a;o++){var s=r[o],c=n[s.uuid+"@import"];c?s.owner[s.prop]=c.addRef():(y("The asset "+s.uuid+" is missing!"),i=!0)}t.__depends__=null}return t.__nativeDepend__&&(n[e+"@native"]?t._nativeAsset=n[e+"@native"]:i=!0,t.__nativeDepend__=!1),i}function $b(e,t,n){var i=0,r=[],o=e.length;0===o&&n&&n(r);for(var a=function(e){e&&r.push(e),++i===o&&n&&n(r)},s=0;s<o;s++)t(e[s],a)}function eR(e,t,n){var i=e,r=t,o=n;if(void 0===n){var a="function"==typeof e;t?(o=t,a||(r=null)):void 0===t&&a&&(o=e,i=null,r=null),void 0!==t&&a&&(r=e,i=null)}return{options:i||Object.create(null),onProgress:r,onComplete:o}}function tR(e,t,n){var i=e,r=t,o=n;if(void 0===n){var a=gt.isChildClassOf(e,H_);t?(o=t,a&&(r=null)):void 0!==t||a||(o=e,r=null,i=null),void 0===t||a||(r=e,i=null)}return{type:i,onProgress:r||Yb,onComplete:o}}function nR(e){return function(t,n){if(e){var i=[];Array.isArray(n)?n.forEach((function(e){return e instanceof H_&&i.push(e.addRef())})):n instanceof H_&&i.push(n.addRef()),Lt((function(){i.forEach((function(e){return e.decRef(!1)})),e(t,n)}))}}}var iR=function(){function e(){this._config=new Hb}var t=e.prototype;return t.getInfoWithPath=function(e,t){return this._config.getInfoWithPath(e,t)},t.getDirWithPath=function(e,t,n){return this._config.getDirWithPath(e,t,n)},t.getAssetInfo=function(e){return this._config.getAssetInfo(e)},t.getSceneInfo=function(e){return this._config.getSceneInfo(e)},t.init=function(e){this._config.init(e),e_.add(e.name,this)},t.load=function(e,t,n,i){var r=tR(t,n,i),o=r.type,a=r.onProgress,s=r.onComplete,l={__requestType__:Qh.PATH,type:o,bundle:this.name,__outputAsArray__:Array.isArray(e)};c.assetManager.loadAny(e,l,a,s)},t.preload=function(e,t,n,i){var r=tR(t,n,i),o=r.type,a=r.onProgress,s=r.onComplete;c.assetManager.preloadAny(e,{__requestType__:Qh.PATH,type:o,bundle:this.name},a,s)},t.loadDir=function(e,t,n,i){var r=tR(t,n,i),o=r.type,a=r.onProgress,s=r.onComplete;c.assetManager.loadAny(e,{__requestType__:Qh.DIR,type:o,bundle:this.name,__outputAsArray__:!0},a,s)},t.preloadDir=function(e,t,n,i){var r=tR(t,n,i),o=r.type,a=r.onProgress,s=r.onComplete;c.assetManager.preloadAny(e,{__requestType__:Qh.DIR,type:o,bundle:this.name},a,s)},t.loadScene=function(e,t,n,i){var r=eR(t,n,i),o=r.options,a=r.onProgress,s=r.onComplete;o.preset=o.preset||"scene",o.bundle=this.name,c.assetManager.loadAny({scene:e},o,a,(function(e,t){if(e)y(e.message,e.stack);else if(t instanceof YA&&t.scene){var n=t.scene;n._id=t._uuid,n.name=t.name}else e=new Error("The asset "+t._uuid+" is not a scene");s&&s(e,t)}))},t.preloadScene=function(e,t,n,i){var r=eR(t,n,i),o=r.options,a=r.onProgress,s=r.onComplete;o.bundle=this.name,c.assetManager.preloadAny({scene:e},o,a,(function(t){t&&R(1210,e,t.message),s&&s(t)}))},t.get=function(e,t){var n=this.getInfoWithPath(e,t);return n&&Zh.get(n.uuid)||null},t.release=function(e,t){var n=this.get(e,t);n&&qb.tryRelease(n,!0)},t.releaseUnusedAssets=function(){var e=this;Zh.forEach((function(t){var n=e.getAssetInfo(t._uuid);n&&!n.redirect&&qb.tryRelease(t)}))},t.releaseAll=function(){var e=this;Zh.forEach((function(t){var n=e.getAssetInfo(t._uuid);n&&!n.redirect&&qb.tryRelease(t,!0)}))},t._destroy=function(){this._config.destroy()},Z(e,[{key:"config",get:function(){return this._config}},{key:"name",get:function(){return this._config.name}},{key:"deps",get:function(){return this._config.deps}},{key:"base",get:function(){return this._config.base}}]),e}(),rR=e("fo",new iR);function oR(e,t,n){var i=new Image;function r(){i.removeEventListener("load",r),i.removeEventListener("error",o),n&&n(null,i)}function o(){i.removeEventListener("load",r),i.removeEventListener("error",o),n&&n(new Error(M(4930,e)))}return"file:"!==window.location.protocol&&(i.crossOrigin="anonymous"),i.addEventListener("load",r),i.addEventListener("error",o),i.src=e,i}function aR(e,t,n,i){var r=new XMLHttpRequest,o="download failed: "+e+", status: ";if(r.open("GET",e,!0),void 0!==t.xhrResponseType&&(r.responseType=t.xhrResponseType),void 0!==t.xhrWithCredentials&&(r.withCredentials=t.xhrWithCredentials),void 0!==t.xhrMimeType&&r.overrideMimeType&&r.overrideMimeType(t.xhrMimeType),void 0!==t.xhrTimeout&&(r.timeout=t.xhrTimeout),t.xhrHeader)for(var a in t.xhrHeader)r.setRequestHeader(a,t.xhrHeader[a]);return r.onload=function(){200===r.status||0===r.status?i&&i(null,r.response):i&&i(new Error(""+o+r.status+"(no response)"))},n&&(r.onprogress=function(e){e.lengthComputable&&n(e.loaded,e.total)}),r.onerror=function(){i&&i(new Error(""+o+r.status+"(error)"))},r.ontimeout=function(){i&&i(new Error(""+o+r.status+"(time out)"))},r.onabort=function(){i&&i(new Error(""+o+r.status+"(abort)"))},r.send(null),r}c.resources=rR;var sR={};function cR(e,t,n){if(sR[e])return n&&n(null),null;var i=document.createElement("script");function r(){i.parentNode.removeChild(i),i.removeEventListener("load",r,!1),i.removeEventListener("error",o,!1),sR[e]=!0,n&&n(null)}function o(){i.parentNode.removeChild(i),i.removeEventListener("load",r,!1),i.removeEventListener("error",o,!1),n&&n(new Error(M(4928,e)))}return"file:"!==window.location.protocol&&(i.crossOrigin="anonymous"),i.async=t.scriptAsyncLoading||!1,i.src=e,i.addEventListener("load",r,!1),i.addEventListener("error",o,!1),document.body.appendChild(i),i}var lR=/^(?:\w+:\/\/|\.+\/).+/,uR=function(e,t,n){(Rv.capabilities.imageBitmap&&c.assetManager.allowImageBitmap?hR:oR)(e,t,n)},hR=function(e,t,n){t.xhrResponseType="blob",aR(e,t,t.onFileProgress,n)},_R=function(e,t,n){t.xhrResponseType="json",aR(e,t,t.onFileProgress,n)},fR=function(e,t,n){t.xhrResponseType="arraybuffer",aR(e,t,t.onFileProgress,n)},mR=function(e,t,n){t.xhrResponseType="text",aR(e,t,t.onFileProgress,n)},dR=function(e,t,n){var i=V(e),r=e;lR.test(r)||(r=-1!==vR.remoteBundles.indexOf(i)?vR.remoteServerAddress+"remote/"+i:"assets/"+i);var o=t.version||vR.bundleVers[i],a=0,s=null,c=null;_R(r+"/config."+(o?o+".":"")+"json",t,(function(e,t){e&&(c=e),(s=t)&&(s.base=r+"/"),2==++a&&n(c,s)})),cR(r+"/index."+(o?o+".":"")+"js",t,(function(e){e?(c=e,2==++a&&n(e)):vR.importBundleEntry(i).then((function(){2==++a&&n(c,s)})).catch((function(e){c=e,2==++a&&n(c)}))}))},pR=function(){function e(){this.maxConcurrency=16,this.maxRequestsPerFrame=16,this.maxRetryCount=3,this.appendTimeStamp=!!i,this.limited=!i,this.retryInterval=2e3,this.bundleVers=null,this.remoteBundles=[],this.downloadDomImage=oR,this.downloadDomAudio=null,this.downloadFile=aR,this.downloadScript=cR,this._downloaders={".png":uR,".jpg":uR,".bmp":uR,".jpeg":uR,".gif":uR,".ico":uR,".tiff":uR,".webp":uR,".image":uR,".pvr":fR,".pkm":fR,".astc":fR,".txt":mR,".xml":mR,".vsh":mR,".fsh":mR,".atlas":mR,".tmx":mR,".tsx":mR,".json":_R,".ExportJson":_R,".plist":mR,".fnt":mR,".binary":fR,".bin":fR,".dbbin":fR,".skel":fR,".js":cR,bundle:dR,default:mR},this._downloading=new Xh,this._queue=[],this._queueDirty=!1,this._totalNum=0,this._totalNumThisPeriod=0,this._lastDate=-1,this._checkNextPeriod=!1,this._remoteServerAddress="",this._maxInterval=1/30}var n=e.prototype;return n.init=function(e,t,n){void 0===e&&(e=""),void 0===t&&(t={}),void 0===n&&(n=[]),this._downloading.clear(),this._queue.length=0,this._remoteServerAddress=e,this.bundleVers=t,this.remoteBundles=n},n.register=function(e,t){"object"==typeof e?$e(this._downloaders,e):this._downloaders[e]=t},n.importBundleEntry=function(e){return t.import("virtual:///prerequisite-imports/"+e)},n.download=function(e,t,n,i,r){var o=this,a=Jh.get(e);if(a)r(null,a);else{var s=this._downloading.get(e);if(s){s.push(r);var c=this._queue.find((function(t){return t.id===e}));if(!c)return;var l=i.priority||0;c.priority<l&&(c.priority=l,this._queueDirty=!0)}else{var u=void 0!==i.maxRetryCount?i.maxRetryCount:this.maxRetryCount,h=void 0!==i.maxConcurrency?i.maxConcurrency:this.maxConcurrency,_=void 0!==i.maxRequestsPerFrame?i.maxRequestsPerFrame:this.maxRequestsPerFrame,f=this._downloaders[n]||this._downloaders.default;!function e(t,n,i,r,o){void 0===o&&(o=0),t(o,(function(a,s){o++,!a||o>n?r&&r(a,s):setTimeout((function(){e(t,n,i,r,o)}),i)}))}((function(n,a){if(0===n&&o._downloading.add(e,[r]),o.limited){o._updateTime();var s=function(e,t){o._totalNum--,o._handleQueueInNextFrame(h,_),a(e,t)};o._totalNum<h&&o._totalNumThisPeriod<_?(f(Kb(t,o.appendTimeStamp),i,s),o._totalNum++,o._totalNumThisPeriod++):(o._queue.push({id:e,priority:i.priority||0,url:t,options:i,done:s,handler:f}),o._queueDirty=!0,o._totalNum<h&&o._handleQueueInNextFrame(h,_))}else f(Kb(t,o.appendTimeStamp),i,a)}),u,this.retryInterval,(function(t,n){t||Jh.add(e,n);for(var i=o._downloading.remove(e),r=0,a=i.length;r<a;r++)i[r](t,n)}))}}},n.loadSubpackage=function(e,t){c.assetManager.loadBundle(e,null,t)},n._updateTime=function(){var e=Date.now(),t=c.director.getDeltaTime(),n=t>this._maxInterval?this._maxInterval:t;e-this._lastDate>1e3*n&&(this._totalNumThisPeriod=0,this._lastDate=e)},n._handleQueue=function(e,t){for(this._checkNextPeriod=!1,this._updateTime();this._queue.length>0&&this._totalNum<e&&this._totalNumThisPeriod<t;){this._queueDirty&&(this._queue.sort((function(e,t){return e.priority-t.priority})),this._queueDirty=!1);var n=this._queue.pop();if(!n)break;this._totalNum++,this._totalNumThisPeriod++,n.handler(Kb(n.url,this.appendTimeStamp),n.options,n.done)}this._handleQueueInNextFrame(e,t)},n._handleQueueInNextFrame=function(e,t){!this._checkNextPeriod&&this._queue.length>0&&(Lt(this._handleQueue.bind(this),e,t),this._checkNextPeriod=!0)},Z(e,[{key:"remoteServerAddress",get:function(){return this._remoteServerAddress}}]),e}(),vR=e("cB",new pR);function gR(e,t,n,i){var r=null,o=null;try{(r=new J_)._nativeUrl=e,r._nativeAsset=t}catch(e){o=e}i(o,r)}function yR(e,t,n,i){var r=new $A;r.json=t,i(null,r)}function xR(e,t,n,i){var r=new JA;r.text=t,i(null,r)}function ER(e,t,n,i){var r=new DA;r._nativeUrl=e,r._nativeAsset=t,i(null,r)}function SR(e,t,n,i){var r=new H_;r._nativeUrl=e,r._nativeAsset=t,i(null,r)}function TR(e,t,n,i){var r=e_.get(t.name);r||(r=t.name===r_.RESOURCES?rR:new iR,t.base=t.base||e+"/",r.init(t)),i(null,r)}var AR=function(){function e(){this._creating=new Xh,this._producers={".png":gR,".jpg":gR,".bmp":gR,".jpeg":gR,".gif":gR,".ico":gR,".tiff":gR,".webp":gR,".image":gR,".pvr":gR,".pkm":gR,".txt":xR,".xml":xR,".vsh":xR,".fsh":xR,".atlas":xR,".tmx":xR,".tsx":xR,".fnt":xR,".json":yR,".ExportJson":yR,".binary":ER,".bin":ER,".dbbin":ER,".skel":ER,bundle:TR,default:SR}}var t=e.prototype;return t.register=function(e,t){"object"==typeof e?gt.mixin(this._producers,e):this._producers[e]=t},t.create=function(e,t,n,i,r){var o=this,a=this._producers[n]||this._producers.default,s=Zh.get(e);if(i.reloadAsset||!s){var c=this._creating.get(e);c?c.push(r):(this._creating.add(e,[r]),a(e,t,i,(function(t,n){!t&&n instanceof H_&&(n._uuid=e,Zb(e,n,i.cacheAsset));for(var r=o._creating.remove(e),a=0,s=r.length;a<s;a++)r[a](t,n)})))}else r(null,s)},e}(),CR=e("cC",new AR),wR=new(function(){function e(){this._loading=new Xh,this._unpackers={".json":this.unpackJson}}var t=e.prototype;return t.unpackJson=function(e,t,n,i){var r=gt.createMap(!0),o=null;if(Array.isArray(t)){(t=function(e){if(e[0]<1)throw new Error(M(5304,e[0]));Df(e,!0,void 0),Lf(e);for(var t=new Gf(e[0]),n=e[1],i=e[2],r=e[3],o=e[4],a=e[5],s=0;s<a.length;++s)a[s].unshift(t,n,i,r,o);return a}(t)).length!==e.length&&R(4915);for(var a=0;a<e.length;a++)r[e[a]+"@import"]=t[a]}else{var s=gt._getClassId(Rm);if(t.type===s&&t.data){var c=t.data;c.length!==e.length&&R(4915);for(var l=0;l<e.length;l++)r[e[l]+"@import"]=Hf(s,{base:c[l][0],mipmaps:c[l][1]})}else o=new Error("unmatched type pack!"),r=null}i(o,r)},t.init=function(){this._loading.clear()},t.register=function(e,t){"object"==typeof e?gt.mixin(this._unpackers,e):this._unpackers[e]=t},t.unpack=function(e,t,n,i,r){t?(0,this._unpackers[n])(e,t,i,r):r(new Error("package data is wrong!"))},t.load=function(e,t,n){var i=this;if(!e.isNative&&e.info&&e.info.packs)if(Jh.has(e.id))n(null,Jh.get(e.id));else{var r=e.info.packs,o=r.find((function(e){return i._loading.has(e.uuid)}));if(o)this._loading.get(o.uuid).push({onComplete:n,id:e.id});else{o=r[0],this._loading.add(o.uuid,[{onComplete:n,id:e.id}]);var a=v_(o.uuid,{ext:o.ext,bundle:e.config.name});vR.download(o.uuid,a,o.ext,e.options,(function(t,n){Jh.remove(o.uuid),t&&y(t.message,t.stack),i.unpack(o.packedUuids,n,o.ext,e.options,(function(e,n){if(!e)for(var r in n)Jh.add(r,n[r]);for(var a=i._loading.remove(o.uuid),s=0,c=a.length;s<c;s++){var l=a[s];if(t||e)l.onComplete(t||e);else{var u=n[l.id];u?l.onComplete(null,u):l.onComplete(new Error("can not retrieve data from package"))}}}))}))}}else vR.download(e.id,e.url,e.ext,e.options,n)},e}());function IR(e,t){var n=!1;e.progress||(e.progress={finish:0,total:e.input.length,canInvoke:!0},n=!0);var i=e.options,r=e.progress,o=[],a=r.total;i.__exclude__=i.__exclude__||Object.create(null),e.output=[],$b(e.input,(function(i,s){if(!i.isNative&&Zh.has(i.uuid)){var l=Zh.get(i.uuid);return l.addRef(),RR(i,e,l,null,l.__asyncLoadAssets__,o,a),void s()}wR.load(i,e.options,(function(l,u){l?e.isFinish||(!c.assetManager.force||n?(y(l.message,l.stack),r.canInvoke=!1,t(l)):RR(i,e,null,null,!1,o,a)):e.isFinish||RR(i,e,null,u,!i.isNative,o,a),s()}))}),(function(){if(e.isFinish)return Xb(e,!0),void e.dispatch("error");if(o.length>0){var a=a_.create({input:o,progress:r,options:i,onProgress:e.onProgress,onError:a_.prototype.recycle,onComplete:function(i){var r;i||((r=e.output).push.apply(r,a.output),a.recycle()),n&&bR(e),t(i)}});n_.async(a)}else n&&bR(e),t()}))}function bR(e){for(var t=e.output,n=0,i=t.length;n<i;n++)t[n].content&&t[n].content.decRef(!1)}function RR(e,t,n,i,r,o,a){var s=t.options.__exclude__,c=t.progress;e.content=n,e.file=i,t.output.push(e),r&&(s[e.uuid]=!0,Qb(e.uuid,i||n,s,o,!0,!1,e.config),c.total=a+o.length),c.canInvoke&&t.dispatch("progress",++c.finish,c.total,e)}var OR=new(function(e){function t(){return e.apply(this,arguments)||this}$(t,e);var n=t.prototype;return n.parse=function(e){var t=this._parseXML(e).documentElement;if("plist"!==t.tagName)return I(5100),{};for(var n=null,i=0,r=t.childNodes.length;i<r&&1!==(n=t.childNodes[i]).nodeType;i++);return this._parseNode(n)},n._parseNode=function(e){var t=null,n=e.tagName;if("dict"===n)t=this._parseDict(e);else if("array"===n)t=this._parseArray(e);else if("string"===n)if(1===e.childNodes.length)t=e.firstChild.nodeValue;else{t="";for(var i=0;i<e.childNodes.length;i++)t+=e.childNodes[i].nodeValue}else"false"===n?t=!1:"true"===n?t=!0:"real"===n?t=parseFloat(e.firstChild.nodeValue):"integer"===n&&(t=parseInt(e.firstChild.nodeValue,10));return t},n._parseArray=function(e){for(var t=[],n=0,i=e.childNodes.length;n<i;n++){var r=e.childNodes[n];1===r.nodeType&&t.push(this._parseNode(r))}return t},n._parseDict=function(e){for(var t={},n="",i=0,r=e.childNodes.length;i<r;i++){var o=e.childNodes[i];1===o.nodeType&&("key"===o.tagName?n=o.firstChild.nodeValue:t[n]=this._parseNode(o))}return t},t}(e("dx",function(){function e(){this._parser=null,window.DOMParser&&(this._parser=new DOMParser)}var t=e.prototype;return t.parse=function(e){return this._parseXML(e)},t._parseXML=function(e){if(this._parser)return this._parser.parseFromString(e,"text/xml");throw new Error("Dom parser is not supported in this platform!")},e}())));function NR(e,t){return e[t]<<8|e[t+1]}var PR=new(function(){function e(){this._parsing=new Xh,this._parsers={".png":this.parseImage,".jpg":this.parseImage,".bmp":this.parseImage,".jpeg":this.parseImage,".gif":this.parseImage,".ico":this.parseImage,".tiff":this.parseImage,".webp":this.parseImage,".image":this.parseImage,".pvr":this.parsePVRTex,".pkm":this.parsePKMTex,".astc":this.parseASTCTex,".mp3":this.parseAudio,".ogg":this.parseAudio,".wav":this.parseAudio,".m4a":this.parseAudio,".plist":this.parsePlist,import:this.parseImport}}var t=e.prototype;return t.parseImage=function(e,t,n){e instanceof HTMLImageElement?n(null,e):createImageBitmap(e,{premultiplyAlpha:"none"}).then((function(e){n(null,e)}),(function(e){n(e,null)}))},t.parseAudio=function(e,t,n){e instanceof ArrayBuffer?Rv.__audioSupport.context.decodeAudioData(e,(function(e){n(null,e)}),(function(e){n(new Error("Error with decoding audio data"+e.err),null)})):n(null,e)},t.parsePVRTex=function(e,t,n){var i=null,r=null;try{var o=e instanceof ArrayBuffer?e:e.buffer,a=new Int32Array(o,0,13);if(55727696===a[0]){var s=a[7],c=a[6],l=a[12]+52;r={_data:new Uint8Array(o,l),_compressed:!0,width:s,height:c,format:0}}else{if(559044176!==a[11])throw new Error("Invalid magic number in PVR header");var u=a[0],h=a[1],_=a[2];r={_data:new Uint8Array(o,u),_compressed:!0,width:_,height:h,format:0}}}catch(e){i=e}n(i,r)},t.parsePKMTex=function(e,t,n){var i=null,r=null;try{var o=e instanceof ArrayBuffer?e:e.buffer,a=new Uint8Array(o),s=NR(a,6);if(0!==s&&1!==s&&3!==s)throw new Error("Invalid magic number in ETC header");var c=NR(a,12),l=NR(a,14);NR(a,8),NR(a,10),r={_data:new Uint8Array(o,16),_compressed:!0,width:c,height:l,format:0}}catch(e){i=e}n(i,r)},t.parseASTCTex=function(e,t,n){var i=null,r=null;try{var o=e instanceof ArrayBuffer?e:e.buffer,a=new Uint8Array(o);if(1554098963!==a[0]+(a[1]<<8)+(a[2]<<16)+(a[3]<<24))throw new Error("Invalid magic number in ASTC header");var s=a[4],c=a[5],l=a[6];if((s<3||s>6||c<3||c>6||l<3||l>6)&&(s<4||7===s||9===s||11===s||s>12||c<4||7===c||9===c||11===c||c>12||1!==l))throw new Error("Invalid block number in ASTC header");var u=function(e,t){return 4===e?k_.RGBA_ASTC_4x4:5===e?4===t?k_.RGBA_ASTC_5x4:k_.RGBA_ASTC_5x5:6===e?5===t?k_.RGBA_ASTC_6x5:k_.RGBA_ASTC_6x6:8===e?5===t?k_.RGBA_ASTC_8x5:6===t?k_.RGBA_ASTC_8x6:k_.RGBA_ASTC_8x8:10===e?5===t?k_.RGBA_ASTC_10x5:6===t?k_.RGBA_ASTC_10x6:8===t?k_.RGBA_ASTC_10x8:k_.RGBA_ASTC_10x10:10===t?k_.RGBA_ASTC_12x10:k_.RGBA_ASTC_12x12}(s,c),h=a[7]+(a[8]<<8)+(a[9]<<16),_=a[10]+(a[11]<<8)+(a[12]<<16);a[13],a[14],a[15],r={_data:new Uint8Array(o,16),_compressed:!0,width:h,height:_,format:u}}catch(e){i=e}n(i,r)},t.parsePlist=function(e,t,n){var i=null,r=OR.parse(e);r||(i=new Error("parse failed")),n(i,r)},t.parseImport=function(e,t,n){if(e){var i=null,r=null;try{i=hm(e,t)}catch(e){r=e}n(r,i)}else n(new Error("The json file of asset "+t.__uuid__+" is empty or missing"))},t.init=function(){this._parsing.clear()},t.register=function(e,t){"object"==typeof e?$e(this._parsers,e):this._parsers[e]=t},t.parse=function(e,t,n,i,r){var o=this,a=$h.get(e);if(a)r(null,a);else{var s=this._parsing.get(e);if(s)s.push(r);else{var c=this._parsers[n];c?(this._parsing.add(e,[r]),c(t,i,(function(t,n){t?Jh.remove(e):d_(n)||$h.add(e,n);for(var i=o._parsing.remove(e),r=0,a=i.length;r<a;r++)i[r](t,n)}))):r(null,t)}}},e}());function MR(e,t){var n=!1;e.progress||(e.progress={finish:0,total:e.input.length,canInvoke:!0},n=!0);var i=e.options,r=e.progress;i.__exclude__=i.__exclude__||Object.create(null),e.output=[],$b(e.input,(function(o,a){var s=a_.create({input:o,onProgress:e.onProgress,options:i,progress:r,onComplete:function(i,l){i&&!e.isFinish&&(!c.assetManager.force||n?(y(i.message,i.stack),r.canInvoke=!1,t(i)):r.canInvoke&&e.dispatch("progress",++r.finish,r.total,o)),e.output.push(l),s.recycle(),a(null)}});DR.async(s)}),(function(){if(i.__exclude__=null,e.isFinish)return Xb(e,!0),void e.dispatch("error");!function(e){var t=e.source;if(e.options.__outputAsArray__||1!==t.length)for(var n=e.output=[],i=0,r=t.length;i<r;i++)n.push(t[i].content);else e.output=t[0].content}(e),Xb(e,!0),t()}))}var DR=new Kh("loadOneAsset",[function(e,t){var n=e.output=e.input,i=n.options,r=n.isNative,o=n.uuid,a=n.file,s=i.reloadAsset;a||!s&&!r&&Zh.has(o)?t():wR.load(n,e.options,(function(e,i){n.file=i,t(e)}))},function(e,t){var n=e.output=e.input,i=e.progress,r=e.options.__exclude__,o=n.id,a=n.file,s=n.options;if(n.isNative)PR.parse(o,a,n.ext,s,(function(r,a){r?t(r):(n.content=a,i.canInvoke&&e.dispatch("progress",++i.finish,i.total,n),Jh.remove(o),$h.remove(o),t())}));else{var c=n.uuid;if(c in r){var l=r[c],u=l.finish,h=l.content,_=l.err,f=l.callbacks;i.canInvoke&&e.dispatch("progress",++i.finish,i.total,n),u||function e(t,n,i,r){if(void 0===r&&(r={}),!i[n]||r[n])return!1;r[n]=!0;var o=!1,a=fm.getDeps(n);if(a)for(var s=0,c=a.length;s<c;s++){var l=a[s];if(l===t||e(t,l,i,r)){o=!0;break}}return o}(c,c,r)?(h&&h.addRef(),n.content=h,t(_)):f.push({done:t,item:n})}else if(!s.reloadAsset&&Zh.has(c)){var m=Zh.get(c);s.__asyncLoadAssets__||!m.__asyncLoadAssets__?(n.content=m.addRef(),i.canInvoke&&e.dispatch("progress",++i.finish,i.total,n),t()):LR(e,m,t,!1)}else s.__uuid__=c,PR.parse(o,a,"import",s,(function(n,i){n?t(n):LR(e,i,t,!0)}))}}]);function LR(e,t,n,i){var r=e.input,o=e.progress,a=r,s=a.uuid,c=a.id,l=a.options,u=a.config,h=l.__asyncLoadAssets__,_=l.cacheAsset,f=[];t.addRef&&t.addRef(),Qb(s,t,Object.create(null),f,!1,h,u),o.canInvoke&&e.dispatch("progress",++o.finish,o.total+=f.length,r);var m=e.options.__exclude__[s]={content:t,finish:!1,callbacks:[{done:n,item:r}]},d=a_.create({input:f,options:e.options,onProgress:e.onProgress,onError:a_.prototype.recycle,progress:o,onComplete:function(e){if(t.decRef&&t.decRef(!1),t.__asyncLoadAssets__=h,m.finish=!0,m.err=e,!e){for(var n,r=Array.isArray(d.output)?d.output:[d.output],o=Object.create(null),a=oe(r);!(n=a()).done;){var l=n.value;l&&(o[l instanceof H_?l._uuid+"@import":s+"@native"]=l)}if(i){Jb(s,t,o);try{!t.onLoaded||t.__onLoadedInvoked__||t.__nativeDepend__||(t.onLoaded(),t.__onLoadedInvoked__=!0)}catch(e){y(e.message,e.stack)}Jh.remove(c),$h.remove(c),Zb(s,t,_)}else if(t.__nativeDepend__){Jb(s,t,o);try{!t.onLoaded||t.__onLoadedInvoked__||t.__nativeDepend__||(t.onLoaded(),t.__onLoadedInvoked__=!0)}catch(e){y(e.message,e.stack)}}d.recycle()}for(var u=m.callbacks,f=0,p=u.length;f<p;f++){var v=u[f];t.addRef&&t.addRef(),v.item.content=t,v.done(e)}u.length=0}});t_.async(d)}function FR(e,t){var n=e.options,i=Object.create(null),r=Object.create(null);for(var o in n)switch(o){case Qh.PATH:case Qh.UUID:case Qh.DIR:case Qh.SCENE:case Qh.URL:break;case"__requestType__":case"__isNative__":case"ext":case"type":case"__nativeName__":case"audioLoadMode":case"bundle":i[o]=n[o];break;case"__exclude__":case"__outputAsArray__":r[o]=n[o];break;default:i[o]=n[o],r[o]=n[o]}e.options=r;var a=a_.create({input:e.input,options:i}),s=null;try{e.output=e.source=i_.sync(a)}catch(e){s=e;for(var c=0,l=a.output.length;c<l;c++)a.output[c].recycle()}a.recycle(),t(s)}var zR=function(){function e(){this.uuid="",this.url="",this.ext=".json",this.content=null,this.file=null,this.info=null,this.config=null,this.isNative=!1,this.options=Object.create(null),this._id=""}return e.create=function(){return 0!==e._deadPool.length?e._deadPool.pop():new e},e.prototype.recycle=function(){e._deadPool.length!==e.MAX_DEAD_NUM&&(this._id="",this.uuid="",this.url="",this.ext=".json",this.content=null,this.file=null,this.info=null,this.config=null,this.isNative=!1,this.options=Object.create(null),e._deadPool.push(this))},Z(e,[{key:"id",get:function(){return this._id||(this._id=this.uuid+"@"+(this.isNative?"native":"import")),this._id}}]),e}();zR.MAX_DEAD_NUM=500,zR._deadPool=[];var BR=[];function UR(e){var t=e.options,n=Array.isArray(e.input)?e.input:[e.input];e.output=[];for(var i=function(i){var r=n[i],o=zR.create(),a=null,s=null;if("string"==typeof r&&((r=Object.create(null))[t.__requestType__||Qh.UUID]=n[i]),"object"==typeof r)for(var c in Je(r,t),r.preset&&Je(r,o_[r.preset]),r){switch(c){case Qh.UUID:if("break"===function(){var e=o.uuid=h_(r.uuid);if(!r.bundle){var t=e_.find((function(t){return!!t.getAssetInfo(e)}));r.bundle=t&&t.name}if(e_.has(r.bundle)){if(a=e_.get(r.bundle).config,(s=a.getAssetInfo(e))&&s.redirect){if(!e_.has(s.redirect))throw new Error("Please load bundle "+s.redirect+" first");a=e_.get(s.redirect).config,s=a.getAssetInfo(e)}o.config=a,o.info=s}return o.ext=r.ext||".json","break"}())break;case"__requestType__":case"ext":case"bundle":case"preset":case"type":break;case Qh.DIR:if(e_.has(r.bundle)){e_.get(r.bundle).config.getDirWithPath(r.dir,r.type,BR);for(var l,u=oe(BR);!(l=u()).done;){var h=l.value;n.push({uuid:h.uuid,__isNative__:!1,ext:".json",bundle:r.bundle})}BR.length=0}o.recycle(),o=null;break;case Qh.PATH:if(e_.has(r.bundle)){if(a=e_.get(r.bundle).config,(s=a.getInfoWithPath(r.path,r.type))&&s.redirect){if(!e_.has(s.redirect))throw new Error("you need to load bundle "+s.redirect+" first");a=e_.get(s.redirect).config,s=a.getAssetInfo(s.uuid)}if(!s)throw o.recycle(),new Error("Bundle "+r.bundle+" doesn't contain "+r.path);o.config=a,o.uuid=s.uuid,o.info=s}o.ext=r.ext||".json";break;case Qh.SCENE:if(!r.bundle){var _=e_.find((function(e){return!!e.getSceneInfo(r.scene)}));r.bundle=_&&_.name}if(e_.has(r.bundle)){if(a=e_.get(r.bundle).config,(s=a.getSceneInfo(r.scene))&&s.redirect){if(!e_.has(s.redirect))throw new Error("you need to load bundle "+s.redirect+" first");a=e_.get(s.redirect).config,s=a.getAssetInfo(s.uuid)}if(!s)throw o.recycle(),new Error("Bundle "+a.name+" doesn't contain scene "+r.scene);o.config=a,o.uuid=s.uuid,o.info=s}break;case"__isNative__":o.isNative=r.__isNative__;break;case Qh.URL:o.url=r.url,o.uuid=r.uuid||r.url,o.ext=r.ext||H(r.url),o.isNative=void 0===r.__isNative__||r.__isNative__;break;default:o.options[c]=r[c]}if(!o)break}if(!o)return"continue";if(e.output.push(o),!o.uuid&&!o.url)throw new Error("Can not parse this input:"+JSON.stringify(r))},r=0;r<n.length;r++)i(r);return null}function GR(e){for(var t=e.output=e.input,n=0;n<t.length;n++){var i=t[n];if(!i.url){var r,o,a=i.config;o=i.isNative?a&&a.nativeBase?a.base+a.nativeBase:c.assetManager.generalNativeBase:a&&a.importBase?a.base+a.importBase:c.assetManager.generalImportBase;var s=i.uuid,l="";i.info&&(l=i.isNative?i.info.nativeVer?"."+i.info.nativeVer:"":i.info.ver?"."+i.info.ver:""),r=".ttf"===i.ext?o+"/"+s.slice(0,2)+"/"+s+l+"/"+i.options.__nativeName__:o+"/"+s.slice(0,2)+"/"+s+l+i.ext,i.url=r}}return null}var HR=e("fn",function(){function e(){this.pipeline=t_.append(FR).append(MR),this.fetchPipeline=n_.append(FR).append(IR),this.transformPipeline=i_.append(UR).append(GR),this.bundles=e_,this.assets=Zh,this.generalImportBase="",this.generalNativeBase="",this.dependUtil=fm,this.force=!!i,this.allowImageBitmap=!Rv.isMobile,this.utils=g_,this.downloader=vR,this.parser=PR,this.packManager=wR,this.cacheAsset=!0,this.cacheManager=null,this.presets=o_,this.factory=CR,this.preprocessPipe=FR,this.fetchPipe=IR,this.loadPipe=MR,this.references=null,this._releaseManager=qb,this._files=Jh,this._parsed=$h,this._parsePipeline=null}var t=e.prototype;return t.init=function(e){void 0===e&&(e={}),this._files.clear(),this._parsed.clear(),this._releaseManager.init(),this.assets.clear(),this.bundles.clear(),this.packManager.init(),this.downloader.init(e.server,e.bundleVers,e.remoteBundles),this.parser.init(),this.dependUtil.init();var t=e.importBase||"";t&&t.endsWith("/")&&(t=t.substr(0,t.length-1));var n=e.nativeBase||"";n&&n.endsWith("/")&&(n=n.substr(0,n.length-1)),this.generalImportBase=t,this.generalNativeBase=n},t.getBundle=function(e){return e_.get(e)||null},t.removeBundle=function(e){e._destroy(),e_.remove(e.name)},t.loadAny=function(e,t,n,i){var r=eR(t,n,i),o=r.options,a=r.onProgress,s=r.onComplete;o.preset=o.preset||"default",e=Array.isArray(e)?e.slice():e;var c=new a_({input:e,onProgress:a,onComplete:nR(s),options:o});t_.async(c)},t.preloadAny=function(e,t,n,i){var r=eR(t,n,i),o=r.options,a=r.onProgress,s=r.onComplete;o.preset=o.preset||"preload",e=Array.isArray(e)?e.slice():e;var c=new a_({input:e,onProgress:a,onComplete:nR(s),options:o});n_.async(c)},t.postLoadNative=function(e,t,n){var i=eR(t,void 0,n),r=i.options,o=i.onComplete;if(e._native&&e.__nativeDepend__){var a=fm.getNativeDep(e._uuid);if(a){if(!e_.has(a.bundle)){var s=e_.find((function(t){return!!t.getAssetInfo(e._uuid)}));s&&(a.bundle=s.name)}this.loadAny(a,r,(function(t,n){t?y(t.message,t.stack):e.isValid&&e.__nativeDepend__&&(e._nativeAsset=n,e.__nativeDepend__=!1),o&&o(t)}))}}else nR(o)(null)},t.loadRemote=function(e,t,n){var i=eR(t,void 0,n),r=i.options,o=i.onComplete;r.reloadAsset||!this.assets.has(e)?(r.__isNative__=!0,r.preset=r.preset||"remote",this.loadAny({url:e},r,null,(function(t,n){t?(y(t.message,t.stack),o&&o(t,n)):CR.create(e,n,r.ext||H(e),r,(function(e,t){o&&o(e,t)}))}))):nR(o)(null,this.assets.get(e))},t.loadBundle=function(e,t,n){var i=eR(t,void 0,n),r=i.options,o=i.onComplete,a=V(e);this.bundles.has(a)?nR(o)(null,this.getBundle(a)):(r.preset=r.preset||"bundle",r.ext="bundle",r.__isNative__=!0,this.loadAny({url:e},r,null,(function(t,n){t?(y(t.message,t.stack),o&&o(t,n)):CR.create(e,n,"bundle",r,(function(e,t){o&&o(e,t)}))})))},t.releaseAsset=function(e){qb.tryRelease(e,!0)},t.releaseUnusedAssets=function(){Zh.forEach((function(e){qb.tryRelease(e)}))},t.releaseAll=function(){Zh.forEach((function(e){qb.tryRelease(e,!0)}))},t.loadWithJson=function(){throw new Error("Only valid in Editor")},Z(e,[{key:"main",get:function(){return e_.get(r_.MAIN)||null}},{key:"resources",get:function(){return e_.get(r_.RESOURCES)||null}}]),e}());HR.Pipeline=Kh,HR.Task=a_,HR.Cache=Xh,HR.RequestItem=zR,HR.Bundle=iR,HR.BuiltinBundleName=r_;var kR=e("ch",c.assetManager=new HR);c.AssetManager=HR;var VR=[".png",".jpg",".bmp",".jpeg",".gif",".ico",".tiff",".webp",".image",".pvr",".pkm",".astc"],jR=[".mp3",".ogg",".wav",".m4a"];function WR(){return!0}var qR={transformURL:function(e){var t=f_(e);if(!t)return e;var n=e_.find((function(e){return!!e.getAssetInfo(t)}));if(!n)return e;var i,r=n.getAssetInfo(t);if(!(i=e.startsWith(n.base+n.config.nativeBase)?r.nativeVer||"":r.ver||"")||-1!==e.indexOf(i))return e;var o=!1;if(".ttf"===H(e)&&(o=!0),o){var a=j(e),s=V(e);e=a+"."+i+"/"+s}else e=e.replace(/.*[/\\][0-9a-fA-F]{2}[/\\]([0-9a-fA-F-@]{8,}).*/,(function(e){return e+"."+i}));return e}},YR=e("fp",function(){function e(){this._autoReleaseSetting=Object.create(null),this._parseLoadResArgs=tR}var t=e.prototype;return t.load=function(e,t,n){void 0===n&&void 0!==t&&(n=t,t=null);for(var i=Array.isArray(e)?e:[e],r=0;r<i.length;r++){var o=i[r];"string"==typeof o?i[r]={url:o,__isNative__:!0}:(o.type&&(o.ext="."+o.type,o.type=void 0),o.url&&(o.__isNative__=!0))}var a=[],s=[];kR.loadAny(i,null,(function(e,n,i){i.content&&(VR.includes(i.ext)?a.push(i.content):jR.includes(i.ext)&&s.push(i.content)),t&&t(e,n,i)}),(function(e,t){var r=null;if(!e){t=Array.isArray(t)?t:[t];for(var o=function(e){var n=t[e];if(!(n instanceof H_)){var r=n,o=i[e].url;a.includes(r)?CR.create(o,n,".png",{},(function(n,i){r=t[e]=i})):s.includes(r)&&CR.create(o,n,".mp3",{},(function(n,i){r=t[e]=i})),Zh.add(o,r)}},c=0;c<t.length;c++)o(c);if(t.length>1){var l=Object.create(null);t.forEach((function(e){l[e._uuid]=e})),r={isCompleted:WR,_map:l}}else r=t[0]}n&&n(e,r)}))},t.getXMLHttpRequest=function(){return new XMLHttpRequest},t.getItem=function(e){return kR.assets.has(e)?{content:kR.assets.get(e)}:null},t.loadRes=function(e,t,n,i){var r=this._parseLoadResArgs(t,n,i),o=r.type,a=r.onProgress,s=r.onComplete,c=H(e);c&&!rR.getInfoWithPath(e,o)&&(e=e.slice(0,-c.length)),rR.load(e,o,a,s)},t.loadResArray=function(e,t,n,i){var r=this._parseLoadResArgs(t,n,i),o=r.type,a=r.onProgress,s=r.onComplete;e.forEach((function(t,n){var i=H(t);i&&!rR.getInfoWithPath(t,o)&&(e[n]=t.slice(0,-i.length))})),rR.load(e,o,a,s)},t.loadResDir=function(e,t,n,i){var r=this._parseLoadResArgs(t,n,i),o=r.type,a=r.onProgress,s=r.onComplete;rR.loadDir(e,o,a,(function(t,n){var i=[];t||(i=rR.getDirWithPath(e,o).map((function(e){return e.path}))),s&&s(t,n,i)}))},t.getRes=function(e,t){return Zh.has(e)?Zh.get(e):rR.get(e,t)},t.getResCount=function(){return Zh.count},t.getDependsRecursively=function(e){if(!e)return[];var t="string"==typeof e?e:e._uuid;return fm.getDepsRecursively(t).concat([t])},t.addDownloadHandlers=function(e){var t=Object.create(null),n=function(n){var i=e[n];t["."+n]=function(e,t,n){i({url:e},n)}};for(var i in e)n(i);vR.register(t)},t.addLoadHandlers=function(e){var t=Object.create(null),n=function(n){var i=e[n];t["."+n]=function(e,t,n){i({content:e},n)}};for(var i in e)n(i);PR.register(t)},t.release=function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++){var n=e[t];"string"==typeof n&&(n=Zh.get(n)),kR.releaseAsset(n)}else e&&("string"==typeof e&&(e=Zh.get(e)),kR.releaseAsset(e))},t.releaseAsset=function(e){kR.releaseAsset(e)},t.releaseRes=function(e,t){rR.release(e,t)},t.releaseAll=function(){kR.releaseAll(),Zh.clear()},t.removeItem=function(e){return!!Zh.remove(e)},t.setAutoRelease=function(e,t){"object"==typeof e&&(e=e._uuid),this._autoReleaseSetting[e]=!!t},t.setAutoReleaseRecursively=function(e,t){"object"==typeof e&&(e=e._uuid),t=!!t,this._autoReleaseSetting[e]=t;for(var n=fm.getDepsRecursively(e),i=0;i<n.length;i++)this._autoReleaseSetting[n[i]]=t},t.isAutoRelease=function(e){return"object"==typeof e&&(e=e._uuid),!!this._autoReleaseSetting[e]},Z(e,[{key:"onProgress",set:function(e){Yb=e}},{key:"_cache",get:function(){return Zh._map}},{key:"md5Pipe",get:function(){return qR}},{key:"downloader",get:function(){return vR}},{key:"loader",get:function(){return kR.parser}}]),e}()),XR=e("fq",new YR),KR=e("fr",{init:function(e){e.importBase=e.libraryPath,e.nativeBase=e.rawAssetsBase,kR.init(e),e.rawAssets&&rR.init({base:"",deps:[],scenes:{},redirect:[],debug:!0,packs:{},types:[],versions:{import:[],native:[]},name:r_.RESOURCES,importBase:e.importBase,nativeBase:e.nativeBase,paths:e.rawAssets.assets,uuids:Object.keys(e.rawAssets.assets)})},loadAsset:function(e,t){kR.loadAny(e,t)}}),QR=e("fs",{});ve(QR,"url",[{name:"normalize",target:kR.utils,targetName:"assetManager.utils",newName:"normalize"},{name:"raw",targetName:"Asset.prototype",newName:"nativeUrl",customFunction:function(e){return e.startsWith("resources/")?v_({path:W(e.substr(10)),bundle:r_.RESOURCES,__isNative__:!0,ext:H(e)}):""}}]),ge(KR,"AssetLibrary",[{name:"getLibUrlNoExt",suggest:"AssetLibrary.getLibUrlNoExt was removed, if you want to transform url, please use cc.assetManager.utils.getUrlWithUuid instead"},{name:"queryAssetInfo",suggest:"AssetLibrary.queryAssetInfo was removed"}]),ge(XR,"loader",[{name:"releaseResDir",suggest:"loader.releaseResDir was removed, please use assetManager.releaseAsset instead"},{name:"flowInDeps",suggest:"loader.flowInDeps was removed"},{name:"assetLoader",suggest:"cc.loader.assetLoader was removed, assetLoader and md5Pipe were merged into cc.assetManager.transformPipeline"}]),ve(c,"cc",[{name:"loader",newName:"assetManager",logTimes:1,customGetter:function(){return XR}},{name:"AssetLibrary",newName:"assetManager",logTimes:1,customGetter:function(){return KR}},{name:"Pipeline",target:HR,targetName:"AssetManager",newName:"Pipeline",logTimes:1},{name:"url",targetName:"assetManager",newName:"utils",logTimes:1,customGetter:function(){return QR}}]),ge(c,"cc",[{name:"LoadingItems",suggest:M(1400,"cc.LoadingItems","cc.AssetManager.Task")}]),ve(Ct,"macro",[{name:"DOWNLOAD_MAX_CONCURRENT",target:vR,targetName:"assetManager.downloader",newName:"maxConcurrency"}]),ve(Gb,"director",[{name:"_getSceneUuid",targetName:"assetManager.main",newName:"getSceneInfo",customFunction:function(e){var t;return kR.main?null===(t=kR.main.getSceneInfo(e))||void 0===t?void 0:t.uuid:""}}]),ve(rA,"game",[{name:"_sceneInfos",targetName:"assetManager.main",newName:"getSceneInfo",customGetter:function(){var e=[];return kR.main&&kR.main.config.scenes.forEach((function(t){e.push(t)})),e}}]);var ZR,JR,$R,eO,tO,nO,iO,rO,oO,aO,sO=qb._autoRelease;qb._autoRelease=function(e,t,n){sO.call(qb,e,t,n);for(var i=XR._autoReleaseSetting,r=Object.keys(i),o=0;o<r.length;o++){var a=r[o];if(!0===i[a]){var s=Zh.get(a);s&&qb.tryRelease(s)}}};var cO,lO,uO,hO,_O,fO,mO,dO,pO,vO,gO,yO,xO,EO,SO,TO,AO,CO,wO,IO,bO,RO,OO,NO,PO,MO,DO,LO,FO,zO,BO,UO,GO,HO,kO,VO,jO,WO,qO,YO,XO,KO,QO,ZO,JO,$O,eN,tN,nN,iN,rN,oN,aN,sN,cN,lN,uN,hN,_N,fN,mN,dN,pN,vN,gN,yN,xN,EN=e("cD",(ZR=vh("cc.ClickEvent"),JR=qh(c.Node),ZR((aO=function(){function e(){ae(this,"target",tO,this),ae(this,"component",nO,this),ae(this,"_componentId",iO,this),ae(this,"handler",rO,this),ae(this,"customEventData",oO,this)}e.emitEvents=function(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];for(var o=0,a=t.length;o<a;o++){var s=t[o];s instanceof e&&s.emit(i)}};var t=e.prototype;return t.emit=function(e){var t=this.target;if(c.isValid(t)){this._genCompIdIfNeeded();var n=c.js._getClassById(this._componentId),i=t.getComponent(n);if(c.isValid(i)){var r=i[this.handler];"function"==typeof r&&(null!=this.customEventData&&""!==this.customEventData&&(e=e.slice()).push(this.customEventData),r.apply(i,e))}}},t._compName2Id=function(e){var t=c.js.getClassByName(e);return c.js._getClassId(t)},t._compId2Name=function(e){var t=c.js._getClassById(e);return c.js.getClassName(t)},t._genCompIdIfNeeded=function(){this._componentId||(this._componentName=this.component,this.component="")},Z(e,[{key:"_componentName",get:function(){return this._genCompIdIfNeeded(),this._compId2Name(this._componentId)},set:function(e){this._componentId=this._compName2Id(e)}}]),e}(),tO=se((eO=aO).prototype,"target",[JR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),nO=se(eO.prototype,"component",[Sh,Nh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),iO=se(eO.prototype,"_componentId",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),rO=se(eO.prototype,"handler",[Sh,Nh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),oO=se(eO.prototype,"customEventData",[Sh,Nh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),$R=eO))||$R));c.Component.EventHandler=EN;var SN,TN,AN,CN,wN,IN,bN,RN,ON,NN,PN=new Un,MN=xt(Wu),DN=xt(ju),LN=xt(qu),FN=xt(Xu),zN=xt(Yu),BN=xt({SKYBOX:ah|ba.DEPTH_STENCIL,SOLID_COLOR:ba.ALL,DEPTH_ONLY:ba.DEPTH_STENCIL,DONT_CLEAR:ba.NONE}),UN=e("cd",(cO=vh("cc.Camera"),lO=Oh(),uO=wh(),hO=Gh(),_O=Dh(),fO=qh(Kl.BitMask),mO=Gh(),dO=Dh(),pO=qh(BN),vO=Gh(),gO=Dh(),yO=Gh(),xO=Dh(),EO=Gh(),SO=Dh(),TO=Gh(),AO=Dh(),CO=qh(MN),wO=Gh(),IO=Dh(),bO=qh(DN),RO=Gh(),OO=Dh(),NO=Gh(),PO=Dh(),MO=Gh(),DO=Dh(),LO=Gh(),FO=Dh(),zO=Gh(),BO=Dh(),UO=qh(LN),GO=Gh(),HO=Dh(),kO=qh(FN),VO=Gh(),jO=Dh(),WO=qh(zN),qO=Gh(),YO=Dh(),XO=Gh(),KO=Dh(),QO=qh(_p),ZO=Gh(),JO=Dh(),cO($O=lO($O=uO($O=Ch((xN=yN=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ae(t=e.call.apply(e,[this].concat(i))||this,"_projection",tN,ie(t)),ae(t,"_priority",nN,ie(t)),ae(t,"_fov",iN,ie(t)),ae(t,"_fovAxis",rN,ie(t)),ae(t,"_orthoHeight",oN,ie(t)),ae(t,"_near",aN,ie(t)),ae(t,"_far",sN,ie(t)),ae(t,"_color",cN,ie(t)),ae(t,"_depth",lN,ie(t)),ae(t,"_stencil",uN,ie(t)),ae(t,"_clearFlags",hN,ie(t)),ae(t,"_rect",_N,ie(t)),ae(t,"_aperture",fN,ie(t)),ae(t,"_shutter",mN,ie(t)),ae(t,"_iso",dN,ie(t)),ae(t,"_screenScale",pN,ie(t)),ae(t,"_visibility",vN,ie(t)),ae(t,"_targetTexture",gN,ie(t)),t._camera=null,t._inEditorMode=!1,t._flows=void 0,t}$(t,e);var n=t.prototype;return n.onLoad=function(){this._createCamera()},n.onEnable=function(){this.node.hasChangedFlags|=$u.POSITION,this._camera&&this._attachToScene()},n.onDisable=function(){this._camera&&this._detachFromScene()},n.onDestroy=function(){this._camera&&(this._camera.destroy(),this._camera=null),this._targetTexture&&this._targetTexture.off("resize")},n.screenPointToRay=function(e,t,n){return n||(n=Go.create()),this._camera&&this._camera.screenPointToRay(n,e,t),n},n.worldToScreen=function(e,t){return t||(t=new Un),this._camera&&this._camera.worldToScreen(t,e),t},n.screenToWorld=function(e,t){return t||(t=this.node.getWorldPosition()),this._camera&&this._camera.screenToWorld(t,e),t},n.convertToUINode=function(e,t,n){if(n||(n=new Un),!this._camera)return n;this.worldToScreen(e,PN);var i=t.getComponent("cc.UITransform"),r=_A.getVisibleSize(),o=PN.x-.5*this._camera.width,a=PN.y-.5*this._camera.height;return PN.x=o/c.view.getScaleX()+.5*r.width,PN.y=a/c.view.getScaleY()+.5*r.height,i&&i.convertToNodeSpaceAR(PN,n),n},n._createCamera=function(){this._camera||(this._camera=c.director.root.createCamera(),this._camera.initialize({name:this.node.name,node:this.node,projection:this._projection,window:this._inEditorMode?c.director.root&&c.director.root.mainWindow:c.director.root&&c.director.root.tempWindow,priority:this._priority}),this._camera.viewport=this._rect,this._camera.fovAxis=this._fovAxis,this._camera.fov=Tn(this._fov),this._camera.orthoHeight=this._orthoHeight,this._camera.nearClip=this._near,this._camera.farClip=this._far,this._camera.clearColor=this._color,this._camera.clearDepth=this._depth,this._camera.clearStencil=this._stencil,this._camera.clearFlag=this._clearFlags,this._camera.visibility=this._visibility,this._camera.aperture=this._aperture,this._camera.shutter=this._shutter,this._camera.iso=this._iso),this._updateTargetTexture()},n._attachToScene=function(){this.node.scene&&this._camera&&(this._camera&&this._camera.scene&&this._camera.scene.removeCamera(this._camera),this._getRenderScene().addCamera(this._camera))},n._detachFromScene=function(){this._camera&&this._camera.scene&&this._camera.scene.removeCamera(this._camera)},n._chechTargetTextureEvent=function(e){var t=this;e&&e.off("resize"),this._targetTexture&&this._targetTexture.on("resize",(function(e){t._camera&&t._camera.setFixedSize(e.width,e.height)}),this)},n._updateTargetTexture=function(){if(this._camera&&this._targetTexture){var e=this._targetTexture.window;this._camera.changeTargetWindow(e),this._camera.setFixedSize(e.width,e.height)}},Z(t,[{key:"camera",get:function(){return this._camera}},{key:"priority",get:function(){return this._priority},set:function(e){this._priority=e,this._camera&&(this._camera.priority=e)}},{key:"visibility",get:function(){return this._visibility},set:function(e){this._visibility=e,this._camera&&(this._camera.visibility=e)}},{key:"clearFlags",get:function(){return this._clearFlags},set:function(e){this._clearFlags=e,this._camera&&(this._camera.clearFlag=e)}},{key:"clearColor",get:function(){return this._color},set:function(e){this._color.set(e),this._camera&&(this._camera.clearColor=this._color)}},{key:"clearDepth",get:function(){return this._depth},set:function(e){this._depth=e,this._camera&&(this._camera.clearDepth=e)}},{key:"clearStencil",get:function(){return this._stencil},set:function(e){this._stencil=e,this._camera&&(this._camera.clearStencil=e)}},{key:"projection",get:function(){return this._projection},set:function(e){this._projection=e,this._camera&&(this._camera.projectionType=e)}},{key:"fovAxis",get:function(){return this._fovAxis},set:function(e){e!==this._fovAxis&&(this._fovAxis=e,this._camera&&(this._camera.fovAxis=e,e===ju.VERTICAL?this.fov=this._fov*this._camera.aspect:this.fov=this._fov/this._camera.aspect))}},{key:"fov",get:function(){return this._fov},set:function(e){this._fov=e,this._camera&&(this._camera.fov=Tn(e))}},{key:"orthoHeight",get:function(){return this._orthoHeight},set:function(e){this._orthoHeight=e,this._camera&&(this._camera.orthoHeight=e)}},{key:"near",get:function(){return this._near},set:function(e){this._near=e,this._camera&&(this._camera.nearClip=e)}},{key:"far",get:function(){return this._far},set:function(e){this._far=e,this._camera&&(this._camera.farClip=e)}},{key:"aperture",get:function(){return this._aperture},set:function(e){this._aperture=e,this._camera&&(this._camera.aperture=e)}},{key:"shutter",get:function(){return this._shutter},set:function(e){this._shutter=e,this._camera&&(this._camera.shutter=e)}},{key:"iso",get:function(){return this._iso},set:function(e){this._iso=e,this._camera&&(this._camera.iso=e)}},{key:"rect",get:function(){return this._rect},set:function(e){this._rect=e,this._camera&&(this._camera.viewport=e)}},{key:"targetTexture",get:function(){return this._targetTexture},set:function(e){if(this._targetTexture!==e){var t=this._targetTexture;this._targetTexture=e,this._chechTargetTextureEvent(t),this._updateTargetTexture(),!e&&this._camera&&(this._camera.changeTargetWindow(null),this._camera.isWindowSize=!0)}}},{key:"screenScale",get:function(){return this._screenScale},set:function(e){this._screenScale=e,this._camera&&(this._camera.screenScale=e)}},{key:"inEditorMode",get:function(){return this._inEditorMode},set:function(e){this._inEditorMode=e,this._camera&&this._camera.changeTargetWindow(e?c.director.root&&c.director.root.mainWindow:c.director.root&&c.director.root.tempWindow)}}]),t}(cm),yN.ProjectionType=MN,yN.FOVAxis=DN,yN.ClearFlag=BN,yN.Aperture=LN,yN.Shutter=FN,yN.ISO=zN,tN=se((eN=xN).prototype,"_projection",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return MN.PERSPECTIVE}}),nN=se(eN.prototype,"_priority",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),iN=se(eN.prototype,"_fov",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 45}}),rN=se(eN.prototype,"_fovAxis",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return DN.VERTICAL}}),oN=se(eN.prototype,"_orthoHeight",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),aN=se(eN.prototype,"_near",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),sN=se(eN.prototype,"_far",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e3}}),cN=se(eN.prototype,"_color",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new zn("#333333")}}),lN=se(eN.prototype,"_depth",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),uN=se(eN.prototype,"_stencil",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),hN=se(eN.prototype,"_clearFlags",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return BN.SOLID_COLOR}}),_N=se(eN.prototype,"_rect",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new fi(0,0,1,1)}}),fN=se(eN.prototype,"_aperture",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return LN.F16_0}}),mN=se(eN.prototype,"_shutter",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return FN.D125}}),dN=se(eN.prototype,"_iso",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return zN.ISO100}}),pN=se(eN.prototype,"_screenScale",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),vN=se(eN.prototype,"_visibility",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ku}}),gN=se(eN.prototype,"_targetTexture",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),se(eN.prototype,"priority",[hO,_O],Object.getOwnPropertyDescriptor(eN.prototype,"priority"),eN.prototype),se(eN.prototype,"visibility",[fO,mO,dO],Object.getOwnPropertyDescriptor(eN.prototype,"visibility"),eN.prototype),se(eN.prototype,"clearFlags",[pO,vO,gO],Object.getOwnPropertyDescriptor(eN.prototype,"clearFlags"),eN.prototype),se(eN.prototype,"clearColor",[yO,xO],Object.getOwnPropertyDescriptor(eN.prototype,"clearColor"),eN.prototype),se(eN.prototype,"clearDepth",[EO,SO],Object.getOwnPropertyDescriptor(eN.prototype,"clearDepth"),eN.prototype),se(eN.prototype,"clearStencil",[TO,AO],Object.getOwnPropertyDescriptor(eN.prototype,"clearStencil"),eN.prototype),se(eN.prototype,"projection",[CO,wO,IO],Object.getOwnPropertyDescriptor(eN.prototype,"projection"),eN.prototype),se(eN.prototype,"fovAxis",[bO,RO,OO],Object.getOwnPropertyDescriptor(eN.prototype,"fovAxis"),eN.prototype),se(eN.prototype,"fov",[NO,PO],Object.getOwnPropertyDescriptor(eN.prototype,"fov"),eN.prototype),se(eN.prototype,"orthoHeight",[MO,DO],Object.getOwnPropertyDescriptor(eN.prototype,"orthoHeight"),eN.prototype),se(eN.prototype,"near",[LO,FO],Object.getOwnPropertyDescriptor(eN.prototype,"near"),eN.prototype),se(eN.prototype,"far",[zO,BO],Object.getOwnPropertyDescriptor(eN.prototype,"far"),eN.prototype),se(eN.prototype,"aperture",[UO,GO,HO],Object.getOwnPropertyDescriptor(eN.prototype,"aperture"),eN.prototype),se(eN.prototype,"shutter",[kO,VO,jO],Object.getOwnPropertyDescriptor(eN.prototype,"shutter"),eN.prototype),se(eN.prototype,"iso",[WO,qO,YO],Object.getOwnPropertyDescriptor(eN.prototype,"iso"),eN.prototype),se(eN.prototype,"rect",[XO,KO],Object.getOwnPropertyDescriptor(eN.prototype,"rect"),eN.prototype),se(eN.prototype,"targetTexture",[QO,ZO,JO],Object.getOwnPropertyDescriptor(eN.prototype,"targetTexture"),eN.prototype),$O=eN))||$O)||$O)||$O)||$O));c.Camera=UN;var GN,HN,kN,VN,jN,WN,qN,YN,XN={parent:null,owner:null,subModelIdx:0},KN=e("b4",(SN=vh("cc.RenderableComponent"),TN=qh([fp]),AN=qh(fp),CN=Gh(),wN=Mh(),SN((NN=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ae(t=e.call.apply(e,[this].concat(i))||this,"_materials",RN,ie(t)),ae(t,"_visFlags",ON,ie(t)),t._materialInstances=[],t._models=[],t}$(t,e);var n=t.prototype;return n.getMaterial=function(e){return e<0||e>=this._materials.length?null:this._materials[e]},n.setMaterial=function(e,t){e&&e instanceof yp&&console.error("Can't set a material instance to a sharedMaterial slot"),this._materials[t]=e;var n=this._materialInstances[t];n?n.parent!==this._materials[t]&&(n.destroy(),this._materialInstances[t]=null,this._onMaterialModified(t,this._materials[t])):this._onMaterialModified(t,this._materials[t])},n.getMaterialInstance=function(e){if(!this._materials[e])return null;if(!this._materialInstances[e]){XN.parent=this._materials[e],XN.owner=this,XN.subModelIdx=e;var t=new yp(XN);this.setMaterialInstance(e,t)}return this._materialInstances[e]},n.setMaterialInstance=function(e,t){t&&t.parent?t!==this._materialInstances[e]&&(this._materialInstances[e]=t,this._onMaterialModified(e,t)):t!==this._materials[e]&&this.setMaterial(t,e)},n.getRenderMaterial=function(e){return this._materialInstances[e]||this._materials[e]},n._collectModels=function(){return this._models},n._attachToScene=function(){},n._detachFromScene=function(){},n._onMaterialModified=function(){},n._onRebuildPSO=function(){},n._clearMaterials=function(){},n._onVisibilityChange=function(){},Z(t,[{key:"visibility",get:function(){return this._visFlags},set:function(e){this._visFlags=e,this._onVisibilityChange(e)}},{key:"sharedMaterials",get:function(){return this._materials},set:function(e){for(var t=0;t<e.length;t++)e[t]!==this._materials[t]&&this.setMaterial(e[t],t);if(e.length<this._materials.length){for(var n=e.length;n<this._materials.length;n++)this.setMaterial(null,n);this._materials.splice(e.length)}}},{key:"materials",get:function(){for(var e=0;e<this._materials.length;e++)this._materialInstances[e]=this.getMaterialInstance(e);return this._materialInstances},set:function(e){var t=e.length-this._materials.length;if(t>0)this._materials.length=e.length,this._materialInstances.length=e.length;else if(t<0)for(var n=this._materials.length-t;n<this._materials.length;++n)this.setMaterialInstance(n,null);for(var i=0;i<this._materialInstances.length;i++)this._materialInstances[i]!=e[i]&&this.setMaterialInstance(i,e[i])}},{key:"sharedMaterial",get:function(){return this.getMaterial(0)}},{key:"material",get:function(){return this.getMaterialInstance(0)},set:function(e){1===this._materials.length&&this._materials[0]===e||this.setMaterialInstance(0,e)}}]),t}(cm),RN=se((bN=NN).prototype,"_materials",[TN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ON=se(bN.prototype,"_visFlags",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Kl.Enum.NONE}}),se(bN.prototype,"sharedMaterials",[AN,CN,wN],Object.getOwnPropertyDescriptor(bN.prototype,"sharedMaterials"),bN.prototype),IN=bN))||IN));function QN(e){return"string"==typeof e||"number"==typeof e}function ZN(e,t){return e instanceof t}c.RenderableComponent=KN,ve(UN,"Camera",[{name:"CameraClearFlag",newName:"ClearFlag"}]),ve(UN.prototype,"Camera.prototype",[{name:"color",newName:"clearColor"},{name:"depth",newName:"clearDepth"},{name:"stencil",newName:"clearStencil"}]),c.CameraComponent=UN,gt.setClassAlias(UN,"cc.CameraComponent");var JN,$N,eP,tP,nP,iP,rP=e("H",vh("cc.animation.HierarchyPath")((VN=function(){function e(e){ae(this,"path",kN,this),this.path=e||""}return e.prototype.get=function(e){return e instanceof FC?e.getChildByPath(this.path)||(g('Node "'+e.name+'" has no path "'+this.path+'"'),null):(g("Target of hierarchy path should be of type Node."),null)},e}(),kN=se((HN=VN).prototype,"path",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),GN=HN))||GN),oP=e("c",vh("cc.animation.ComponentPath")((YN=function(){function e(e){ae(this,"component",qN,this),this.component=e||""}return e.prototype.get=function(e){return e instanceof FC?e.getComponent(this.component)||(g('Node "'+e.name+'" has no component "'+this.component+'"'),null):(g("Target of component path should be of type Node."),null)},e}(),qN=se((WN=YN).prototype,"component",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),jN=WN))||jN);function aP(e){for(var t=e,n=0;n<(arguments.length<=1?0:arguments.length-1);++n){var i=n+1<1||arguments.length<=n+1?void 0:arguments[n+1];if(QN(i)){if(!(i in t))return g('Target object has no property "'+i+'"'),null;t=t[i]}else t=i.get(t);if(null===t)break}return t}var sP,cP,lP,uP,hP,_P,fP,mP,dP,pP,vP,gP=e("U",vh("cc.animation.UniformProxyFactory")((iP=function(){function e(e,t){ae(this,"passIndex",eP,this),ae(this,"uniformName",tP,this),ae(this,"channelIndex",nP,this),this.passIndex=t||0,this.uniformName=e||""}return e.prototype.forTarget=function(e){var t=e.passes[this.passIndex],n=t.getHandle(this.uniformName);if(!n)throw new Error('Material "'+e.name+'" has no uniform "'+this.uniformName+'"');var i=hd.getPropertyTypeFromHandle(n);if(i===Dm.UBO){var r=void 0===this.channelIndex?n:t.getHandle(this.uniformName,this.channelIndex,Zo.FLOAT);if(!r)throw new Error('Uniform "'+this.uniformName+" (in material "+e.name+") has no channel "+this.channelIndex+'"');return function(e,t){for(var n,i=oe(e.shaderInfo.blocks);!(n=i()).done;)for(var r,o=oe(n.value.members);!(r=o()).done;){var a=r.value;if(a.name===t)return a.count>1}return!1}(t,this.uniformName)?{set:function(e){t.setUniformArray(r,e)}}:{set:function(e){t.setUniform(r,e)}}}if(i===Dm.SAMPLER){var o=hd.getBindingFromHandle(n),a=t.properties[this.uniformName],s=a&&a.value?a.value+"-texture":Wm(a.type),l=ad.get(s);return l||(g("Illegal texture default value: "+s+"."),l=ad.get("default-texture")),{set:function(e){e||(e=l);var n=e.getGFXTexture();n&&n.width&&n.height&&(t.bindTexture(o,n),e instanceof xf&&t.bindSampler(o,gf.getSampler(c.game._gfxDevice,e.getSamplerHash())))}}}throw new Error("Animations are not available for uniforms with property type "+i+".")},e}(),eP=se(($N=iP).prototype,"passIndex",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),tP=se($N.prototype,"uniformName",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),nP=se($N.prototype,"channelIndex",[Vh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),JN=$N))||JN);function yP(e,t,n,i){var r,o,a,s,c,l,u=new t,h=new t,_=new t,f=vh(e)((l=function(){function e(e,n,i){ae(this,"dataPoint",a,this),ae(this,"inTangent",s,this),ae(this,"outTangent",c,this),this.dataPoint=e||new t,this.inTangent=n||new t,this.outTangent=i||new t}var r=e.prototype;return r.lerp=function(e,t,r){var o=this.dataPoint,a=e.dataPoint;h=n(h,this.inTangent,r),_=n(_,e.outTangent,r);var s=t*t*t,c=t*t,l=s-2*c+t,f=-2*s+3*c,m=s-c;return u=n(u,o,2*s-3*c+1),u=i(u,u,h,l),u=i(u,u,a,f),u=i(u,u,_,m)},r.getNoLerp=function(){return this.dataPoint},e}(),a=se((o=l).prototype,"dataPoint",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new t}}),s=se(o.prototype,"inTangent",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new t}}),c=se(o.prototype,"outTangent",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new t}}),r=o))||r;if(t===qn){var m=f.prototype.lerp;f.prototype.lerp=function(e,t,n){var i=m.call(this,e,t,n);return qn.normalize(i,i),i}}return f}e("M",vh("cc.animation.MorphWeightsValueProxy")((uP=function(){function e(){ae(this,"subMeshIndex",lP,this)}return e.prototype.forTarget=function(e){var t=this;return{set:function(n){e.setWeights(n,t.subMeshIndex)}}},e}(),lP=se((cP=uP).prototype,"subMeshIndex",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),sP=cP))||sP),e("a",vh("cc.animation.MorphWeightsAllValueProxy")(hP=function(){function e(){}return e.prototype.forTarget=function(e){return{set:function(t){for(var n,i,r=null!==(n=null===(i=e.mesh)||void 0===i?void 0:i.struct.primitives.length)&&void 0!==n?n:0,o=0;o<r;++o)e.setWeights(t,o)}}},e}())||hP);var xP=e("d",yP("cc.CubicSplineVec2Value",ri,ri.multiplyScalar,ri.scaleAndAdd));c.CubicSplineVec2Value=xP;var EP=e("f",yP("cc.CubicSplineVec3Value",Un,Un.multiplyScalar,Un.scaleAndAdd));c.CubicSplineVec3Value=EP;var SP=e("g",yP("cc.CubicSplineVec4Value",ci,ci.multiplyScalar,ci.scaleAndAdd));c.CubicSplineVec4Value=SP;var TP=e("h",yP("cc.CubicSplineQuatValue",qn,qn.multiplyScalar,qn.scaleAndAdd));c.CubicSplineQuatValue=TP;var AP=e("j",vh("cc.CubicSplineNumberValue")((vP=function(){function e(e,t,n){ae(this,"dataPoint",mP,this),ae(this,"inTangent",dP,this),ae(this,"outTangent",pP,this),this.dataPoint=e,this.inTangent=t,this.outTangent=n}var t=e.prototype;return t.lerp=function(e,t,n){var i=this.dataPoint,r=e.dataPoint,o=t*t*t,a=t*t;return i*(2*o-3*a+1)+this.outTangent*n*(o-2*a+t)+r*(-2*o+3*a)+e.inTangent*n*(o-a)},t.getNoLerp=function(){return this.dataPoint},e}(),mP=se((fP=vP).prototype,"dataPoint",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),dP=se(fP.prototype,"inTangent",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),pP=se(fP.prototype,"outTangent",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),_P=fP))||_P);function CP(e,t,n){void 0===n&&(n=1e-6);for(var i=0,r=e.length-1,o=r>>>1;i<=r;o=i+r>>>1){var a=e[o];if(a>t+n)r=o-1;else{if(!(a<t-n))return o;i=o+1}}return~i}function wP(e,t,n,i,r){var o=1-r;return o*(o*(e+(3*t-e)*r)+3*n*r*r)+i*r*r*r}c.CubicSplineNumberValue=AP,c.bezier=wP;var IP=Math.cos,bP=Math.acos,RP=Math.max,OP=2*Math.PI,NP=Math.sqrt;function PP(e){return e<0?-Math.pow(-e,1/3):Math.pow(e,1/3)}function MP(e,t){var n=function(e,t){var n,i,r,o,a=t-0,s=t-e[0],c=3*a,l=3*s,u=3*(t-e[2]),h=1/(-a+l-u+(t-1)),_=(c-6*s+u)*h,f=_*(1/3),m=(-c+l)*h,d=1/3*(3*m-_*_),p=d*(1/3),v=(2*_*_*_-9*_*m+a*h*27)/27,g=v/2,y=g*g+p*p*p;if(y<0){var x=1/3*-d,E=NP(x*x*x),S=-v/(2*E),T=bP(S<-1?-1:S>1?1:S),A=2*PP(E);return i=A*IP(T*(1/3))-f,r=A*IP((T+OP)*(1/3))-f,o=A*IP((T+2*OP)*(1/3))-f,i>=0&&i<=1?r>=0&&r<=1?o>=0&&o<=1?RP(i,r,o):RP(i,r):o>=0&&o<=1?RP(i,o):i:r>=0&&r<=1?o>=0&&o<=1?RP(r,o):r:o}if(0===y)return r=-(n=g<0?PP(-g):-PP(g))-f,(i=2*n-f)>=0&&i<=1?r>=0&&r<=1?RP(i,r):i:r;var C=NP(y);return(n=PP(-g+C))-PP(g+C)-f}(e,t),i=e[1];return((1-n)*(i+(e[3]-i)*n)*3+n*n)*n}c.bezierByTime=MP;var DP=e("fG",function(){function e(e){var t,n;this.ratios=void 0,this._findRatio=void 0,this.ratios=e;for(var i=!0,r=1,o=e.length;r<o;r++)if(t=e[r]-e[r-1],1===r)n=t;else if(Math.abs(t-n)>1e-6){i=!1;break}this._findRatio=i?BP:CP}return e.prototype.sample=function(e){return this._findRatio(this.ratios,e)},e}());c.RatioSampler=DP;var LP=e("fH",function(){function e(t,n){this.types=void 0,this.type=null,this._values=[],this._lerp=void 0,this._duration=void 0,this._array=void 0,this._duration=n,this._values=t.values;var i=function(t){return"string"==typeof t?t:Array.isArray(t)?t[0]===t[1]&&t[2]===t[3]?e.Linear:e.Bezier(t):e.Linear};if(void 0!==t.easingMethod)this.type=i(t.easingMethod);else if(Array.isArray(t.easingMethods))this.types=t.easingMethods.map(i);else if(void 0!==t.easingMethods){this.types=new Array(this._values.length).fill(null);for(var r=0,o=Object.keys(t.easingMethods);r<o.length;r++){var a=o[r];this.types[a]=i(t.easingMethods[a])}}else this.type=null;var s=t.values[0];(void 0===t.interpolate||t.interpolate)&&(this._lerp=$P(s)),void 0!==t._arrayLength&&(this._array=new Array(t._arrayLength))}e.Bezier=function(e){return e};var t=e.prototype;return t.hasLerp=function(){return!!this._lerp},t.valueAt=function(e){if(void 0===this._array){var t=this._values[e];return t&&t.getNoLerp?t.getNoLerp():t}for(var n=0;n<this._array.length;++n)this._array[n]=this._values[this._array.length*e+n];return this._array},t.valueBetween=function(e,t,n,i,r){if(this._lerp){var o=this.types?this.types[t]:this.type,a=r-n,s=(e-n)/a;if(o&&(s=zP(s,o)),void 0===this._array){var c=this._values[t],l=this._values[i];return this._lerp(c,l,s,a*this._duration)}for(var u=0;u<this._array.length;++u){var h=this._values[this._array.length*t+u],_=this._values[this._array.length*i+u];this._array[u]=this._lerp(h,_,s,a*this._duration)}return this._array}if(void 0===this._array)return this.valueAt(t);for(var f=0;f<this._array.length;++f)this._array[f]=this._values[this._array.length*t+f];return this._array},t.empty=function(){return 0===this._values.length},t.constant=function(){return 1===this._values.length},e}());function FP(e,t,n){var i=t.sample(n);if(i<0)if((i=~i)<=0)i=0;else{if(!(i>=t.ratios.length))return e.valueBetween(n,i-1,t.ratios[i-1],i,t.ratios[i]);i=t.ratios.length-1}return e.valueAt(i)}function zP(e,t){if("string"==typeof t){var n=vv[t];n?e=n(e):R(3906,t)}else Array.isArray(t)&&(e=MP(t,e));return e}function BP(e,t){var n=e.length-1;if(0===n)return 0;var i=e[0];if(t<i)return 0;var r=e[n];if(t>r)return n;var o=(t=(t-i)/(r-i))/(1/n),a=0|o;return o-a<1e-6?a:a+1-o<1e-6?a+1:~(a+1)}LP.Linear=null,c.AnimCurve=LP,e("fI",function(){function e(){this.events=[]}return e.prototype.add=function(e,t){this.events.push({func:e||"",params:t||[]})},e}()),c.sampleAnimationCurve=FP;var UP,GP,HP,kP,VP,jP,WP,qP,YP,XP,KP,QP,ZP,JP,$P=function(){function e(e,t,n,i){return e.lerp(t,n,i)}return function(t){if(null!==t){if("number"==typeof t)return Sn;if("object"==typeof t&&t.constructor){if(t instanceof qn)return n=new qn,function(e,t,i){return qn.slerp(n,e,t,i)};if(t instanceof At)return function(e){var t=new e;return function(n,i,r){return e.lerp(t,n,i,r),t}}(t.constructor);if(t.constructor===Number)return Sn;if("function"==typeof t.lerp)return e}var n}}}(),eM=e("bx",function(){function e(){}return e.getOrExtract=function(t){var n=e.pool.get(t);return n&&n.info.sample===t.sample||(n&&c.director.root.dataPoolManager.releaseAnimationClip(t),n=function(e){var t={};e.curves.forEach((function(e){if(!e.valueAdapter&&ZN(e.modifiers[0],rP)&&QN(e.modifiers[1])){var n=e.modifiers[0].path,i=t[n];i||(i=t[n]={}),i[e.modifiers[1]]={values:e.data.values,keys:e.data.keys}}}));for(var n=Math.ceil(e.sample*e.duration)+1,i=function(){var i=o[r],a=t[i];if(!a)return"continue";Object.defineProperty(a,"worldMatrix",{get:function(){if(!a._worldMatrix){var r=a.position,o=a.rotation,s=a.scale;tM(e,r,n),tM(e,o,n),tM(e,s,n),function(e,t,n){var i=n.position.values,r=n.rotation.values,o=n.scale.values,a=i.map((function(){return new ei})),s=t.lastIndexOf("/"),c=null;if(s>0){var l=e[t.substring(0,s)];if(!l)return void console.warn("no data for parent bone?");c=l.worldMatrix.values}for(var u=0;u<i.length;u++){var h=i[u],_=r[u],f=o[u],m=a[u];ei.fromRTS(m,_,h,f),c&&ei.multiply(m,c[u],m)}Object.keys(n).forEach((function(e){return delete n[e]})),n._worldMatrix={keys:0,interpolate:!1,values:a}}(t,i,a)}return a._worldMatrix}})},r=0,o=Object.keys(t);r<o.length;r++)i();return{info:{frames:n,sample:e.sample},data:t}}(t),e.pool.set(t,n)),n},e.destroy=function(t){e.pool.delete(t)},e}());function tM(e,t,n){var i=e.keys[t.keys],r=[];if(i&&1!==i.length)for(var o=t.values[0]instanceof qn,a=0,s=0;a<n;a++){for(var c=a/e.sample;i[s]<=c;)s++;s>i.length-1?c=i[s=i.length-1]:0===s&&(s=1);var l=t.values[s-1].clone(),u=i[s]-i[s-1],h=u?En((c-i[s-1])/u):1;o?l.slerp(t.values[s],h):l.lerp(t.values[s],h),r[a]=l}else for(var _=0;_<n;_++)r[_]=t.values[0].clone();t.values=r}eM.pool=new Map;var nM=e("fL",vh("cc.AnimationClip")((JP=ZP=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ae(t=e.call.apply(e,[this].concat(i))||this,"sample",HP,ie(t)),ae(t,"speed",kP,ie(t)),ae(t,"wrapMode",VP,ie(t)),ae(t,"events",jP,ie(t)),ae(t,"_duration",WP,ie(t)),ae(t,"_keys",qP,ie(t)),ae(t,"_stepness",YP,ie(t)),ae(t,"_curves",XP,ie(t)),ae(t,"_commonTargets",KP,ie(t)),ae(t,"_hash",QP,ie(t)),t.frameRate=0,t._ratioSamplers=[],t._runtimeCurves=void 0,t._runtimeEvents=void 0,t._data=null,t}$(t,e),t.createWithSpriteFrames=function(e,n){if(!Array.isArray(e))return R(3905),null;var i=new t;i.sample=n||i.sample,i.duration=e.length/i.sample;for(var r=1/i.sample,o=new Array(e.length),a=new Array(o.length),s=0;s<e.length;s++)o[s]=s*r,a[s]=e[s];return i.keys=[o],i.curves=[{modifiers:[new oP("cc.Sprite"),"spriteFrame"],data:{keys:0,values:a}}],i};var n=t.prototype;return n.onLoaded=function(){this.frameRate=this.sample,this._decodeCVTAs()},n.getPropertyCurves=function(){return this._runtimeCurves||this._createPropertyCurves(),this._runtimeCurves},n.updateEventDatas=function(){delete this._runtimeEvents},n.getEventGroupIndexAtRatio=function(e){return this._runtimeEvents||this._createRuntimeEvents(),CP(this._runtimeEvents.ratios,e)},n.hasEvents=function(){return 0!==this.events.length},n.destroy=function(){return c.director.root.dataPoolManager&&c.director.root.dataPoolManager.releaseAnimationClip(this),eM.destroy(this),e.prototype.destroy.call(this)},n._createPropertyCurves=function(){var e=this;this._ratioSamplers=this._keys.map((function(t){return new DP(t.map((function(t){return t/e._duration})))})),this._runtimeCurves=this._curves.map((function(t){return{curve:new LP(t.data,e._duration),modifiers:t.modifiers,valueAdapter:t.valueAdapter,sampler:e._ratioSamplers[t.data.keys],commonTarget:t.commonTarget}})),this._applyStepness()},n._createRuntimeEvents=function(){for(var e,t=this,n=[],i=[],r=function(){var r=e.value,o=r.frame/t._duration,a=n.findIndex((function(e){return e===o}));a<0&&(a=n.length,n.push(o),i.push({events:[]})),i[a].events.push({functionName:r.func,parameters:r.params})},o=oe(this.events.sort((function(e,t){return e.frame-t.frame})));!(e=o()).done;)r();this._runtimeEvents={ratios:n,eventGroups:i}},n._applyStepness=function(){},n._decodeCVTAs=function(){var e=ArrayBuffer.isView(this._nativeAsset)?this._nativeAsset.buffer:this._nativeAsset;if(e){for(var t=this._keys,n=0;n<t.length;++n){var i=t[n];i instanceof YE&&(t[n]=i.decompress(e))}for(var r=0;r<this._curves.length;++r){var o=this._curves[r];o.data.values instanceof YE&&(o.data.values=o.data.values.decompress(e))}}},Z(t,[{key:"duration",get:function(){return this._duration},set:function(e){this._duration=e}},{key:"keys",get:function(){return this._keys},set:function(e){this._keys=e}},{key:"eventGroups",get:function(){return this._runtimeEvents||this._createRuntimeEvents(),this._runtimeEvents.eventGroups}},{key:"stepness",get:function(){return this._stepness},set:function(e){this._stepness=e,this._applyStepness()}},{key:"hash",get:function(){if(this._hash)return this._hash;var e=this._nativeAsset,t=new Uint8Array(ArrayBuffer.isView(e)?e.buffer:e);return this._hash=is(t,666)}},{key:"curves",get:function(){return this._curves},set:function(e){this._curves=e,delete this._runtimeCurves}},{key:"data",get:function(){return this._data}},{key:"commonTargets",get:function(){return this._commonTargets},set:function(e){this._commonTargets=e}}]),t}(H_),ZP.preventDeferredLoadDependents=!0,ZP.WrapMode=Il,HP=se((GP=JP).prototype,"sample",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 60}}),kP=se(GP.prototype,"speed",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),VP=se(GP.prototype,"wrapMode",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Il.Normal}}),jP=se(GP.prototype,"events",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),WP=se(GP.prototype,"_duration",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),qP=se(GP.prototype,"_keys",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),YP=se(GP.prototype,"_stepness",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),XP=se(GP.prototype,"_curves",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),KP=se(GP.prototype,"_commonTargets",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),QP=se(GP.prototype,"_hash",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),UP=GP))||UP);function iM(e,t,n){var i,r=t[t.length-1];if(0!==t.length&&QN(r)&&!n){var o=aP.apply(void 0,[e].concat(t.slice(0,t.length-1)));if(null===o)return null;i={isProxy:!1,object:o,property:r}}else{if(!n)return y("Empty animation curve."),null;var a=aP.apply(void 0,[e].concat(t));if(null===a)return null;i={isProxy:!0,proxy:n.forTarget(a)}}return{setValue:function(e){i.isProxy?i.proxy.set(e):i.object[i.property]=e},getValue:function(){return i.isProxy?i.proxy.get?i.proxy.get():(y("Target doesn't provide a get method."),null):i.object[i.property]}}}function rM(e,t,n){var i=iM(e,t,n);if(null===i)return null;var r=i.getValue(),o=aM(r);if(!o)return y("Value is not copyable!"),null;var a=o.createBuffer(),s=o.copy;return Object.assign(i,{peek:function(){return a},pull:function(){var e=i.getValue();s(a,e)},push:function(){i.setValue(a)}})}c.AnimationClip=nM;var oM,aM=((oM=new Map).set(ri,{createBuffer:function(){return new ri},copy:ri.copy}),oM.set(Un,{createBuffer:function(){return new Un},copy:Un.copy}),oM.set(ci,{createBuffer:function(){return new ci},copy:ci.copy}),oM.set(zn,{createBuffer:function(){return new zn},copy:zn.copy}),oM.set(hi,{createBuffer:function(){return new hi},copy:function(e,t){return e.set(t)}}),function(e){return oM.get(null==e?void 0:e.constructor)}),sM=function(){function e(){this._isPlaying=!1,this._isPaused=!1,this._stepOnce=!1}var t=e.prototype;return t.play=function(){this._isPlaying?this._isPaused?(this._isPaused=!1,this.onResume()):this.onError(M(3912)):(this._isPlaying=!0,this.onPlay())},t.stop=function(){this._isPlaying&&(this._isPlaying=!1,this.onStop(),this._isPaused=!1)},t.pause=function(){this._isPlaying&&!this._isPaused&&(this._isPaused=!0,this.onPause())},t.resume=function(){this._isPlaying&&this._isPaused&&(this._isPaused=!1,this.onResume())},t.step=function(){this.pause(),this._stepOnce=!0,this._isPlaying||this.play()},t.update=function(){},t.onPlay=function(){},t.onPause=function(){},t.onResume=function(){},t.onStop=function(){},t.onError=function(){},Z(e,[{key:"isPlaying",get:function(){return this._isPlaying}},{key:"isPaused",get:function(){return this._isPaused}},{key:"isMotionless",get:function(){return!this.isPlaying||this.isPaused}}]),e}(),cM=function(){function e(){this._nodeBlendStates=new Map,this._states=new Set}var t=e.prototype;return t.ref=function(e,t){var n=this._nodeBlendStates.get(e);n||(n={dirty:!1,properties:{}},this._nodeBlendStates.set(e,n));var i=n.properties[t];return i||(i=n.properties[t]=new hM(n,lM(t)?new Un:new qn)),++i.refCount,i},t.deRef=function(e,t){var n=this._nodeBlendStates.get(e);if(n){var i=n.properties[t];i&&(--i.refCount,i.refCount>0||(delete n.properties[t],function(e){return!(e.properties.position||e.properties.rotation||e.properties.eulerAngles||e.properties.scale)}(n)&&this._nodeBlendStates.delete(e)))}},t.apply=function(){this._nodeBlendStates.forEach((function(e,t){if(e.dirty){e.dirty=!1;var n,i,r,o=e.properties,a=o.position,s=o.scale,c=o.rotation,l=o.eulerAngles,u=!1;a&&0!==a.weight&&(a.weight=0,n=a.value,u=!0),s&&0!==s.weight&&(s.weight=0,i=s.value,u=!0),c&&0!==c.weight&&(c.weight=0,r=c.value,u=!0),l&&0!==l.weight&&(l.weight=0,r=l.value,u=!0),u&&t.setRTS(r,n,i)}})),this._states.forEach((function(e){e.onBlendFinished()}))},t.bindState=function(e){this._states.add(e)},t.unbindState=function(e){this._states.delete(e)},e}();function lM(e){return!function(e){return"rotation"===e}(e)}var uM,hM=function(){function e(e,t){this.weight=0,this.value=void 0,this.refCount=0,this._node=void 0,this._node=e,this.value=t}return e.prototype.markAsDirty=function(){this._node.dirty=!0},e}();function _M(e,t,n){return 0===n.weight&&Un.zero(n.value),0===t?n.value:1===t?Un.copy(n.value,e):Un.scaleAndAdd(n.value,n.value,e,t)}function fM(e,t,n){if(0===n.weight&&qn.identity(n.value),0===t)return n.value;if(1===t)return qn.copy(n.value,e);var i=t/(n.weight+t);return qn.slerp(n.value,n.value,e,i)}!function(e){e.PLAY="play",e.STOP="stop",e.PAUSE="pause",e.RESUME="resume",e.LASTFRAME="lastframe",e.FINISHED="finished"}(uM||(uM={})),Tt(uM);var mM=function(){function e(e,t,n){this.commonTargetIndex=void 0,this._curve=void 0,this._boundTarget=void 0,this._rootTargetProperty=void 0,this._curveDetail=void 0,this._curve=e.curve,this._curveDetail=e,this._boundTarget=n}var t=e.prototype;return t.applySample=function(e,t,n,i,r){var o;this._curve.empty()||(o=this._curve.hasLerp()&&n?this._curve.valueBetween(e,i.from,i.fromRatio,i.to,i.toRatio):this._curve.valueAt(t),this._setValue(o,r))},t._setValue=function(e){this._boundTarget.setValue(e)},Z(e,[{key:"propertyName",get:function(){return this._rootTargetProperty||""}},{key:"curveDetail",get:function(){return this._curveDetail}}]),e}(),dM=e("bP",function(e){function t(t,n){var i;return void 0===n&&(n=""),(i=e.call(this)||this).duration=1,i.speed=1,i.time=0,i.weight=0,i.frameRate=0,i._targetNode=null,i._curveLoaded=!1,i._clip=void 0,i._process=i.process,i._samplerSharedGroups=[],i._target=null,i._ignoreIndex=-1,i._commonTargetStatuses=[],i._wrapMode=Il.Normal,i._repeatCount=1,i._delay=0,i._delayTime=0,i._currentFramePlayed=!1,i._name=void 0,i._lastIterations=void 0,i._lastWrapInfo=null,i._lastWrapInfoEvent=null,i._wrappedInfo=new Ol,i._blendStateBuffer=null,i._blendStateWriters=[],i._allowLastFrame=!1,i._blendStateWriterHost={weight:0,enabled:!1},i._clip=t,i._name=n||t&&t.name,i}$(t,e),Z(t,[{key:"clip",get:function(){return this._clip}},{key:"name",get:function(){return this._name}},{key:"length",get:function(){return this.duration}},{key:"wrapMode",get:function(){return this._wrapMode},set:function(e){this._wrapMode=e,this.time=0,e&wl.Loop?this.repeatCount=1/0:this.repeatCount=1}},{key:"repeatCount",get:function(){return this._repeatCount},set:function(e){this._repeatCount=e;var t=this._wrapMode&wl.ShouldWrap,n=(this.wrapMode&wl.Reverse)===wl.Reverse;this._process=e!==1/0||t||n?this.process:this.simpleProcess}},{key:"delay",get:function(){return this._delay},set:function(e){this._delayTime=this._delay=e}},{key:"current",get:function(){return this.getWrappedInfo(this.time).time}},{key:"ratio",get:function(){return this.current/this.duration}}]);var n=t.prototype;return n.initialize=function(e,t){var n,i,r=this;if(!this._curveLoaded){this._curveLoaded=!0,this._destroyBlendStateWriters(),this._samplerSharedGroups.length=0,this._blendStateBuffer=null!==(n=null===(i=c.director.getAnimationManager())||void 0===i?void 0:i.blendState)&&void 0!==n?n:null,this._blendStateBuffer&&this._blendStateBuffer.bindState(this),this._targetNode=e;var o=this._clip;this.duration=o.duration,this.speed=o.speed,this.wrapMode=o.wrapMode,this.frameRate=o.sample,(this.wrapMode&wl.Loop)===wl.Loop?this.repeatCount=1/0:this.repeatCount=1;var a=function(e,t,n,i,o){if(!function(e){var t;if(1===e.length&&"string"==typeof e[0])t=e[0];else if(e.length>1){for(var n=0;n<e.length-1;++n)if(!(e[n]instanceof rP))return!1;t=e[e.length-1]}switch(t){case"position":case"scale":case"rotation":case"eulerAngles":return!0;default:return!1}}(n)||!r._blendStateBuffer)return e(t,n,i);var a=aP.apply(void 0,[t].concat(n.slice(0,n.length-1)));if(null!==a&&a instanceof FC){var s=n[n.length-1],c=function(e,t,n,i,r){var o=lM(n)?_M:fM,a=e.ref(t,n),s=!1,c=-1;return{destroy:function(){a&&(e.deRef(t,n),a=null)},forTarget:function(){return{get:function(){return t[n]},set:function(e){if(a&&i.enabled){var t=i.weight;if(r)if(1!==t||t!==c)s=!1;else if(s)return;o(e,t,a),a.weight+=t,a.markAsDirty(),s=!0,c=t}}}}}}(r._blendStateBuffer,a,s,r._blendStateWriterHost,o);return r._blendStateWriters.push(c),e(t,[],c)}return null};this._commonTargetStatuses=o.commonTargets.map((function(t){var n=a(rM,e,t.modifiers,t.valueAdapter,!1);return null===n?null:{target:n,changed:!1}})),t||(t=o.getPropertyCurves());for(var s=function(n){var i=t[n],o=r._samplerSharedGroups.find((function(e){return e.sampler===i.sampler}));o||(o={sampler:i.sampler,curves:[],samplerResultCache:{from:0,fromRatio:0,to:0,toRatio:0}},r._samplerSharedGroups.push(o));var s=void 0;if(void 0===i.commonTarget)s=e;else{var c=r._commonTargetStatuses[i.commonTarget];if(!c)return"continue";s=c.target.peek()}var l=a(iM,s,i.modifiers,i.valueAdapter,i.curve.constant());if(null===l);else{var u=new mM(i,s,l);u.commonTargetIndex=i.commonTarget,o.curves.push(u)}},l=0;l<t.length;++l)s(l)}},n.destroy=function(){this._destroyBlendStateWriters()},n.onBlendFinished=function(){this._blendStateWriterHost.enabled=!1},n.emit=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];c.director.getAnimationManager().pushDelayEvent(this._emit,this,t)},n.on=function(e,t,n){return this._target&&this._target.isValid?this._target.on(e,t,n):null},n.once=function(e,t,n){return this._target&&this._target.isValid?this._target.once(e,t,n):null},n.off=function(e,t,n){this._target&&this._target.isValid&&this._target.off(e,t,n)},n.allowLastFrameEvent=function(e){this._allowLastFrame=e},n._setEventTarget=function(e){this._target=e},n.setTime=function(e){this._currentFramePlayed=!1,this.time=e||0,this._lastWrapInfoEvent=null,this._ignoreIndex=-1;var t=this.getWrappedInfo(e,this._wrappedInfo),n=t.direction,i=this._clip.getEventGroupIndexAtRatio(t.ratio);i<0&&(i=~i-1,n<0&&(i+=1),this._ignoreIndex=i)},n.update=function(e){this._delayTime>0&&(this._delayTime-=e,this._delayTime>0)||(this._currentFramePlayed?this.time+=e*this.speed:this._currentFramePlayed=!0,this._process())},n.sample=function(){var e=this.getWrappedInfo(this.time,this._wrappedInfo);return this._sampleCurves(e.ratio),this._sampleEvents(e),e},n.onPlay=function(){this.setTime(0),this._delayTime=this._delay,this._onReplayOrResume(),this.emit(uM.PLAY,this)},n.onStop=function(){this.isPaused||this._onPauseOrStop(),this.emit(uM.STOP,this)},n.onResume=function(){this._onReplayOrResume(),this.emit(uM.RESUME,this)},n.onPause=function(){this._onPauseOrStop(),this.emit(uM.PAUSE,this)},n._sampleCurves=function(e){this._blendStateWriterHost.weight=this.weight,this._blendStateWriterHost.enabled=!0;for(var t=0;t<this._commonTargetStatuses.length;++t){var n=this._commonTargetStatuses[t];n&&(n.target.pull(),n.changed=!1)}for(var i=0,r=this._samplerSharedGroups.length;i<r;++i){var o=this._samplerSharedGroups[i],a=o.sampler,s=o.samplerResultCache,c=0,l=!1;a?(c=a.sample(e))<0&&((c=~c)<=0?c=0:c>=a.ratios.length?c=a.ratios.length-1:(l=!0,s.from=c-1,s.fromRatio=a.ratios[s.from],s.to=c,s.toRatio=a.ratios[s.to],c=s.from)):c=0;for(var u=0,h=o.curves.length;u<h;++u){var _=o.curves[u];if(_.applySample(e,c,l,s,this.weight),void 0!==_.commonTargetIndex){var f=this._commonTargetStatuses[_.commonTargetIndex];f&&(f.changed=!0)}}}for(var m=0;m<this._commonTargetStatuses.length;++m){var d=this._commonTargetStatuses[m];d&&d.changed&&d.target.push()}},n.process=function(){var e,t=this.sample();this._allowLastFrame&&(e=this._lastWrapInfo?this._lastWrapInfo:this._lastWrapInfo=new Ol(t),this.repeatCount>1&&(0|t.iterations)>(0|e.iterations)&&this.emit(uM.LASTFRAME,this),e.set(t)),t.stopped&&(this.stop(),this.emit(uM.FINISHED,this))},n.simpleProcess=function(){var e=this.duration,t=this.time%e;t<0&&(t+=e);var n=t/e;this._sampleCurves(n),this._clip.hasEvents()&&this._sampleEvents(this.getWrappedInfo(this.time,this._wrappedInfo)),this._allowLastFrame&&(void 0===this._lastIterations&&(this._lastIterations=n),(this.time>0&&this._lastIterations>n||this.time<0&&this._lastIterations<n)&&this.emit(uM.LASTFRAME,this),this._lastIterations=n)},n.cache=function(){},n._needReverse=function(e){var t=this.wrapMode,n=!1;return(t&wl.PingPong)===wl.PingPong&&(e-(0|e)==0&&e>0&&(e-=1),1&e&&(n=!n)),(t&wl.Reverse)===wl.Reverse&&(n=!n),n},n.getWrappedInfo=function(e,t){t=t||new Ol;var n=!1,i=this.duration,r=this.repeatCount,o=e>0?e/i:-e/i;if(o>=r){o=r,n=!0;var a=r-(0|r);0===a&&(a=1),e=a*i*(e>0?1:-1)}if(e>i){var s=e%i;e=0===s?i:s}else e<0&&0!=(e%=i)&&(e+=i);var c=!1,l=this._wrapMode&wl.ShouldWrap;l&&(c=this._needReverse(o));var u=c?-1:1;return this.speed<0&&(u*=-1),l&&c&&(e=i-e),t.ratio=e/i,t.time=e,t.direction=u,t.stopped=n,t.iterations=o,t},n._sampleEvents=function(e){var t=this._clip.eventGroups.length,n=e.direction,i=this._clip.getEventGroupIndexAtRatio(e.ratio);if(i<0&&(i=~i-1,n<0&&(i+=1)),this._ignoreIndex!==i&&(this._ignoreIndex=-1),e.frameIndex=i,!this._lastWrapInfoEvent)return this._fireEvent(i),void(this._lastWrapInfoEvent=new Ol(e));var r=this.wrapMode,o=pM(e.iterations),a=this._lastWrapInfoEvent,s=pM(a.iterations),l=a.frameIndex,u=a.direction,h=-1!==s&&o!==s;if(l===i&&h&&1===t)this._fireEvent(0);else if(l!==i||h){n=u;do{if(l!==i){if(-1===n&&0===l&&i>0?((r&wl.PingPong)===wl.PingPong?n*=-1:l=t,s++):1===n&&l===t-1&&i<t-1&&((r&wl.PingPong)===wl.PingPong?n*=-1:l=-1,s++),l===i)break;if(s>o)break}l+=n,c.director.getAnimationManager().pushDelayEvent(this._fireEvent,this,[l])}while(l!==i&&l>-1&&l<t)}this._lastWrapInfoEvent.set(e)},n._emit=function(e,t){this._target&&this._target.isValid&&this._target.emit(e,e,t)},n._fireEvent=function(e){if(this._targetNode&&this._targetNode.isValid){var t=this._clip.eventGroups;if(!(e<0||e>=t.length||this._ignoreIndex===e))for(var n,i=t[e],r=this._targetNode.components,o=oe(i.events);!(n=o()).done;)for(var a,s=n.value,c=s.functionName,l=oe(r);!(a=l()).done;){var u=a.value,h=u[c];"function"==typeof h&&h.apply(u,s.parameters)}}},n._onReplayOrResume=function(){c.director.getAnimationManager().addAnimation(this)},n._onPauseOrStop=function(){c.director.getAnimationManager().removeAnimation(this)},n._destroyBlendStateWriters=function(){for(var e=0;e<this._blendStateWriters.length;++e)this._blendStateWriters[e].destroy();this._blendStateWriters.length=0,this._blendStateBuffer&&(this._blendStateBuffer.unbindState(this),this._blendStateBuffer=null),this._blendStateWriterHost.enabled=!1},Z(t,[{key:"curveLoaded",get:function(){return this._curveLoaded}}]),t}(sM));function pM(e){return e-(0|e)==0&&(e-=1),0|e}c.AnimationState=dM;var vM,gM,yM,xM,EM,SM,TM,AM,CM,wM,IM,bM,RM,OM,NM,PM,MM,DM=function(e){function t(){var t;return(t=e.call(this)||this)._managedStates=[],t._fadings=[],t}$(t,e);var n=t.prototype;return n.update=function(e){if(!this.isMotionless){for(var t=0;t<this._managedStates.length;++t){var n=this._managedStates[t].state;n&&(n.weight=0)}for(var i=1,r=this._fadings.length,o=0;o<this._fadings.length;++o){var a=this._fadings[o];a.easeTime+=e;var s=0===a.easeDuration?1:En(a.easeTime/a.easeDuration),c=s*i;if(i*=1-s,a.target.state&&(a.target.state.weight+=c),a.easeTime>=a.easeDuration){r=o+1,a.easeTime=a.easeDuration;break}}if(r!==this._fadings.length){for(var l=r;l<this._fadings.length;++l){var u=this._fadings[l];--u.target.reference,u.target.reference<=0&&(u.target.state&&u.target.state.stop(),be(this._managedStates,u.target))}this._fadings.splice(r)}for(var h=0;h<this._managedStates.length;++h){var _=this._managedStates[h].state;_&&_.isMotionless&&_.sample()}}},n.crossFade=function(e,t){var n;0===this._managedStates.length&&(t=0),0===t&&this.clear();var i=this._managedStates.find((function(t){return t.state===e}));i?(null===(n=i.state)||void 0===n?void 0:n.isMotionless)&&i.state.play():(i={state:e,reference:0},e&&e.play(),this._managedStates.push(i)),++i.reference,this._fadings.unshift({easeDuration:t,easeTime:0,target:i})},n.clear=function(){for(var e=0;e<this._managedStates.length;++e){var t=this._managedStates[e].state;t&&t.stop()}this._managedStates.length=0,this._fadings.length=0},n.onPlay=function(){e.prototype.onPlay.call(this),c.director.getAnimationManager().addCrossFade(this)},n.onPause=function(){e.prototype.onPause.call(this),c.director.getAnimationManager().removeCrossFade(this);for(var t=0;t<this._managedStates.length;++t){var n=this._managedStates[t].state;n&&n.pause()}},n.onResume=function(){e.prototype.onResume.call(this),c.director.getAnimationManager().addCrossFade(this);for(var t=0;t<this._managedStates.length;++t){var n=this._managedStates[t].state;n&&n.resume()}},n.onStop=function(){e.prototype.onStop.call(this),c.director.getAnimationManager().removeCrossFade(this),this.clear()},t}(sM),LM=e("bQ",(vM=vh("cc.Animation"),gM=Oh(),yM=yh(99),xM=wh(),EM=qh([nM]),SM=Dh(),TM=qh(nM),AM=Dh(),CM=Dh(),wM=qh([nM]),vM(IM=gM(IM=yM(IM=Ch(IM=xM((MM=PM=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ae(t=e.call.apply(e,[this].concat(i))||this,"playOnLoad",RM,ie(t)),t._crossFade=new DM,t._nameToState=ke(!0),ae(t,"_clips",OM,ie(t)),ae(t,"_defaultClip",NM,ie(t)),t._hasBeenPlayed=!1,t}$(t,e);var n=t.prototype;return n.onLoad=function(){for(var e in this.clips=this._clips,this._nameToState)this._nameToState[e].initialize(this.node)},n.start=function(){this.playOnLoad&&!this._hasBeenPlayed&&this._defaultClip&&this.crossFade(this._defaultClip.name,0)},n.onEnable=function(){this._crossFade.resume()},n.onDisable=function(){this._crossFade.pause()},n.onDestroy=function(){for(var e in this._crossFade.stop(),this._nameToState)this._nameToState[e].destroy();this._nameToState=ke(!0)},n.play=function(e){if(this._hasBeenPlayed=!0,!e){if(!this._defaultClip)return;e=this._defaultClip.name}this.crossFade(e,0)},n.crossFade=function(e,t){void 0===t&&(t=.3),this._hasBeenPlayed=!0;var n=this._nameToState[e];n&&(this._crossFade.play(),this._crossFade.crossFade(n,t))},n.pause=function(){this._crossFade.pause()},n.resume=function(){this._crossFade.resume()},n.stop=function(){this._crossFade.stop()},n.getAnimationState=function(e){return this.getState(e)},n.getState=function(e){var t=this._nameToState[e];return t&&!t.curveLoaded&&t.initialize(this.node),t||null},n.createState=function(e,t){return t=t||e.name,this.removeState(t),this._doCreateState(e,t)},n.removeState=function(e){var t=this._nameToState[e];t&&(t.allowLastFrameEvent(!1),t.stop(),delete this._nameToState[e])},n.addClip=function(e,t){return Re(this._clips,e)||this._clips.push(e),this.createState(e,t)},n.removeClip=function(e,t){var n;for(var i in this._nameToState){var r=this._nameToState[i];if(r.clip===e){n=r;break}}if(e===this._defaultClip){if(!t)return void I(3902);this._defaultClip=null}if(n&&n.isPlaying){if(!t)return void I(3903);n.stop()}this._clips=this._clips.filter((function(t){return t!==e})),n&&delete this._nameToState[n.name]},n.on=function(t,n,i,r){var o=e.prototype.on.call(this,t,n,i,r);return t===uM.LASTFRAME&&this._syncAllowLastFrameEvent(),o},n.once=function(t,n,i){var r=e.prototype.once.call(this,t,n,i);return t===uM.LASTFRAME&&this._syncAllowLastFrameEvent(),r},n.off=function(t,n,i){e.prototype.off.call(this,t,n,i),t===uM.LASTFRAME&&this._syncDisallowLastFrameEvent()},n._createState=function(e,t){return new dM(e,t)},n._doCreateState=function(e,t){var n=this._createState(e,t);return n._setEventTarget(this),n.allowLastFrameEvent(this.hasEventListener(uM.LASTFRAME)),this.node&&n.initialize(this.node),this._nameToState[n.name]=n,n},n._getStateByNameOrDefaultClip=function(e){if(!e){if(!this._defaultClip)return null;e=this._defaultClip.name}return this._nameToState[e]||null},n._removeStateOfAutomaticClip=function(e){for(var t in this._nameToState){var n=this._nameToState[t];FM(e,n.clip)&&(n.stop(),delete this._nameToState[t])}},n._syncAllowLastFrameEvent=function(){if(this.hasEventListener(uM.LASTFRAME))for(var e in this._nameToState)this._nameToState[e].allowLastFrameEvent(!0)},n._syncDisallowLastFrameEvent=function(){if(!this.hasEventListener(uM.LASTFRAME))for(var e in this._nameToState)this._nameToState[e].allowLastFrameEvent(!1)},Z(t,[{key:"clips",get:function(){return this._clips},set:function(e){var t=this;this._crossFade&&this._crossFade.clear();for(var n,i=oe(this._clips);!(n=i()).done;){var r=n.value;r&&this._removeStateOfAutomaticClip(r)}for(var o,a=oe(e);!(o=a()).done;){var s=o.value;s&&this.createState(s)}var c=e.find((function(e){return FM(e,t._defaultClip)}));this._defaultClip=c||null,this._clips=e}},{key:"defaultClip",get:function(){return this._defaultClip},set:function(e){this._defaultClip=e,e&&(this._clips.findIndex((function(t){return FM(t,e)}))>=0||(this._clips.push(e),this.createState(e)))}}]),t}(D_(cm)),PM.EventType=uM,se((bM=MM).prototype,"clips",[EM,SM],Object.getOwnPropertyDescriptor(bM.prototype,"clips"),bM.prototype),se(bM.prototype,"defaultClip",[TM,AM],Object.getOwnPropertyDescriptor(bM.prototype,"defaultClip"),bM.prototype),RM=se(bM.prototype,"playOnLoad",[Sh,CM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),OM=se(bM.prototype,"_clips",[wM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),NM=se(bM.prototype,"_defaultClip",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),IM=bM))||IM)||IM)||IM)||IM)||IM));function FM(e,t){return e===t||!(!e||!t||e.name!==t.name&&e._uuid!==t._uuid)}ve(LM.prototype,"Animation",[{name:"getAnimationState",newName:"getState"},{name:"addClip",newName:"createState"},{name:"removeClip",newName:"removeState",customFunction:function(){var e=arguments.length<=0?void 0:arguments[0];return LM.prototype.removeState.call(this,e.name)}}]),c.AnimationComponent=LM,gt.setClassAlias(LM,"cc.AnimationComponent");var zM,BM,UM,GM=[],HM=new Map;function kM(e,t){for(var n=0,i=ei.IDENTITY;e;){if(e.stamp===t||e.stamp+1===t&&!e.node.hasChangedFlags){i=e.world,e.stamp=t;break}e.stamp=t,GM[n++]=e,e=e.parent}for(;n>0;){var r=(e=GM[--n]).node;ei.fromRTS(e.local,r.rotation,r.position,r.scale),i=ei.multiply(e.world,i,e.local)}return i}function VM(e,t){for(var n,i=null,r=0;e!==t;){var o=e.uuid;if(HM.has(o)){i=HM.get(o);break}i={node:e,local:new ei,world:new ei,stamp:-1,parent:null},HM.set(o,i),GM[r++]=i,e=e.parent,i=null}for(;r>0;)(n=GM[--r]).parent=i,i=n;return i}function jM(e){for(var t=HM.get(e.uuid)||null;t;)HM.delete(t.node.uuid),t=t.parent}var WM=e("fM",vh((UM=BM=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this)._anims=new Ce([]),t._delayEvents=[],t._blendStateBuffer=new cM,t._crossFades=[],t._sockets=[],t}$(t,e);var n=t.prototype;return n.addCrossFade=function(e){this._crossFades.push(e)},n.removeCrossFade=function(e){be(this._crossFades,e)},n.update=function(e){for(var t=this._delayEvents,n=this._crossFades,i=this._sockets,r=0,o=n.length;r<o;r++)n[r].update(e);var a=this._anims,s=a.array;for(a.i=0;a.i<s.length;++a.i){var l=s[a.i];l.isMotionless||l.update(e)}this._blendStateBuffer.apply();for(var u=c.director.getTotalFrames(),h=0,_=i.length;h<_;h++){var f=i[h],m=f.target,d=f.transform;m.matrix=kM(d,u)}for(var p=0,v=t.length;p<v;p++){var g=t[p];g.fn.apply(g.thisArg,g.args)}t.length=0},n.destruct=function(){},n.addAnimation=function(e){-1===this._anims.array.indexOf(e)&&this._anims.push(e)},n.removeAnimation=function(e){var t=this._anims.array.indexOf(e);t>=0?this._anims.fastRemoveAt(t):R(3907)},n.pushDelayEvent=function(e,t,n){this._delayEvents.push({fn:e,thisArg:t,args:n})},n.addSockets=function(e,t){for(var n=this,i=function(i){var r=t[i];if(n._sockets.find((function(e){return e.target===r.target})))return"continue";var o=e.getChildByPath(r.path),a=r.target&&o&&VM(o,e);a&&n._sockets.push({target:r.target,transform:a})},r=0;r<t.length;++r)i(r)},n.removeSockets=function(e,t){for(var n=0;n<t.length;++n)for(var i=t[n],r=0;r<this._sockets.length;++r){var o=this._sockets[r];if(o.target===i.target){jM(o.transform.node),this._sockets[r]=this._sockets[this._sockets.length-1],this._sockets.length--;break}}},Z(t,[{key:"blendState",get:function(){return this._blendStateBuffer}}]),t}(EA),BM.ID="animation",zM=UM))||zM);Gb.on(Ub.EVENT_INIT,(function(){var e=new WM;Gb.registerSystem(WM.ID,e,IA.PRIORITY_SYSTEM)})),c.AnimationManager=WM;var qM,YM,XM,KM,QM=new ei;c.easing=vv;var ZM=e("fx",vh("cc.HierachyModifier")(qM=function(e){function t(){return e.apply(this,arguments)||this}return $(t,e),t}(rP))||qM);c.HierachyModifier=ZM;var JM=e("fy",vh("cc.ComponentModifier")(YM=function(e){function t(){return e.apply(this,arguments)||this}return $(t,e),t}(oP))||YM);c.ComponentModifier=JM;var $M=e("fz",vh("cc.CurveValueAdapter")(XM=function(){function e(){}return e.prototype.forTarget=function(){return{set:function(){}}},e}())||XM);c.CurveValueAdapter=$M;var eD=e("fA",vh("cc.UniformCurveValueAdapter")(KM=function(e){function t(){return e.apply(this,arguments)||this}return $(t,e),t}(gP))||KM);function tD(e){return"string"==typeof e}function nD(e){return"number"==typeof e}function iD(e,t){return e instanceof t}c.UniformCurveValueAdapter=eD,c.isPropertyModifier=tD,c.isElementModifier=nD,c.isCustomTargetModifier=iD,c.math=di,c.geometry=Wl;var rD=e("fO",function(){function e(e){this.poolHandlerComp=void 0,this._pool=void 0,this.poolHandlerComp=e,this._pool=[]}var t=e.prototype;return t.size=function(){return this._pool.length},t.clear=function(){for(var e=this._pool.length,t=0;t<e;++t)this._pool[t].destroy();this._pool.length=0},t.put=function(e){if(e&&-1===this._pool.indexOf(e)){e.removeFromParent();var t=this.poolHandlerComp?e.getComponent(this.poolHandlerComp):null;t&&t.unuse&&t.unuse(),this._pool.push(e)}},t.get=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=this._pool.length-1;if(i<0)return null;var r=this._pool[i];this._pool.length=i;var o=this.poolHandlerComp?r.getComponent(this.poolHandlerComp):null;return o&&o.reuse&&o.reuse(arguments),r},e}());c.NodePool=rD,c.renderer=Bp;var oD=new URL("assets/ammo.wasm-2f572f72.wasm",t.meta.url).href;let aD,sD=!1;"undefined"==typeof WebAssembly?aD=await t.import("./ammo-f0bdd709.js"):(aD=await t.import("./ammo.wasm-baa9669a.js"),sD=!0);var cD,lD=aD.default,uD=e("d6",{});function hD(e){var t={};return void 0!==e&&(uD.wasmBinary=e),new Promise((function(e){lD.call(t,uD).then((function(){e()}))}))}(cD=hD||(hD=e("fP",{}))).isWasm=sD,cD.wasmBinaryURL=oD}}}));
