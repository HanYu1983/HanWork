{"version":3,"sources":["app3/system/action.cljs"],"mappings":"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","names":["model","event","pred__36310","cljs.core/=","expr__36311","cljs.core/first","G__36313","G__36314","vec__36315","cljs.core/rest","app3.system.action/actionController","entities","origin","cljs.core.filter.cljs$core$IFn$_invoke$arity$2","cljs.core.partial.cljs$core$IFn$_invoke$arity$2","app3.tool/checkProperty","next","cljs.core.map.cljs$core$IFn$_invoke$arity$2","p__36318","map__36319","cljs.core/PROTOCOL_SENTINEL","cljs.core.apply.cljs$core$IFn$_invoke$arity$2","cljs.core/hash-map","entity","cljs.core.get.cljs$core$IFn$_invoke$arity$2","cljs.core.update.cljs$core$IFn$_invoke$arity$3","cljs.core/replace","cljs.core/zipmap","pos","vel","action","G__36323","cljs.core/some","cljs.core/contains?","fexpr__36325","v","G__36326","cljs.core.map.cljs$core$IFn$_invoke$arity$3","cljs.core/+","cljs.core.merge.cljs$core$IFn$_invoke$arity$variadic","fexpr__36327","self","target","app3.interface.player/target","dir","app3.tool/seek","app3.tool/makeLength","app3.tool/length","fexpr__36357","fexpr__36358","weapon","nextWeapon","app3.interface.weapon/fire","isFireSuccess","cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2","app3.emitter/send","fexpr__36359","weapons","seekWeapon","clojure.set.difference.cljs$core$IFn$_invoke$arity$2","fexpr__36360","healing","seekHealing"],"sourcesContent":["(ns app3.system.action\n  (:require-macros [app3.macros :as m])\n  (:require [app3.emitter :refer [send]]\n            [app3.interface.player]\n            [app3.interface.weapon]))\n\n(m/defsys actionController\n  :update []\n  (m/docom {pos :position vel :velocity action :action}\n    (cond-> entity\n            (some (partial contains? action) [:up :left :down :right])\n            ((fn [entity]\n               (let [v (cond->> [0 0]\n                                (contains? action :up) (map + [0 -10])\n                                (contains? action :left) (map + [-10 0])\n                                (contains? action :down) (map + [0 10])\n                                (contains? action :right) (map + [10 0]))]\n                 (merge entity {:velocity v}))))\n            \n            (contains? action :seek)\n            ((fn [entity] \n               (let [self entity\n                     target (app3.interface.player/target nil model self)]\n                 (let [dir (app3.tool/seek (:position self) (:position target))\n                       vel (app3.tool/makeLength 3 dir)]\n                   (if (< (app3.tool/length dir) 50)\n                     self\n                     (merge self {:velocity vel}))))))\n            \n            (contains? action :evade)\n            ((fn [entity]\n               (let [self entity\n                     target (app3.interface.player/target nil model self)]\n                 (let [dir (app3.tool/seek (:position target) (:position self))\n                       vel (app3.tool/makeLength 5 dir)]\n                   (merge self {:velocity vel})))))\n            \n            (contains? action :fire)\n            ((fn [entity]\n               (let [self entity\n                     weapon (:useWeapon self)]\n                 (if weapon\n                   (let [nextWeapon (app3.interface.weapon/fire weapon)\n                         isFireSuccess (not (= weapon nextWeapon))\n                         target (app3.interface.player/target nil model self)]\n                     (send [:fire self weapon isFireSuccess target] nil)\n                     (merge self {:useWeapon nextWeapon}))\n                   self))))\n            \n            (contains? action :seekWeapon)\n            ((fn [entity]\n               (let [weapons (filter (partial app3.tool/checkProperty [:position :weapon]) (:entities model))\n                     seekWeapon (first weapons)]\n                 (if seekWeapon\n                   (let [dir (app3.tool/seek pos (:position seekWeapon))\n                         vel (app3.tool/makeLength 5 dir)]\n                     (merge entity {:velocity vel}))\n                   (merge entity {:action (clojure.set/difference action #{:seekWeapon})})))))\n            \n            (contains? action :seekHealing)\n            ((fn [entity]\n               (let [healing (filter (partial app3.tool/checkProperty [:position :healing]) (:entities model))\n                     seekHealing (first healing)]\n                 (if seekHealing\n                   (let [dir (app3.tool/seek pos (:position seekHealing))\n                         vel (app3.tool/makeLength 5 dir)]\n                     (merge entity {:velocity vel}))\n                   (merge entity {:action (clojure.set/difference action #{:seekHealing})}))))))))\n"]}